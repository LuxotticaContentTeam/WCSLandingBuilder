var _dl={};function isUserAuthenticated(){var isAuthenticated="not authenticated";constants.ajaxParams.loggedIn&&(null!=document.cookie.match("WC_USERACTIVITY_")&&(isAuthenticated="authenticated"));return isAuthenticated}function getUserRegistrationStatus(){var isRegistered="undefined";constants.ajaxParams.loggedIn?isRegistered=null!=document.cookie.match("WC_USERACTIVITY_")?"registered":"not registered":isRegistered="not registered";return isRegistered}function getBasicDLObject(){return(_dl={authentication_status:"",registration_status:"",country:"us",page_layout:"desktop",language:"en"}).site_events={},_dl.authentication_status=isUserAuthenticated(),_dl.registration_status=getUserRegistrationStatus(),_dl}function callTrackAnalytics(_data){try{console.log("Before event is fired.");var _dataCopy=$.extend(!0,{},_data);_trackAnalytics(_dataCopy),console.log("After event is fired.")}catch(err){console.log("error")}}function fillProductDL(json){_dl.products=[];var glass={price:{}};$("#tah-quantity-header").text().trim();glass.id=productObj.id,glass.price.regular_unit_price=$("#pdp-frame-price").val(),glass.price.current_unit_price=$("#pdp-frame-price").val(),$("#discountPrice").length>0?(glass.price.regular_unit_price=""+(parseFloat(glass.price.regular_unit_price)+parseFloat($("#discountPrice").text().replace("$","").trim())),glass.price.unit_price_point="sale"):glass.price.unit_price_point="regular",glass.category=$.trim(productObj.category).toLowerCase(),glass.brand=$.trim(productObj.brand).toLowerCase(),glass.frame_fit=$.trim(productObj.frame_fit).toLowerCase(),glass.frame_shape=$.trim(productObj.frame_shape).toLowerCase(),glass.model=$.trim(productObj.model).toLowerCase(),glass.face_shape=""+$.trim($($(".face-shapes-list").find('li:not(".disabled")')).map((function(){return $.trim($(this).text())})).get().join(",")),glass.color=$.trim(productObj.color).toLowerCase(),glass.material=$.trim(productObj.material).toLowerCase(),""!=$(".bv-rating span").text()&&(glass.rating=$(".bv-rating span").text()),glass.product_available_online=$.trim(productObj.product_available_online).toLowerCase(),glass.product_lens_type_available=[],glass.product_lens_tint_available=[],null!=json&&$.each(json.lens_categories,(function(i,categ){glass.product_lens_type_available.push(categ.name),$.each(categ.lenses,(function(y,lens){"SUN"==categ.name.toUpperCase()&&$.each(lens.skus,(function(z,skus){-1==jQuery.inArray(skus.color,glass.product_lens_tint_available)&&glass.product_lens_tint_available.push(skus.color)}))}))})),_dl.products.push(glass)}function fillLensInfo(lensEl){try{lens={},_dl.products[0].applied_lenses=[],lens.id=""+$(lensEl).data("lensid"),lens.price={},lens.price.regular_unit_price=""+$(lensEl).data("listprice"),$($(lensEl).data("offerprice")).length>0?(lens.price.current_unit_price=""+parseInt($(lensEl).data("listprice"))-parseInt($(lensEl).data("offerprice"))+"",lens.price.unit_price_point="sale"):lens.price.unit_price_point="regular",lens.category=$(lensEl).data("category"),lens.tint="",_dl.products[0].applied_lenses.push(lens)}catch(e){console.log("fillLensInfo: "+e)}}function trackApplyLensToFrame(pdpLensInfo,selectedLensId,selectedSkuId){try{LC2.pdpUtils.getPropFromLensId(pdpLensInfo,"lens_sku_id",selectedLensId,selectedSkuId);var color=LC2.pdpUtils.getPropFromLensId(pdpLensInfo,"color",selectedLensId,selectedSkuId),lens_sku_code=LC2.pdpUtils.getPropFromLensId(pdpLensInfo,"lens_sku_code",selectedLensId,selectedSkuId),lens_saving=LC2.pdpUtils.getPropFromLensProduct(pdpLensInfo,"saving",selectedLensId),lens_listPrice=LC2.pdpUtils.getPropFromLensProduct(pdpLensInfo,"list_price",selectedLensId),lens_currentPrice=LC2.pdpUtils.getPropFromLensProduct(pdpLensInfo,"current_price",selectedLensId),lens_discounts=LC2.pdpUtils.getPropFromLensProduct(pdpLensInfo,"discounts",selectedLensId);_dl.products[0].applied_lenses=[];var appliedLens={};_dl.products[0].applied_lenses.push(appliedLens),appliedLens.id=lens_sku_code.toLowerCase();var pricePoint="regular";appliedLens.discounts=[],null!=lens_saving&&lens_saving>0?(pricePoint="sale",appliedLens.discounts=lens_discounts):lens_listPrice=lens_currentPrice,appliedLens.price={regular_unit_price:lens_listPrice,current_unit_price:lens_currentPrice,unit_price_point:pricePoint},utag_data.Products[utag_data.product_id].Price=(parseFloat(utag_data.Products[utag_data.product_id].Price)+parseFloat(lens_currentPrice)).toFixed(2)+"",appliedLens.category=lens_sku_code==$("#planoCodeSku").val()?"non-rx lens":"rx lens",appliedLens.color=color.toLowerCase(),appliedLens.tint=color.toLowerCase(),_dl.site_events={add_lenses:"true"},callTrackAnalytics(_dl)}catch(e){console.log("error in apply lens: "+e.stack)}}function trackEditLensInsideCart(pdpLensInfo,selectedLensId,selectedSkuId,indexEl){if(null!=pdpLensInfo){var _dlCopy=$.extend(!0,{},_dl),color=(LC2.pdpUtils.getPropFromLensId(pdpLensInfo,"lens_sku_id",selectedLensId,selectedSkuId),LC2.pdpUtils.getPropFromLensId(pdpLensInfo,"color",selectedLensId,selectedSkuId)),lens_sku_code=LC2.pdpUtils.getPropFromLensId(pdpLensInfo,"lens_sku_code",selectedLensId,selectedSkuId);try{var lens_saving=LC2.pdpUtils.getPropFromLensProduct(pdpLensInfo,"saving",selectedLensId),lens_listPrice=LC2.pdpUtils.getPropFromLensProduct(pdpLensInfo,"list_price",selectedLensId),lens_currentPrice=LC2.pdpUtils.getPropFromLensProduct(pdpLensInfo,"current_price",selectedLensId),lens_discounts=LC2.pdpUtils.getPropFromLensProduct(pdpLensInfo,"discounts",selectedLensId);void 0===_dlCopy.products&&(_dlCopy.products=[]),_dlCopy.products[0]=_dlCopy.products_in_cart[indexEl],_dlCopy.products[0].applied_lenses=[];var appliedLens={};_dlCopy.products[0].applied_lenses.push(appliedLens),appliedLens.id=lens_sku_code.toLowerCase();var pricePoint="regular";appliedLens.discounts=[],null!=lens_saving&&lens_saving>0?(pricePoint="sale",appliedLens.discounts=lens_discounts):lens_listPrice=lens_currentPrice,appliedLens.price={regular_unit_price:lens_listPrice,current_unit_price:lens_currentPrice,unit_price_point:pricePoint},appliedLens.category=lens_sku_code==$("#planoCodeSku").val()?"non-rx lens":"rx lens",appliedLens.color=color.toLowerCase(),appliedLens.tint=color.toLowerCase(),_dlCopy.site_events={edit_lens:"true"},callTrackAnalytics(_dlCopy)}catch(e){console.log("error in apply lens: "+e.stack)}}}