function WCService(properties){this.actionId=properties.actionId,this.failureHandler=properties.failureHandler,this.formId=properties.formId,this.id=properties.id,this.initProperties=properties.initProperties,this.successHandler=properties.successHandler,this.url=properties.url,this.validateForm=properties.validateForm,this.validateParameters=properties.validateParameters}function WCWidget(id,controllerId,widgetId){this.id=id,this.controllerId=controllerId,this.widgetId=widgetId,this.objectId=$("#"+this.id).attr("objectid"),this.controller=wc.render.getRefreshControllerById(controllerId),this.refresh=function(params){null==params&&(params={}),this.controller.refresh(this,params)}}function WCContext(id,properties,url){this.id=id,this.properties=properties||{},this.url=url,this.contextChangedEventName=id+"/RenderContextChanged",this.update=function(updates){if(this.url){for(var key in updates)updates[key]?this.properties[key]=updates[key]:delete this.properties[key];dojo.publish("ajaxRequestInitiated");var promise=$.ajax({url:this.url,data:properties,dataType:"json",type:"post",context:this});promise.done((function(data){if($.isArray(data.renderContextChanges)){for(var i=0;i<data.renderContextChanges.length;i++){var name=data.renderContextChanges[i];request.properties[name]=data[name]}dojo.publish(this.contextChangedEventName,[data])}})),promise.always((function(){dojo.publish("ajaxRequestCompleted")}))}else{console.debug("wc.render.updateContext - url not specified");var data={renderContextChanges:[]};for(var name in updates){var value=updates[name];value!=this.properties[name]&&(data.renderContextChanges.push(name),void 0===value?delete this.properties[name]:(this.properties[name]=value,data[name]=value,console.debug("updating render context: "+name+" = "+value)))}console.debug("publishing "+this.contextChangedEventName+" event"),dojo.publish(this.contextChangedEventName,[data])}}}function WCController(properties){this.id=properties.id,this.renderContext=properties.renderContext,this.url=properties.url,this.formId=properties.formId,this.modelChangedHandler=properties.modelChangedHandler,this.renderContextChangedHandler=properties.renderContextChangedHandler,this.postRefreshHandler=properties.postRefreshHandler,this.currentRCProperties={},this.getWidgets=function(){return $('[controllerId="'+this.id+'"]').map((function(){var $this=$(this);return new WCWidget(this.id,$this.attr("controllerId"),$this.attr("widgetId"))})).toArray()},this.renderContextChanged=function(message){var widgets=this.getWidgets();for(var i in widgets)this.renderContextChangedHandler(message,widgets[i]);this.syncRCProperties()},this.modelChanged=function(message){var widgets=this.getWidgets();for(var i in widgets)this.modelChangedHandler(message,widgets[i])},this.syncRCProperties=function(){if(this.renderContext){var properties={},rc=this.renderContext.properties;for(var prop in rc)properties[prop]=rc[prop];this.currentRCProperties=properties}},this.testForChangedRC=function(propertyNames){for(var change=!1,i=0;i<propertyNames.length;i++){var prop=propertyNames[i];if(this.currentRCProperties[prop]!=this.renderContext.properties[prop]){change=!0;break}}return change},this.refresh=function(widget,parameters){parameters||(parameters={});var formNode=null;if(this.formId){for(var formData=$("#"+this.formId).serializeArray(),i=0;i<formData.length;i++){var d=formData[i];parameters[d.name]=d.value}formNode=document.getElementById(this.formId)}parameters.requesttype||(parameters.requesttype="ajax"),this.url=this.url.replace(/amp;/g,""),dojo.publish("ajaxRequestInitiated");var promise=$.ajax({url:this.url,data:parameters,dataType:"text",type:"post",context:this});promise.done((function(data){function getIds(idType,controllerURL){var myId="";if(parameters&&parameters[idType]&&(myId=parameters[idType]),""==myId&&null!=formNode&&formNode[idType]&&(myId=formNode[idType],null!=formNode[idType].value&&(myId=formNode[idType].value)),""==myId&&controllerURL){var temp=controllerURL;if(-1!=temp.indexOf(idType))myId=(temp=temp.substring(temp.indexOf(idType))).split("&")[0].split("=")[1]}return myId}var storeId=getIds("storeId",this.url),catalogId=getIds("catalogId",this.url),langId=getIds("langId",this.url),errorCodeBegin=data.indexOf("errorCode");if(-1!=errorCodeBegin){var errorCodeEnd=data.indexOf(",",errorCodeBegin),errorCodeString=data.substring(errorCodeBegin,errorCodeEnd);console.debug("error condition encountered - error code: "+errorCodeString),-1!=errorCodeString.indexOf("2550")?(console.debug("error type: ERR_DIDNT_LOGON - the customer did not log on to the system."),console.debug("redirecting to URL: AjaxLogonForm?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId+"&myAcctMain=1"),document.location.href="AjaxLogonForm?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId+"&myAcctMain=1"):-1!=errorCodeString.indexOf("2510")?(console.debug("error type: ERR_SESSION_TIMEOUT - use session has timed out"),console.debug("redirecting to URL: Logoff?URL=ReLogonFormView&storeId="+storeId),document.location.href="Logoff?URL=ReLogonFormView&storeId="+storeId):-1!=errorCodeString.indexOf("2520")?(console.debug("error type: ERR_PROHIBITED_CHAR - detected prohibited characters in request"),console.debug("redirecting to URL: ProhibitedCharacterErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId),document.location.href="ProhibitedCharacterErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId):-1!=errorCodeString.indexOf("2540")?(console.debug("error type: ERR_CSRF - cross site request forgery attempt was detected"),console.debug("redirecting to URL: CrossSiteRequestForgeryErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId),document.location.href="CrossSiteRequestForgeryErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId):-1!=errorCodeString.indexOf("CMN1039E")&&(console.debug("error type: _ERR_INVALID_COOKIE - cookie error was detected"),console.debug("redirecting to URL: CookieErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId),document.location.href="CookieErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId)}else{var controller=widget.controller;console.debug("RefreshController.refresh - calling refreshHandler for "+widget);var $rootScope=angular.element(document.body).scope().$root;void 0!==$rootScope&&null!=$rootScope.wrapAngular&&"function"==typeof $rootScope.wrapAngular?$rootScope.wrapAngular($("#"+widget.id).html(data)):$("#"+widget.id).html(data),null!=controller.postRefreshHandler&&(console.debug("RefreshController.refresh - calling postRefreshHandler for "+widget),controller.postRefreshHandler(widget))}})),promise.always((function(){dojo.publish("ajaxRequestCompleted")}))},$.isFunction(this.renderContextChangedHandler)&&this.renderContext&&dojo.subscribe(this.renderContext.contextChangedEventName,this,"renderContextChanged"),$.isFunction(this.modelChangedHandler)&&dojo.subscribe("modelChanged",this,"modelChanged")}function filterAjaxResponse(responseText){var resp=responseText;try{resp=$.parseJSON(resp.replace(/^\s*\/\*/,"").replace(/\*\/\s*$/,""))}catch(e){console.debug(e)}return resp}function parseWidget(){}dojo={channels:{},channelContexts:{},addClass:function(el,val){"string"==typeof el?$("#"+el).addClass(val):$(el).addClass(val)},addOnLoad:function(f){$(document).ready(f)},attr:function(el,attrName,value){var $el;return($el="string"==typeof el?$("#"+el):$(el)).attr.apply($el,[attrName,value])},back:{init:function(){},setInitialState:function(){}},byId:function(id){return"string"==typeof id?document.getElementById(id):$(id)[0]},connect:function(el,eventType,callback){eventType=eventType.replace("on","");("string"==typeof el?$("#"+el):$(el)).bind(eventType,callback)},cookie:function(){return $.cookie.apply(window,arguments)},dnd:{Moveable:function(){return{}},Source:function(){return{copyOnly:!1,setItem:function(){}}}},isArray:function(obj){return $.isArray(obj)},keys:{BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,META:224,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,HELP:47,LEFT_WINDOW:91,RIGHT_WINDOW:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_PLUS:107,NUMPAD_ENTER:108,NUMPAD_MINUS:109,NUMPAD_PERIOD:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,NUM_LOCK:144,SCROLL_LOCK:145,copyKey:17},parser:{instantiate:function(){}},publish:function(channel,params){var c=this.channels[channel],cc=this.channelContexts[channel];null==c&&(c=[],cc=[]),null==params&&(params=[]);for(var i=0;i<c.length;i++){var fn=c[i],ctx=cc[i];"function"==typeof fn?fn.apply(ctx,params):window[fn]?window[fn].apply(ctx,params):ctx[fn].apply(ctx,params)}},query:function(selector,el){var results=[];return null==el?results=$(selector).toArray():"string"==typeof el?results=$(selector,"#"+el).toArray():"object"==typeof el&&(results=$(selector,el).toArray()),results.forEach=function(fn){$.each(results,(function(index,element){fn.apply(element,[element,index])}))},results},registerModulePath:function(){},removeClass:function(el,val){"string"==typeof el?$("#"+el).removeClass(val):$(el).removeClass(val)},require:function(){},style:function(id,prop,value){$("#"+id).css(prop,value)},subscribe:function(channel,ctx,fn){var c=this.channels[channel],cc=this.channelContexts[channel];null==c&&(this.channels[channel]=[],this.channelContexts[channel]=[],c=this.channels[channel],cc=this.channelContexts[channel]),null==fn?(c.push(ctx),cc.push(window)):(c.push(fn),cc.push(ctx))},trim:function(val){return $.trim(val)}},wc={service:{servicesMap:{},declare:function(properties){var s=new WCService(properties);return this.servicesMap[s.id]=s,s},getServiceById:function(serviceId){return this.servicesMap[serviceId]},invoke:function(serviceId,parameters){var service=this.servicesMap[serviceId],promise=null;if(service){var data=parameters;if(parameters instanceof Array)for(var key in data={},parameters)data[key]=parameters[key];else null==parameters&&(data={});if(service.formId&&""!=service.formId)for(var formData=$("#"+service.formId).serializeArray(),i=0;i<formData.length;i++){var d=formData[i];data[d.name]=d.value}(promise=$.ajax({url:service.url,data:data,dataType:"text",traditional:!0,type:"post"})).done((function(response){var serviceResponse=filterAjaxResponse(response);if(null==serviceResponse||!serviceResponse.errorMessage&&!serviceResponse.errorMessageKey){if(service.successHandler){service.successHandler.apply(ServicesDeclarationJS,[serviceResponse]);var modelChangedMessage=$.extend(!0,{},serviceResponse);modelChangedMessage.actionId=service.actionId,modelChangedMessage.serviceId=service.serviceId,dojo.publish("modelChanged",[modelChangedMessage]),service.actionId&&(console.debug("success: publishing modelChanged/"+service.actionId+" event"),dojo.publish("modelChanged/"+service.actionId,[modelChangedMessage]))}}else{var storeId=ServicesDeclarationJS.storeId,catalogId=ServicesDeclarationJS.catalogId,langId=ServicesDeclarationJS.langId;if("2500"==serviceResponse.errorCode)myURL="LogonForm?nextUrl="+(myURL=(myURL=(myURL=(myURL=(myURL=serviceResponse.originatingCommand).replace("?","%3F")).replace(/&amp;/g,"%26")).replace(/&/g,"%26")).replace(/=/g,"%3D"))+"&storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId+"&myAcctMain=1",console.debug("error type: ERR_USER_NOT_LOGGED_ON - only registered user can invoke the command"),console.debug("redirecting to URL: "+myURL),document.location.href=myURL;else if("2550"==serviceResponse.errorCode){myURL="AjaxLogonForm?nextUrl="+(myURL=(myURL=(myURL=(myURL=(myURL=serviceResponse.originatingCommand).replace("?","%3F")).replace(/&amp;/g,"%26")).replace(/&/g,"%26")).replace(/=/g,"%3D"))+"&storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId+"&myAcctMain=1",console.debug("error type: ERR_DIDNT_LOGON - the customer did not log on to the system."),console.debug("redirecting to URL: "+myURL),document.location.href=myURL}else if("2530"==serviceResponse.errorCode){var myURL;myURL="PasswordReEnterErrorView?nextUrl="+(myURL=(myURL=(myURL=(myURL=(myURL=serviceResponse.originatingCommand).replace("?","%3F")).replace(/&amp;/g,"%26")).replace(/&/g,"%26")).replace(/=/g,"%3D"))+"&storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId,console.debug("error type: ERR_PASSWORD_REREQUEST - password is required"),console.debug("redirecting to URL: "+myURL),document.location.href=myURL}else"2510"==serviceResponse.errorCode?(console.debug("error type: ERR_SESSION_TIMEOUT - use session has timed out"),console.debug("redirecting to URL: Logoff?URL=ReLogonFormView&storeId="+storeId),document.location.href="Logoff?URL=ReLogonFormView&storeId="+storeId):"2520"==serviceResponse.errorCode?(console.debug("error type: ERR_PROHIBITED_CHAR - detected prohibited characters in request"),console.debug("redirecting to URL: ProhibitedCharacterErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId),document.location.href="ProhibitedCharacterErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId):"2540"==serviceResponse.errorCode?(console.debug("error type: ERR_CSRF - cross site request forgery attempt was detected"),console.debug("redirecting to URL: CrossSiteRequestForgeryErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId),document.location.href="CrossSiteRequestForgeryErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId):"CMN1039E"==serviceResponse.errorCode?(console.debug("error type: _ERR_INVALID_COOKIE - cookie error was detected"),console.debug("redirecting to URL: CookieErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId),document.location.href="CookieErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId):(console.debug("calling service.failureHandler"),service.failureHandler(serviceResponse))}})),promise.fail((function(response){var serviceResponse=filterAjaxResponse(response);service.failureHandler&&service.failureHandler.apply(ServicesDeclarationJS,[serviceResponse])})),promise.always((function(){dojo.publish("ajaxRequestCompleted")}))}return promise}},render:{contexts:{},controllers:{},declareRefreshController:function(properties){var controller=new WCController(properties);return this.controllers[controller.id]=controller,controller},getRefreshControllerById:function(id){return this.controllers[id]},declareContext:function(id,properties,updateContextURL){if(null==this.contexts[id]||""==this.contexts[id])return this.contexts[id]=new WCContext(id,properties,updateContextURL),this.contexts[id]},getContextById:function(id){return this.contexts[id]},updateContext:function(id,updates){this.contexts[id].update(updates)}}},dijit={byNode:function(){return{}},byId:function(){},registry:{byClass:function(){return{forEach:function(){}}}},Tooltip:function(){}},CommonControllersDeclarationJS={setControllerURL:function(){}};