function saveInsuranceSingle(i,exams){var f=$("#formApptConfirm_"+i);$.ajax({url:f.attr("action"),data:f.serialize(),dataType:"json",type:"post",complete:function(response){try{"true"==$.parseJSON(response.responseText).success?i<exams?saveInsuranceSingle(i+1,exams):window.location.href=$("#InsuranceConfirmationURL").val():$("#apptConfirmErrorSection").text(constants.error.ajax).fadeIn(500)}catch(err){$("#apptConfirmErrorSection").text(constants.error.ajax).fadeIn(500)}}})}function customSignInModalLinkClick(signInModal){return $(".examRegisterSection, #signInModalLink, .ForgotPasswordSection").hide(),$("#createAccountModalLink, #examSignInSection").show(),signInModal.filter(":not(.registerAfterOffersModal)").dialog("open"),$(".signInEmail").focus(),$("#ui-dialog-title-examSignInModal").remove(),!1}function examLogonFormSubmitCheckout(logonForm){var logonFromPopup=document.getElementById("ScheduleExamLoginForm").getElementsByClassName("signInEmail").value,f=$(logonForm);if(utag_data.form_name="exam logon",utag_data.form_field=error_list,f.valid()){for(var data=f.serializeArray(),newData=[],originalURL=null,i=0;i<data.length;i++){var d=data[i];"URL"==d.name?(originalURL=d.value,newData.push({name:"URL",value:"LogonAjaxView"})):newData.push(d)}$.ajax({url:getAbsoluteURL(!0)+"LogonAjax",data:newData,type:"POST",dataType:"json",success:function(data){if(data.passwordExpired&&"1"==data.passwordExpired)$("#examSignInSection").css("display","none").attr("aria-hidden","true"),$(".header-set-a-new-password-modal").attr("aria-hidden","true").css("display","block"),obj={id:"Error",Error_Source:"User",Error_Code:"Login",Error_Message:"Your password has expired"},tealium_data2track.push(obj);else if(data.success){utagData={site_events:{authentication_complete:!0},authentication_status:"authenticated",registration_status:"registered"},callTrackAnalytics(utagData);try{if(window.loginFlowHandler)window.loginFlowHandler.onSuccess(),$(".examSignInModal").dialog("close");else if(document.getElementById("userRegModelFormExam"))$(".examSignInModal").dialog("close"),document.getElementById("userRegModelFormExam").closest("div").style.display="none","true"!=data.syncValueForSignedIn?(document.getElementById("consentFormStepfour").style.display="block",document.getElementById("logonId").value=logonFromPopup):document.getElementById("manageExams").style.display="block",$(".step3_details2").css("display","none");else{var nextUrl=originalURL;nextUrl.length&&"#"==nextUrl.charAt(nextUrl.length-1)&&(nextUrl=nextUrl.substring(0,x.length-1)),window.location=nextUrl}}catch(err){obj={id:"Error",Error_Source:"Server",Error_Code:"Login",Error_Message:"Sign up Request Failed"},tealium_data2track.push(obj)}}else{var errMsg=data.errorMessage;"EXIST_IN_US"==errMsg?($(".examLogOnFailureResponseMessageDiv").html(MessageHelper.messages.ERR_MSG_DID_YOU_MEAN),$(".examLogOnFailureResponseMessageDiv").append("<a target='_blank' href='"+MessageHelper.messages.RediectHomePageURL+"'>"+MessageHelper.messages.LenscrafterUS+"</a>?")):"EXIST_IN_CA"==errMsg?($(".examLogOnFailureResponseMessageDiv").html(MessageHelper.messages.ERR_MSG_DID_YOU_MEAN),$(".examLogOnFailureResponseMessageDiv").append("<a target='_blank' href='"+MessageHelper.messages.RediectHomePageURL+"'>"+MessageHelper.messages.LenscrafterCA+"</a>?")):$(".examLogOnFailureResponseMessageDiv").html(errMsg),obj={id:"Error",Error_Source:"User",Error_Code:"Form Filling Error - Login",Error_Details:errMsg,Error_Message:errMsg},tealium_data2track.push(obj)}},error:function(jqXHR,textStatus,errorThrown){$(".examLogOnFailureResponseMessageDiv").html("Login request failed - please try again later.")}})}return!1}$(document).ready((function(){CoreFunctionality.setupAjaxEventHandlers(),CoreFunctionality.setupBasicModals(),CoreFunctionality.setupRegistrationValidation(),CoreFunctionality.setupRegistrationModal(),CoreFunctionality.setupDoctorInfoModal(),CoreFunctionality.setupContactInfoSection(),CoreFunctionality.setupChangeLocationForm(),CoreFunctionality.setupAddExamButton();try{storeLocatorJS&&CoreFunctionality.setupPreferredStore()}catch{}CoreFunctionality.setupEmailCapture(),CoreFunctionality.locationDetailsAjaxCall(),CoreFunctionality.eyeExamAvailablityAjaxCall(),CoreFunctionality.checkEyeExamCount(),$(".sign-in-modal-exam-cancel").on("click",(function(){$(".examSignInModal").dialog("close")})),$(".registration-modal-submit").on("click",(function(){var f=$("#ScheduleExamSignInForm");return f.valid(),f.submit(),!1}))})),CoreFunctionality={setupAjaxEventHandlers:function(){var cf=this;if($(".examModule a.eyeExamRemoveExam").on("click",(function(){$(this);var parent=$(this).closest(".examModule"),examNumber=parent.find("input[name=examNumber]").val();if(examNumber=examNumber.length?parseInt(examNumber):0){var lockId=parent.find("input[name=lockId]").val();cf.removeExam(examNumber,lockId),1==examNumber&&document.getElementsByClassName("each-exam").length<=2&&($(".book-exams").addClass("disabled"),$(".book-exams").click((function(e){e.preventDefault();try{var obj={id:"WCS-D-Exam-Funnel-Confirmation"}}catch(err){obj={id:"WCS-D-Exam-Funnel-Confirmation-Error",Error_Source:"Server",Error_Code:"utag_data syntax - "+err.message};tealium_data2track.push(obj)}finally{obj.id="WCS-D-Exam-Funnel-Confirmation",tealium_data2track.push(obj)}})))}if($(".addAnotherExam").hasClass("disabled")&&$(".addAnotherExam").removeClass("disabled"),3==$(".examModule").length){$(".book-exams").html("<span>Book my exam</span>"),$(".texasLocationInstructions p.subtext").css("marginTop","60px");var copy=$(".will-change").html();copy=copy.replace("Book Exams","Book Exam"),$(".will-change").html(copy)}return updateBookButton(!0),!1})),$("#exam-content-"+$(".focusExam").val()).parents(".each-exam").remove(),null!=document.getElementById("InfoToPopulate"))for(var htmlObj=document.getElementById("InfoToPopulate").innerHTML,currentId=1;currentId<=3;currentId++)document.getElementById("AjaxToRender-"+currentId).innerHTML=htmlObj.replace(/each-exam/g,"copied-each-exam")},setupBasicModals:function(){$("[data-modal-id]").click((function(){var modalId="#"+$(this).attr("data-modal-id");return $(modalId).dialog({modal:!0}),!1}))},setupRegistrationValidation:function(){var examLogonParameters=$.extend(!0,{},window.logonParameters),examRegisterParameters=$.extend(!0,{},window.registerParameters);examRegisterParameters.rules={logonId:{required:!0,email:!0},logonIdVerify:{required:!0,email:!0,equalTo:"#ScheduleExamSignInForm input[name=logonId]"},logonPassword:{required:!0,minlength:6},logonPasswordVerify:{required:!0,equalTo:"#ScheduleExamSignInForm input[name=logonPassword]"},optin_18yrs:{required:!0}},examRegisterParameters.messages={logonId:{required:MessageHelper.messages.ERROR_Logon_model_EmailEmpty,email:MessageHelper.messages.ERROR_Logon_model_EmailInvalid},logonIdVerify:{required:MessageHelper.messages.ERROR_LOGON_MODEL_EMAIL_CONFIRM,email:MessageHelper.messages.ERROR_LOGON_MODEL_EMAIL_CONFIRM,equalTo:MessageHelper.messages.ERROR_EMAIL_MISMATCH},logonPassword:{required:MessageHelper.messages.ERROR_PASSWORD_ENTER},logonPasswordVerify:{required:MessageHelper.messages.ERROR_PASSWORD_RE_ENTER,equalTo:MessageHelper.messages.ERROR_PASSWORD_MISMATCH},optin_18yrs:{required:MessageHelper.messages.EYE_EXAM_ERROR_NOT_18_YEARS_OLD}},examLogonParameters.rules={logonId:{required:!0,email:!0},logonPassword:{required:!0}},examLogonParameters.messages={logonId:{required:MessageHelper.messages.ERROR_Logon_model_EmailInvalid},logonPassword:{required:MessageHelper.messages.ERROR_PASSWORD_ENTER}},examLogonParameters.submitHandler=window.examLogonFormSubmitCheckout,examRegisterParameters.submitHandler=window.registerFormSubmit;try{$("#ScheduleExamLoginForm").validate(examLogonParameters),$("#ScheduleExamSignInForm").validate(examRegisterParameters),$("#ScheduleExamSignInForm").find('input[type="checkbox"]').on("keyup",(function(e){13==e.keyCode&&registerFormSubmit($(this).closest("form"))}))}catch(e){-1==window.location.href.indexOf("ScheduleExamView")?console.error("Logged: "+e):console.log("OEE - No need to setup validation")}},setupRegistrationModal:function(){try{var signInModal=$(".examSignInModal");signInModal.dialog({modal:!0,width:362,height:385,autoOpen:!1,open:function(){signInModal.find("form").each((function(){$(this).validate().resetForm()})),$("html,body").toggleClass("hidden-overflow")},close:function(event){clearRegErrorMessages(),$("html,body").toggleClass("hidden-overflow"),event.currentTarget&&window.loginFlowHandler&&window.loginFlowHandler.onCancel()},create:function(event,ui){var dialogTitle=$(this).dialog("option","title"),dialog=$(this).dialog("widget");dialog.attr("role","complementary"),void 0!==dialogTitle&&""!=dialogTitle||dialog.attr("aria-label","Exam Signin Modal").removeAttr("aria-labelledby"),$(".ui-dialog-titlebar-close",dialog).text("").addClass("extra-class")}}),signInModal.find("input[name=URL]").val(document.location.href),$("#ScheduleExamLoginForm .forgotPasswordLink").click((function(){tealium_data2track.push({id:"Click",data_element_id:"ForgotPassword"}),0==$(".header-reset-password-modal").length&&$(".reset-password-info").toggleClass("hidden")})),$("#createAccountModalLink, #createAccountModalLink2").click((function(){return $("#examSignInSection, #createAccountModalLink, .ForgotPasswordSection").hide(),$("#signInModalLink, .examRegisterSection").show(),signInModal.dialog("open"),$(".createEmailAccount").focus(),$("#ui-dialog-title-examSignInModal").remove(),!1})),$("#signInModalLink").click((function(){return $(".examRegisterSection, #signInModalLink, .ForgotPasswordSection").hide(),$("#createAccountModalLink, #examSignInSection").show(),signInModal.dialog("open"),$(".signInEmail").focus(),$("#ui-dialog-title-examSignInModal").remove(),!1})),$("#examForgotPasswordLink").click((function(){return $("#examSignInSection, #createAccountModalLink").hide(),$(".ForgotPasswordSection").show(),!1})),$(".exam-close-reset-password").on("click",(function(e){e.preventDefault(),$(".ForgotPasswordSection").hide(),$("#examSignInSection").show()})),$(document).on("click",".eyeExamSigninLink",(function(){var _dlCopy=$.extend(!0,{},_dl);return _dlCopy.site_events={sign_in_click:"true"},callTrackAnalytics(_dlCopy),$("#ScheduleExamLoginForm")[0].reset(),$(".examLogOnFailureResponseMessageDiv").html(""),customSignInModalLinkClick(signInModal),utag_data.form_name="login",utag_data.form_field=error_list,$(".signInEmail").focus(),!1})),$("#eyeExamRegisterLink").click((function(){return $("#createAccountModalLink, #createAccountModalLink2").click(),$(".createEmailAccount").focus(),utag_data.form_name="register",utag_data.form_field=error_list,!1})),$("#examPasswordResetSubmitButton").click((function(){if($("#examResetPasswordForm").valid()){var resetForm=document.examResetPasswordForm,params={};params.challengeAnswer=resetForm.challengeAnswer.value,params.state=resetForm.state.value,params.URL=resetForm.URL.value,params.errorViewName=resetForm.errorViewName.value,params.logonId=resetForm.logonId.value,params.email1=resetForm.logonId.value,params.emailType="forgotpassword",params.senderEmail=resetForm.logonId.value,params.senderName=resetForm.logonId.value,params.email1=resetForm.logonId.value,params.receiveEmail="true",params.recipientEmail=resetForm.logonId.value,params.receiveEmail="true",params.fromName=resetForm.logonId.value,params.pdp_18yrs="true",invokeResetPasswordService(params,!0)}return!1})),$(".examSignInModal .cancel").not(".exam-close-reset-password").click((function(e){e.preventDefault(),signInModal.dialog("close")})),$("#examResetPasswordForm").validate({onfocusout:!1,onkeyup:!1,onclick:!1,errorClass:"required",errorElement:"span",rules:{logonId:{required:!0,email:!0}},messages:{logonId:{required:MessageHelper.messages.ERROR_Logon_model_EmailInvalid,email:MessageHelper.messages.ERROR_Logon_model_EmailInvalid}}})}catch(e){-1==window.location.href.indexOf("ScheduleExamView")?console.error("Logged: "+e):console.log("OEE - No need to setup account modal")}},setupDoctorInfoModal:function(){$("body").on("click","[data-store-number]",(function(){var $this=$(this),storeNumber=$this.attr("data-store-number"),isOnline=$this.attr("data-online"),hasOnlineScheduling=!1,hours=$this.attr("data-store-hours");isOnline&&"true"==isOnline&&(hasOnlineScheduling=!0);var data={storeId:constants.ajaxParams.storeId,langId:constants.ajaxParams.langId,catalogId:constants.ajaxParams.catalogId,storeNumber:storeNumber,online:hasOnlineScheduling,isIframe:constants.ajaxParams.isIframe,storeHours:hours};return $.ajax({url:getAbsoluteURL()+"AjaxDoctorInfoView",data:$.param(data),dataType:"html",type:"post",complete:function(response){try{var responseHTML=response.responseText;$(".doctorInformationModalContent").html(responseHTML),$(".doctorInformationModal").dialog({modal:!0,width:680,zIndex:9999,position:["center","center"],open:function(event,ui){$(".doctorInformationModalContent").find("#doctor-accordion").accordion({active:!1,collapsible:!0,autoHeight:!1,change:function(event,ui){$("#doctor-accordion").css("top","0px")}}),$(".doctorInformationModal").parent(".ui-dialog").addClass("no-padding"),$(".doctorInformationModal").siblings(".ui-dialog-titlebar").css("z-index","200011")}}),$(".doctorInformationModal").removeClass("hide")}catch(err){MessageHelper.displayErrorMessage(constants.error.ajax)}}}),!1}))},setupChangeLocationForm:function(){try{$("#examChangeLocationForm").validate({onfocusout:!1,onkeyup:!1,onclick:!1,errorClass:"required",errorElement:"span",rules:{locationEntry:{required:!0,antipattern:otherCountryZipPattern}},messages:{locationEntry:{required:MessageHelper.messages.ERROR_SearchBoxEmpty,antipattern:MessageHelper.messages.STORE_FINDER_ZIP_COUNTRY_MISMATCH}},errorPlacement:function(error,element){$(error).insertAfter('#examChangeLocationForm input[type="submit"]')},submitHandler:function(){performGeocode($("#locationEntry").val(),"CoreFunctionality.performStoreSearch")}})}catch(e){-1==window.location.href.indexOf("ScheduleExamView")?console.error("Logged: "+e):console.log("OEE - No need to setup change location form")}},performStoreSearch:function(response){for(var paramString="",i=0;i<response.results[0].locations.length;i++)paramString=paramString+response.results[0].locations[i].latLng.lat+"|"+response.results[0].locations[i].latLng.lng,i!=response.results[0].locations.length-1&&(paramString+=",");$("#examChangeLocationForm").find("input[name=latLong]").val(paramString);var data=$("#locationEntry").val();document.cookie="lc_lastValidStoreSearch="+data+"; path=/",$("#examChangeLocationForm")[0].submit()},locationDetailsAjaxCall:function(){$("body").on("click","[data-loc-store-number]",(function(){console.log("in the second function");var $this=$(this),storeNumber=$this.attr("data-loc-store-number"),storeName=$this.attr("data-loc-store-name"),hours=$this.attr("data-loc-store-hours"),data={storeId:constants.ajaxParams.storeId,langId:constants.ajaxParams.langId,catalogId:constants.ajaxParams.catalogId,storeNumber:storeNumber,storeName:storeName,hours:hours,isIframe:constants.ajaxParams.isIframe};return $.ajax({url:getAbsoluteURL()+"AjaxLocationDetailsView",data:$.param(data),dataType:"html",type:"post",complete:function(response){try{var responseHTML=response.responseText;$(".doctorInformationModalContent").html(responseHTML),$(".doctorInformationModal").dialog({modal:!0,width:680,zIndex:9999,position:["center","center"],open:function(event,ui){$(".doctorInformationModalContent").find("#doctor-accordion").accordion({active:!1,collapsible:!0,autoHeight:!1,change:function(event,ui){$("#doctor-accordion").css("top","0px")}}),$(".doctorInformationModal").parent(".ui-dialog").addClass("no-padding"),$(".doctorInformationModal").siblings(".ui-dialog-titlebar").css("z-index","200011")},dialogClass:"no-padding"}),$accordion=$("#doctor-accordion"),$accordion&&$accordion.accordion({active:!1}),$(".doctorInformationModal").removeClass("hide")}catch(err){MessageHelper.displayErrorMessage(constants.error.ajax)}}}),!1}))},eyeExamAvailablityAjaxCall:function(){$(".eye-exam-availablity").each((function(){var $this=$(this),storeNumber=$this.attr("data-storeid"),date=new Date,year=date.getFullYear(),month=(1+date.getMonth()).toString();month=month.length>1?month:"0"+month;var day=date.getDate().toString(),currentDate=month+"/"+(day=day.length>1?day:"0"+day)+"/"+year,data={storeId:constants.ajaxParams.storeId,langId:constants.ajaxParams.langId,catalogId:constants.ajaxParams.catalogId,storeNumber:storeNumber,requestedDate:currentDate};$.ajax({url:getAbsoluteURL()+"AjaxGetAppointmentListCmd",data:$.param(data),dataType:"json",type:"post",complete:function(response){var available=0;console.log("available: "+available);var examsAvailable="";try{var responseJSON=response.responseText,apptsObj=JSON.parse(responseJSON),totalAppts=apptsObj.data.appts.length,responseBlockedDates=apptsObj.data.blockedDates;available=totalAppts,-1!=responseBlockedDates.search(currentDate)&&(available=0),available>1?(examsAvailable=" Eye exams* available today",$this.show()):1==available&&(examsAvailable=" Eye exam* available today",$this.show()),$this.text(available+examsAvailable)}catch(err){available>1?examsAvailable=" Eye exams* available today":1==available?examsAvailable=" Eye exam* available today":0==available&&$this.hide(),$this.text(available+examsAvailable)}}})}))},removeExam:function(examNumber,lockId){eyeExamRemoveEyeExamAnalytics();var data={lockId:lockId,storeId:constants.ajaxParams.storeId,langId:constants.ajaxParams.langId,storeNumber:$(".storeNumber").val()};$.ajax({url:getAbsoluteURL()+"AjaxReleaseLockCmd",data:data,dataType:"json",type:"post",complete:function(response){try{if("Success"==$.parseJSON(response.responseText).status){if($(".examModule input[name=examNumber]").each((function(){if(this.value==examNumber){var exam=$(this).closest(".each-exam");exam.fadeOut(500,(function(){if(exam.remove(),$(".lockedExamSection .each-exam").eq(0).find(".examNumber").html("EXAM One"),$(".lockedExamSection .each-exam").eq(1).find(".examNumber").html("EXAM TWO"),$(".lockedExamSection .each-exam").eq(2).find(".examNumber").html("EXAM Three"),$("#InfoToPopulate").length)for(var htmlObj=$("#InfoToPopulate").html(),currentId=1;currentId<=3;currentId++){$("#AjaxToRender-"+currentId).html(htmlObj.replace(/each-exam/g,"copied-each-exam"))}try{$("#activeLockIds").val($("#activeLockIds").val().replace(lockId," "))}catch(e){console.error(e)}}))}})),ExamPersistence.clearExamData(examNumber),$(".copied-each-exam:visible").length<=1&&$("#examForm-3 .AddAnotherExamLink").show(),$(".lockedExamSection .each-exam:visible").length<=3&&$(".AddAnotherExamLink").show(),"0"==$(".copied-each-exam:visible").length)try{$(".EyeExamStepsCount .remove-exam-scehdule").hide()}catch(e){console.error(e)}if("3"==$(".currentEyeExamStep").val()){var addLink=$(".AddAnotherExamLink"),addUrl=addLink.attr("href"),nextExam=ExamPersistence.getNextAvailableExam();if(nextExam>=1){addUrl=addUrl.replace(/focusExam=\d*/,"focusExam="+nextExam);addLink.attr("href",addUrl)}}try{findAllExamNames()}catch(e){}document.getElementsByClassName("each-exam").length<1&&(document.getElementById("toShowIncaseNoExams").style.display="block",$("#bookEyeExambutton").removeClass("new-style-orange-button").addClass("new-style-orange-button-disabled"));try{document.getElementById("activeLockIds").value=document.getElementById("activeLockIds").value.replace(lockId," "),""==document.getElementById("activeLockIds").value.trim()&&(document.getElementById("BackbuttonLink").style.display="none",document.getElementById("bookEyeExambutton").style.display="none")}catch(e){}}}catch(e){}}});$("#examForm-"+examNumber).find("#firstName").val(""),$("#examForm-"+examNumber).find("#lastName").val(""),$("#dobMonth_"+examNumber).find("option:first").attr("selected","selected"),$("#dobDay_"+examNumber).find("option:first").attr("selected","selected"),$("#dobYear_"+examNumber).find("option:first").attr("selected","selected")},setupAddExamButton:function(){"3"==$(".currentEyeExamStep").val()&&$(".AddAnotherExamLink").on("click",(function(){return ExamPersistence.hasAvailableExam()})).hover((function(){ExamPersistence.hasAvailableExam()||$(".examLimitReached").css("visibility","visible")}),(function(){$(".examLimitReached").css("visibility","hidden")}))},setupContactInfoSection:function(){var contactInfoSection=$("#contactInfoModule"),phone11=contactInfoSection.find("[name=phone1_1]"),phone12=contactInfoSection.find("[name=phone1_2]"),phone13=contactInfoSection.find("[name=phone1_3]");contactInfoSection.find(".edit").click((function(){if(""==contactInfoSection.find("[name=phone1_1]").val()){var currentPhone=contactInfoSection.find("[name=phoneNumber]").val();if(""!=currentPhone&&4==(currentPhone=currentPhone.match(/\((\d{3})\)(\d{3})-(\d{4})/)).length){var phone1=currentPhone[1],phone2=currentPhone[2],phone3=currentPhone[3];contactInfoSection.find("[name=phone1_1]").val(phone1),contactInfoSection.find("[name=phone1_2]").val(phone2),contactInfoSection.find("[name=phone1_3]").val(phone3)}}return $("#contactInfoDisplaySection, #contactInfoEditSection").toggle(),!1})),contactInfoSection.find(".save").click((function(){if(!constants.ajaxParams.loggedIn)for(var patientIds=contactInfoSection.find("[name=patientId]").val(""),i=1;i<=3;i++){var d=ExamPersistence.getExamData(i);d&&d.patientId&&patientIds.eq(i-1).val(d.patientId)}return contactForm.submit(),!1}));try{var contactForm=$("#contactInfoEditForm");contactForm.validate({ignore:"[name=contacts]:hidden",onfocusout:!1,onkeyup:!1,onclick:!1,errorClass:"required",errorElement:"span",rules:{email1:{required:!0,email:!0},phone1_1:{required:!0,minlength:3},phone1_2:{required:!0,minlength:3},phone1_3:{required:!0,minlength:4}},messages:{email1:MessageHelper.messages.EXAM_VAL_EMAIL,phone1_1:MessageHelper.messages.EXAM_VAL_PHONE,phone1_2:MessageHelper.messages.EXAM_VAL_PHONE,phone1_3:MessageHelper.messages.EXAM_VAL_PHONE},errorPlacement:function(error,element){for(var noErrorElements=["phone1_1","phone1_2","phone1_3"],found=!1,i=0;i<noErrorElements.length;i++)found=found||noErrorElements[i]==element.name;found||$(error).addClass("validationError").insertAfter(element)},highlight:function(element,errorClass){$(element).addClass("required")},unhighlight:function(element,errorClass){$(element).removeClass("required")},submitHandler:function(form){var f=$(form);$("#contactInfoErrorSection").hide();var nextUrl=f.attr("action");constants.ajaxParams.loggedIn||(nextUrl=getAbsoluteURL()+"UpdateExamContactInfoCmd"),$.ajax({url:nextUrl,data:f.serialize(),dataType:"json",type:"post",complete:function(response){try{if("true"!=$.parseJSON(response.responseText).success)throw"Could not parse ajax response";var email=contactInfoSection.find("[name=email1]").val();contactInfoSection.find(".email").text(email);var phone1val=phone11.val(),phone2val=phone12.val(),phone3val=phone13.val(),phone="("+phone1val+")"+phone2val+"-"+phone3val;if(contactInfoSection.find(".phone").text(phone),"2"==$(".currentEyeExamStep").val()){var forms=getExamForms();forms.find("[name=phone1_1]").val(phone1val),forms.find("[name=phone1_2]").val(phone2val),forms.find("[name=phone1_3]").val(phone3val),forms.find("[name=email]").val(email)}$(".schedule-exam-right").removeClass("contact")}catch(err){$("#contactInfoErrorSection").text(constants.error.ajax).fadeIn(500)}$("#contactInfoDisplaySection, #contactInfoEditSection").toggle(),$(".schedule-exam-right").toggle(),$(".schedule-exam-right").toggle()}})}})}catch(e){-1==window.location.href.indexOf("ScheduleExamView")?console.error("Logged: "+e):console.log("OEE - No need to setup the contact section validation")}},setupPreferredStore:function(){storeLocatorJS.bindInfoWindowEvents(),storeLocatorJS.storeName=$("#StoreAddedMsgDiv .storeName").val(),storeLocatorJS.stLocId=$(".storeNumber").val(),$(".preferredStoreAddress").html("").append($(".exam-address").clone()),$(".preferredStoreHours").html("").append($(".exam-store-hours").clone())},setupEmailCapture:function(){$(document.body).on("change",".scheduleExamForm.focus input[name=scheduleId]",(function(){CoreFunctionality.emailCapture()}))},emailCapture:function(){if($(".scheduleExamForm.focus").validate().element("input[name=email]")){$(".scheduleExamForm.focus").attr("action");if(!constants.ajaxParams.loggedIn){var schIdTmp,providerTmp,tempDate=$(".scheduleExamForm.focus select[name=dobMonth]").val()+"/"+$(".scheduleExamForm.focus select[name=dobDay]").val()+"/"+$(".scheduleExamForm.focus select[name=dobYear]").val();if(null!=$(".scheduleExamForm.focus input[name=scheduleId]:checked").val())schIdTmp=$(".scheduleExamForm.focus input[name=scheduleId]:checked").val(),providerTmp=$(".scheduleExamForm.focus input[name=scheduleId]:checked").attr("data-provider");else if($('input[name="scheduleId"]').length>0)schIdTmp=$('input[name="scheduleId"]')[0].value,providerTmp=$('input[name="scheduleId"]')[0].getAttribute("data-provider");var data={email1:$(".scheduleExamForm.focus input[name=email]").val(),firstName:$(".scheduleExamForm.focus input[name=firstName]").val(),lastName:$(".scheduleExamForm.focus input[name=lastName]").val(),birthDate:tempDate,officeId:$(".scheduleExamForm.focus  input[name='officeId']").val(),refid:getURLParameter("refid"),cid:getURLParameter("cid"),userFirstName:$(".scheduleExamForm.focus input[name=contactfirstName]").val(),userLastName:$(".scheduleExamForm.focus input[name=contactlastName]").val(),phone1_0:$(".scheduleExamForm.focus input[name=phone1_0]").val(),phone1_1:$(".scheduleExamForm.focus input[name=phone1_1]").val(),phone1_2:$(".scheduleExamForm.focus input[name=phone1_2]").val(),phone1_3:$(".scheduleExamForm.focus input[name=phone1_3]").val(),schId:schIdTmp,provider:providerTmp,dateTime:$(".scheduleExamForm.focus input[name=dateTimeStr]").val()};$.ajax({url:getAbsoluteURL()+"UpdateExamContactInfoCmd",data:data,dataType:"json",type:"post",success:function(response){try{if("true"!=response.success)throw"Could not capture de email for the invite back";console.log("Email capture for invite back sent")}catch(err){console.log(err)}},error:function(response){console.log(response)}})}}},setupAppointmentConfirmation:function(){if($(".fe.save").show(),$("#hasInsurance_1").length>0){var visionInsurance1=$("#formApptConfirm_1");$("#hasInsurance_1").is(":checked")?(visionInsurance1.find(".visionPlan").hide(),visionInsurance1.find(".medicalPlan").hide()):(visionInsurance1.find(".visionPlan").show(),visionInsurance1.find(".medicalPlan").show())}if($("#hasInsurance_2").length>0){var visionInsurance2=$("#formApptConfirm_2");$("#hasInsurance_2").is(":checked")?(visionInsurance2.find(".visionPlan").hide(),visionInsurance2.find(".medicalPlan").hide()):(visionInsurance2.find(".visionPlan").show(),visionInsurance2.find(".medicalPlan").show())}if($("#hasInsurance_3").length>0){var visionInsurance3=$("#formApptConfirm_3");$("#hasInsurance_3").is(":checked")?(visionInsurance3.find(".visionPlan").hide(),visionInsurance3.find(".medicalPlan").hide()):(visionInsurance3.find(".visionPlan").show(),visionInsurance3.find(".medicalPlan").show())}$("#sameAs_1, #sameAs_2").change((function(){if(""==$.trim($(this).val())){var FormCopyName=$(this).closest("form").attr("id");$("#"+FormCopyName)[0].reset()}if("Patient_one"==$.trim($(this).val())){var f=$("#formApptConfirm_1");FormCopyName=$(this).closest("form").attr("id");$("#"+FormCopyName).find('input[name="visionInsCarrier"]').val($(f).find('input[name="visionInsCarrier"]').val()),$("#"+FormCopyName).find('input[name="visionInsGroup"]').val($(f).find('input[name="visionInsGroup"]').val()),$("#"+FormCopyName).find('input[name="visionInsPolicy"]').val($(f).find('input[name="visionInsPolicy"]').val()),$("#"+FormCopyName).find('input[name="medInsCarrier"]').val($(f).find('input[name="medInsCarrier"]').val()),$("#"+FormCopyName).find('input[name="medInsGroup"]').val($(f).find('input[name="medInsGroup"]').val()),$("#"+FormCopyName).find('input[name="medInsPolicy"]').val($(f).find('input[name="medInsPolicy"]').val())}if("Patient_two"==$.trim($(this).val())){f=$("#formApptConfirm_2"),FormCopyName=$(this).closest("form").attr("id");$("#"+FormCopyName).find('input[name="visionInsCarrier"]').val($(f).find('input[name="visionInsCarrier"]').val()),$("#"+FormCopyName).find('input[name="visionInsGroup"]').val($(f).find('input[name="visionInsGroup"]').val()),$("#"+FormCopyName).find('input[name="visionInsPolicy"]').val($(f).find('input[name="visionInsPolicy"]').val()),$("#"+FormCopyName).find('input[name="medInsCarrier"]').val($(f).find('input[name="medInsCarrier"]').val()),$("#"+FormCopyName).find('input[name="medInsGroup"]').val($(f).find('input[name="medInsGroup"]').val()),$("#"+FormCopyName).find('input[name="medInsPolicy"]').val($(f).find('input[name="medInsPolicy"]').val())}}));var exams=$("input[name=examQuantity]").val();$("#hasInsurance_1,#hasInsurance_2,#hasInsurance_3").on("change",(function(){var theClassName=this.className;theClassName=theClassName.replace(" blur","");var thisForm=$("form[class="+theClassName+"]");$(".fe.save").show(),$("input[name="+this.name+"]").is(":checked")?($(thisForm).find('input[name="hasInsurance"]').val("null"),$(thisForm).find('input[name="visionInsCarrier"]').val(""),$(thisForm).find('input[name="visionInsGroup"]').val(""),$(thisForm).find('input[name="visionInsPolicy"]').val(""),$(thisForm).find('input[name="medInsCarrier"]').val(""),$(thisForm).find('input[name="medInsGroup"]').val(""),$(thisForm).find('input[name="medInsPolicy"]').val(""),$(".visiplanData_"+theClassName).hide(),$(".medicalPlanData_"+theClassName).hide(),$(".sameInfo_"+theClassName).hide(),$(".selectBox_"+theClassName).hide()):($(thisForm).find('input[name="hasInsurance"]').val("true"),$(".visiplanData_"+theClassName).show(),$(".medicalPlanData_"+theClassName).show(),$(".sameInfo_"+theClassName).show(),$(".selectBox_"+theClassName).show())})),$("#apptConfirm_submit_Button").click((function(){$(".required.validationError").remove();saveInsuranceSingle(1,exams)}))},setupPopups:function(){var previousPopup="";$(".exam-popup-click").mouseover((function(e){var $this=$(this);""!=previousPopup&&previousPopup.children(".exam-popup").hide(),previousPopup=$this,$this.children(".exam-popup").show(),$this.children(".exam-popup").css("top","-"+($this.children(".exam-popup").height()-10)+"px"),$this.children(".exam-popup").find(".close-text-favorites").bind("click",(function(e){e.preventDefault(),$this.siblings(".exam-popup").hide(),$(this).unbind("click")}))})).mouseout((function(e){$(this).children(".exam-popup").hide()})).click((function(){return!1}))},checkEyeExamCount:function(){$(".lockedExamSection .each-exam:visible").length>=3&&$(".AddAnotherExamLink").hide(),$(".copied-each-exam:visible").length>=2?$(".AddAnotherExamLink").hide():1==$(".copied-each-exam:visible").length&&$(".AddAnotherExamLink").show()}};