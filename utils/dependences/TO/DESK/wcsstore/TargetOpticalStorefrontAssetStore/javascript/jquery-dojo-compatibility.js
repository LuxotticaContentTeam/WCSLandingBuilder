function WCService(e){this.actionId=e.actionId,this.failureHandler=e.failureHandler,this.formId=e.formId,this.id=e.id,this.initProperties=e.initProperties,this.successHandler=e.successHandler,this.url=e.url,this.validateForm=e.validateForm,this.validateParameters=e.validateParameters}function WCWidget(e,r,t){this.id=e,this.controllerId=r,this.widgetId=t,this.objectId=$("#"+this.id).attr("objectid"),this.controller=wc.render.getRefreshControllerById(r),this.refresh=function(e){null==e&&(e={}),this.controller.refresh(this,e)}}function WCContext(e,r,t){this.id=e,this.properties=r||{},this.url=t,this.contextChangedEventName=e+"/RenderContextChanged",this.update=function(e){if(this.url){for(var t in e)e[t]?this.properties[t]=e[t]:delete this.properties[t];dojo.publish("ajaxRequestInitiated");var o=$.ajax({url:this.url,data:r,dataType:"json",type:"post",context:this});o.done(function(e){if($.isArray(e.renderContextChanges)){for(var r=0;r<e.renderContextChanges.length;r++){var t=e.renderContextChanges[r];request.properties[t]=e[t]}dojo.publish(this.contextChangedEventName,[e])}}),o.always(function(){dojo.publish("ajaxRequestCompleted")})}else{console.debug("wc.render.updateContext - url not specified");var n={renderContextChanges:[]};for(var i in e){var s=e[i];s!=this.properties[i]&&(n.renderContextChanges.push(i),void 0===s?delete this.properties[i]:(this.properties[i]=s,n[i]=s,console.debug("updating render context: "+i+" = "+s)))}console.debug("publishing "+this.contextChangedEventName+" event"),dojo.publish(this.contextChangedEventName,[n])}}}function WCController(e){this.id=e.id,this.renderContext=e.renderContext,this.url=e.url,this.formId=e.formId,this.modelChangedHandler=e.modelChangedHandler,this.renderContextChangedHandler=e.renderContextChangedHandler,this.postRefreshHandler=e.postRefreshHandler,this.currentRCProperties={},this.getWidgets=function(){return $('[controllerId="'+this.id+'"]').map(function(){var e=$(this);return new WCWidget(this.id,e.attr("controllerId"),e.attr("widgetId"))}).toArray()},this.renderContextChanged=function(e){var r=this.getWidgets();for(var t in r)this.renderContextChangedHandler(e,r[t]);this.syncRCProperties()},this.modelChanged=function(e){var r=this.getWidgets();for(var t in r)this.modelChangedHandler(e,r[t])},this.syncRCProperties=function(){if(this.renderContext){var e={},r=this.renderContext.properties;for(var t in r)e[t]=r[t];this.currentRCProperties=e}},this.testForChangedRC=function(e){for(var r=!1,t=0;t<e.length;t++){var o=e[t];if(this.currentRCProperties[o]!=this.renderContext.properties[o]){r=!0;break}}return r},this.refresh=function(e,r){r||(r={});var t=null;if(this.formId){for(var o=$("#"+this.formId).serializeArray(),n=0;n<o.length;n++){var i=o[n];r[i.name]=i.value}t=document.getElementById(this.formId)}r.requesttype||(r.requesttype="ajax"),this.url=this.url.replace(/amp;/g,""),dojo.publish("ajaxRequestInitiated");var s=$.ajax({url:this.url,data:r,dataType:"text",type:"post",context:this});s.done(function(o){function n(e,o){var n="";if(r&&r[e]&&(n=r[e]),""==n&&null!=t&&t[e]&&(n=t[e],null!=t[e].value&&(n=t[e].value)),""==n&&o){var i=o;if(-1!=i.indexOf(e))n=(i=i.substring(i.indexOf(e))).split("&")[0].split("=")[1]}return n}var i=n("storeId",this.url),s=n("catalogId",this.url),a=n("langId",this.url),d=o.indexOf("errorCode");if(-1!=d){var l=o.indexOf(",",d),c=o.substring(d,l);console.debug("error condition encountered - error code: "+c),-1!=c.indexOf("2550")?(console.debug("error type: ERR_DIDNT_LOGON - the customer did not log on to the system."),console.debug("redirecting to URL: AjaxLogonForm?storeId="+i+"&catalogId="+s+"&langId="+a+"&myAcctMain=1"),document.location.href="AjaxLogonForm?storeId="+i+"&catalogId="+s+"&langId="+a+"&myAcctMain=1"):-1!=c.indexOf("2510")?(console.debug("error type: ERR_SESSION_TIMEOUT - use session has timed out"),console.debug("redirecting to URL: Logoff?URL=ReLogonFormView&storeId="+i),document.location.href="Logoff?URL=ReLogonFormView&storeId="+i):-1!=c.indexOf("2520")?(console.debug("error type: ERR_PROHIBITED_CHAR - detected prohibited characters in request"),console.debug("redirecting to URL: ProhibitedCharacterErrorView?storeId="+i+"&catalogId="+s+"&langId="+a),document.location.href="ProhibitedCharacterErrorView?storeId="+i+"&catalogId="+s+"&langId="+a):-1!=c.indexOf("2540")?(console.debug("error type: ERR_CSRF - cross site request forgery attempt was detected"),console.debug("redirecting to URL: CrossSiteRequestForgeryErrorView?storeId="+i+"&catalogId="+s+"&langId="+a),document.location.href="CrossSiteRequestForgeryErrorView?storeId="+i+"&catalogId="+s+"&langId="+a):-1!=c.indexOf("CMN1039E")&&(console.debug("error type: _ERR_INVALID_COOKIE - cookie error was detected"),console.debug("redirecting to URL: CookieErrorView?storeId="+i+"&catalogId="+s+"&langId="+a),document.location.href="CookieErrorView?storeId="+i+"&catalogId="+s+"&langId="+a)}else{var u=e.controller;console.debug("RefreshController.refresh - calling refreshHandler for "+e);var h=angular.element(document.body).scope().$root;void 0!==h&&void 0!=h.wrapAngular&&"function"==typeof h.wrapAngular?h.wrapAngular($("#"+e.id).html(o)):$("#"+e.id).html(o),null!=u.postRefreshHandler&&(console.debug("RefreshController.refresh - calling postRefreshHandler for "+e),u.postRefreshHandler(e))}}),s.always(function(){dojo.publish("ajaxRequestCompleted")})},$.isFunction(this.renderContextChangedHandler)&&this.renderContext&&dojo.subscribe(this.renderContext.contextChangedEventName,this,"renderContextChanged"),$.isFunction(this.modelChangedHandler)&&dojo.subscribe("modelChanged",this,"modelChanged")}function filterAjaxResponse(e){var r=e;try{r=$.parseJSON(r.replace(/^\s*\/\*/,"").replace(/\*\/\s*$/,""))}catch(e){console.debug(e)}return r}function parseWidget(){}dojo={channels:{},channelContexts:{},addClass:function(e,r){"string"==typeof e?$("#"+e).addClass(r):$(e).addClass(r)},addOnLoad:function(e){$(document).ready(e)},attr:function(e,r,t){var o;return(o="string"==typeof e?$("#"+e):$(e)).attr.apply(o,[r,t])},back:{init:function(){},setInitialState:function(){}},byId:function(e){return"string"==typeof e?document.getElementById(e):$(e)[0]},connect:function(e,r,t){r=r.replace("on","");("string"==typeof e?$("#"+e):$(e)).bind(r,t)},cookie:function(){return $.cookie.apply(window,arguments)},dnd:{Moveable:function(){return{}},Source:function(){return{copyOnly:!1,setItem:function(){}}}},isArray:function(e){return $.isArray(e)},keys:{BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,META:224,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,HELP:47,LEFT_WINDOW:91,RIGHT_WINDOW:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_PLUS:107,NUMPAD_ENTER:108,NUMPAD_MINUS:109,NUMPAD_PERIOD:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,NUM_LOCK:144,SCROLL_LOCK:145,copyKey:17},parser:{instantiate:function(){}},publish:function(e,r){var t=this.channels[e],o=this.channelContexts[e];null==t&&(t=[],o=[]),null==r&&(r=[]);for(var n=0;n<t.length;n++){var i=t[n],s=o[n];"function"==typeof i?i.apply(s,r):window[i]?window[i].apply(s,r):s[i].apply(s,r)}},query:function(e,r){var t=[];return null==r?t=$(e).toArray():"string"==typeof r?t=$(e,"#"+r).toArray():"object"==typeof r&&(t=$(e,r).toArray()),t.forEach=function(e){$.each(t,function(r,t){e.apply(t,[t,r])})},t},registerModulePath:function(){},removeClass:function(e,r){"string"==typeof e?$("#"+e).removeClass(r):$(e).removeClass(r)},require:function(){},style:function(e,r,t){$("#"+e).css(r,t)},subscribe:function(e,r,t){var o=this.channels[e],n=this.channelContexts[e];null==o&&(this.channels[e]=[],this.channelContexts[e]=[],o=this.channels[e],n=this.channelContexts[e]),null==t?(o.push(r),n.push(window)):(o.push(t),n.push(r))},trim:function(e){return $.trim(e)}},wc={service:{servicesMap:{},declare:function(e){var r=new WCService(e);return this.servicesMap[r.id]=r,r},getServiceById:function(e){return this.servicesMap[e]},invoke:function(e,r){var t=this.servicesMap[e],o=null;if(t){var n=r;if(r instanceof Array)for(var i in n={},r)n[i]=r[i];else null==r&&(n={});if(t.formId&&""!=t.formId)for(var s=$("#"+t.formId).serializeArray(),a=0;a<s.length;a++){var d=s[a];n[d.name]=d.value}(o=$.ajax({url:t.url,data:n,dataType:"text",traditional:!0,type:"post"})).done(function(e){var r=filterAjaxResponse(e);if(null==r||!r.errorMessage&&!r.errorMessageKey){if(t.successHandler){t.successHandler.apply(ServicesDeclarationJS,[r]);var o=$.extend(!0,{},r);o.actionId=t.actionId,o.serviceId=t.serviceId,dojo.publish("modelChanged",[o]),t.actionId&&(console.debug("success: publishing modelChanged/"+t.actionId+" event"),dojo.publish("modelChanged/"+t.actionId,[o]))}}else{var n=ServicesDeclarationJS.storeId,i=ServicesDeclarationJS.catalogId,s=ServicesDeclarationJS.langId;if("2500"==r.errorCode)a="LogonForm?nextUrl="+(a=(a=(a=(a=(a=r.originatingCommand).replace("?","%3F")).replace(/&amp;/g,"%26")).replace(/&/g,"%26")).replace(/=/g,"%3D"))+"&storeId="+n+"&catalogId="+i+"&langId="+s+"&myAcctMain=1",console.debug("error type: ERR_USER_NOT_LOGGED_ON - only registered user can invoke the command"),console.debug("redirecting to URL: "+a),document.location.href=a;else if("2550"==r.errorCode){a="AjaxLogonForm?nextUrl="+(a=(a=(a=(a=(a=r.originatingCommand).replace("?","%3F")).replace(/&amp;/g,"%26")).replace(/&/g,"%26")).replace(/=/g,"%3D"))+"&storeId="+n+"&catalogId="+i+"&langId="+s+"&myAcctMain=1",console.debug("error type: ERR_DIDNT_LOGON - the customer did not log on to the system."),console.debug("redirecting to URL: "+a),document.location.href=a}else if("2530"==r.errorCode){var a;a="PasswordReEnterErrorView?nextUrl="+(a=(a=(a=(a=(a=r.originatingCommand).replace("?","%3F")).replace(/&amp;/g,"%26")).replace(/&/g,"%26")).replace(/=/g,"%3D"))+"&storeId="+n+"&catalogId="+i+"&langId="+s,console.debug("error type: ERR_PASSWORD_REREQUEST - password is required"),console.debug("redirecting to URL: "+a),document.location.href=a}else"2510"==r.errorCode?(console.debug("error type: ERR_SESSION_TIMEOUT - use session has timed out"),console.debug("redirecting to URL: Logoff?URL=ReLogonFormView&storeId="+n),document.location.href="Logoff?URL=ReLogonFormView&storeId="+n):"2520"==r.errorCode?(console.debug("error type: ERR_PROHIBITED_CHAR - detected prohibited characters in request"),console.debug("redirecting to URL: ProhibitedCharacterErrorView?storeId="+n+"&catalogId="+i+"&langId="+s),document.location.href="ProhibitedCharacterErrorView?storeId="+n+"&catalogId="+i+"&langId="+s):"2540"==r.errorCode?(console.debug("error type: ERR_CSRF - cross site request forgery attempt was detected"),console.debug("redirecting to URL: CrossSiteRequestForgeryErrorView?storeId="+n+"&catalogId="+i+"&langId="+s),document.location.href="CrossSiteRequestForgeryErrorView?storeId="+n+"&catalogId="+i+"&langId="+s):"CMN1039E"==r.errorCode?(console.debug("error type: _ERR_INVALID_COOKIE - cookie error was detected"),console.debug("redirecting to URL: CookieErrorView?storeId="+n+"&catalogId="+i+"&langId="+s),document.location.href="CookieErrorView?storeId="+n+"&catalogId="+i+"&langId="+s):(console.debug("calling service.failureHandler"),t.failureHandler(r))}}),o.fail(function(e){var r=filterAjaxResponse(e);t.failureHandler&&t.failureHandler.apply(ServicesDeclarationJS,[r])}),o.always(function(){dojo.publish("ajaxRequestCompleted")})}return o}},render:{contexts:{},controllers:{},declareRefreshController:function(e){var r=new WCController(e);return this.controllers[r.id]=r,r},getRefreshControllerById:function(e){return this.controllers[e]},declareContext:function(e,r,t){if(null==this.contexts[e]||""==this.contexts[e])return this.contexts[e]=new WCContext(e,r,t),this.contexts[e]},getContextById:function(e){return this.contexts[e]},updateContext:function(e,r){this.contexts[e].update(r)}}},dijit={byNode:function(){return{}},byId:function(){},registry:{byClass:function(){return{forEach:function(){}}}},Tooltip:function(){}},CommonControllersDeclarationJS={setControllerURL:function(){}};
//# sourceMappingURL=jquery-dojo-compatibility.js.map