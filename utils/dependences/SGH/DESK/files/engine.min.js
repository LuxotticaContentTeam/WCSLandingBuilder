var HT_Chrono=[],HT_Ranking=[],HT_FilteredByCat=[],selectorCatEntryID=selectorCatEntryID||!1,historyEngine=function(){var ct_history_config={date:{currentDate:new Date,currentDate_timestamp:Date.now(),currentDate_human:new Date(Date.now()).toLocaleString(),currentDate_number:(new Date).getFullYear()+""+("0"+((new Date).getMonth()+1)).slice(-2)+("0"+(new Date).getDate()).slice(-2)},userData:{getUsername:!1,takeUsernameFrom:".oo-hdr-username"},setting:{ranking:{scroll:{averageScroll:window.innerHeight/2,value:1},addToCart:1,slide:1}}},ct_history,start=function(){return new Promise((function(resolve,reject){var controll=0,utchecker=setInterval((function(){if(!(++controll<10))return clearInterval(utchecker),void reject();utag_data.Page_Type&&("Pdp"==utag_data.Page_Type||"Pcp"==utag_data.Page_Type?utag_data.Products&&(clearInterval(utchecker),checklocalstorage(),resolve()):(checklocalstorage(),resolve(),clearInterval(utchecker)))}),1e3)}))},checklocalstorage=function(){var thereIsLocalStorage=null!=localStorage.getItem("pdpH"),getLocalStorage=!!thereIsLocalStorage&&JSON.parse(localStorage.getItem("pdpH"));ct_history={user:{status:thereIsLocalStorage?getLocalStorage.user.status:"",name:thereIsLocalStorage?getLocalStorage.user.name:"",visits:{prev:thereIsLocalStorage?getLocalStorage.user.visits.prev:"",last:thereIsLocalStorage?getLocalStorage.user.visits.last:""},loveCategory:thereIsLocalStorage?getLocalStorage.user.loveCategory:[]},purchasedProducts:thereIsLocalStorage&&getLocalStorage.purchasedProducts?getLocalStorage.purchasedProducts:[],products:thereIsLocalStorage?getLocalStorage.products:[],orderBy:{chrono:thereIsLocalStorage?getLocalStorage.orderBy.chrono:[]},pages:thereIsLocalStorage?getLocalStorage.pages:{},productsCategory:thereIsLocalStorage?getLocalStorage.productsCategory:{}},HT_Chrono=thereIsLocalStorage?getLocalStorage.orderBy.chrono:[],HT_Ranking=thereIsLocalStorage?getLocalStorage.products:[],checkUserStatus()},checkUserStatus=function(){"Logged"==utag_data.User_LoginStatus?(ct_history.user.status="Logged",ct_history_config.userData.getUsername&&(ct_history.user.name=document.querySelector(ct_history_config.userData.takeUsernameFrom).innerText)):ct_history.user.status="Guest",parseInt(ct_history.user.visits.last)<parseInt(ct_history_config.date.currentDate_number)&&(ct_history.user.visits.prev=ct_history.user.visits.last),ct_history.user.visits.last=ct_history_config.date.currentDate_number,checkpagetype()},checkpagetype=function(){"Pdp"==utag_data.Page_Type||"Pcp"==utag_data.Page_Type?startTrackingProducts():"Thankyou"==utag_data.Page_Type?checkPurchasedProduct():startTrackingPages()},startTrackingPages=function(){var currentPage={pagename:utag_data.Page_Name,lastvisit:ct_history_config.date.currentDate_number};ct_history.pages[utag_data.Page_Type]?ct_history.pages[utag_data.Page_Type].push(currentPage):(ct_history.pages[utag_data.Page_Type]=[],ct_history.pages[utag_data.Page_Type].push(currentPage)),setLocalStorage()},checkPurchasedProduct=function(){Object.keys(utag_data.Products).forEach((function(item){-1==ct_history.purchasedProducts.indexOf(item.split("#")[0])&&ct_history.purchasedProducts.push(item.split("#")[0])})),setLocalStorage()},startTrackingProducts=function(){var currentCatEntryID=selectorCatEntryID||void 0,currentProductUPC=Object.keys(utag_data.Products).toString(),currentProductInfo=utag_data.Products[currentProductUPC],currentProductCategory=currentProductInfo.Category,hasMatch;if(ct_history.products.length>0)if(ct_history.products.filter((function(product){return product.upc===currentProductUPC})).length>0){var proceed=!0;ct_history.products.forEach((function(product,i){product.upc===currentProductUPC&&proceed&&(proceed=!1,product.modelName=currentProductInfo.ModelName,product.url=currentProductInfo.Url,product.visits.counter=product.visits.counter+1,product.visits.prev.timestamp=product.visits.last.timestamp,product.visits.prev.fullDate=product.visits.last.fullDate,product.visits.last.timestamp=ct_history_config.date.currentDate_timestamp,product.visits.last.fullDate=ct_history_config.date.currentDate_number,product.catentryId=currentCatEntryID,ct_history.purchasedProducts.indexOf(product.upc)>-1?product.purchased=!0:product.purchased=!1,ct_history.products.push(ct_history.products.splice(i,1)[0]))}))}else generateProduct(currentProductInfo,currentProductUPC,currentCatEntryID);else generateProduct(currentProductInfo,currentProductUPC,currentCatEntryID);ct_history.productsCategory[currentProductCategory]?ct_history.productsCategory[currentProductCategory]=ct_history.productsCategory[currentProductCategory]+1:(ct_history.productsCategory[currentProductCategory]=1,ct_history.productsCategory[currentProductCategory]=1),generateChrono(),generateRanking(currentProductUPC),checkLoveCategory()},generateProduct=function(currentProductInfo,currentProductUPC,currentCatEntryID){var isDiscounted=parseInt(currentProductInfo.PriceFull)>parseInt(currentProductInfo.Price),product={upc:currentProductUPC,sku:currentProductInfo.Sku,catentryId:currentCatEntryID,modelName:currentProductInfo.ModelName,modelFamily:currentProductInfo.ModelCode,url:currentProductInfo.Url,category:currentProductInfo.Category,price:currentProductInfo.Price,priceFull:currentProductInfo.PriceFull,isDiscounted:isDiscounted,status:currentProductInfo.Status,stock:currentProductInfo.Stock,purchased:!1,addedToCart:!1,visits:{counter:1,prev:{timestamp:!1,fullDate:!1},last:{timestamp:ct_history_config.date.currentDate_timestamp,fullDate:ct_history_config.date.currentDate_number}},ranking:1};ct_history.products.push(product)},generateChrono=function(){var orderChrono=JSON.parse(JSON.stringify(ct_history.products)).reverse();ct_history.orderBy.chrono=orderChrono,HT_Chrono=orderChrono},generateRanking=function(currentProductUPC){var addOnScroll=!0},checkLoveCategory=function(){var sortableCategory=[];for(var category in ct_history.productsCategory)sortableCategory.push([category,ct_history.productsCategory[category]]);var sorted=sortableCategory.sort((function(a,b){return b[1]-a[1]}));ct_history.user.loveCategory=sorted[0][0],setLocalStorage()},orderProduct=function(...args){HT_Ranking.sort(sortProductList(...args))},sortProductList=function(){var arrArgs=Array.prototype.slice.call(arguments);return function(a,b){for(var x in arrArgs){var arg=arrArgs[x].substring(1),ax=eval("a."+arg),bx=eval("b."+arg),cx;if(ax="string"==typeof ax?ax.toLowerCase():ax/1,bx="string"==typeof bx?bx.toLowerCase():bx/1,"-"==arrArgs[x].substring(0,1)&&(cx=ax,ax=bx,bx=cx),ax!=bx)return ax<bx?-1:1}}},filterProductsCategory=function(category){var filteredProduct=(HT_FilteredByCat=JSON.parse(JSON.stringify(HT_Ranking))).filter((function(product){return product.category==category}));HT_FilteredByCat=filteredProduct},setLocalStorage=function(){localStorage.setItem("pdpH",JSON.stringify(ct_history))};return{init:start,order:orderProduct,filterBy:filterProductsCategory}}();

/* */