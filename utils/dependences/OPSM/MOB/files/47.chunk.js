(this["webpackJsonp@abstract/frameadvisor-ui"]=this["webpackJsonp@abstract/frameadvisor-ui"]||[]).push([[47],{503:function(e,t,n){"use strict";n.d(t,"a",(function(){return Nt})),n.d(t,"b",(function(){return nt})),n.d(t,"c",(function(){return xt})),n.d(t,"d",(function(){return ye})),n.d(t,"e",(function(){return Ht})),n.d(t,"f",(function(){return Ue})),n.d(t,"g",(function(){return en})),n.d(t,"h",(function(){return Yt})),n.d(t,"i",(function(){return st})),n.d(t,"j",(function(){return H})),n.d(t,"k",(function(){return ve})),n.d(t,"l",(function(){return Y})),n.d(t,"m",(function(){return C})),n.d(t,"n",(function(){return D})),n.d(t,"o",(function(){return E})),n.d(t,"p",(function(){return ht})),n.d(t,"q",(function(){return A})),n.d(t,"r",(function(){return _})),n.d(t,"s",(function(){return N})),n.d(t,"t",(function(){return S})),n.d(t,"u",(function(){return et})),n.d(t,"v",(function(){return Je})),n.d(t,"w",(function(){return ie})),n.d(t,"x",(function(){return an})),n.d(t,"y",(function(){return Jt})),n.d(t,"z",(function(){return Ve})),n.d(t,"A",(function(){return F})),n.d(t,"B",(function(){return pn})),n.d(t,"C",(function(){return Ze})),n.d(t,"D",(function(){return vn})),n.d(t,"E",(function(){return G})),n.d(t,"F",(function(){return tt}));var r=n(511),i=n(520),o=n(495),a=n(38),s=n(1040),u=n(1038),c=n(77),l=n.n(c),d=n(515),f=n(531),v=n.n(f),p=n(532),h=n(519),m=n(522),g=n(533);var y="@luxottica/virtual-mirror",b="7.3.4";function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(e,t,n){return t&&T(e.prototype,t),n&&T(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&M(e,t)}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function P(e,t,n){return(P=I()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&M(i,n.prototype),i}).apply(null,arguments)}function R(e){var t="function"===typeof Map?new Map:void 0;return(R=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return P(e,arguments,k(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),M(r,e)})(e)}function N(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e,t){if(t&&("object"===typeof t||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return N(e)}function D(e){var t=I();return function(){var n,r=k(e);if(t){var i=k(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return j(this,n)}}function V(e){return function(e){if(Array.isArray(e))return L(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return L(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var F=function(e){C(n,e);var t=D(n);function n(e,r,i){var o;return E(this,n),_(N(o=t.call(this,i)),"type",void 0),_(N(o),"adobeErrorParameters",void 0),o.type=e,o.message=i,o.adobeErrorParameters={errorSource:r,errorCode:"Vm - ".concat(e),errorDetails:i},Object.setPrototypeOf(N(o),n.prototype),o}return A(n)}(R(Error)),U=function(e){C(n,e);var t=D(n);function n(){var e;return E(this,n),e=t.call(this,n.type,"Client","failed to initialize component"),Object.setPrototypeOf(N(e),n.prototype),e}return A(n)}(F);_(U,"type","InitializationError");var x=function(e){C(n,e);var t=D(n);function n(){var e;return E(this,n),e=t.call(this,n.type,"Client","VirtualMirror must be initialized before rendering"),Object.setPrototypeOf(N(e),n.prototype),e}return A(n)}(F);_(x,"type","NotInitializedError");var B=function(e){C(n,e);var t=D(n);function n(e,r){var i;return E(this,n),i=t.call(this,n.type,"Client","'".concat(e,": ").concat(r,"' parameter is invalid")),Object.setPrototypeOf(N(i),n.prototype),i}return A(n)}(F);_(B,"type","InvalidParametersError");var W=function(e){C(n,e);var t=D(n);function n(e){var r;return E(this,n),r=t.call(this,n.type,"Client","invalid locale: ".concat(e," - supported format: aa-BB")),Object.setPrototypeOf(N(r),n.prototype),r}return A(n)}(F);_(W,"type","InvalidLocaleError");var z=function(e){C(n,e);var t=D(n);function n(e){var r;return E(this,n),_(N(r=t.call(this,n.type,"Client","upc ".concat(e," failed to successfully render"))),"upc",void 0),r.upc=e,Object.setPrototypeOf(N(r),n.prototype),r}return A(n)}(F);_(z,"type","RenderingError");var G=function(e){C(n,e);var t=D(n);function n(e){var r;return E(this,n),_(N(r=t.call(this,n.type,"Server","failed to determine if upc ".concat(e," is supported"))),"upc",void 0),r.upc=e,Object.setPrototypeOf(N(r),n.prototype),r}return A(n)}(F);_(G,"type","UpcSupportedError");var H=function(e){C(n,e);var t=D(n);function n(e){var r;return E(this,n),_(N(r=t.call(this,n.type,"Server","upc ".concat(e," could not be found"))),"upc",void 0),r.upc=e,Object.setPrototypeOf(N(r),n.prototype),r}return A(n)}(F);_(H,"type","UpcMissingError");var K=function(e){C(n,e);var t=D(n);function n(e){var r;return E(this,n),r=t.call(this,n.type,"Client","failed to mount component at divId: ".concat(e)),Object.setPrototypeOf(N(r),n.prototype),r}return A(n)}(F);_(K,"type","MountComponentError");var q=function(e){C(n,e);var t=D(n);function n(e){var r;return E(this,n),r=t.call(this,n.type,"Client","failed to unmount component at divId: ".concat(e)),Object.setPrototypeOf(N(r),n.prototype),r}return A(n)}(F);_(q,"type","UnmountComponentError");var J=function(e){C(n,e);var t=D(n);function n(){var e;return E(this,n),(e=t.call(this,n.type,"User","webcam support could not be found")).adobeErrorParameters.errorCode="Vm - WebcamNotFoundError",Object.setPrototypeOf(N(e),n.prototype),e}return A(n)}(F);_(J,"type","WebcamUnavailableError");var Y=function(e){C(n,e);var t=D(n);function n(){var e;return E(this,n),e=t.call(this,n.type,"User","webcam access was rejected by user"),Object.setPrototypeOf(N(e),n.prototype),e}return A(n)}(F);_(Y,"type","WebcamRejectedError");var Q=function(e){C(n,e);var t=D(n);function n(e){var r;return E(this,n),r=t.call(this,n.type,"Client",e),Object.setPrototypeOf(N(r),n.prototype),r}return A(n)}(F);_(Q,"type","OpacityError");var Z=function(e){C(n,e);var t=D(n);function n(e){var r;return E(this,n),r=t.call(this,n.type,"Client",e),Object.setPrototypeOf(N(r),n.prototype),r}return A(n)}(F);_(Z,"type","AnimationError");var X=function(e){C(n,e);var t=D(n);function n(){var e;return E(this,n),e=t.call(this,n.type,"Client","Virtual Mirror requires a key to work"),Object.setPrototypeOf(N(e),n.prototype),e}return A(n)}(F);_(X,"type","MissingAuthKeyError");var $=function(e){C(n,e);var t=D(n);function n(){var e;return E(this,n),e=t.call(this,n.type,"Client","Virtual Mirror feature service failed to initialize"),Object.setPrototypeOf(N(e),n.prototype),e}return A(n)}(F);_($,"type","FeatureInitializationError");var ee=function(e){C(n,e);var t=D(n);function n(e){var r;return E(this,n),r=t.call(this,n.type,"Client","feature ".concat(e," is not available for this client")),Object.setPrototypeOf(N(r),n.prototype),r}return A(n)}(F);_(ee,"type","FeatureUnavailableError"),_(function(e){C(n,e);var t=D(n);function n(){var e;return E(this,n),e=t.call(this,n.type,"Client","Can't get auth for undefined feature"),Object.setPrototypeOf(N(e),n.prototype),e}return A(n)}(F),"type","FeatureUndefinedError");var te=function(e){C(n,e);var t=D(n);function n(e){var r;return E(this,n),r=t.call(this,n.type,"Server",e.message),Object.setPrototypeOf(N(r),n.prototype),r}return A(n)}(F);_(te,"type","FeatureServerError");var ne={key:void 0,analyticsConfig:{},brand:void 0,channel:void 0,storeId:void 0,locale:"en-US",environment:"PRODUCTION",sessionTimeout:!1},re="vm.akamai.licensing.skip";window.VMAkamaiLicensingFlag=re;var ie,oe={STAGING:{get baseUrl(){return se(),"https://test-gateway-vtoprofile.luxdeepblue.com/services/vtomoduleprotection/public/v1/"},getAllFeaturesPath:"get-functionalities/",getKeyAuthorizationPath:"key-authorized/"},ACCEPTANCE:{get baseUrl(){return console.warn("backoffice for feature licensing development env will be changed soon"),se()?"https://acceptance-gateway-vtoprofile.luxdeepblue.com/services/vtomoduleprotection/public/v1/":"https://vmcore-test.luxottica.com/services/vtomoduleprotection/public/v1/"},getAllFeaturesPath:"get-functionalities/",getKeyAuthorizationPath:"key-authorized/"},PRODUCTION:{get baseUrl(){return se()?"https://gateway-vtoprofile.luxdeepblue.com/services/vtomoduleprotection/public/v1/":"https://vmcore.luxottica.com/services/vtomoduleprotection/public/v1/"},getAllFeaturesPath:"get-functionalities/",getKeyAuthorizationPath:"key-authorized/"}},ae=new Map([]),se=function(){return!(!window||!window.localStorage)&&"true"===window.localStorage.getItem(re)},ue=function(e){return oe[e]};!function(e){e.VM_TRANSITIONS="VM_TRANSITIONS",e.VM_SCREENSHOT="VM_SCREENSHOT",e.VM_MOVE_GLASSES="VM_MOVE_GLASSES",e.VM_ANALYTICS="VM_ANALYTICS",e.VM_TAP_TO_PAUSE="VM_TAP_TO_PAUSE",e.VM_BIPA="VM_BIPA",e.VM_GET_BIPA_VERSION="VM_GET_BIPA_VERSION",e.VM_SAVE_BIPA_ENTRY="VM_SAVE_BIPA_ENTRY"}(ie||(ie={}));var ce,le,de,fe,ve,pe=o.b.getInstance().getLoggerInfo(y,b,"FeatureLicensingService"),he=!1,me=ne.environment,ge=function(){return new Promise((function(e,t){try{e(function(){if(void 0===ce)throw new X;var e=ue(me);return pe.debug("Getting feature list for key {} using config {}",ce,JSON.stringify(e)),"".concat(e.baseUrl).concat(e.getAllFeaturesPath).concat(ce)}())}catch(n){t(n)}})).then((function(e){return fetch(e)})).then((function(e){return e.ok?e.json():Promise.reject(new te("".concat(e.status," - ").concat(e.statusText)))})).then((function(e){var t=new Map;return Object.values(ie).forEach((function(n){t.set(n,e.includes(n.toString()))})),pe.debug("client feature list has been imported {}",V(t.entries())),t})).catch((function(e){var t=e instanceof X||e instanceof te?e:new te(e.message);throw pe.error(t),t}))},ye={initialize:function(e,t){var n=!1;return he||(n=!0),e&&e!==ce&&(ce=e,n=!0),t&&t!==me&&(me=t,n=!0),n?(he=!1,ge().then((function(e){le=e,he=!0})).catch((function(e){throw le=ae,e}))):Promise.resolve()},isInitialized:function(){return he},isFeatureAuthorized:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t&&le)return t.every((function(e){return!!le.get(e)}));throw new $}},be="SET_ENVIRONMENT",we="SET_AUTH",Se="RESET_AUTH",Oe="SET_LOADING_STATUS",Ee="SET_PRIVACY_OPTIONS",Te="SET_USER",Ae="FREEZE_MIRROR",_e="SET_MIRROR_OPTIONS",Ce="SET_MIRROR_STATUS",ke="SET_MIRROR_GLASSES",Me="SET_MIRROR_GLASSES_DATA",Ie="SET_MIRROR_GLASSES_STATUS",Pe="SET_GLTF_MIRROR_GLASSES_STATUS",Re="SET_MESH",Ne="SET_MESH_DATA",je="SET_MESH_STATUS",De={environment:"PRODUCTION",loading:{WEBCAM_ACCESS:!1,INITIALIZATION:!1,POSETRACKER:!1,RENDERING:!1,GLASSES:!1,MESH:!1},privacy:{},auth:{accessToken:void 0,refreshToken:void 0}},Ve={setEnvironment:Object(s.a)(be),setAuth:Object(s.a)(we),resetAuth:Object(s.a)(Se),setPrivacyOptions:Object(s.a)(Ee),setLoadingStatus:Object(s.a)(Oe)},Le=Object(u.a)((_(de={},be,(function(e,t){return t.payload?S(S({},e),{},{environment:t.payload}):S({},e)})),_(de,we,(function(e,t){return t.payload.accessToken&&t.payload.refreshToken?S(S({},e),{},{auth:{accessToken:t.payload.accessToken,refreshToken:t.payload.refreshToken}}):S({},e)})),_(de,Se,(function(e){return S(S({},e),{},{auth:{accessToken:void 0,refreshToken:void 0}})})),_(de,Ee,(function(e,t){return S(S({},e),{},{privacy:S({},t.payload)})})),_(de,Oe,(function(e,t){return S(S({},e),{},{loading:S(S({},e.loading),{},_({},t.payload.type,t.payload.status))})})),de),De),Fe={freeze:!1,glasses:void 0,video:void 0,mirrorStatus:"LOADING",mirrorOptions:void 0},Ue={freezeMirror:Object(s.a)(Ae),setMirrorOptions:Object(s.a)(_e),setMirrorStatus:Object(s.a)(Ce),setMirrorGlasses:Object(s.a)(ke),setMirrorGlassesData:Object(s.a)(Me),setMirrorGlassesStatus:Object(s.a)(Ie),setGltfMirrorGlassesStatus:Object(s.a)(Pe),setMesh:Object(s.a)(Re),setMeshData:Object(s.a)(Ne),setMeshStatus:Object(s.a)(je)},xe=Object(u.a)((_(fe={},Ae,(function(e,t){return S(S({},e),{},{freeze:t.payload})})),_(fe,_e,(function(e,t){return S(S({},e),{},{mirrorOptions:t.payload})})),_(fe,Ce,(function(e,t){return S(S({},e),{},{mirrorStatus:t.payload})})),_(fe,ke,(function(e,t){return S(S({},e),{},{glasses:{upc:t.payload.upc,type:t.payload.type,status:"LOADING"}})})),_(fe,Me,(function(e,t){return S(S({},e),{},{glasses:t.payload})})),_(fe,Ie,(function(e,t){return S(S({},e),{},{glasses:S(S({},e.glasses),{},{upc:t.payload.upc,status:t.payload.status})})})),_(fe,Pe,(function(e,t){return t.payload.upc===e.glasses.upc?S(S({},e),{},{glasses:S(S({},e.glasses),{},{upc:t.payload.upc,status:t.payload.status})}):S({},e)})),_(fe,Re,(function(e,t){return S(S({},e),{},{video:{videoId:t.payload.videoId,pupillaryDistance:t.payload.pupillaryDistance,status:"LOADING"}})})),_(fe,Ne,(function(e,t){return S(S({},e),{},{video:S(S(S({},e.video),t.payload),{},{status:"READY"})})})),_(fe,je,(function(e,t){return S(S({},e),{},{video:S(S({},e.video),{},{videoId:t.payload.videoId,status:t.payload.status})})})),fe),Fe),Be={locale:"en-US",region:void 0,source:void 0,brand:void 0,storeId:void 0,channel:void 0},We={setUser:Object(s.a)(Te)},ze=Object(u.a)(_({},Te,(function(e,t){return S(S({},e),t.payload)})),Be),Ge=Object(a.combineReducers)({app:Le,mirror:xe,user:ze});var He,Ke,qe,Je,Ye=function(){return void 0!==ve&&!0===ve.getState().app.loading.INITIALIZATION},Qe=function(){ve=function(e){var t=("object"===("undefined"===typeof window?"undefined":O(window))&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({name:"virtual-mirror"}):a.compose)();return Object(a.createStore)(Ge,e,t)}()},Ze={onEngineStarting:"onEngineStarting",onFirstFrameRendered:"onFirstFrameRendered",onNewAssetRequested:"onNewAssetRequested",onWaitingForPose:"onWaitingForPose",onFirstFrameStarted:"onFirstFrameStarted",onAssetSwitchDone:"onAssetSwitchDone",onNewTransitionRequested:"onNewTransitionRequested",onNewTransitionRendered:"onNewTransitionRendered",onFPSCount:"onFPSCount"},Xe=function(){return document.querySelector("body")},$e=!1,et=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Xe().dispatchEvent(new CustomEvent(e,t))},tt=function(){return $e},nt={onFaceFound:function(){},onLowEndDeviceDetected:function(){},onTransitionAnimation:function(){},onTransitionAnimationEnd:function(){},onAuthUpdated:function(){},onDisplayPage:function(){},onPrivacyAgree:function(){},onPrivacyFail:function(){},onPrivacyReject:function(){},onPrivacyPolicyClick:void 0,onTermsAndConditionsClick:void 0,onPrivacyDisplay:function(){},onMirrorExperience:function(){}},rt={},it=0,ot=!1,at=!1,st={downloadTransitionColors:function(e){return 0!==Object.keys(rt).length?Promise.resolve():ye.isFeatureAuthorized(ie.VM_TRANSITIONS)?i.a.downloadTransitionColors(e).then((function(e){Object.keys(e).map((function(t){rt[t]={mirror:e[t].mirror,active:e[t].active,clear:e[t].clear}}))})):Promise.resolve()},setTransitionOverrideColor:function(e){rt.OVERRIDE=e},reset:function(){ot=!1,He=void 0},startAnimation:function(e){ot||(ot=!0,qe=e,at=it<.5,Ke=it%1===0?Date.now():function(e,t,n){return e?Date.now()-t*n:Date.now()-t*(1-n)}(at,qe,it),He=void 0)},getTransitionColor:function(e){return null===rt||void 0===rt?void 0:rt[e]},setCurrentLensOpacity:function(e){st.reset(),it=e},getCurrentLensOpacity:function(){if(void 0===He&&ot){var e=(Date.now()-Ke)/qe;return e>=1&&(e=1,ot=!1),it=at?e:1-e,1===e&&(He=it,nt.onTransitionAnimationEnd(He)),nt.onTransitionAnimation(it),it}return it}},ut=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;if(Ye()){if("TRACKING"!==(null===ve||void 0===ve?void 0:ve.getState().mirror.mirrorStatus)){var t=new Z("animateOpacity cannot be triggered when mirror is not rendering");throw t}if(!ve.getState().mirror.glasses.transitionAvailable){var n=new Z("animateOpacity cannot be triggered when transition is not available for this asset");throw n}if(void 0===e||"number"!==typeof e||e<=0){var r=new Z("animateOpacity cannot be triggered when duration value is invalid");throw r}st.startAnimation(e)}};!function(e){e.VM_OK="vm-ok",e.VM_KO="vm-ko",e.VM_INIT="_init",e.VM_INIT_BRAND="_init_brand",e.VM_INIT_CHANNEL="_init_channel",e.VM_INIT_LOCALE="_init_locale",e.VM_CLOSE="_close",e.VM_FITMEBETTER="_fitmebetter",e.VM_SCREENSHOT="_screenshot",e.VM_RENDER="_render",e.VM_RENDER_TIME="_render_time_ms",e.VM_UPC_AVAILABILITY="_upc_availability"}(Je||(Je={}));var ct,lt,dt,ft,vt,pt=new o.a,ht=function(e){return o.b.getInstance().getLoggerInfo(y,b,e)},mt=function(e){pt.sendAppViewSession({statusCode:Je.VM_OK+Je.VM_INIT_BRAND,statusText:e.brand},{statusCode:Je.VM_OK+Je.VM_INIT_CHANNEL,statusText:e.channel},{statusCode:Je.VM_OK+Je.VM_INIT_LOCALE,statusText:e.locale})},gt=function(e){pt.sendAppViewSession({statusCode:Je.VM_KO+Je.VM_INIT,statusText:e.channel})},yt=function(e){pt.sendAppViewSession({statusCode:Je.VM_OK+Je.VM_UPC_AVAILABILITY,statusText:e})},bt=function(e){pt.sendAppViewSession({statusCode:Je.VM_KO+Je.VM_UPC_AVAILABILITY,statusText:e})},wt=function(e){pt.sendAppViewSession({statusCode:"orientation change",statusText:e?"landscape":"portrait"})},St=function(){pt.sendAppViewSession({statusCode:Je.VM_OK+Je.VM_FITMEBETTER,statusText:""})},Ot=function(){pt.sendAppViewSession({statusCode:Je.VM_KO+Je.VM_FITMEBETTER,statusText:""})},Et=function(e){pt.sendAppViewSession({statusCode:Je.VM_OK+Je.VM_CLOSE,statusText:e})},Tt=function(e){pt.sendAppViewSession({statusCode:Je.VM_KO+Je.VM_CLOSE,statusText:e})},At=ht("AdobeHelper"),_t=function(e,t){var n,r,i,o,a,s,u,c,l=new Map;return l.set("AQB","1"),l.set("ndh","1"),l.set("ns","luxottica"),l.set("g",window.location.href),l.set("r",document.referrer),l.set("ch","VirtualMirror"),l.set("server",window.location.hostname),l.set("c1",null===(n=ct)||void 0===n?void 0:n.channel),l.set("c2",null===(r=ct)||void 0===r?void 0:r.storeId),l.set("c3",null===(i=ct)||void 0===i?void 0:i.brand),l.set("c4",null===(o=ct)||void 0===o?void 0:o.locale),l.set("c5",e.upc),l.set("c6",null===(a=ct)||void 0===a?void 0:a.storeRegion),l.set("c7",null===(s=ct)||void 0===s?void 0:s.storeCompany),l.set("c8",null===(u=ct)||void 0===u?void 0:u.globalStoreId),l.set("c9",b),c=e.lensName&&ye.isFeatureAuthorized(ie.VM_TRANSITIONS)?"transition":e.upc?"standard":"undefined",l.set("c11",c),t&&(l.set("v1",t.errorSource),l.set("v2",t.errorCode),l.set("v3",t.errorDetails),l.set("v5",e.upc)),l.set("events",e.eventCode),l.set("pageName","VirtualMirror"),l.set("AQE","1"),l},Ct=function(e){var t="PRODUCTION"===lt?"https://luxottica.d2.sc.omtrdc.net/b/ss/lux-virtualmirror-prod/1?":"https://luxottica.d2.sc.omtrdc.net/b/ss/lux-virtualmirror-dev/1?",n=Array.from(e.keys()).filter((function(t){return void 0!==e.get(t)})).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e.get(t))})).join("&"),r="".concat(t).concat(n);return At.debug("sending adobe analytics event: {}",JSON.stringify({abobeHost:t,entries:V(e.entries())})),fetch(r,{method:"POST"}).catch((function(e){At.warn("failed to post analytics event {}",JSON.stringify(e))}))},kt=function(e,t){ct=e,lt="PRODUCTION"===t?"PRODUCTION":"DEVELOPMENT"},Mt=function(e){if(ye.isFeatureAuthorized(ie.VM_ANALYTICS))try{var t=_t(e);Ct(t)}catch(n){At.error(n)}},It=function(e,t){if(!ye.isInitialized())throw new $;if(ye.isFeatureAuthorized(ie.VM_ANALYTICS))try{if(["InitializationError","InvalidParametersError","UpcSupportedError","UpcMissingError","WebcamUnavailableError","WebcamRejectedError","MountComponentError","UnmountComponentError"].includes(null===e||void 0===e?void 0:e.type)){var n=_t({eventCode:"event8",upc:t},e.adobeErrorParameters);Ct(n)}}catch(r){At.error(r)}},Pt=function(){ft&&(ft=Date.now())},Rt=function(e){try{if(e in dt&&void 0!==dt[e]){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=dt)[e].apply(t,r)}}catch(o){console.error("Analytics Event Failed")}},Nt={initialize:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;Pt(),dt=t,kt(n,e)},onSessionStart:function(){(!ft||Date.now()-ft>vt)&&(ft=Date.now(),Mt({eventCode:"event1"}),Rt("onSessionStart"))},onInitializeSuccess:function(){Pt(),Rt("onInitializeSuccess")},onInitializeError:function(){Pt(),It(new U),Rt("onInitializeError")},onRequestWebcam:function(){Pt(),Mt({eventCode:"event2"}),Rt("onRequestWebcam")},onWebcamAllowed:function(){Pt(),Mt({eventCode:"event3"}),Rt("onWebcamAllowed")},onWebcamDenied:function(){Pt(),It(new Y),Rt("onWebcamDenied")},onWebcamUnavailable:function(){Pt(),It(new J),Rt("onWebcamUnavailable")},onMirrorWasmFailure:function(){Pt(),Rt("onMirrorWasmFailure")},onGlassesOn:function(){Pt(),Rt("onGlassesOn")},onGlassesOff:function(){Pt(),Rt("onGlassesOff")},onRender:function(e,t){Pt();var n=jt(e,t);Rt("onRender",n)},onRenderReady:function(e,t){Pt();var n=jt(e,t);Mt({eventCode:n?"event4:".concat(n):"event4",upc:n,lensName:t}),Rt("onRenderReady",n)},onMirrorRenderFailure:function(e,t){Pt();var n=jt(e,t);Rt("onMirrorRenderFailure",n)},onFitGlasses:function(e,t){Pt();var n=jt(e,t);Mt({eventCode:n?"event5:".concat(n):"event5",upc:n,lensName:t}),Rt("onFitGlasses")},onAdjustGlasses:function(e,t){Pt();var n=jt(e,t);Mt({eventCode:n?"event6:".concat(n):"event6",upc:n,lensName:t}),Rt("onAdjustGlasses")},onCloseMirror:function(){Pt(),Mt({eventCode:"event7"}),Rt("onCloseMirror")},onError:function(){Pt(),Rt("onError")},onScreenshot:function(e,t){Pt();var n=jt(e,t);Mt({eventCode:n?"event9:".concat(n):"event9",upc:n,lensName:t}),Rt("onScreenshot")}},jt=function(e,t){return t?"".concat(e,"_").concat(t):e},Dt=ht("CloseMirror"),Vt=function(e){try{ve.dispatch(Ve.setLoadingStatus({type:"WEBCAM_ACCESS",status:!1})),ve.dispatch(Ve.setLoadingStatus({type:"RENDERING",status:!1})),ve.dispatch(Ve.setLoadingStatus({type:"POSETRACKER",status:!1})),Nt.onCloseMirror(),Dt.debug("closing mirror for target div {}",e);var t=document.getElementById(e);if(!l.a.unmountComponentAtNode(t)){Dt.debug("closing mirror for target div {} failed",e),Tt(e);var n=new q(e);return It(n),Promise.reject(n)}return Dt.debug("closed mirror for target div {}",e),Et(e),Promise.resolve()}catch(i){Dt.debug("closing mirror for target div {} failed: {}",e,i.message);var r=new q(e);try{It(r)}catch(i){return Promise.reject(i)}return Promise.reject(r)}},Lt=ht("FitMeBetter"),Ft=function(){return new Promise((function(e,t){try{Ye()&&"TRACKING"===ve.getState().mirror.mirrorStatus?(Nt.onAdjustGlasses(ve.getState().mirror.glasses.upc,ve.getState().mirror.mirrorOptions.transitionColor),ve.dispatch(Ue.setMirrorStatus("RESET")),St(),e()):t()}catch(n){Lt.error("resetting mirror failed: {}",n.message),Ot(),t()}}))},Ut=function(e){return Object(d.b)({environment:e,version:1,accessToken:ve.getState().app.auth.accessToken,refreshToken:ve.getState().app.auth.refreshToken,onAuthUpdated:nt.onAuthUpdated})},xt={PAUSE:"vm_pause_event",RESUME:"vm_resume_event",TOPIC_SCREENSHOT_REQ:"TOPIC_SCREENSHOT_REQ",TOPIC_SCREENSHOT_RES:"TOPIC_SCREENSHOT_RES"},Bt=ht("GetScreenshot"),Wt=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/jpeg",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9;if(!ye.isFeatureAuthorized(ie.VM_SCREENSHOT))return Promise.reject(new ee(ie.VM_SCREENSHOT));var r=new Promise((function(t){e=v.a.subscribe(xt.TOPIC_SCREENSHOT_RES,(function(e,n){Nt.onScreenshot(ve.getState().mirror.glasses.upc,ve.getState().mirror.mirrorOptions.transitionColor),Bt.debug("message reveived from topic {}: total img bytes {}",e,n.imgURI.length),t({imgURI:n.imgURI,width:n.w,height:n.h})})),Bt.debug("subscription for {}: {}",xt.TOPIC_SCREENSHOT_RES,e)}));r.then((function(){e&&(v.a.unsubscribe(e),Bt.debug("unsubscribed for {}: {}",xt.TOPIC_SCREENSHOT_RES,e))}));var i=v.a.publish(xt.TOPIC_SCREENSHOT_REQ,{type:t,quality:n});return Bt.debug("published screenshot request on {}: {}",xt.TOPIC_SCREENSHOT_REQ,i),r},zt={locale:"en-US",language:"en",localeMap:{de:"de-DE",en:"en-US",es:"es-ES",fr:"fr-FR",it:"it-IT",ja:"ja-JP",ko:"ko-KR",nl:"nl-NL",pl:"pl-PL",pt:"pt-PT",sv:"sv-SE",tr:"tr-TR",zh:"zh-CN"},translations:{MIRROR:{PERMISSION_ERROR:{ERROR:"You must allow access to your camera to use Virtual Mirror.",SUBTEXT:"Click the Share or Allow button above to enable your webcam."},WEBCAM_ERROR:{ERROR:"We could not detect your webcam.",SUBTEXT:"Enable webcam access in your browser and refresh the page to continue."},GENERIC_ERROR:{ERROR:"An error occured",BUTTON:"Continue"},MANUAL_START:{BUTTON:"Start the experience",TEXT:"You are probably in Low Power Mode. The experience may be degraded."},GUIDANCE:{UNKNOWN:"Is anyone there?",DEFAULT:"Place your head in the oval",MOVE_CLOSER:"Move closer to the oval",MOVE_FARTHER:"Move farther from the screen",STAY_STILL:"Good, stay still while fitting glasses",LOOK_UP:"Look up",LOOK_RIGHT:"Look to your right",LOOK_DOWN:"Look down",LOOK_LEFT:"Look to your left",TILT_LEFT:"Tilt to your left",TILT_RIGHT:"Tilt to your right",GLASSES:"Please remove your glasses"},UI:{FIT_ME_BETTER:"Fit me better",USE_TWO_FINGERS:"Use two fingers to adjust on the nose",TAP_TO_FREEZE:"Tap and hold to freeze the screen",DESKTOP_TAP_TO_FREEZE:"Hold to freeze the screen or drag the pointer along the nose to adjust the frames"}}}},Gt=ht("LocalizationHelper"),Ht=function(){function e(){E(this,e)}return A(e,null,[{key:"getString",value:function(t,n){var r="";try{r=e.getStringFromTranslation(t,n,this.localizedTranslations)}catch(i){Gt.warn("local translation not found for [".concat(this.translationType,"][").concat(t,"][").concat(n,"] using default"));try{r=e.getStringFromTranslation(t,n,zt.translations)}catch(i){Gt.warn("default translation not found for [".concat(this.translationType,"][").concat(t,"][").concat(n,"]"))}}return r}},{key:"getStringFromTranslation",value:function(e,t,n){var r,i,o,a=null===(r=this.overriddenTranslations)||void 0===r||null===(i=r[this.translationType])||void 0===i||null===(o=i[e])||void 0===o?void 0:o[t];return a||n[this.translationType][e][t]}},{key:"setOverrides",value:function(e){this.overriddenTranslations={MIRROR:e}}},{key:"initializeRemote",value:function(e){var t=this;return new Promise((function(n,r){t.localizationPromise(e).then((function(e){t.localizedTranslations=e.localTranslations,n(e.locale)})).catch((function(e){r(e)}))}))}},{key:"cleanLocale",value:function(t){var n=t;return n&&2!==n.length||(n=zt.localeMap[n]||"en-US"),n=n.replace(e.formatLocaleRegEx,(function(e,t,n){return[t,n.toUpperCase()].join("-")}))}},{key:"getDefaults",value:function(){return zt.translations.MIRROR}}]),e}();_(Ht,"baseUrl","https://d5nhc6q3o19l2.cloudfront.net"),_(Ht,"localeRegEx",new RegExp(/([a-z]{2})-([A-Z]{2}|[0-9]*)/)),_(Ht,"localeIsoRegEx",new RegExp(/([a-z]{2})-[A-Z]{2}/)),_(Ht,"formatLocaleRegEx",new RegExp(/([a-z]{2})-([A-Z|a-z]{2})/)),_(Ht,"localizedTranslations",void 0),_(Ht,"overriddenTranslations",void 0),_(Ht,"translationType","MIRROR"),_(Ht,"fetchLocalization",(function(e){var t="".concat(Ht.baseUrl,"/vmmv/v1/prod/ui/application_").concat(e,".json");return fetch(t).then((function(t){if(t.ok)return t.json();throw Error("failed to find localization for locale: ".concat(e))})).then((function(e){return e}))})),_(Ht,"localizationPromise",(function(e){return new Promise((function(t){var n=Ht.cleanLocale(e),r=n,i=Ht.localeRegEx.exec(n),o=i&&i[1]||zt.language;if(!i){var a=new W(e);Gt.error(JSON.stringify(a)),console.warn(a)}var s=!1;Ht.fetchLocalization(n).then((function(e){s=!0,t({locale:n,localTranslations:e})})).catch((function(){Gt.warn("failed to find localization for locale: ".concat(n,", trying with ").concat(zt.localeMap[o]))})).then((function(){if(r=zt.localeMap[o],s)throw Error("break");return Ht.fetchLocalization(r)})).then((function(e){s=!0,t({locale:r,localTranslations:e})})).catch((function(){s||Gt.warn("failed to find localization language ".concat(o," mapped as locale: ").concat(r))})).then((function(){if(s)throw Error("break");return r=zt.locale,Ht.fetchLocalization(r)})).then((function(e){s=!0,t({locale:r,localTranslations:e})})).catch((function(){return s||Gt.warn("failed to find localization for locale: ".concat(r,", falling back to default ").concat(zt.locale)),Promise.resolve()})).then((function(){s||t({locale:r,localTranslations:zt.translations})}))}))}));var Kt=function(){function e(){E(this,e)}return A(e,null,[{key:"getSupportedFeatures",value:function(){return new Promise((function(e,t){var n=new p.a;return n.isVideoInputDeviceAvailable().then((function(t){t||Nt.onWebcamUnavailable(),e({wasmSupport:n.isWebAssemblySupported(),webcamAccess:n.isUserMediaSupported(),webcamAvailable:t,webglRendering:n.isWebGlSupported(),isWebView:n.isWebView()})})).catch((function(e){t(e)}))}))}}]),e}(),qt=function(){function e(){E(this,e)}return A(e,null,[{key:"initialize",value:function(e,t){return Promise.all([Ht.initializeRemote(e.locale),Kt.getSupportedFeatures()]).then((function(n){return{userStore:{locale:n[0],region:t.region,source:t.source,brand:e.brand,storeId:e.storeId,channel:e.channel},supportedFeatures:n[1]}})).catch((function(e){throw e}))}}]),e}(),Jt=function(){function e(){E(this,e),_(this,"fpsQueue",void 0),_(this,"processStartTime",void 0),this.fpsQueue=new Array(e.fpsQueueLength).fill(0)}return A(e,[{key:"fps",get:function(){return this.fpsQueue.reduce((function(e,t){return e+t}))/this.fpsQueue.length}},{key:"tick",value:function(){this.fpsQueue.shift(),this.fpsQueue.push(e.calcFps(this.processStartTime,performance.now())),this.processStartTime=performance.now()}}],[{key:"calcFps",value:function(e,t){return e&&t?1/((t-e)/1e3):0}}]),e}();_(Jt,"fpsQueueLength",30);var Yt,Qt={glasses:"PROD",video:"PRODUCTION",wasm:"PROD"},Zt={bipaActive:!1,region:void 0,source:void 0,privacyPolicy:void 0,termsAndConditions:void 0,bipaPrefill:{firstName:void 0,lastName:void 0,email:void 0},localizationText:void 0};!function(e){e.OFF="OFF",e.STANDARD="STANDARD"}(Yt||(Yt={}));var Xt={revealFX:Yt.OFF,debug:{checkError:!1,hideGlasses:!1,showMesh:!1,meshColor:[0,1,0,.5]}},$t={debug:!1,inspect:!1,recoveryLimit:1,areaSize:1,areaOffset:[0,0],depthRange:[100,2e3],axisRange:[7,50,7],fittedPointsRatio:.25,fov:52,minimumFaceSizeRatio:.3,edgeDetectionPercentage:[.15,.1,.1,.1],nudgingType:2,standstill:{timeLimit:1500,positionVariance:50,axisVariance:8,depthRange:[150,500]},onPoseTrack:function(){}},en=function(){function e(){E(this,e)}return A(e,null,[{key:"mergeInitializationParams",value:function(e){var t=S(S({},ne),e.options),n=S(S({},Zt),e.privacy),r={options:t,auth:S({},e.auth),privacy:n,privacyCallbacks:e.privacyCallbacks};if(null!==n&&void 0!==n&&n.bipaActive){if(!["US","AU","EU"].includes(n.region))throw new B("region",n.region);if(!n.source)throw new B("source",n.source)}return r}},{key:"mergeMirrorOptions",value:function(e,t,n){var r=n||{},i=r.width&&r.height?{width:r.width,height:r.height}:this.createOptionsForTarget(e),o=this.calculateMinimumPointsRatio(i.width,i.height);return{width:i.width,height:i.height,transitionColor:r.transitionColor,videoResolution:r.videoResolution?r.videoResolution:720,glassesResolution:r.glassesResolution?r.glassesResolution:"512",glassesType:t||"B3D",device:S({evaluationThreshold:Jt.fpsQueueLength/10*1e3},r.device),rendering:{revealFX:r.rendering&&r.rendering.revealFX?r.rendering.revealFX:Xt.revealFX,debug:S(S({},Xt.debug),r.rendering?r.rendering.debug:{})},nosePosition:{enabled:void 0===r.nosePosition||void 0===r.nosePosition.enabled||"boolean"!==typeof r.nosePosition.enabled||r.nosePosition.enabled,touches:this.calculateAutoPointerCount(r.nosePosition)},tracking:S(S(S({},$t),{},{minimumFaceSizeRatio:o},r.tracking),{},{standstill:S(S({},$t.standstill),r.tracking?r.tracking.standstill:{})}),fittingModel:this.calculateFittingModel(r.fittingModel),environment:S(S({},Qt),r.environment?r.environment:{})}}},{key:"calculateAutoPointerCount",value:function(e){var t=e||{enabled:!0,touches:-1},n=t.enabled,r=t.touches;return n&&r&&[1,2].includes(r)?r:h.a.mobile()||h.a.tablet()||this.isTouchDevice()?2:1}},{key:"isTouchDevice",value:function(){var e=!1;return window.PointerEvent&&"maxTouchPoints"in navigator?navigator.maxTouchPoints>0&&(e=!0):(window.matchMedia&&window.matchMedia("(any-pointer:coarse)").matches||window.TouchEvent||"ontouchstart"in window)&&(e=!0),e}},{key:"calculateMinimumPointsRatio",value:function(e,t){return Math.PI*Math.pow(.35*t,2)/(e*t)}},{key:"createOptionsForTarget",value:function(e){var t=document.getElementById(e),n={width:0,height:0};return t?(this.elementHasSize(t)?n={height:t.clientHeight,width:t.clientWidth}:t.parentElement&&this.elementHasSize(t.parentElement)&&(n={height:t.parentElement.clientHeight,width:t.parentElement.clientWidth}),n):n}},{key:"elementHasSize",value:function(e){return e.clientWidth>0&&e.clientHeight>0}},{key:"calculateFittingModel",value:function(e){return e?{videoId:e.videoId?e.videoId:void 0,pupillaryDistance:e.pupillaryDistance?e.pupillaryDistance:63}:{videoId:void 0,pupillaryDistance:63}}},{key:"glassesAreReady",value:function(e){return!!e&&"READY"===e.status}}]),e}(),tn=ht("Initialize"),nn=!1,rn=function(e){return nn||(window.addEventListener("error",(function(e){var t;t=e.error,pt.sendAppViewSession({statusCode:"99-error",statusText:t.message})})),nn=!0),ye.initialize(e.options.key,e.options.environment).then((function(){var t=en.mergeInitializationParams(e);if(t.privacy.bipaActive&&!ye.isFeatureAuthorized(ie.VM_BIPA))throw new ee(ie.VM_BIPA);var n,r=t.options;return Nt.initialize(r.environment,r.analyticsConfig,{brand:r.brand,channel:r.channel,locale:r.locale,storeId:r.storeId,storeRegion:r.storeRegion,storeCompany:r.storeCompany,globalStoreId:r.globalStoreId}),n=r.sessionTimeout,vt=n?3e5:1/0,tn.debug("initializing virtual mirror [channel={},brand={},locale={},storeId={}]",r.channel,r.brand,r.locale,r.storeId),Promise.all([qt.initialize(t.options,t.privacy),Promise.resolve(r)])})).then((function(t){var n,r,i;void 0===ve&&Qe(),i=e.options.callbacks,nt.onAuthUpdated=function(e){var t;ve.dispatch(Ve.setAuth(e)),null===i||void 0===i||null===(t=i.onAuthUpdated)||void 0===t||t.call(i,e)},i&&(i.onFaceFound&&($e=!0,nt.onFaceFound=i.onFaceFound),i.onLowEndDeviceDetected&&(nt.onLowEndDeviceDetected=i.onLowEndDeviceDetected),i.onTransitionAnimation&&(nt.onTransitionAnimation=i.onTransitionAnimation),i.onTransitionAnimationEnd&&(nt.onTransitionAnimationEnd=i.onTransitionAnimationEnd)),function(e){if(e)for(var t in e)e[t]&&(nt[t]=e[t])}(e.privacyCallbacks);var o=t[0].userStore,a=t[0].supportedFeatures,s=t[1];return s.environment!==ve.getState().app.environment&&ve.dispatch(Ve.resetAuth()),ve.dispatch(Ve.setAuth({accessToken:null===(n=e.auth)||void 0===n?void 0:n.accessToken,refreshToken:null===(r=e.auth)||void 0===r?void 0:r.accessToken})),ve.dispatch(Ve.setEnvironment(s.environment)),ve.dispatch(Ve.setPrivacyOptions(e.privacy)),ve.dispatch(Ve.setLoadingStatus({type:"INITIALIZATION",status:!0})),ve.dispatch(We.setUser(o)),tn.info("virtual mirror initialized with options {}",JSON.stringify(s)),Nt.onInitializeSuccess(),mt(s),{userId:void 0,locale:o.locale,supportedFeatures:a}})).catch((function(t){throw tn.error("virtual mirror initialization failed with options {} [{}]",JSON.stringify(e.options),JSON.stringify(t)),Nt.onInitializeError(),gt(e.options),t}))},on=ht("VmWebCam"),an=function(){function e(){E(this,e),_(this,"webCam",void 0),_(this,"webCamStream",void 0),this.webCam=new g.a}return A(e,[{key:"tryToOpenWebCam",value:function(e,t){return this.webCam.tryToOpenWebCam(e,t,"user")}},{key:"initStreamObject",value:function(e,t){this.webCamStream=this.createStreamObject(e,t)}},{key:"closeCurrentMediaStream",value:function(){this.webCam.closeCurrentMediaStream()}},{key:"pause",value:function(){var e=new p.a;this.webCamStream.isNativeStream()||!e.isAppleiOS13()?this.webCamStream.streamObject.pause():on.warn("Can't pause Webcam on iOS 13 device due a bug that would freeze video stream on resume playing")}},{key:"play",value:function(){return this.webCamStream.streamObject.play()}},{key:"stream",get:function(){return this.webCamStream}},{key:"createStreamObject",value:function(e,t){return this.webCam.createStreamObject(e,t)}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();_(an,"instance",void 0);var sn=ht("RenderMirror"),un=function(e,t){return i.a.getUpcAvailability(e,t)},cn=function(e,t,r){return new Promise((function(i,o){n.e(10).then(n.bind(null,789)).then((function(n){var a=n.MirrorAsyncRoot;ve.dispatch(Ue.setMirrorOptions(r)),sn.debug("vm default tracking options: {}",JSON.stringify($t)),sn.debug("vm mirror options: {}",JSON.stringify(r)),sn.debug("mounting render mirror component on div {}",e);try{var s=document.getElementById(e);if(s)a.mountMirror(s,ve,t,i,o,r),ln();else{var u=new K(e);It(u),o(u)}}catch(l){var c=new K(e);It(c),o(c)}})).catch((function(t){sn.error(t);var n=new K(e);It(n),o(n)}))}))},ln=function(){window&&window.addEventListener("orientationchange",(function(){var e=90===window.orientation||-90===window.orientation;sn.debug("orientation change detected [new value is {} - landscape: {}]",window.orientation,e),wt(e),window.setTimeout((function(){return Ft()}),150)}))},dn=ht("Resume"),fn=ht("SetTransitionOverrideColor"),vn=function(){function e(t){E(this,e),e.config={env:t}}return A(e,[{key:"isUpcSupported",value:function(){for(var t={},n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return r.forEach((function(n){t[n]=i.a.getUpcAvailability(e.config,n)})),t}},{key:"downloadTransitionColorCatalogue",value:function(){return e.featureLicensingInitialization.then((function(){return ye.isFeatureAuthorized(ie.VM_TRANSITIONS)?i.a.downloadTransitionColors(e.config):Promise.resolve({})}))}}],[{key:"build",value:function(t){var n=t.catalogueEnvironment,r=t.featureLicensingEnv,i=t.key;return this.featureLicensingInitialization=ye.initialize(i,r||"PRODUCTION"),new e(n||"PROD")}}]),e}();_(vn,"config",void 0),_(vn,"featureLicensingInitialization",void 0);var pn={version:function(){return"v7.3.4"},initialize:function(e){return rn(e)},overrideLocalization:function(e){return Ht.setOverrides(e)},getMirrorDefaultLocalization:function(){return Ht.getDefaults()},getBipaVersion:function(){return Ye()?ye.isFeatureAuthorized(ie.VM_GET_BIPA_VERSION)?Ut(ve.getState().app.environment).then((function(){return r.a.getBipaVersion({environment:ve.getState().app.environment,locale:ve.getState().user.locale,accessToken:ve.getState().app.auth.accessToken,refreshToken:ve.getState().app.auth.refreshToken,onAuthUpdated:nt.onAuthUpdated})})):Promise.reject(new ee(ie.VM_GET_BIPA_VERSION)):Promise.reject(new x)},saveBipaEntry:function(e){return function(e){return Ye()?ye.isFeatureAuthorized(ie.VM_SAVE_BIPA_ENTRY)?Ut(ve.getState().app.environment).then((function(){return r.a.saveBipaEntry({environment:ve.getState().app.environment,source:ve.getState().app.privacy.source,accessToken:ve.getState().app.auth.accessToken,refreshToken:ve.getState().app.auth.refreshToken,bipaVersion:e.bipaVersion,formData:{firstName:e.firstName,lastName:e.lastName,email:e.email},onAuthUpdated:nt.onAuthUpdated})})):Promise.reject(new ee(ie.VM_SAVE_BIPA_ENTRY)):Promise.reject(new x)}(e)},resetBipaState:function(){document.cookie="".concat(r.a.getCookieName("BASIC"),"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/"),document.cookie="".concat(r.a.getCookieName("BIOMETRIC"),"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/")},renderMirror:function(e){return function(e){var t;if(!Ye())return Promise.reject(new x);var n=e.target,r=e.upc,i=e.options;Nt.onSessionStart();var o={env:null!==i&&void 0!==i&&null!==(t=i.environment)&&void 0!==t&&t.glasses?i.environment.glasses:Qt.glasses};return Promise.all([un(o,r),st.downloadTransitionColors(o)]).then((function(e){var t=e[0],a=t.glassesType;if("MOCK"===o.env){sn.debug("rendering virtual mirror for upc {} on target {}",r,n),yt(r);var s=en.mergeMirrorOptions(n,a,i);return cn(n,t,s)}if("B3D"===a&&(t.available[256]||t.available[512])||"GLTF"===a&&(t.lods.includes(1)||t.lods.includes(2))){sn.debug("rendering virtual mirror for upc {} on target {}",r,n),yt(r);var u=en.mergeMirrorOptions(n,a,i);return cn(n,t,u)}sn.warn("rendering virtual mirror not possible: upc {} isn't supported",r),bt(r);var c=new H(r);throw It(c,r),c}))}(e)},pause:function(){Ye()&&(an.getInstance().pause(),m.a.publish(xt.PAUSE,{}))},resume:function(){return Ye()?an.getInstance().play().then((function(){m.a.publish(xt.RESUME,{})})).catch((function(e){dn.error(e)})):Promise.reject(new x)},fitMeBetter:function(){return Ft()},getScreenshot:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/jpeg",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9;return Wt(e,t)},setTransitionOpacity:function(e){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!Ye())throw new x;if(void 0===e){throw new Q("opacity cannot be set when mirror is not initialized")}if("number"!==typeof e||e<0||e>1){throw new Q("opacity must be a number between 0 and 1")}st.setCurrentLensOpacity(e)}(null===e||void 0===e?void 0:e.opacity)},setTransitionOverrideColor:function(e){return function(e){fn.debug("setting new override color",e),st.setTransitionOverrideColor(e)}(e)},animateOpacity:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{duration:1e3};return ut(null===e||void 0===e?void 0:e.duration)},closeMirror:function(e){return Vt(null===e||void 0===e?void 0:e.target)}}},531:function(e,t,n){(function(e){!function(n,r){"use strict";var i={};n.PubSub?(i=n.PubSub,console.warn("PubSub already loaded, using existing version")):(n.PubSub=i,function(e){var t={},n=-1,r="*";function i(e){var t;for(t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!0;return!1}function o(e){return function(){throw e}}function a(e,t,n){try{e(t,n)}catch(r){setTimeout(o(r),0)}}function s(e,t,n){e(t,n)}function u(e,n,r,i){var o,u=t[n],c=i?s:a;if(Object.prototype.hasOwnProperty.call(t,n))for(o in u)Object.prototype.hasOwnProperty.call(u,o)&&c(u[o],e,r)}function c(e,t,n){return function(){var i=String(e),o=i.lastIndexOf(".");for(u(e,e,t,n);-1!==o;)o=(i=i.substr(0,o)).lastIndexOf("."),u(e,i,t,n);u(e,r,t,n)}}function l(e){var n=String(e);return Boolean(Object.prototype.hasOwnProperty.call(t,n)&&i(t[n]))}function d(e){for(var t=String(e),n=l(t)||l(r),i=t.lastIndexOf(".");!n&&-1!==i;)i=(t=t.substr(0,i)).lastIndexOf("."),n=l(t);return n}function f(e,t,n,r){var i=c(e="symbol"===typeof e?e.toString():e,t,r);return!!d(e)&&(!0===n?i():setTimeout(i,0),!0)}e.publish=function(t,n){return f(t,n,!1,e.immediateExceptions)},e.publishSync=function(t,n){return f(t,n,!0,e.immediateExceptions)},e.subscribe=function(e,r){if("function"!==typeof r)return!1;e="symbol"===typeof e?e.toString():e,Object.prototype.hasOwnProperty.call(t,e)||(t[e]={});var i="uid_"+String(++n);return t[e][i]=r,i},e.subscribeAll=function(t){return e.subscribe(r,t)},e.subscribeOnce=function(t,n){var r=e.subscribe(t,(function(){e.unsubscribe(r),n.apply(this,arguments)}));return e},e.clearAllSubscriptions=function(){t={}},e.clearSubscriptions=function(e){var n;for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&0===n.indexOf(e)&&delete t[n]},e.countSubscriptions=function(e){var n,r,i=0;for(n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&0===n.indexOf(e)){for(r in t[n])i++;break}return i},e.getSubscriptions=function(e){var n,r=[];for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&0===n.indexOf(e)&&r.push(n);return r},e.unsubscribe=function(n){var r,i,o,a=function(e){var n;for(n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&0===n.indexOf(e))return!0;return!1},s="string"===typeof n&&(Object.prototype.hasOwnProperty.call(t,n)||a(n)),u=!s&&"string"===typeof n,c="function"===typeof n,l=!1;if(!s){for(r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(i=t[r],u&&i[n]){delete i[n],l=n;break}if(c)for(o in i)Object.prototype.hasOwnProperty.call(i,o)&&i[o]===n&&(delete i[o],l=!0)}return l}e.clearSubscriptions(n)}}(i)),void 0!==e&&e.exports&&(t=e.exports=i),t.PubSub=i,e.exports=t=i}("object"===typeof window&&window||this)}).call(this,n(537)(e))},532:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(505),i=n(93),o=n(94),a=n(579),s=function(){function e(){Object(i.a)(this,e),this.userAgentData=(new a.UAParser).getResult()}return Object(o.a)(e,[{key:"getUserAgentData",value:function(){return this.userAgentData}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),u=function(){function e(){Object(i.a)(this,e),this.simplewasm=Uint8Array.of(0,97,115,109,1,0,0,0)}return Object(o.a)(e,[{key:"isWebAssemblySupported",value:function(){var e=!1;try{if("object"===typeof WebAssembly&&"function"===typeof WebAssembly.instantiate){var t=new WebAssembly.Module(this.simplewasm);e=t instanceof WebAssembly.Module&&new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(n){e=!1}return e}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),c=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,[{key:"isWebGlSupported",value:function(){var t=!1;try{var n=document.createElement("canvas");if(n.setAttribute("id",e.tmpCanvasElementId),n)this.getWebglContext(n,["webgl2","webgl","experimental-webgl"])&&(t=!0)}catch(i){t=!1}finally{if(document){var r=document.getElementById(e.tmpCanvasElementId);r&&(r.outerHTML="")}}return t}},{key:"getWebglContext",value:function(t,n){var i,o,a=Object(r.a)(n);try{for(a.s();!(o=a.n()).done;){var s=o.value;if(i=t.getContext(s,e.webglCtxAttributes))break}}catch(u){a.e(u)}finally{a.f()}return i}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();c.tmpCanvasElementId="canvas-for-webgl-check",c.webglCtxAttributes={depth:!0,premultipliedAlpha:!1};var l=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,[{key:"isUserMediaSupported",value:function(){return this.isMediaDeviceAvailable()||this.isNativeBridgePresent()}},{key:"isVideoInputDeviceAvailable",value:function(){var e;try{e=this.isMediaDeviceAvailable()?navigator.mediaDevices.enumerateDevices().then((function(e){return e.some((function(e){return"videoinput"===e.kind}))})):this.isNativeBridgePresent()?Promise.resolve(!0):Promise.resolve(!1)}catch(t){e=Promise.resolve(!1)}return e}},{key:"isMediaDeviceAvailable",value:function(){return"object"===typeof navigator.mediaDevices&&"function"===typeof navigator.mediaDevices.getUserMedia}},{key:"isNativeBridgePresent",value:function(){return"object"===typeof window.webkit&&"object"===typeof window.webkit.messageHandlers&&"object"===typeof window.webkit.messageHandlers.startNativeCam}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),d=function(){function e(){Object(i.a)(this,e),this.uaData=s.getInstance().getUserAgentData()}return Object(o.a)(e,[{key:"isAppleiOS13",value:function(){var e=!1;return this.uaData.os&&this.uaData.os.name&&"iOS"===this.uaData.os.name?this.uaData.os.version&&this.uaData.os.version.startsWith("13")&&(e=!0,console.info("--- detected iOS 13 ---")):this.isiPadOS()&&(e=!0,console.info("--- detected iPad 13 ---"),console.warn("iPad OS detection is still a workaround, Apple does not use a specific UA for iPad")),e}},{key:"isiOS",value:function(){return this.uaData.os&&this.uaData.os.name&&"iOS"===this.uaData.os.name||this.isiPadOS()}},{key:"isiPadOS",value:function(){var e=this.uaData.os&&this.uaData.os.name&&this.uaData.os.name||void 0,t=void 0!==window.orientation&&"Mac OS"===e;return"iOS"===e||t}},{key:"getUserAgentData",value:function(){return this.uaData}},{key:"isWebView",value:function(){var e=!1;return this.uaData.os&&this.uaData.os.name&&"iOS"===this.uaData.os.name&&this.uaData.engine&&this.uaData.engine.name&&"WebKit"===this.uaData.engine.name&&this.uaData.browser&&this.uaData.browser.name&&"WebKit"===this.uaData.browser.name&&(e=!0),e}},{key:"isWebViewBrowser",value:function(){var e=!1;return this.uaData.os&&this.uaData.os.name&&"iOS"===this.uaData.os.name&&this.uaData.engine&&this.uaData.engine.name&&"WebKit"===this.uaData.engine.name&&this.uaData.browser&&this.uaData.browser.name&&"Mobile Safari"!==this.uaData.browser.name&&(e=!0),e}},{key:"isWebAssemblySupported",value:function(){return u.getInstance().isWebAssemblySupported()}},{key:"isUserMediaSupported",value:function(){return l.getInstance().isUserMediaSupported()}},{key:"isVideoInputDeviceAvailable",value:function(){return l.getInstance().isVideoInputDeviceAvailable()}},{key:"isWebGlSupported",value:function(){return c.getInstance().isWebGlSupported()}}]),e}()},533:function(e,t,n){"use strict";n.d(t,"a",(function(){return Q}));var r=n(495),i=n(559),o=n.n(i);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e){return(u="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function g(e,t,n){return(g=m()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&h(i,n.prototype),i}).apply(null,arguments)}function y(e){var t="function"===typeof Map?new Map:void 0;return(y=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return g(e,arguments,p(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),h(r,e)})(e)}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e,t){if(t&&("object"===typeof t||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return b(e)}function S(e){var t=m();return function(){var n,r=p(e);if(t){var i=p(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return w(this,n)}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function E(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"===typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}var T="@luxottica/vm-webcam",A="1.3.1",_=function(e){return fetch(e).then((function(e){return e.blob()})).then((function(e){return new Promise((function(t,n){var r=new FileReader;r.onloadend=function(){return t(r.result)},r.onerror=n,r.readAsDataURL(e)}))}))},C=function(){function e(){c(this,e),f(this,"id",void 0),f(this,"label",void 0),f(this,"settings",void 0),this.id=o()(),this.label="mock-stream-track",this.settings={}}return d(e,[{key:"getSettings",value:function(){return this.settings}},{key:"stop",value:function(){}}]),e}(),k=function(){function e(t){c(this,e),f(this,"id",void 0),f(this,"tracks",[]),this.id=o()(),this.tracks.push(new C)}return d(e,[{key:"getTracks",value:function(){return this.tracks}},{key:"getVideoTracks",value:function(){return this.tracks}}]),e}(),M=function(){function e(){c(this,e)}return d(e,[{key:"getUserMedia",value:function(e){return new Promise((function(e,t){var n=localStorage.getItem("vm.mock.videoSrc");if(null!==n)return _(n).then((function(t){console.log("RESULT OK"),e(new k)})).catch((function(e){console.error(e)}));t(new Error("video src undefined"))}))}}]),e}(),I=function e(){c(this,e)};f(I,"isNativeBridgePresent",void 0);var P,R=function(e){v(n,e);var t=S(n);function n(){var e;c(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return f(b(e=t.call.apply(t,[this].concat(i))),"onStartNativeCam",void 0),f(b(e),"onCamFrame",void 0),f(b(e),"close",(function(){window.webkit.messageHandlers.closeNativeCam.postMessage(void 0)})),f(b(e),"start",(function(e){window.webkit.messageHandlers.startNativeCam.postMessage(e)})),f(b(e),"pause",(function(){window.webkit.messageHandlers.pauseNativeCam&&window.webkit.messageHandlers.pauseNativeCam.postMessage(void 0)})),f(b(e),"resume",(function(){window.webkit.messageHandlers.resumeNativeCam&&window.webkit.messageHandlers.resumeNativeCam.postMessage(void 0)})),e}return d(n,null,[{key:"isNativeBridgePresent",value:function(){return"object"===u(window.webkit)&&"object"===u(window.webkit.messageHandlers)&&"object"===u(window.webkit.messageHandlers.startNativeCam)}}]),n}(I),N=function(){function e(t){c(this,e),f(this,"id",void 0),f(this,"label",void 0),f(this,"settings",void 0),this.id=o()(),this.label="native-stream-track",this.settings={height:t.height,width:t.width}}return d(e,[{key:"getSettings",value:function(){return this.settings}},{key:"stop",value:function(){window.NativeBridge.close()}}]),e}(),j=function(){function e(t){c(this,e),f(this,"id",void 0),f(this,"tracks",[]),this.id=o()(),this.tracks.push(new N(t))}return d(e,[{key:"getTracks",value:function(){return this.tracks}},{key:"getVideoTracks",value:function(){return this.tracks}}]),e}(),D=r.b.getInstance().getLoggerInfo(T,A,"NativeBridgeMedia"),V=function(){function e(){c(this,e),f(this,"remoteLog",new r.a)}return d(e,[{key:"getUserMedia",value:function(e){var t=this;D.info("opening Native Camera with {}",JSON.stringify(e));var n=this.getRequiredResolution(e);return new Promise((function(e,r){window.NativeBridge=new R,window.NativeBridge.start(n),window.NativeBridge.onStartNativeCam=function(n,i){if(i){var o="Error starting Native Camera -> "+JSON.stringify(i);D.error(o),t.remoteLog.sendAppViewSession({statusCode:"webcam-stream-error",statusText:o}),r(i)}else D.info("Started Native Camera"),t.remoteLog.sendAppViewSession({statusCode:"webcam-stream",statusText:"Started Native Camera"}),e(new j(n));window.NativeBridge.onStartNativeCam=void 0}}))}},{key:"getRequiredResolution",value:function(e){var t=null;if(e&&e.video&&"boolean"!==typeof e.video&&e.video.width&&e.video.height){var n="number"===typeof e.video.width?e.video.width:e.video.width.ideal;t={resolution:{height:"number"===typeof e.video.height?e.video.height:e.video.height.ideal,width:n}}}return t}}]),e}(),L=function(){function e(){c(this,e),f(this,"userMedia",void 0),f(this,"mockOptionName","vm.mock.video"),"true"===localStorage.getItem(this.mockOptionName)?this.userMedia=new M:this.userMedia=navigator.mediaDevices||new V}return d(e,[{key:"get",value:function(){return this.userMedia}}]),e}(),F=function(){function e(t){c(this,e),f(this,"videoSrc",void 0),f(this,"imageElement",void 0),f(this,"privateCurrentTime",0),f(this,"mediaStream",void 0),f(this,"playingListener",[]);var n=localStorage.getItem("vm.mock.videoSrc");if(!n)throw new Error("no video src defined");this.videoSrc=n,this.imageElement=new Image,this.mediaStream=new k}return d(e,[{key:"currentTime",get:function(){return this.privateCurrentTime++,this.privateCurrentTime}},{key:"videoWidth",get:function(){var e;return null===(e=this.imageElement)||void 0===e?void 0:e.width}},{key:"videoHeight",get:function(){var e;return null===(e=this.imageElement)||void 0===e?void 0:e.height}},{key:"defaultMuted",get:function(){return console.debug("This is a mock context, defaultMuted will always return true"),!0},set:function(e){console.debug("This is a mock context, is not possible to set mute a video stream")}},{key:"width",get:function(){return this.imageElement.width},set:function(e){console.debug("This is a mock context, not possible to set image width")}},{key:"height",get:function(){return this.imageElement.height},set:function(e){console.debug("This is a mock context, not possible to set image height")}},{key:"addEventListener",value:function(e,t,n){"playing"===e?this.playingListener.push(t):t()}},{key:"removeEventListener",value:function(e,t,n){"playing"===e&&(this.playingListener=[])}},{key:"play",value:function(){var e=this;return new Promise((function(t,n){e.waitForFrame().then((function(){var n,r=E(e.playingListener);try{for(r.s();!(n=r.n()).done;){(0,n.value)()}}catch(i){r.e(i)}finally{r.f()}t()})).catch((function(){n()}))}))}},{key:"pause",value:function(){console.debug("This is a mock context, not possible to pause")}},{key:"close",value:function(){console.debug("This is a mock context, not possible to close")}},{key:"image",get:function(){return this.imageElement}},{key:"waitForFrame",value:function(){var e=this;return _(this.videoSrc).then((function(t){try{e.imageElement.setAttribute("src",t)}catch(n){throw n}}))}}]),e}(),U=function(){function e(t,n){var r=this;c(this,e),f(this,"imageElement",void 0),f(this,"privateCurrentTime",0),f(this,"mediaStream",void 0),f(this,"playingListener",[]),this.mediaStream=n,this.imageElement=new Image,this.imageElement.width=this.mediaStream.getVideoTracks()[0].getSettings().width,this.imageElement.height=this.mediaStream.getVideoTracks()[0].getSettings().height,window.NativeBridge.onCamFrame=function(e){r.imageElement.src=e}}return d(e,[{key:"currentTime",get:function(){return this.privateCurrentTime}},{key:"videoWidth",get:function(){return this.imageElement.width}},{key:"videoHeight",get:function(){return this.imageElement.height}},{key:"defaultMuted",get:function(){return console.debug("This is a native context, defaultMuted will always return true"),!0},set:function(e){console.debug("This is a native context, is not possible to set mute a video stream")}},{key:"width",get:function(){return this.imageElement.width},set:function(e){console.debug("This is a native context, not possible to set image width")}},{key:"height",get:function(){return this.imageElement.height},set:function(e){console.debug("This is a native context, not possible to set image height")}},{key:"addEventListener",value:function(e,t,n){"playing"===e?this.playingListener.push(t):t()}},{key:"removeEventListener",value:function(e,t,n){"playing"===e&&(this.playingListener=[])}},{key:"play",value:function(){var e=this;return new Promise((function(t,n){window.NativeBridge.resume(),e.waitForFrame().then((function(){e.startTimeCounter();var n,r=E(e.playingListener);try{for(r.s();!(n=r.n()).done;){(0,n.value)()}}catch(i){r.e(i)}finally{r.f()}t()})).catch((function(){n()}))}))}},{key:"pause",value:function(){window.NativeBridge.pause()}},{key:"close",value:function(){window.NativeBridge.close()}},{key:"image",get:function(){return this.imageElement}},{key:"waitForFrame",value:function(){var e=this;return new Promise((function(t,n){e.imageElement.onload=function(){t()},e.imageElement.onerror=function(){n()}}))}},{key:"startTimeCounter",value:function(){var e=this;this.imageElement.onload=function(){e.privateCurrentTime++}}}]),e}(),x=function(){function e(t,n){c(this,e),f(this,"video",void 0);var r=document.getElementById(t.target);if(!r)throw new Error("Impossible to start video on undefined element -> "+t.target);this.video=document.createElement("video"),this.video.id=t.id||"",this.video.className=t.className||"",this.video.muted=!0,this.video.setAttribute("playsinline",null),this.video.srcObject=n,r.appendChild(this.video)}return d(e,[{key:"currentTime",get:function(){return this.video.currentTime}},{key:"videoWidth",get:function(){return this.video.videoWidth}},{key:"videoHeight",get:function(){return this.video.videoHeight}},{key:"defaultMuted",get:function(){return this.video.defaultMuted},set:function(e){this.video.defaultMuted=e}},{key:"width",get:function(){return this.video.width},set:function(e){this.video.width=e}},{key:"height",get:function(){return this.video.height},set:function(e){this.video.height=e}},{key:"addEventListener",value:function(e,t,n){this.video.addEventListener(e,t,n)}},{key:"removeEventListener",value:function(e,t,n){this.video.removeEventListener(e,t,n)}},{key:"play",value:function(){return this.video.play()}},{key:"pause",value:function(){this.video.pause()}},{key:"image",get:function(){return this.video}}]),e}(),B=function(){function e(t,n){c(this,e),f(this,"mockOptionName","vm.mock.video"),f(this,"privateStreamObject",void 0),this.isMockStream()?this.privateStreamObject=new F(t):this.isMediaStream(n)?this.privateStreamObject=new x(t,n):this.privateStreamObject=new U(t,n)}return d(e,[{key:"streamObject",get:function(){return this.privateStreamObject}},{key:"close",value:function(){this.privateStreamObject.constructor.name===x.name?this.privateStreamObject.pause():this.privateStreamObject.close()}},{key:"isMockStream",value:function(){return"true"===localStorage.getItem(this.mockOptionName)}},{key:"isNativeStream",value:function(){return this.privateStreamObject.constructor.name===j.name}},{key:"isMediaStream",value:function(e){return e.constructor.name===MediaStream.name}}]),e}(),W={audio:!1,video:{facingMode:"user",height:{ideal:720,max:720},width:{ideal:1280,max:1280}}},z=["Snap Camera"],G=function(){function e(){c(this,e)}return d(e,null,[{key:"getConstraints",value:function(t,n,r){return e.getDeviceIdConstraints().then((function(e){return s(s({},W),{},{audio:!1,video:{deviceId:e,facingMode:r,height:s(s({},W.video.height),{},{ideal:n}),width:s(s({},W.video.width),{},{ideal:t})}})}))}},{key:"getDeviceIdConstraints",value:function(){return navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices().then((function(e){return e.filter((function(e){return"videoinput"===e.kind&&!z.includes(e.label)})).map((function(e){return e.deviceId}))}))||Promise.resolve(void 0)}}]),e}(),H=function(e){v(n,e);var t=S(n);function n(e){var r;return c(this,n),r=t.call(this,e),Object.setPrototypeOf(b(r),(this instanceof n?this.constructor:void 0).prototype),r}return n}(y(Error)),K=function(e){v(n,e);var t=S(n);function n(){return c(this,n),t.call(this,"webcam not found")}return n}(H),q=function(e){v(n,e);var t=S(n);function n(){return c(this,n),t.call(this,"webcam access was rejected")}return n}(H),J=function(e){v(n,e);var t=S(n);function n(){return c(this,n),t.call(this,"webcam system error")}return n}(H);!function(e){e.WEBCAM_OK="vm-webcam-ok",e.WEBCAM_KO="vm-webcam-ko",e.WEBCAM_KO_REASON_MESS="vm-webcam-ko_reason_mess",e.WEBCAM_SIZE_W="_webcam_size_w",e.WEBCAM_SIZE_H="_webcam_size_h",e.WEBCAM_FRAMERATE="_webcam_framerate",e.WEBCAM_OPENED="_webcam_opened",e.WEBCAM_CLOSED="_webcam_closed",e.WEBCAM_OPENING="_webcam_opening",e.WEBCAM_OPENING_TIME="_webcam_opening_time_s",e.WEBCAM_POWERED_TIME="_webcam_powered_time_s"}(P||(P={}));var Y=r.b.getInstance().getLoggerInfo(T,A,"WebCam"),Q=function(){function e(){c(this,e),f(this,"remoteLog",new r.a),f(this,"userMediaPromise",void 0),f(this,"userReqPermissionTime",0),f(this,"userResPermissionTime",0)}return d(e,[{key:"tryToOpenWebCam",value:function(e,t,n){var r=this;return new Promise((function(i,o){G.getConstraints(e,t,n).then((function(e){r.tryToOpen(e).then((function(e){return i(e)})).catch((function(e){switch(e.name){case"AbortError":case"NotReadableError":o(new J);case"NotFoundError":case"TypeError":case"OverconstrainedError":o(new K);case"NotAllowedError":case"SecurityError":o(new q);default:o(new J)}}))}))}))}},{key:"closeCurrentMediaStream",value:function(){var e=this;this.userMediaPromise&&this.userMediaPromise.then((function(t){try{t.getTracks().forEach((function(n){var r=e.streamOpenedTotalTime();Y.info("closing webcam mediastream {} track {} [after {} secs]",t.id,n.label,r),n.stop(),e.logCloseSucc(t.id,r)}))}catch(n){Y.warn("error closing mediastream {} tracks",t.id)}})).catch((function(e){Y.warn("error closing mediastream: {}",e)}))}},{key:"listMediaDevices",value:function(){navigator.mediaDevices.enumerateDevices().then((function(e){e.forEach((function(e){Y.info("found {}: {}",e.deviceId,e.label)}))}))}},{key:"createStreamObject",value:function(e,t){return new B(e,t)}},{key:"tryToOpen",value:function(e){var t=this;return Y.info("try to open webcam fow with constraints {}",JSON.stringify(e)),this.remoteLog.sendAppViewSession({statusCode:P.WEBCAM_OK+P.WEBCAM_OPENING,statusText:JSON.stringify(e)}),this.userReqPermissionTime=performance.now(),this.userMediaPromise=(new L).get().getUserMedia(e),this.userMediaPromise.then((function(e){t.userResPermissionTime=performance.now();var n=t.permissionWaitingTime();Y.info("webcam opened in {} secs [mediastream id: {}]",n,e.id),t.logOpenSucc(e.id,n),e.getVideoTracks().map((function(e){t.logTrackSettings(e)}))})).catch((function(e){Y.warn("webcam not opened after {} secs ([{}] {})",t.permissionWaitingTime(),e.name,e.message),e.constraintName&&Y.warn("failed constraint: {}"+e.constraintName),t.logOpenFail(e)})),this.userMediaPromise}},{key:"logCloseSucc",value:function(e,t){this.remoteLog.sendAppViewSession({statusCode:P.WEBCAM_OK+P.WEBCAM_CLOSED,statusText:e},{statusCode:P.WEBCAM_OK+P.WEBCAM_POWERED_TIME,statusText:t?t.toFixed(2):"n.a."})}},{key:"logOpenSucc",value:function(e,t){this.remoteLog.sendAppViewSession({statusCode:P.WEBCAM_OK,statusText:e}),this.remoteLog.sendAppViewSession({statusCode:P.WEBCAM_OK+P.WEBCAM_OPENING_TIME,statusText:t?t.toFixed(2):"n.a."})}},{key:"logOpenFail",value:function(e){this.remoteLog.sendAppViewSession({statusCode:P.WEBCAM_KO,statusText:e.name},{statusCode:P.WEBCAM_KO_REASON_MESS,statusText:e.name+": "+e.message})}},{key:"logTrackSettings",value:function(e){if(e&&e.getSettings()){var t=e.getSettings().width,n=e.getSettings().height,r=e.getSettings().frameRate;Y.info("webcam mediastream track available '{}' [id {} - w {} - h {} - framerate {}]",e.label,e.id,t,n,r),this.remoteLog.sendAppViewSession({statusCode:P.WEBCAM_OK+P.WEBCAM_SIZE_W,statusText:t?t.toString():"n.a."},{statusCode:P.WEBCAM_OK+P.WEBCAM_SIZE_H,statusText:n?n.toString():"n.a."},{statusCode:P.WEBCAM_OK+P.WEBCAM_FRAMERATE,statusText:r?Math.round(r).toString():"n.a."})}}},{key:"streamOpenedTotalTime",value:function(){return 0===this.userResPermissionTime?0:(performance.now()-this.userResPermissionTime)/1e3}},{key:"permissionWaitingTime",value:function(){return 0===this.userReqPermissionTime?0:(performance.now()-this.userReqPermissionTime)/1e3}}]),e}()},612:function(e,t,n){"use strict";n.r(t);var r=n(511);n.d(t,"PrivacyLocalizationKey",(function(){return r.c}));var i=n(520);n.d(t,"GlassesEnvironment",(function(){return i.c}));var o=n(503);n.d(t,"UpcMissingError",(function(){return o.j})),n.d(t,"UpcSupportedError",(function(){return o.E})),n.d(t,"VirtualMirror",(function(){return o.B})),n.d(t,"VirtualMirrorCatalogue",(function(){return o.D})),n.d(t,"VmAbstractError",(function(){return o.A})),n.d(t,"VtoError",(function(){return o.A})),n.d(t,"performanceEvents",(function(){return o.C}));n(495),n(77),n(515),n(531),n(532),n(519),n(522),n(533)}}]);
//# sourceMappingURL=47.chunk.js.map