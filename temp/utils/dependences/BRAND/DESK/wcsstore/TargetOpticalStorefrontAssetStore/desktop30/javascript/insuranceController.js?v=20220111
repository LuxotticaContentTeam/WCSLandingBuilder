var insuranceController={lastLoginMethod:"",idleTime:0,activateDebugMode:function(){this.settingInsurance({result:"ok",data:{contact:[{available:!0,reimbursement:"150",discount:0,nextServiceDate:"01/01/2020"}],frames:[{available:!0,reimbursement:"150",nextServiceDate:"01/01/2018"}],lenses:[{available:!0,reimbursement:"150",nextServiceDate:"01/01/2019"}],exam:[{available:!0,reimbursement:"150",nextServiceDate:"01/01/2020"}]},patientInfo:{firstName:"Ajeje",lastName:"Brazof"}})},checkZipField:function(e){var n=$(e).val();for(newInp="",i=0;i<n.length;i++)/^[0-9]+$/.test(n[i])&&(newInp+=n[i]);$(e).val(newInp)},maskDateInput:function(){var e=this.value;null!==e.match(/^\d{2}$/)?this.value=e+"/":null!==e.match(/^\d{2}\/\d{2}$/)&&(this.value=e+"/")},closeCommunicationErrorModal:function(){$("#insur-communication-error-modal .close").click()},isValidForm:function(e,n){var i=!1;if(!1!==$("#insurance-information-form")[0].checkValidity()&&(e.stopPropagation(),e.preventDefault(),i=!0,"personal"===n)){var a=$("input[name='zip']").val(),t=Date.parse($("#insuranceDOB").val());isNaN(t)||t<Date.parse("01/01/1920")||t>Date.parse(new Date)?(i=!1,$("#insuranceDOB").addClass("is-invalid")):$("#insuranceDOB").removeClass("is-invalid"),5==a.length&&constants.regex.zip.usa.test(a)?$("input[name='zip']").removeClass("is-invalid"):(i=!1,$("input[name='zip']").addClass("is-invalid"))}if(i)$("#insurance-information-form").addClass("was-validated");else{$("#insurance-information-form").removeClass("was-validated");try{utagFiller.insuranceTentative("Invalid Form","Invalid Form. Check your "+n+" information","personal"===n?sessionStorage.getItem("ins_provider"):"")}catch(e){console.log("Cannot fill insurance analytics")}if("personal"===n){var r=$("#insurance-information-form select[name='provider']")[0].validity.customError;$(".selectize-input").toggleClass("is-invalid",r)}}return i},sendInsuranceRequest:function(e){return $.post("/webapp/wcs/stores/jsonpInsuranceAjax.jsp",e).promise()},checkInsuranceForm:function(e){var n=0===$("fieldset#plan-information-fieldset input").filter(function(){return 0===this.value.length}).length?"plan":"personal";if(this.lastLoginMethod=n,insuranceController.isValidForm(e,n)){this.openPanelWithId("insurance-loading-panel");var i="",a="",t="";if("personal"===n){var r=$("#insuranceDOB")[0].valueAsDate;i=(r.getUTCMonth()+1).toString().padStart(2,"0"),a=r.getUTCDate().toString().padStart(2,"0"),t=r.getUTCFullYear().toString()}if($.cookie("lux_omn_debug"))this.activateDebugMode();else{var o={planID:$("input[name='planID']").val(),memberID:$("input[name='memberID']").val(),firstName:$("input[name='firstName']").val(),lastName:$("input[name='lastName']").val(),birth_month:i,birth_date:a,birth_year:t,zip:$("input[name='zip']").val(),infoForm:n,provider:sessionStorage.getItem("ins_provider")||"EYEMED",storeId:storeId};this.sendInsuranceRequest(o).then(function(e){insuranceController.settingInsurance(e)},function(e){sendDLOnInsuranceSync(e,null),insuranceController.openHoverigPanel(),insuranceController.openPanelWithId("insurance-form"),insuranceController.openCommunicationErrorMessage();try{utagFiller.insuranceTentative("Communication error","The store has encountered a problem processing the last request. Try again later. If the problem persists, contact your site administrator.",o.provider)}catch(e){console.log("Cannot fill insurance analytics")}})}}},updateFieldsetRequired:function(){var e=$("fieldset#personal-information-fieldset input:not(#provider-selectized), fieldset#personal-information-fieldset select"),n=$("fieldset#plan-information-fieldset input"),i=e.filter(function(){return 0===this.value.length}),a=n.filter(function(){return 0===this.value.length});e.prop("required",0!==a.length),n.prop("required",0!==i.length)},closeAllPanels:function(){$(".insur-panel-step").addClass("d-none")},openPanelWithId:function(e){this.closeAllPanels(),$("#"+e).removeClass("d-none"),$(".insur-panel-step :not(.d-none) .close").focus()},openHoverigPanel:function(){return $("#panel-insurance").addClass("in"),$(".insur-panel-step :not(.d-none) .close").focus(),!1},closeHoverigPanel:function(){$("#panel-insurance").removeClass("in")},userNotFound:function(){$("#insurance-form .title").html('<img class="mr-2" src="/wcsstore/TargetOpticalStorefrontAssetStore/images/icons/alert.svg">We\'re having trouble finding you'),$("#insurance-form .subtitle").text("Make sure the information you entered matches your insurance details."),$("#need-help").removeClass("d-none"),insuranceController.openPanelWithId("insurance-form"),setTimeout(function(){$("#plan-information-fieldset")[0].scrollIntoView({behavior:"smooth",block:"center"})},1e3)},settingInsurance:function(e){var n=!1;if("ok"==e.result){var i,a,t,r;RiaHelper.getInsuranceCookie()||(n=!0,document.cookie="restart=1",sendDLOnInsuranceSync(e,null)),e.data.frames&&(i=e.data.frames[0].available),e.data.lenses&&(a=e.data.lenses[0].available),e.data.contact&&(t=e.data.contact[0].available),e.data.exam&&(r=e.data.exam[0].available);var o="";if(i&&(o+="frames"),a&&(""!=o&&(o+=","),o+="lenses"),t&&(""!=o&&(o+=","),o+="contact"),r&&(""!=o&&(o+=","),o+="eye exam"),RiaHelper.setTentativeCookie(4),RiaHelper.saveJsonInsurance(e),this.settingPanelDetailsInsurance(e.data),n){try{utagFiller.insuranceAppliedEvent(o,sessionStorage.getItem("ins_provider"))}catch(e){console.log("Cannot fire Insurance-Applied event")}window.isPdp||((window.location.href.indexOf("AjaxOrderItemDisplayView")>-1||window.location.href.indexOf("CartView")>-1)&&(RiaHelper.toggleInsurance(!0),applyInsurance(!0),window.globalMethods.onInsuranceClosing("add_success")),location.reload())}else{try{utagFiller.insuranceApplied(o,sessionStorage.getItem("ins_provider"))}catch(e){console.log("Cannot fill insurance analytics")}this.openPanelWithId("insurance-benefits-panel")}constants.ajaxParams.insuranceCheckEligibility=!0}else{var s=RiaHelper.getTentativeUserCookie(),l=""===s?3:parseInt(s)-1;l>0?(RiaHelper.setTentativeCookie(l),this.userNotFound(),$("#plan-information-fieldset").prop("disabled",!1).removeClass("hide"),insuranceController.updateFieldsetRequired(),sendDLOnInsuranceSync(e,l)):(insuranceController.openHoverigPanel(),this.openPanelWithId("insurance-lock-error-panel"),RiaHelper.setTentativeCookie(),sendDLOnInsuranceSync(e,null));try{utagFiller.insuranceTentative("SOMETHING WENT WRONG","Make sure what you entered matches the insurance information on file. For your security, you will have Insurance Not Found Panel 3 more chances to look up your insurance benefits. For help call, 1-877-848-8476",sessionStorage.getItem("ins_provider"))}catch(e){console.log("Cannot fill insurance analytics")}constants.ajaxParams.insuranceCheckEligibility=!1}if(!n)if(e.trackingInfo)window._dl=e.trackingInfo;else{var c={site_events:{insurance_check_eligibility:!0},insurance_status:getUserInsuranceEligibilityStatus()};constants.ajaxParams.insuranceCheckEligibility?(e.trackingInfo=c,RiaHelper.setTentativeCookie(4),RiaHelper.saveJsonInsurance(e)):callTrackAnalytics(c),window._dl=c}},settingPanelDetailsInsurance:function(e,n){var i=!1;Object.keys(e).filter(function(e){return!e.includes("_add")}).map(function(n){value=e[n],value&&value.length?(insuranceController.setPanel(n,!!value[0].available),i=i||!!value[0].available):insuranceController.setPanel(n,!1)}),n||(i?($("#benefits-success").removeClass("d-none"),$("#benefits-unsuccess").addClass("d-none")):($("#benefits-unsuccess").removeClass("d-none"),$("#benefits-success").addClass("d-none")))},setPanel:function(e,n){n?$("."+e+"-benefit .text-success").removeClass("d-none"):$("."+e+"-benefit .text-unsuccess").removeClass("d-none")},openSessionExpiredMessage:function(){"4"===RiaHelper.getCookie("tentative_user")&&$("#insur-session-expiration-modal").modal()},openCommunicationErrorMessage:function(){$("#insurance-information-form").removeClass("was-validated"),$("#insur-communication-error-modal").modal()},orderCalculateSenzaBenefit:function(){formParams={riaInsuranceInformation:"",chooseBenefit:!1,storeId:storeId,catalogId:catalogId,langId:langId};var e=$("#shoppingCartUrlNoInsurance").val(),n=$('<form action="'+e+'" method="POST"></form>').appendTo("body");for(var i in formParams)$field=$('<input type="text"/>').attr("name",i).attr("value",formParams[i]),n.append($field);n.submit()},checkSyncUserInactivity:function(){var e=RiaHelper.getTentativeUserCookie(),n=RiaHelper.loadJsonInsurance();if(""!=e&&n){RiaHelper.setTentativeCookie(4);setInterval(insuranceController.incrementTimer,6e4);$(document).on("click keydown keypress keyup dblclick",function(){insuranceController.idleTime=0})}},incrementTimer:function(){insuranceController.idleTime=insuranceController.idleTime+1,insuranceController.idleTime>29&&insuranceController.openSessionExpiredMessage()},checkNumericField:function(e){-1!==$.inArray(e.keyCode,[46,8,9,27,13,110,190])||65===e.keyCode&&(!0===e.ctrlKey||!0===e.metaKey)||e.keyCode>=35&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()},checkInsuranceStatus:function(){if(RiaHelper.getTentativeUserCookie()){var e=parseInt(RiaHelper.getTentativeUserCookie());if(window.insuranceLP&&openSticky(this),e<=0)this.openPanelWithId("insurance-lock-error-panel");else if(""!=RiaHelper.getInsuranceCookie()){var n=RiaHelper.loadJsonInsurance();n&&n.data&&n.data.contact&&!n.data.contact[0]?$.post("/webapp/wcs/stores/jsonpInsuranceAjax.jsp",{token:n.token,infoForm:"sync",storeId:"12001"}).done(function(e){null!=e.reimbursement&&null!=e.discount&&0==e.reimbursement&&0==e.discount&&(e.available=!1),n.data.contact[0]=e,insuranceController.settingInsurance(n)}).fail(function(e){sendDLOnInsuranceSync(e,null),insuranceController.openPanelWithId("insurance-form"),insuranceController.openCommunicationErrorMessage()}):this.settingInsurance(n)}else this.openSessionExpiredMessage()}else RiaHelper.getInsuranceCookie()&&RiaHelper.removeInsuranceCookie(),insuranceController.openPanelWithId("insurance-form"),this.settingPanelDetailsInsurance("");"1"==RiaHelper.getCookie("restart")&&(document.cookie="restart=2",insuranceController.openHoverigPanel(),this.openPanelWithId("insurance-benefits-panel"))},openFromToggle:function(){this.checkInsuranceStatus(),this.openHoverigPanel()},desync:function(){RiaHelper.removeInsuranceCookie(),insuranceController.settingPanelDetailsInsurance("",!0),location.href.includes("AjaxOrderItemDisplayView")?insuranceController.orderCalculateSenzaBenefit():location.reload()},tryAgain:function(e){$("#insurance-information-form").removeClass("was-validated"),this.openPanelWithId("insurance-form")},setupSelectize:function(){window.insuranceProviders?$("select#provider").selectize({options:Object.values(window.insuranceProviders),labelField:"text",valueField:"text",openOnFocus:!1,maxItems:1,plugins:{no_results:{},clear_button:{className:"clear-input",label:""}},onInitialize:function(){this.$control.addClass("form-control"),this.$input[0].setCustomValidity("This field is required"),this.$control.on("click",function(){this.ignoreFocusOpen=!0,setTimeout(function(){this.ignoreFocusOpen=!1},50)})},onFocus:function(){this.ignoreFocusOpen||this.open()},onChange:function(e){if(e){var n=Object.values(window.insuranceProviders).filter(function(n){return n.text===e})[0];sessionStorage.setItem("ins_provider",n.value),n.network?($("#first-name").prop("disabled",!1),$("#last-name").prop("disabled",!1),$("#insuranceDOB").prop("disabled",!1),$("#zip-code").prop("disabled",!1),$("#certificate-1").prop("disabled",!1),$("#plan-group-id").prop("disabled",!1),$("#member-id").prop("disabled",!1),$("#submit-insur-info").prop("disabled",!1),$(".form-group.submit").removeClass("hide"),$("#out-of-network-error").addClass("hide"),$(".form-row:not(.selectize)").removeClass("d-none")):($("#first-name").prop("disabled",!0),$("#last-name").prop("disabled",!0),$("#insuranceDOB").prop("disabled",!0),$("#zip-code").prop("disabled",!0),$("#certificate-1").prop("disabled",!0),$("#plan-group-id").prop("disabled",!0),$("#member-id").prop("disabled",!0),$("#submit-insur-info").prop("disabled",!0),$(".form-group.submit").addClass("hide"),$("#out-of-network-error").removeClass("hide"),$(".form-row:not(.selectize)").addClass("d-none"),$("#out-of-network-error").html('<span class="strong">'+n.description+"</span>"))}insuranceController.updateFieldsetRequired(),this.$input[0].setCustomValidity(this.isInvalid?"This field is required":""),$("#insurance-information-form").hasClass("was-validated")&&(this.$control.toggleClass("is-invalid",this.isInvalid),this.$control.toggleClass("is-valid",!this.isInvalid))}}):console.error("\n\n\n\n\n\nNO INSURANCE PROVIDERS\n\n\n\n\n\n")},setupInputFields:function(){$(".input-field").each(function(){var e=$(this),n=e.find("input"),i=e.find("select"),a=e.find("label");function t(){var a;a=0,n.length>0&&(a+=n.val().toString().length),i.length>0&&(a+=i.val().toString().length),a>0?e.addClass("active"):e.removeClass("active")}n.attr("required")&&a.text(a.text()+"*"),e.filter(":not(.selectize)").append($('<a class="clear-input"></a>').on("mousedown",function(){n.val("").trigger("change"),setTimeout(function(){n.focus()},0)})),n.on("keyup",function(){t()}),n.on("focus",function(){t(),e.addClass("focused")}),n.on("blur",function(){t(),e.removeClass("focused")}),n.on("change",function(){insuranceController.updateFieldsetRequired()})}),$("#insuranceDOB")[0].min=new Date("01/01/1920").toISOString().substring(0,10),$("#insuranceDOB")[0].max=(new Date).toISOString().substring(0,10)},setupEvents:function(){$("#zip-code").on("keydown",function(e){insuranceController.checkNumericField(e)}),$("#submit-insur-info").on("click",function(e){insuranceController.checkInsuranceForm(e)}),$("#insurance-information-form").on("submit",function(e){return!1}),$(".js-main-nav-mobile #menuInsuranceBtn, .js-main-nav-desktop #menuInsuranceBtn").on("click",insuranceController.openHoverigPanel),$("#insuranceDOB").on("keyup",insuranceController.maskDateInput),$("#zip-code").on("keyup",function(){insuranceController.checkZipField("#zip-code")}),$("#remove-insurance-sync-btn").on("click",insuranceController.desync),$("#insur-session-expiration-modal").on("hide.bs.modal",insuranceController.desync),$("#insur-check-again").on("click",function(){insuranceController.tryAgain(!0)}),$("#insur-check-again-alternative").on("click",function(){insuranceController.tryAgain(!1)}),$("#continue-shopping-btn").on("click",insuranceController.closeHoverigPanel),this.setupInputFields()}};$("document").ready(function(){insuranceController.checkInsuranceStatus(),insuranceController.checkSyncUserInactivity(),$("#panel-insurance").length&&(insuranceController.setupSelectize(),insuranceController.setupEvents())});
//# sourceMappingURL=insuranceController.js.map