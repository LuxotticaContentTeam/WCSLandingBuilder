var tooptipContentObj,storeAddedResponseDiv,storeLocatorIdentity={},fromModal=!1,miCounter=0,map=null,imagePathDir=null;function populateStoreLocatorSearchBox(){var locationParam=$.getUrlVar("locationEntry"),searchBox=$("#locationEntry"),geoCity=$.trim($.cookie("lc_city")),geoState=$.trim($.cookie("lc_state")),metroCode=$.cookie("metroCode"),lastValidSearch=$.cookie("lc_lastValidStoreSearch");if(getSubtextMsg(!1),"true"==searchBox.attr("noLocate")&&"false"!=searchBox.attr("noLocate")||!searchBox.length||""!=$.trim(searchBox.val())&&searchBox.val()!=searchBox.attr("placeholder")){utag_data.form_name="find a store",utag_data.form_field=error_list,utag_data.site_layout_type="desktop";var country="us";"CA"==constants.ajaxParams.countryName&&(country="ca"),utag_data.country=country,constants.ajaxParams.loggedIn?(utag_data.authentication_status="authenticated",utag_data.registration_status="registered"):(utag_data.authentication_status="not authenticated",utag_data.registration_status="not registered")}else if(null!=locationParam&&""!=locationParam)$("#locationEntry").attr("value",locationParam.replace(/\+/g," "));else if(lastValidSearch)$("#locationEntry").val(lastValidSearch);else{var locationDisplay=geoCity+", "+geoState;geoCity&&geoState&&"null"!=geoCity&&"null"!=geoState&&/\w/.test(locationDisplay)&&metroCode>0&&$("#locationEntry").val(locationDisplay)}}function getSubtextMsg(flag){searchentered=$.cookie("lc_searchentered"),(null!=searchentered||flag)&&("US"==$("#currentCountryName").val()?$(".subtext").text("Don't see your store?  Try using your full address or zip code."):$(".subtext").text("Don't see your store?  Try using your full address or Postal code."),$.cookie("lc_searchentered",null,{path:"/"}))}function redirectToHomePage(){location.href=$("#homeUrlHiddenInput")[0].value}function getAddressComponent(result,type){for(var addressComponents=result.address_components,i=0;i<addressComponents.length;i++)for(var types=addressComponents[i].types;0<types.length;types++)if(types[0]==type)return addressComponents[i];return null}function renderLatLong(response,status){$.cookie("lc_searchentered","true",{path:"/"});var paramString="",countryCheck=!1,invalidRes=!1,currentCountryName=$("#currentCountryName").val();if("OK"==status&&response.length){paramString=paramString+response[0].geometry.location.lat()+"|"+response[0].geometry.location.lng();var country=getAddressComponent(response[0],"country");null==country||country.short_name!=currentCountryName&&"PR"!=country.short_name||(countryCheck=!0)}else invalidRes=!0,requestSubmitted=!1;if(countryCheck||storeLocatorJS.noValidate){countryCheck&&$("#storeSearchForm").find('input[name="latLong"]').val(paramString);var data=null;data=null!=window.lastSearchForm&&$(window.lastSearchForm).find("[id=locationEntry]")?$(window.lastSearchForm).find("[id=locationEntry]").val():$("#locationEntry").val(),$.cookie("lc_lastValidStoreSearch",data,{path:"/"}),$.cookie("lc_latitude",response[0].geometry.location.lat(),{path:"/"}),$.cookie("lc_longitude",response[0].geometry.location.lng(),{path:"/"});var isRecommendationsForm=null!=window.lastSearchForm&&"recs-form"==$(window.lastSearchForm).attr("id");storeLocatorJS.isStoreLocatorResultsPage(storeLocatorJS.fromHeader)&&!isRecommendationsForm?!isFirst&&isStoreLocatorPage()?(storeLocatorJS.displayMoreLocation(!0,!0),isFirst=!0):isFirst||(storeLocatorJS.displayMoreLocation(!0,!1),isFirst=!0):window.location="AjaxStoreLocatorDisplayView?"+storeLocatorJS.currentForm.serialize()}else{if(getSubtextMsg(!0),invalidRes)$("span[for=locationEntry],#ErrorDivStoreSearch,#ModalErrorDivStoreSearch").hide(),"US"==currentCountryName?fromModal?fromModal&&$("#ModalErrorDivStoreSearch").text("Please enter a valid City, State, or ZIP Code"):$("#ErrorDivStoreSearch").text("Please enter a valid City, State, or ZIP Code"):fromModal?fromModal&&$("#ModalErrorDivStoreSearch").text("Please enter a valid City, Province or Postal"):$("#ErrorDivStoreSearch").text("Please enter a valid City, Province or Postal Code"),$("#ErrorDivStoreSearch").siblings("div#map_accountDashBoard").size()>0?$("#ErrorDivStoreSearch").appendTo($("#ErrorDivStoreSearch").siblings("div#map_accountDashBoard").find("#storeSearchForm")):$("#ErrorDivStoreSearch").siblings("form#storeSearchForm").size()>0?$("#ErrorDivStoreSearch").appendTo($("#ErrorDivStoreSearch").siblings("form#storeSearchForm")).css("clear","none"):"map"==$("#ErrorDivStoreSearch").parent("form").siblings("div#map").attr("id")&&$("#ErrorDivStoreSearch").insertAfter($("#ErrorDivStoreSearch").parent("form").find(".submit-find-store")).css("clear","none").css("position","absolute").css("top","104px"),$("#ErrorDivStoreSearch").show(),$("#ModalErrorDivStoreSearch").show();else{if("US"==$("#currentCountryName").val()){var caUrl=window.location.href;caUrl=(caUrl=(caUrl=window.location.href.substring(0,window.location.href.indexOf("lc-us"))).concat("en-ca/find-a-store?locationEntry=").replace(".com",".ca")).concat($("#locationEntry").val()),fromModal?fromModal&&$("#ModalErrorDivStoreSearch").html('Did you mean to go to <a href="'+caUrl+'">LensCrafters.ca</a>?'):$("#ErrorDivStoreSearch").html('Did you mean to go to <a href="'+caUrl+'">LensCrafters.ca</a>?'),$("span[for=locationEntry]").hide()}else{var usUrl=window.location.href;usUrl=(usUrl=(usUrl=window.location.href.substring(0,window.location.href.indexOf("en-ca"))).concat("lc-us/find-a-store?locationEntry=").replace(".ca",".com")).concat($("#locationEntry").val()),fromModal?fromModal&&$("#ErrorDivStoreSearch").html('Did you mean to go to <a href="'+usUrl+'">LensCrafters.com</a>?'):$("#ErrorDivStoreSearch").html('Did you mean to go to <a href="'+usUrl+'">LensCrafters.com</a>?')}$("#ErrorDivStoreSearch").siblings("div#map_accountDashBoard").size()>0?$("#ErrorDivStoreSearch").appendTo($("#ErrorDivStoreSearch").siblings("div#map_accountDashBoard").find("#storeSearchForm")):$("#ErrorDivStoreSearch").siblings("form#storeSearchForm").size()>0?$("#ErrorDivStoreSearch").appendTo($("#ErrorDivStoreSearch").siblings("form#storeSearchForm")).css("clear","none"):"map"==$("#ErrorDivStoreSearch").parent("form").siblings("div#map").attr("id")&&$("#ErrorDivStoreSearch").insertAfter($("#ErrorDivStoreSearch").parent("form").find(".submit-find-store")).css("clear","none").css("position","absolute").css("top","104px"),$("#ErrorDivStoreSearch").show(),$("#ModalErrorDivStoreSearch").show()}requestSubmitted=!1}}function isStoreLocatorPage(){return $(".find-a-store-search").length>0&&$(".footer-mailing-box").addClass("prefooter_none"),$(".store-locator-page").length>0}function prepareGetDirectionSubmit(){var fromAddress=$("#address1").val(),fromCity=$("#city").val(),fromState=$("#state").val(),fromZipCode=$("#zipCode").val(),toAddress=$.getUrlVar("address").replace(/\+/g," "),toCity=$.getUrlVar("city").replace(/\+/g," "),toState=$.getUrlVar("state").replace(/\+/g," "),toZipCode=$.getUrlVar("zip").replace(/\+/g," ");if($("#getDirectionsForm").valid()){var printLink=$("#getDirectionPrintLink"),emailLink=$("#getDirectionLink");if(printLink.data("originalHref")||printLink.data("originalHref",printLink.attr("href")),emailLink.data("originalEmailHref")||emailLink.data("originalEmailHref",emailLink.attr("generic_email_view_url")),printLink.length>0){var newPrintUrl=printLink.data("originalHref")+"&fromAddress="+fromAddress+"&fromCity="+fromCity+"&fromState="+fromState+"&fromZipCode="+fromZipCode,newEmailUrl=emailLink.data("originalEmailHref")+encodeURI("&startAddress="+fromAddress+"&startCity="+fromCity+"&startStateProvince="+fromState+"&startPostalCode="+fromZipCode);printLink.attr("href",newPrintUrl),emailLink.attr("generic_email_view_url",newEmailUrl)}addRoute(fromAddress,fromCity,fromState,fromZipCode,toAddress,toCity,toState,toZipCode)}}function addRoute(fromAddress,fromCity,fromState,fromZipCode,toAddress,toCity,toState,toZipCode){$("#storeCountryName").val();var dirService=new google.maps.DirectionsService,dirRequest={origin:fromAddress+", "+fromCity+", "+fromZipCode+", "+fromState,destination:toAddress+", "+toCity+", "+toZipCode+", "+toState,travelMode:google.maps.TravelMode.DRIVING};dirService.route(dirRequest,(function(dirResult,dirStatus){"OK"==dirStatus&&(storeLocatorJS.initializeMap(),storeLocatorJS.directionRenderer&&(storeLocatorJS.directionRenderer.setMap(null),storeLocatorJS.directionRenderer=null),storeLocatorJS.directionRenderer=new google.maps.DirectionsRenderer({directions:dirResult,map:map}),map.fitBounds(dirResult.routes[0].bounds),displayNarrative(dirResult),document.getElementById("directionsEmailPrintLink")&&(document.getElementById("directionsEmailPrintLink").style.display="block"))}))}function addScrollDirections(){var scrollPane=$("#scroll-pane-narrative-directions");scrollableHeight=scrollPane.height()-$("#the-directions").height()||0,scrollableHeight<=0?($("#slider-vertical-directions").hide(),$(".scroll-bar-bottom").hide()):($("#slider-vertical-directions").show(),$(".scroll-bar-bottom").show()),$("#slider-vertical-directions").slider({orientation:"vertical",range:"max",min:0,max:scrollableHeight,value:scrollableHeight,create:function(event,ui){},slide:function(event,ui){scrollPane.css({top:ui.value-scrollableHeight})},change:function(event,ui){($("#scroll-pane-narrative-directions").height()-$("#the-directions").height()||0)>0&&scrollPane.css({top:ui.value-scrollableHeight})}}),$("#slider-vertical-directions a").attr("tabindex","-1")}function displayNarrative(dirResult){if($(".directions-result-holder").show(),scrollToElement($(".directions-result-holder"),1e3),dirResult){var steps,allDirections="",legs=dirResult.routes[0].legs,startLoc="",endLoc="",encPath=dirResult.routes[0].overview_polyline,totalDuration=0,totalDistance=0,html="";for(i=0;i<legs.length;i++){for(steps=legs[i].steps,j=0;j<steps.length;j++)0==j?(startLoc=steps[j].start_location.lat()+","+steps[j].start_location.lng(),html+='<div class="each-direction-step first">',html+='<div class="icon-holder first"><img src="'+imagePathDir+'images/mapquest_icon_a.png"></div>'):j==steps.length-1?(endLoc=steps[j].end_location.lat()+","+steps[j].end_location.lng(),html+='<div class="each-direction-step last">',html+='<div class="icon-holder last"><img src="'+imagePathDir+'images/mapquest_icon_b.png"></div>'):html+='<div class="each-direction-step">',html+='<div class="text-narrative"><p><span class="number">'+(j+1)+'.</span><span class="narrative">'+steps[j].instructions+'</span></p><span class="distance">'+steps[j].distance.text+"</span></div>",html+="</div>",allDirections+=j+1+". "+steps[j].instructions+" `"+steps[j].distance.text+"~";void 0!==legs[i].distance.value&&(totalDistance+=legs[i].distance.value),void 0!==legs[i].duration.value&&(totalDuration+=legs[i].duration.value)}html+='<div class="hide" id="totalDist">'+totalDistance+"</div>",html+='<div class="hide" id="allDirections">'+allDirections+"</div>";var scheme="http";window.location.href.indexOf("https")>-1&&(scheme="https");var formattedTotalDuration=new Date(1e3*totalDuration).toISOString().substr(11,8).split(":");html+='<div class="hide" id="timeTaken">'+formatTime(formattedTotalDuration[0])+" hours "+formatTime(formattedTotalDuration[1])+" minutes "+formatTime(formattedTotalDuration[2])+" seconds </div>",html+='<div class="hide" id="imageUrl">'+scheme+"://maps.googleapis.com/maps/api/staticmap?key="+constants.services.googleAPIKey+"&size=342x425&markers=color:green|label:A|"+startLoc+"&markers=color:red|label:B|"+endLoc+"&path=enc:"+encPath+"</div>",document.getElementById("scroll-pane-narrative-directions").innerHTML=html}}function formatTime(string){return string>10?string:string.substring(1,2)}function scheduleWithPreffStores(oldUrl){var newUrl=oldUrl+"&storeNumber="+$("#myPreffStoreSelection").val();location.href=newUrl}function isTexasFlowMatch(inputCode){try{var texasString=constants.ajaxParams.isTexasFlow;if(null!=texasString&&""!=texasString)for(var stringArray=texasString.split(":"),i=0;i<=stringArray.length;i++)if(stringArray[i].toUpperCase()==inputCode.toUpperCase())return!0}catch(e){}return!1}function getStateTextFromId(stateTextId){var stateTextMap=[];return stateTextMap.AL="Alabama",stateTextMap.AK="Alaska",stateTextMap.AZ="Arizona",stateTextMap.AR="Arkansas",stateTextMap.CA="California",stateTextMap.CO="Colorado",stateTextMap.CT="Connecticut",stateTextMap.DE="Delaware",stateTextMap.DC="District of Columbia",stateTextMap.FL="Florida",stateTextMap.GA="Georgia",stateTextMap.HI="Hawaii",stateTextMap.ID="Idaho",stateTextMap.IL="Illinois",stateTextMap.IN="Indiana",stateTextMap.IA="Iowa",stateTextMap.KS="Kansas",stateTextMap.KY="Kentucky",stateTextMap.LA="Louisiana",stateTextMap.ME="Maine",stateTextMap.MD="Maryland",stateTextMap.MA="Massachusetts",stateTextMap.MI="Michigan",stateTextMap.MN="Minnesota",stateTextMap.MS="Mississippi",stateTextMap.MO="Missouri",stateTextMap.MT="Montana",stateTextMap.NE="Nebraska",stateTextMap.NV="Nevada",stateTextMap.NH="New Hampshire",stateTextMap.NJ="New Jersey",stateTextMap.NM="New Mexico",stateTextMap.NY="New York",stateTextMap.NC="North Carolina",stateTextMap.ND="North Dakota",stateTextMap.OH="Ohio",stateTextMap.OK="Oklahoma",stateTextMap.OR="Oregon",stateTextMap.PA="Pennsylvania",stateTextMap.RI="Rhode Island",stateTextMap.SC="South Carolina",stateTextMap.SD="SouthDakota",stateTextMap.TN="Tennessee",stateTextMap.TX="Texas",stateTextMap.UT="Utah",stateTextMap.VT="Vermont",stateTextMap.VA="Virginia",stateTextMap.WA="Washington",stateTextMap.WV="West Virginia",stateTextMap.WI="Wisconsin",stateTextMap.WY="Wyoming",stateTextMap.AA="Armed Forces Americas",stateTextMap.AE="Armed Forces Europe",stateTextMap.AP="Armed Forces Pacific",stateTextMap.AB="Alberta",stateTextMap.BC="British Columbia",stateTextMap.MB="Manitoba",stateTextMap.NL="Newfoundland and Labrador",stateTextMap.NB="New Brunswick",stateTextMap.NT="Northwest Territories",stateTextMap.NS="Nova Scotia",stateTextMap.NU="Nunavut",stateTextMap.ON="Ontario",stateTextMap.PE="Prince Edward Island",stateTextMap.QC="Qu&#233;bec",stateTextMap.SK="Saskatchewan",stateTextMap.YT="Yukon Territory",stateTextMap[stateTextId.toUpperCase()]}isFirst=!1,offset=null,$(document).ready((function(){void 0===storeLocatorIdentity.ready1&&(storeLocatorIdentity.ready1=!0,imagePathDir=$("#imagePathIcons").val(),populateStoreLocatorSearchBox())})),$((function(){$("#warningModalClose").dialog({width:500,modal:!0,autoOpen:!1,open:function(){$(this).closest(".ui-dialog").css("z-index","100003"),$(this).closest(".ui-dialog").siblings(".ui-widget-overlay").remove(),$(this).find(".continue").bind("click",(function(){return!0,$("#locatorModal").dialog("close"),$("#warningModalClose").dialog("close"),!1})),$(this).find(".cancel").bind("click",(function(){return!1,$("#warningModalClose").dialog("close"),!1}))},close:function(){!1,$(this).find(".continue, .cancel").unbind("click")},create:function(){var dialogTitle=$(this).dialog("option","title"),dialog=$(this).dialog("widget");dialog.attr("role","complementary"),void 0!==dialogTitle&&""!=dialogTitle||dialog.attr("aria-label","Warning Modal Close").removeAttr("aria-labelledby")}}),$(".store-locator-page").on("click",".schedule-exam-store",(function(e){$.cookie("thank_you_page","0",{path:"/"});var doctorModalText=$.trim($(this).parent().find(".examState").text().toLowerCase()),storeNumber=$(this).parent().siblings(".store-address").find(".store-name").attr("data-stlocid"),isCaliFlow="true"==$(this).parent().find(".caliFlow").text()||"true"==$(this).parent().siblings().find(".caliFlow").text();if(null==storeNumber&&(storeNumber=$(this).attr("data-storeid")),isTexasFlowMatch($(this).parent().siblings(".store-address").find(".state").text())||isTexasFlowMatch(doctorModalText)){storeLocation=$(this).parent().siblings(".link-options").find(".locationDetailsInfo").attr("data-loc-store-number"),void 0!==storeLocation&&""!=storeLocation||(storeLocation=$(this).parent().siblings(".link-options").find(".doctorInfo").attr("data-store-number")),void 0!==storeLocation&&""!=storeLocation||(storeLocation=$(this).parent().find('[name="storeNumber"]').val()),void 0!==storeLocation&&""!=storeLocation||(storeLocation=storeNumber);$(this).attr("href");return null!=$(this).parent().siblings(".store-address").find(".state").text()&&""!=$(this).parent().siblings(".store-address").find(".state").text()&&(stateTextId=$(this).parent().siblings(".store-address").find(".state").text()),null!=doctorModalText&&""!=doctorModalText&&(stateTextId=doctorModalText),storeLocatorJS.createEyeExamRedirectModal($("#texasExamModal"),stateTextId),$("#texasExamModal").removeClass("hide"),!1}if(("ca"==$(this).parent().siblings(".store-address").find(".state").text()||"ca"==doctorModalText)&&isCaliFlow){storeLocation=$(this).parent().siblings(".link-options").find(".locationDetailsInfo").attr("data-loc-store-number"),void 0!==storeLocation&&""!=storeLocation||(storeLocation=$(this).parent().siblings(".link-options").find(".doctorInfo").attr("data-store-number")),void 0!==storeLocation&&""!=storeLocation||(storeLocation=$(this).parent().find('[name="storeNumber"]').val()),void 0!==storeLocation&&""!=storeLocation||(storeLocation=storeNumber);$(this).attr("href");return storeLocatorJS.createEyeExamRedirectModal($("#californiaExamModal")),$("#californiaExamModal").removeClass("hide"),!1}var schedulePage=$(this).parent().find(".scheduleURL").val();null!=schedulePage&&null!=schedulePage&&(window.location.href=schedulePage)})),$("#eyeExamLink").on("click",(function(e){return"TX"==$(".schedulingState").val()?(storeLocatorJS.createEyeExamRedirectModal($("#texasExamModal")),!1):"CA"==$(".schedulingState").val()?(storeLocatorJS.createEyeExamRedirectModal($("#californiaExamModal")),!1):void 0}))})),storeLocatorJS={markers:[],stLocId:null,storeName:null,storeId:null,catalogId:null,langId:null,preferredStoreNumber:0,noValidate:!1,openedInfoWindow:null,directionRenderer:null,fromHeader:!1,displayMoreLocation:function(clearCurrentResults,reloadPage,numResultsRequested,resetLimit){var pageSize=numResultsRequested||3,page=0,startIndex=0;if(!clearCurrentResults){var numStores=$(".storeLocation").length;page=Math.floor(numStores/pageSize)}if($('input[name="page"]').val(page),null!=$('input[name="latLong"]').val()&&0!==$('input[name="latLong"]').val().length||$('input[name="latLong"]').val($.cookie("lc_latitude")+"|"+$.cookie("lc_longitude")),reloadPage){if(clearCurrentResults)return window.location=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+$("#storeSearchForm").serialize()+"&startIndex="+startIndex,!1;startIndex=$(".store").length,$.get(getAbsoluteURL()+"AjaxStoreLocatorResultsView",$("#storeSearchForm").serialize()+"&endIndex="+(startIndex+6)+"&resetSplit=true&startIndex="+startIndex,(function(data){$("#hasMoreLocations").remove(),$("#num-results").show(),$(".disclaimer").show(),clearCurrentResults?$(".storeLocatorResults").html(data):$(".storeLocatorResults").append(data);var storeResultNumber=$("#storeResultNumber").val();$("#number-of-store-results").html(storeResultNumber),$("#number-of-results-on-page").text($(".store").length),Number(storeResultNumber)>$(".store").length?$(".seeMoreLocationLink").show():$(".seeMoreLocationLink").hide(),$(".storeLocation").removeClass("last"),$(".storeLocation").last().addClass("last"),storeLocatorJS.displayMap(clearCurrentResults),cursor_clear(),requestSubmitted=!1})).done((function(){$(".seeMoreLocationLink").removeClass("disabled"),$("#store-locator-loading-icon").addClass("hide"),setTimeout((function(){$("a.make-preferred-store").toggleClass("sign-in-link",!constants.ajaxParams.loggedIn),$("a.make-preferred-store").toggleClass("makePreferred",constants.ajaxParams.loggedIn),$(".sign-in-link").unbind("click"),$(".sign-in-link").click((function(){return constants.ajaxParams.loggedIn&&showLogonModal(),!1}))}),0)}))}else{$(".ui-dialog .find-a-store").hide(),$("#modal-loading-icon").show(),startIndex=$(".store").length;var resetSplit=resetLimit?"&resetSplit=true&endIndex="+(startIndex+6)+"&startIndex="+startIndex:"";$.get(getAbsoluteURL()+"AjaxStoreLocatorResultsView",$("#storeSearchForm").serialize()+resetSplit,(function(data){$("#hasMoreLocations").remove(),$("#num-results").show(),$(".disclaimer").show(),clearCurrentResults?$(".storeLocatorResults").html(data):$(".storeLocatorResults").append(data);var storeResultNumber=$("#storeResultNumber").val();$("#number-of-store-results").html(storeResultNumber),$("#number-of-results-on-page").text($(".store").length),"true"==$("#hasMoreLocations").val()?$(".seeMoreLocationLink").show():$(".seeMoreLocationLink").hide(),$(".storeLocation").removeClass("last"),$(".storeLocation").last().addClass("last");var prodId=$("#StoreLocator_ProductId").val();if(""!=prodId&&null!=prodId)storeResultNumber>0?utagViewSafe({Page_Name:"in store product look up",page_name:"in store product look up",sc_event:"event31,event40"}):utagViewSafe({Page_Name:"in store product look up",page_name:"in store product look up",sc_event:"event31,event41"});else{var sc_event="event8",search_results="zero";storeResultNumber>0&&(sc_event="event10,event11",search_results=storeResultNumber),utagViewSafe({Page_Name:"StoreLocatorResults",page_name:"StoreLocatorResults",Page_Type:"Service",sc_event:sc_event,search_results:search_results,search_term:$("#locationEntry").val()})}$("#modal-loading-icon").hide(),$(".ui-dialog .find-a-store").show(),isStoreLocatorPage()||storeLocatorJS.initializeMap(),storeLocatorJS.displayMap(clearCurrentResults),cursor_clear(),requestSubmitted=!1})).done((function(){$(".seeMoreLocationLink").removeClass("disabled"),$("#store-locator-loading-icon").addClass("hide"),setTimeout((function(){$("a.make-preferred-store").toggleClass("sign-in-link",!constants.ajaxParams.loggedIn),$("a.make-preferred-store").toggleClass("makePreferred",constants.ajaxParams.loggedIn),$(".sign-in-link").unbind("click"),$(".sign-in-link").click((function(){return showLogonModal(),!1}))}),0)}))}},clearMap:function(){for(var i=0;i<storeLocatorJS.markers.length;i++)storeLocatorJS.markers[i].setMap(null);storeLocatorJS.markers.length=0},openInfoWindow:function(marker){storeLocatorJS.closeInfoWindow(),storeLocatorJS.openedInfoWindow=marker.infoWindow,marker.infoWindow.open(map,marker)},closeInfoWindow:function(){null!=storeLocatorJS.openedInfoWindow&&(storeLocatorJS.openedInfoWindow.close(),storeLocatorJS.openedInfoWindow=null)},displayMap:function(clearCurrentResults){var $map=$("#map");$map.show(),0==$("#storeResultNumber").val()&&$map.hide(),clearCurrentResults&&storeLocatorJS.clearMap();var bounds=new google.maps.LatLngBounds;function setMarkerIcon(marker,index,highlighted){var iconPath;iconPath=highlighted?index>21?"images/icons/mapquest_icon_on_hover.png":"images/icons/mapquest_icon_on_hover"+index+".png":index>21?"images/icons/mapquest_icon.png":"images/icons/mapquest_icon"+index+".png",marker.setIcon({url:imagePathDir+iconPath,size:new google.maps.Size(34,42)})}function createInfoWindow(stLocId,$storeDiv){var template=$("#mapDetailTemplate .mapDetailStoreInfo").clone();if($storeDiv||($storeDiv=$("#storeLocation-"+stLocId)),$storeDiv.find(".copyToInfoWindow").each((function(index,input){template.find("."+$(input).data("name")).html($(input).html())})),$storeDiv.hasClass("store-closed"))template.find(".getDirections").hide(),template.find(".hours").hide();else{var getDirectionLink=$storeDiv.find(".getDirections").attr("href");template.find(".getDirections").attr("href",getDirectionLink)}if(userStoresArray.length>0&&$.inArray(stLocId,userStoresArray)>=0){var parentElem=template.children(".mapquest-options");parentElem.children(".makePreferred").html("Store added"),parentElem.children(".makePreferred").removeClass("makePreferred")}var infoWindow=new google.maps.InfoWindow({content:template.html()});return google.maps.event.addListener(infoWindow,"closeclick",(function(){storeLocatorJS.openedInfoWindow=null})),infoWindow}var $unmapped=$(".unmapped");$unmapped.each((function(index,storeDiv){var $storeDiv=$(storeDiv),latitude=parseFloat($storeDiv.find(".latitude").val()),longitude=parseFloat($storeDiv.find(".longitude").val()),stLocId=$storeDiv.find("input.stLocId").val(),marker=new google.maps.Marker({position:new google.maps.LatLng({lat:latitude,lng:longitude}),infoWindow:createInfoWindow(stLocId,$storeDiv)}),markerIndex=index+miCounter+1;setMarkerIcon(marker,markerIndex,!1),google.maps.event.addListener(marker,"click",(function(){setMarkerIcon(marker,markerIndex,!0),storeLocatorJS.openInfoWindow(this)})),google.maps.event.addListener(marker,"mouseover",(function(){setMarkerIcon(marker,markerIndex,!0),storeLocatorJS.openInfoWindow(this)})),google.maps.event.addListener(marker,"mouseout",(function(){setMarkerIcon(marker,markerIndex,!1)})),storeLocatorJS.markers["stLocId-"+stLocId]=marker,bounds.extend(marker.getPosition()),marker.setMap(map),$storeDiv.removeClass("unmapped"),$(".storeLocation:gt(8)").addClass("double")}));var scheme="http";window.location.href.indexOf("https")>-1&&(scheme="https"),miCounter+=$unmapped.length;for(var i=0;i<storeLocatorObjects.length;i++){var latitude=parseFloat(storeLocatorObjects[i].lat),longitude=parseFloat(storeLocatorObjects[i].lng),stLocId=storeLocatorObjects[i].id,marker=new google.maps.Marker({position:new google.maps.LatLng({lat:latitude,lng:longitude}),infoWindow:createInfoWindow(stLocId)});marker.setIcon({url:scheme+"://www.mapquestapi.com/staticmap/geticon?uri=poi-blue-only.png",scaledSize:new google.maps.Size(12,12)}),google.maps.event.addListener(marker,"click",(function(){storeLocatorJS.openInfoWindow(this)})),google.maps.event.addListener(marker,"mouseover",(function(){storeLocatorJS.openInfoWindow(this)})),storeLocatorJS.markers["stLocId-"+stLocId]=marker,bounds.extend(marker.getPosition()),marker.setMap(map)}map.fitBounds(bounds),null==offset&&(offset=$("#map").offset().top)},isStoreLocatorResultsPage:function(fromHeader){return $(".storeLocatorResults").length>0&&!(null!=fromHeader&&fromHeader)},isPreferredStoresPage:function(){return $(".stores").length>0},handleStoreSearchForm:function(form){miCounter=0,storeLocatorJS.currentForm=form;var locationEntry=form.find('input[name="locationEntry"]').val();if(fromModal=!1,locationEntry||(locationEntry=form.find('input[name="modalLocationEntry"]').val(),fromModal=!0),locationEntry=$.trim(locationEntry),storeLocatorJS.fromHeader="true"===storeLocatorJS.currentForm[0].querySelector("[name=fromHeader]").value,storeLocatorJS.noValidate="storeSearchFormNoRules"==storeLocatorJS.currentForm.attr("id"),constants.ajaxParams.countryName,document.getElementById("ErrorDivStoreSearch")&&(document.getElementById("ErrorDivStoreSearch").innerHTML=""),storeLocatorJS.isStoreLocatorResultsPage(storeLocatorJS.fromHeader)&&""==locationEntry&&MessageHelper.formErrorHandleClient("location",MessageHelper.messages.ERROR_SearchBoxEmpty),""!==locationEntry){if(storeLocatorJS.fromHeader){$(".find-a-store").length;window.location=window.location.origin+$("#storeSearchFormHeader").attr("action")+"?"+storeLocatorJS.currentForm.serialize()}else performGeocode(locationEntry,renderLatLong);window.lastSearchForm=form}},bindInfoWindowEvents:function(){$("a.make-preferred-store").toggleClass("sign-in-link",!constants.ajaxParams.loggedIn),$("a.make-preferred-store").toggleClass("makePreferred",constants.ajaxParams.loggedIn);var makePreferredFunction=function(e){$("#StoreAddedMsgDiv").dialog("open"),$("#StoreAddedMsgDiv").removeClass("hide"),tooptipContentObj=$(this);var storeDiv=$(this).parents(".mqabasicwnd-content");0==storeDiv.length&&(storeDiv=$(".storeInfoDiv"));var stLocId=storeDiv.find(".stLocId").html();null==stLocId?(stLocId=$(this).data("stlocid"),storeDiv=$(this).parents(".store"),$("body").data("storeInfo",storeDiv.children(".store-address").clone())):$("body").data("storeInfo",storeDiv.clone());var params={},marker=storeLocatorJS.markers["stLocId-"+stLocId];return marker&&storeLocatorJS.openInfoWindow(marker),userStoresArray.push(stLocId),storeAddedResponseDiv=storeDiv,params.storeId=constants.ajaxParams.storeId,params.catalogId=constants.ajaxParams.catalogId,params.langId=constants.ajaxParams.langId,params.stLocId=stLocId,params.storeName=storeDiv.find(".storeName").html(),null==params.storeName&&(params.storeName=storeDiv.find(".store-name").html()),null!=this.preferredStoreNumber&&""!=this.preferredStoreNumber&&(params.preferredStoreNumber=this.preferredStoreNumber),$(".responseStoreNameLabel").html(params.storeName),params.primary="0",params.storeNickName="",params.requesttype="ajax",$.ajax({url:getAbsoluteURL()+"AjaxLCUpdatePreferredStoreCmd",data:params,dataType:"html",type:"post",complete:function(response){try{var serviceResponse=filterAjaxResponse(response.responseText);if(void 0!==serviceResponse.errorMessageKey&&"_ERR_DIDNT_LOGON"==serviceResponse.errorMessageKey)return window.location.href=$("#myAccountURL").val(),!1;storeLocatorJS.storeAddedResponseDiv=$("#StoreAddedAsPrefferedDiv"),storeLocatorJS.storeId=serviceResponse.storeId,storeLocatorJS.langId=serviceResponse.langId,storeLocatorJS.catalogId=serviceResponse.catalogId,storeLocatorJS.stLocId=serviceResponse.stLocId.toString(),storeLocatorJS.storeName=serviceResponse.storeName}catch(e){console&&console.error("Could not add preferred store")}},error:function(){console&&console.error("Could not add preferred store")}}),e.preventDefault(),!1};-1==navigator.userAgent.indexOf("Mobile")?$(".makePreferred").off("click").on("click",makePreferredFunction):$(".makePreferred").off("click").live("click",makePreferredFunction),$(".sign-in-link").unbind("click"),$(".sign-in-link").on("click",(function(){return constants.ajaxParams.loggedIn?($("#header-notification-modal").toggle(),$(".user-subnav-link a:first-child").focus()):window.location=$(".header_icon.sign-in-link.header_account_icon").attr("href"),!1})),$("#forgotPassword").on("click",(function(){return showLogonModal()||$(".header-reset-password-modal").css("display","block"),$(".thank-you-page-overlay")&&$(".thank-you-page-overlay").removeClass("hidden"),$("#myaccount-rectangle > .backdrop").removeClass("hide"),$(".header-sign-in-modal").css("display","none"),$("#myaccount-rectangle").removeClass("hide"),!1})),$(document).ready((function(){try{void 0!==$.getUrlVar("resetPassword")&&"true"==$.getUrlVar("resetPassword")&&$("#forgotPassword").click()}catch(e){-1==window.location.href.indexOf("ScheduleExamView")?console.error("Logged: "+e):console.log("OEE - No need to bind forgot password click")}}))},makePreferredStore:function(storeLocId,storeName,storeId,catalogId,langId,storeNickName,isPreferredStore){var params={};params.storeId=storeId,params.catalogId=catalogId,params.langId=langId,params.stLocId=storeLocId.toString(),params.storeNickName=storeNickName,params.storeName=storeName,params.preferredStoreNumber="0",params.primary=isPreferredStore?1:0,params.requesttype="ajax",$.ajax({url:getAbsoluteURL()+"AjaxLCUpdatePreferredStoreCmd",data:params,dataType:"html",type:"post",complete:function(response){try{var serviceResponse=filterAjaxResponse(response.responseText);if(void 0!==serviceResponse.errorMessageKey&&"_ERR_DIDNT_LOGON"==serviceResponse.errorMessageKey)return window.location.href=$("#myAccountURL").val(),!1;$("#StoreAddedMsgDiv").dialog("close"),$("#StoreAddedAsPrefferedDiv").dialog("open"),$("#StoreAddedAsPrefferedDiv").removeClass("hide"),$(".store-info-updated-content .store-name .storeName").html($(".responseStoreNameLabel").html()),$(".store-preferred-info").html($("body").data("storeInfo"));var str="",storeHourArray=$(".store-preferred-info").children().find("li[class=store-hours]").find("input");for(i=0;i<storeHourArray.length;i++)str=str+'<li class="StoreTime'+i+' copyToInfoWindow" data-name="StoreTime" data-stlocid="${param.stLocId}" style="cursor: pointer;">'+$(storeHourArray[i]).val()+"</li>";""!=str&&(str='<li class="hours-header">Store Hours</li>'+str,$(".store-preferred-info").find(".store-hours").html(str)),$(".nick_store_name_div").text(serviceResponse.storeNickName[0]),$(".store-preferred-info .mapquest-options").hide()}catch(e){console&&console.error("Could not add preferred store")}},error:function(){console&&console.error("Could not add preferred store")}})},createEyeExamRedirectModal:function(modal,stateTextId){$(modal).dialog({modal:!0,width:500,height:300,position:["center","center"],open:function(){$(modal).dialog("option","position",["center","center"]);try{if(null!=stateTextId){var stateText=getStateTextFromId(stateTextId);document.getElementById("TXWarning_Message_Text_state").innerHTML=stateText}}catch(e){}},beforeClose:function(){},close:function(){$("html").removeClass("cut"),window.document.closeMe=null}})},initializeMap:function(showMap,showLocations){var $map=$("#map"),$storeLocatorLoadingIcon=$("#store-locator-loading-icon");if(null==showMap&&(showMap=!0),$map.length>0&&1!=$map.data("initialized")){$map.data("initialized",!0);var latLng=new google.maps.LatLng({lat:39.358056,lng:-84.311944});if(showLocations){var $firstUnmapped=$(".unmapped").first();latLng=new google.maps.LatLng({lat:parseFloat($firstUnmapped.find(".latitude").val()),lng:parseFloat($firstUnmapped.find(".longitude").val())})}var options={center:latLng,zoom:10,zoomControl:!0,fullscreenControl:!1,streetViewControl:!1,scrollwheel:!0,gestureHandling:"greedy"};window.map=new google.maps.Map($map[0],options);showLocations&&storeLocatorJS.displayMap(!1),$map.toggle(showMap),$storeLocatorLoadingIcon.addClass("hide")}}},$(document).ready((function(){if(void 0===storeLocatorIdentity.ready2){storeLocatorIdentity.ready2=!0,$(document).keydown((function(e){if(13==e.keyCode&&$('[id="locationEntry"]').is(":focus")){e.preventDefault();var submitButton=$('[id="locationEntry"]').filter(":focus").closest("form").find('.submit-find-store, input[type="submit"]').first();submitButton.length?submitButton.click():$(".submit-find-store").click()}})),$("#StoreAddedMsgDiv").dialog({autoOpen:!1,draggable:!1,resizable:!1,modal:!0,zIndex:9999,minWidth:520,create:function(){var dialogTitle=$(this).dialog("option","title"),dialog=$(this).dialog("widget");dialog.attr("role","complementary"),void 0!==dialogTitle&&""!=dialogTitle||dialog.attr("aria-label","Store added modal").removeAttr("aria-labelledby")}}),$("#StoreAddedAsPrefferedDiv").dialog({autoOpen:!1,draggable:!1,resizable:!1,modal:!0,zIndex:9999,minWidth:590,open:function(){$(".done").bind("click",(function(e){$("#StoreAddedAsPrefferedDiv").dialog("close")})),$(this).find(".go-to-account").bind("click",(function(e){document.location=$(this).attr("href")}))},close:function(){$(".done").unbind("click")},create:function(){var dialogTitle=$(this).dialog("option","title"),dialog=$(this).dialog("widget");dialog.attr("role","complementary"),void 0!==dialogTitle&&""!=dialogTitle||dialog.attr("aria-label","Store added as preferred modal").removeAttr("aria-labelledby")}}),$("#preferredStoreChangeModalDiv").dialog({autoOpen:!1,draggable:!1,resizable:!1,modal:!0,zIndex:9999,minWidth:485,open:function(event,ui){$("input").blur()}}),isStoreLocatorPage()||($("#num-results").hide(),$(".disclaimer").hide()),$("body").on("click",".submit-find-store",(function(e){e.preventDefault(),isFirst=!1;var parentForm=$(this).closest("form");0==parentForm.length&&(parentForm=$(this).closest(".each-saved-store").find("form.store-search-form")),cursor_wait(),storeLocatorJS.handleStoreSearchForm(parentForm)})),$.validator.addMethod("USPostalCode",(function(value,element){return $("span[for=locationEntry],#ErrorDivStoreSearch").hide(),!MessageHelper.IsNumeric(value)||/^\d{5}|\d{5}-\d{4}$/.test(value)})),$.validator.addMethod("postalFormatCheckDirections",(function(value,element){var regexObj_canada=/^[ABCEGHJKLMNPRSTVXY]\d[ABCEGHJKLMNPRSTVWXYZ]( )?\d[ABCEGHJKLMNPRSTVWXYZ]\d$/i,regexObj_usa=/^\d{5}(-\d{4})?$/;if(""!=$("#storeCountryName").val()&&"US"==$("#storeCountryName").val()){var regexp=new RegExp(regexObj_usa);if(value.length>0)return regexp.test(value)}else{regexp=null;regexp=new RegExp(regexObj_canada);if(value.length>0)return regexp.test(value)}})),$.validator.addMethod("CityStateValidation",(function(value,element){var form=document.getDirectionsForm,status=!0;return"City"!=form.city.value&&""!=form.city.value&&0!=form.city.value.length||(status=!1),""!=form.state.value&&0!=form.state.value.length||(status=!1),status})),$.validator.addMethod("Address1Validation",(function(value,element){var form=document.getDirectionsForm,status=!0;return"Address 1"!=form.address1.value&&""!=form.address1.value&&0!=form.address1.value.length||(status=!1),status}));var canadaURL="",storeSearchRequiredMessage="",invalidPostalCode="";"US"==$("#currentCountryName").val()?(storeSearchRequiredMessage="Please enter a valid City, State, or ZIP Code",error_list.push(storeSearchRequiredMessage),invalidPostalCode="Please enter a valid ZIP code",canadaURL="LensCrafters.ca"):(storeSearchRequiredMessage="Please enter a valid City, Province or Postal Code",invalidPostalCode="Please enter a valid Postal code",canadaURL="LensCrafters.com");var storeSearchValidation={onfocusout:!1,onclick:!1,onkeyup:!1,errorClass:"required",errorElement:"span",rules:{locationEntry:{required:!0,USPostalCode:!0,antipattern:otherCountryZipPattern}},messages:{locationEntry:{required:storeSearchRequiredMessage,minlength:"minimum 5 digits",USPostalCode:invalidPostalCode,antipattern:"Did you mean to go to "+canadaURL.link("http://"+canadaURL)+"?"}},submitHandler:function(form){$("span[for=locationEntry],#ErrorDivStoreSearch").hide(),storeLocatorJS.handleStoreSearchForm($(form))},invalidHandler:function(form,validator){cursor_clear(),$("span[for=locationEntry],#ErrorDivStoreSearch").hide()},errorPlacement:function(error,element){$("span[for=locationEntry],#ErrorDivStoreSearch").hide(),"storeSearchForm"==$(element).parent("form").attr("id")?$(error).insertAfter($(element).parent("form").find(".submit-find-store")).css("clear","none"):"NewStoreLocationAddForm"==$(element).parent("form").attr("name")?"map"==$(error).parent(element).siblings("div#map").attr("id")?$(error).insertAfter($(element).parent("form").find(".submit-find-store")).css("clear","none").css("position","absolute").css("top","104px"):$(error).insertAfter($(element).parent("form").find(".submit-find-store")).css("clear","none"):"StoreLocationAddForm"==$(element).parent("form").attr("name")?$(error).insertAfter($(element).parent("form").find(".submit-find-store")).css("clear","none"):"storeSearchFormAdd"==$(element).parent("div").parent("form").attr("id")?($(error).insertAfter($(element).parent("div").parent("form").find(".submit-find-store")),$("span[for=locationEntry],#ErrorDivStoreSearch").hide()):$(error).insertAfter(element)}},modalStoreSearchValidation={onfocusout:!1,onclick:!1,onkeyup:!1,errorClass:"required",errorElement:"span",rules:{modalLocationEntry:{required:!0,USPostalCode:!0,antipattern:otherCountryZipPattern}},messages:{modalLocationEntry:{required:storeSearchRequiredMessage,minlength:"minimum 5 digits",USPostalCode:invalidPostalCode,antipattern:"Did you mean to go to "+canadaURL.link("http://"+canadaURL)+"?"}},submitHandler:function(form){$("span[for=modalLocationEntry],#ModalErrorDivStoreSearch").hide(),storeLocatorJS.handleStoreSearchForm($(form))},invalidHandler:function(form,validator){cursor_clear(),$("span[for=modalLocationEntry],#ModalErrorDivStoreSearch").hide()},errorPlacement:function(error,element){$("span[for=modalLocationEntry],#ModalErrorDivStoreSearch").hide(),"storeSearchForm"==$(element).parent("form").attr("id")?$(error).insertAfter($(element).parent("form").find(".submit-find-store")).css("clear","none"):"storeSearchFormChange"==$(element).parent("form").attr("name")?"map"==$(error).parent(element).siblings("div#map").attr("id")?$(error).insertAfter($(element).parent("form").find(".submit-find-store")).css("clear","none").css("position","absolute").css("top","104px"):$(error).insertAfter($(element).parent("form").find(".submit-find-store")).css("clear","none"):"storeSearchFormChange"==$(element).parent("form").attr("name")?$(error).insertAfter($(element).parent("form").find(".submit-find-store")).css("clear","none"):"storeSearchForm"==$(element).parent("div").parent("form").attr("id")?$(error).insertAfter($(element).parent("div").parent("form").find(".submit-find-store")):$(error).insertAfter(element)}};if($("#storeSearchForm").validate(storeSearchValidation),$("#storeSearchFormChange").validate(modalStoreSearchValidation),$("#storeSearchFormGo1").validate(storeSearchValidation),$("#storeSearchFormGo2").validate(storeSearchValidation),$("#storeSearchFormGo3").validate(storeSearchValidation),$("#storeSearchFormAdd").validate(storeSearchValidation),$("#recs-form").validate(storeSearchValidation),delete storeSearchValidation.rules,$("#storeSearchFormNoRules").validate(storeSearchValidation),$("#ChangePreferredStoreLocation_Change").click((function(){return $(this).parents("form").submit(),!1})),$("#getDirectionsForm").validate({onfocusout:!1,onkeyup:function(form,event){13==event.keyCode&&prepareGetDirectionSubmit()},onclick:!1,errorClass:"required",errorElement:"span",rules:{city:{CityStateValidation:{depends:function(element){return""==$("#zipCode").val()}}},zipCode:{required:!1,postalFormatCheckDirections:{depends:function(element){return""!=$("#zipCode").val()}}}},messages:{city:{CityStateValidation:MessageHelper.messages.ERROR_ZIPCODE_CITY_STATE_EMPTY},zipCode:{postalFormatCheckDirections:MessageHelper.messages.ERROR_INVALID_ZIP_CODE}},submitHandler:function(form){prepareGetDirectionSubmit()},errorPlacement:function(error,element){"state"==$(element).attr("name")?($(error).insertAfter(".drop_down_country"),$("#state").next(".required").remove()):$(error).insertAfter(element)}}),$("#getDirectionsForm #zipCode").keydown((function(evt){var charCode=evt.which?evt.which:event.keyCode;"US"==$("#currentCountryName").val()&&charCode>31&&(charCode<48||charCode>57)&&(charCode<96||charCode>105)&&evt.preventDefault()})),$(".store-result-holder").on("click",".seeMoreLocationLink",(function(){return $(".seeMoreLocationLink").hasClass("disabled")||($(".seeMoreLocationLink").addClass("disabled"),$("#store-locator-loading-icon").removeClass("hide"),isStoreLocatorPage()?storeLocatorJS.displayMoreLocation(!1,!0):storeLocatorJS.displayMoreLocation(!1,!1,8,!0)),!1})),$(".storeLocatorResults").on("click",".storeHours",(function(){var stLocId=$(this).data("stlocid"),marker=storeLocatorJS.markers["stLocId-"+stLocId];return storeLocatorJS.openInfoWindow(marker),$(".mqabasicwnd-content .make-preferred-store").focus(),$("#StoreLocatorPdpModelDiv").is(":visible")&&scrollToElement($("#number-of-store-results"),500),!1})),$(".storeLocatorResults").on("hover",".miles",(function(){var stLocId=$(this).data("stlocid"),marker=storeLocatorJS.markers["stLocId-"+stLocId];return storeLocatorJS.openInfoWindow(marker),!1})),$(".make-preferred, .remove-store").click((function(){return $(this).parents("form").submit(),!1})),$(".close-preferred-store").click((function(){return $("#preferredStoreChangeModalDiv").dialog("close"),!1})),$(".makePreferredApplyButton").click((function(){var nickname=$(".storeNickName").val();if(""!==nickname){var isPreferredStore=$("#isPreferredStore").is(":checked");storeLocatorJS.makePreferredStore(storeLocatorJS.stLocId,storeLocatorJS.storeName,constants.ajaxParams.storeId,constants.ajaxParams.catalogId,constants.ajaxParams.langId,nickname,isPreferredStore)}})),$("#map").length>0&&storeLocatorJS.isPreferredStoresPage()&&storeLocatorJS.initializeMap(),storeLocatorJS.isStoreLocatorResultsPage(storeLocatorJS.fromHeader)){var showMap=!1,showLocations=!1;if(isStoreLocatorPage()&&$("#storeResultNumber").length&&"0"!=$("#storeResultNumber").val()&&(showMap=!0,showLocations=!0),isStoreLocatorPage()&&$("#storeResultNumber").length){var prodId=$("#StoreLocator_ProductId").val();if(""!=prodId&&null!=prodId)storeResultNumber>0?utagViewSafe({Page_Name:"in store product look up",page_name:"in store product look up",sc_event:"event31,event40"}):utagViewSafe({Page_Name:"in store product look up",page_name:"in store product look up",sc_event:"event31,event41"});else{storeResultNumber>0&&("event10,event11",storeResultNumber)}}null!=$.getUrlVar("latLong")?($(".latLong").val($.getUrlVar("latLong")),storeLocatorJS.initializeMap(showMap,showLocations)):$(".storeLocatorResults:visible").length>0&&storeLocatorJS.initializeMap(showMap,showLocations);var input=$("#locationEntry").val();(otherCountryZipPattern.test(input)||"HomePage"==$.getUrlVar("fromEspot"))&&($("span[for=locationEntry],#ErrorDivStoreSearch").hide(),$("#storeSearchForm").submit())}}}));