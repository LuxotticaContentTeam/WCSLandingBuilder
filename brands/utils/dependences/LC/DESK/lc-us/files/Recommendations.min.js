var fbImage="",fbDesc="";function emailResponse(textResponse){$("#recomendationsSocialShareModal").dialog("close"),$("#emailFrameRecomModal").dialog("close"),$("#emailFrameRecomSuccessModal").dialog("open"),$("#emailResponse").empty(),$("#emailResponse").text(textResponse)}function setSliderDescription(eye){var value=$("#"+eye+"-eye-slider").slider("option","value"),message="";value<=-4?message="LENS_RX_VERY_NEAR":value<=-2?message="LENS_RX_NEAR":value<0?message="LENS_RX_MILD_NEAR":0==value?message="LENS_RX_0":value<2?message="LENS_RX_MILD_FAR":value<4?message="LENS_RX_FAR":value>=4&&(message="LENS_RX_VERY_FAR"),$("."+eye+"-eye-value .description").html(MessageHelper.messages[message])}function checkBothValuesOfSlider(){var rightValue=$("#right-eye-slider").slider("option","value"),leftValue=$("#left-eye-slider").slider("option","value");0==rightValue&&0==leftValue?($(".continueLensStep2").hide(),$(".continueWithGeneral").show()):($(".continueLensStep2").show(),$(".continueWithGeneral").hide(),setSliderDescription("left"),setSliderDescription("right"))}RecommendationsJS={fastScrollSpeed:100,gender:null,answers:new Array(9),inStoreCookie:$.cookie?$.cookie("inStore"):"",requestSubmitted:!1,getStyleQuizApi:function(){return $(".questions-scroll").data("scrollable")},getStyleQuizResult:function(){for(var totals=[0,0,0,0],i=0;i<RecommendationsJS.answers.length;i++)totals[RecommendationsJS.answers[i]]++;var style=0,max=0,multipleMax=!1;for(i=0;i<totals.length;i++)totals[i]>max?(max=totals[i],multipleMax=!1,style=i+1):totals[i]==max&&(multipleMax=!0);return multipleMax&&(style=5),style},ajaxGuestMemberAttributeValueUpdate:function(dataMap,emsName,confirmElement,url){dataMap.emsName=emsName,dataMap.URL="AjaxThankYouEspotView",dataMap.storeId=constants.ajaxParams.storeId,dataMap.catalogId=constants.ajaxParams.catalogId,dataMap.langId=constants.ajaxParams.langId,$.post("GuestMemberAttributeValueUpdateCmd",dataMap,(function(data){null!=confirmElement?$(confirmElement).attr("aria-hidden","false").show():null==url||void 0===url?($("#recommendEspot").html(data),$("#recommendEspotModal").attr("aria-hidden","false").show(),$(".question .answer, .question .prev").unbind("click"),scrollToElement($(".plan-visit-steps-holder"),500)):(url.indexOf("Recommendations")>-1&&recoModalOpen(),document.location=url)}))},emailTabletResultsHandler:function(form){$("#optIn").val($(":checked").length>0?"true":"false"),$("#optin_18yrs_frameRecomModel").val($(":checked").length>0?"true":"false");var data=$("#emailFrameRecomModalForm").serializeArray();return newData={},$.each(data,(function(){newData[this.name]=this.value||""})),$("#emailFrameRecomModal .subscribed").hide(),$.ajax({url:getAbsoluteURL(!0)+"RecommendationsTabletSaveAndSendCmd",type:"post",data:newData,dataType:"text",success:function(response){var responseData=$.parseJSON(response);return"0"==responseData.status?void emailResponse(MessageHelper.messages.EMAIL_SENT_MESSAGE):"100"==responseData.status?void $("#emailFrameRecomModal .subscribed").show():void 0},error:function(jqXHR,textStatus,errorThrown){return console.log(textStatus+"textStatus"),console.log(jqXHR+"jqXHR"),console.log(errorThrown+"errorThrown"),emailResponse(MessageHelper.messages.ERROR_SENDING_EMAIL),!1}}),!1},emailFYLResultsHandler:function(form){return $.ajax({url:getAbsoluteURL(!0)+"RecommendationsTabletSaveAndSendCmd",type:"post",data:$("#recoShareForm").serializeArray(),dataType:"text",success:function(response){var responseData=$.parseJSON(response);return"0"==responseData.status?void emailResponse(MessageHelper.messages.EMAIL_SENT_MESSAGE):"100"==responseData.status?void $("#emailFrameRecomModal .subscribed").show():void 0},error:function(jqXHR,textStatus,errorThrown){return console.log(textStatus+"textStatus"),console.log(jqXHR+"jqXHR"),console.log(errorThrown+"errorThrown"),emailResponse(MessageHelper.messages.ERROR_SENDING_EMAIL),!1}}),!1}},$(document).ready((function(){try{$(document).keyup((function(e){27==e.which&&$("#recommendEspotModal:visible")&&$("#recommendEspotModal").hide()})),$("#right-eye-slider").slider({orientation:"horizontal",min:-4,max:4,value:0,step:.1,change:function(event,ui){checkBothValuesOfSlider(),$("#slider-ticks span").removeClass("highlight");var startPoint=ui.value>0?0:ui.value;for(i=startPoint;i<=startPoint+Math.abs(ui.value);i+=.1)$('#slider-ticks span[rel="'+i.toFixed(1)+'"]').addClass("highlight");showHideGreenPrescriptions()},slide:function(event,ui){checkBothValuesOfSlider(),$("#rEye").val(ui.value),ui.value>0&&$("#right-eye-cover").css({width:110*ui.value+"px"}).removeClass("lessZero").addClass("greaterZero"),ui.value<0&&$("#right-eye-cover").css({width:-110*ui.value+"px"}).removeClass("greaterZero").addClass("lessZero"),0==ui.value&&$("#right-eye-cover").removeClass("greaterZero lessZero"),showHideGreenPrescriptions()}}),$("#rEye").val($("#right-eye-slider").slider("value")),$("#left-eye-slider").slider({orientation:"horizontal",min:-4,max:4,value:0,step:.1,change:function(event,ui){checkBothValuesOfSlider(),$("#slider-ticks span").removeClass("highlight");var startPoint=ui.value>0?0:ui.value;for(i=startPoint;i<=startPoint+Math.abs(ui.value);i+=.1)$('#slider-ticks span[rel="'+i.toFixed(1)+'"]').addClass("highlight");showHideGreenPrescriptions()},slide:function(event,ui){checkBothValuesOfSlider(),$("#lEye").val(ui.value),ui.value>0&&$("#left-eye-cover").css({width:110*ui.value+"px"}).removeClass("lessZero").addClass("greaterZero"),ui.value<0&&$("#left-eye-cover").css({width:-110*ui.value+"px"}).removeClass("greaterZero").addClass("lessZero"),0==ui.value&&$("#left-eye-cover").removeClass("greaterZero lessZero"),showHideGreenPrescriptions()}}),$("#lEye").val($("#left-eye-slider").slider("value")),showHideGreenPrescriptions();var counterBig=-1,incCount=-4;for(i=0;i<80;i++)10==++counterBig&&79!=i?(counterBig=0,$('<span class="big-tick" rel="'+incCount.toFixed(1)+'"></span>').appendTo("#slider-ticks")):$('<span rel="'+incCount.toFixed(1)+'"></span>').appendTo("#slider-ticks"),incCount+=.1;$("#howToModal").dialog({autoOpen:!1,draggable:!1,resizable:!1,modal:!0,zIndex:9999,position:["center"],width:825}),$("#photoUploadModal").dialog({autoOpen:!1,draggable:!1,resizable:!1,modal:!0,position:["center"],zIndex:9999,minWidth:620,open:function(){$("#back").live("click",(function(){$("#photoUploadModal").dialog("close")})),$(this).prev().hide()},close:function(){$("#faceShapeToolModalDiv").dialog("open"),$("#back").unbind("click")}}),$("#faceShapeToolModalDiv").dialog({autoOpen:!1,title:"",draggable:!1,resizable:!1,position:["center"],modal:!0,zIndex:9999,width:850,dialogClass:"face-shape-dialog st-dialog",open:function(){$(".ui-widget-overlay").addClass("black-overlay"),$("#recommendEspot, #faceShapeResponseDiv").hide()},close:function(){$("#faceShapeToolModalDiv").css("display","none"),$("#inline-confirm").css("display","none")},create:function(){var dialogTitle=$(this).dialog("option","title"),dialog=$(this).dialog("widget");dialog.attr("role","complementary"),void 0!==dialogTitle&&""!=dialogTitle||dialog.attr("aria-label","Face Shape Tool Modal").removeAttr("aria-labelledby")}}),$("#PhotoUploadModalDiv").dialog({autoOpen:!1,title:"",draggable:!1,resizable:!1,position:["center"],modal:!0,zIndex:9999,minWidth:700});var dataMap={};$(".lensType").live("click",(function(e){e.preventDefault(),$(this).toggleClass("selected-lens"),$(".lensType.selected-lens").length>0?($("#continueLensStep").removeClass("continueLensStep").addClass("blue button continue").html('<span>Continue</span><span class="arrow"></span>'),$("#continueLensStep").focus()):$("#continueLensStep").addClass("continueLensStep").removeClass("blue button continue").html('Continue, none apply to me <span class="arrow"></span>')})),$("#continueLensStep").live("click",(function(e){if(e.preventDefault(),!this.requestSubmitted){this.requestSubmitted=!0;var lensSelected="";$(".lensType.selected-lens").length>0?($(".lensType").each((function(index){$(this).hasClass("selected-lens")?($("#"+$(this).attr("id")+"In").val("Y"),lensSelected+=$(this).attr("id")+","):$("#"+$(this).attr("id")+"In").val("N")})),lensSelected=lensSelected.slice(0,-1),$("#none").val("N")):($("#NightglareIn").val("N"),$("#ComputerIn").val("N"),$("#TransitionIn").val("N"),$("#none").val("Y")),utagLinkSafe({Page_Name:"pyv:lenses:select",page_name:"pyv:lenses:select",link_id:"pyv:lenses:select",pyv_answer:lensSelected}),$("#step1Form").submit()}})),$(".continueLensStep2").click((function(e){if(e.preventDefault(),!this.requestSubmitted){this.requestSubmitted=!0;var strongRx="N";(Math.abs($("#rEye").val())>=4||Math.abs($("#lEye").val())>=4)&&(strongRx="Y"),dataMap["recStrongRx_"+constants.ajaxParams.storeId+"_r_1"]=strongRx;var tealiumData={Page_Name:"pyv:lenses-prescription-strength:select",page_name:"pyv:lenses-prescription-strength:select",link_id:"pyv:lenses-prescription-strength:select",pyv_answer:"R:"+$("#rEye").val()+" L:"+$("#lEye").val()};utagLinkSafe(tealiumData),RecommendationsJS.ajaxGuestMemberAttributeValueUpdate(dataMap,"Lens_Recommendations_Espot",null,$("#nextPageURL").text())}})),$(".continueWithGeneral").click((function(e){if(e.preventDefault(),!this.requestSubmitted){this.requestSubmitted=!0,dataMap["recStrongRx_"+constants.ajaxParams.storeId+"_r_1"]="N";utagLinkSafe({Page_Name:"pyv:lenses-prescription-strength:select",page_name:"pyv:lenses-prescription-strength:select",link_id:"pyv:lenses-prescription-strength:select",pyv_answer:"R:0 L:0"}),RecommendationsJS.ajaxGuestMemberAttributeValueUpdate(dataMap,"Lens_Recommendations_Espot",null,$("#nextPageURL").text())}})),$(".questions-scroll").scrollable&&$(".questions-scroll").scrollable({items:".questions",touch:!1}),$(".question .gender").click((function(e){e.preventDefault(),RecommendationsJS.gender=$(this).data("gender");var pos="male"==RecommendationsJS.gender?1:2;utagViewSafe({link_name:"fyl_style1",fyl_answer:RecommendationsJS.gender,fyl_position:pos})})),$(".question .male").click((function(e){e.preventDefault();var maleStart=Math.ceil($(".question").length/2);return RecommendationsJS.getStyleQuizApi().seekTo(maleStart,RecommendationsJS.fastScrollSpeed),!1}));var counter=0;$(".question .first").click((function(e){e.preventDefault(),RecommendationsJS.getStyleQuizApi().begin(RecommendationsJS.fastScrollSpeed),counter--,$(".indicators").removeClass("number"+(counter+1)).addClass("number"+counter)})),$(".question .answer").bind("click",(function(e){if(e.preventDefault(),!this.requestSubmitted){var question=$(this).data("question"),answer=$(this).data("style");if(RecommendationsJS.answers[question-1]=answer-1,counter++,9==question){this.requestSubmitted=!0,counter=9,$(".indicators").removeClass("number9").addClass("number9");var style=RecommendationsJS.getStyleQuizResult();dataMap["recStyle_"+constants.ajaxParams.storeId+"_r_1"]=style,dataMap["recGender_"+constants.ajaxParams.storeId+"_r_1"]="male"==RecommendationsJS.gender?"M":"F",RecommendationsJS.ajaxGuestMemberAttributeValueUpdate(dataMap,"Style_Recommendations_Espot",null,$("#nextPageURL").text())}else $(".indicators").removeClass("number"+(counter-1)).addClass("number"+counter);if(null!=question){var linkName="fyl_style"+counter,pos=$(this).data("answer");utagViewSafe({link_name:linkName,fyl_answer:answer,fyl_position:pos})}}})),$(".question .prev").bind("click",(function(e){counter--,$(".indicators").removeClass("number"+(counter+1)).addClass("number"+counter)})),$(".openPrescriptionModal").click((function(e){e.preventDefault(),$("#howToModal").dialog("open"),$("#howToModal").parent().addClass("close-button-outside")})),$("#face-shape-container .section").click((function(e){e.preventDefault(),this.requestSubmitted||(this.requestSubmitted=!0,dataMap["recFaceShape_"+constants.ajaxParams.storeId+"_r_1"]=$(this).attr("id"),$(this).parents(".ui-dialog").length>0?RecommendationsJS.ajaxGuestMemberAttributeValueUpdate(dataMap,"",$("#faceShapeResponseDiv")):$(this).closest("#plan-visit-view").length>0&&RecommendationsJS.ajaxGuestMemberAttributeValueUpdate(dataMap,"",null,$("#nextPageURL").text()),utagViewSafe({link_name:"fyl_shape",fyl_answer:$(this).attr("id"),fyl_position:$(this).closest(".section").index()+1}))})),$(".photoUploadTool").click((function(e){e.preventDefault(),$("#photoUploadModal").dialog("open"),$("#photoUploadModal").parent().addClass("close-button-outside")})),$("#faceShapeToolModalLink").click((function(e){return e.preventDefault(),$("#faceShapeToolModalDiv").dialog("open"),$("#faceShapeToolModalDiv").parent().addClass("no-padding"),!1})),$(".FaceShap-sign-in-link").click((function(){$("#faceShapeToolModalDiv").dialog("close"),$(".header-sign-in-modal").css("display","block").attr("aria-hidden","false"),$(".sign-in-link").addClass("open"),window.scrollTo(0,0)})),$("#PhotoUploadLink").click((function(){return $("#faceShapeToolModalDiv").dialog("close"),$("#photoUploadModal").dialog("open"),!1})),$("#openEmailFrameRecomModal").click((function(){return $("#emailFrameRecomModal").dialog("open"),!1})),$("#emailFrameRecomModal").dialog({autoOpen:!1,draggable:!1,resizable:!1,modal:!0,zIndex:9999,width:480,open:function(){$("#firstName_frameRecomModel").attr("tabindex","1"),$("#lastName_frameRecomModel").attr("tabindex","2"),$("#email_frameRecomModel").attr("tabindex","3"),$("#optin_18yrs_frameRecomModel").attr("tabindex","4"),$("#optIn").attr("tabindex","5"),$("#cancelEmailFrameRecomModalForm").attr("tabindex","6"),$("#sendEmailFrameRecomModalForm").attr("tabindex","7"),$(".ui-dialog-titlebar-close").attr("tabindex","-1"),$("#emailFrameRecomModal .cancel").bind("click",(function(){$("#emailFrameRecomModal").dialog("close")}))},close:function(){$("#firstName_frameRecomModel").attr("tabindex","-1"),$("#lastName_frameRecomModel").attr("tabindex","-1"),$("#email_frameRecomModel").attr("tabindex","-1"),$("#optin_18yrs_frameRecomModel").attr("tabindex","-1"),$("#optIn").attr("tabindex","-1"),$("#cancelEmailFrameRecomModalForm").attr("tabindex","-1"),$("#sendEmailFrameRecomModalForm").attr("tabindex","-1"),$("#emailFrameRecomModal .cancel").unbind("click"),$("#emailFrameRecomModalForm").trigger("reset")}}),$("#emailFrameRecomSuccessModal").dialog({autoOpen:!1,draggable:!1,resizable:!1,modal:!0,zIndex:9999,width:470,open:function(){$("#emailFrameRecomModal .cancel").bind("click",(function(){$("#emailFrameRecomModal").dialog("close")}))},close:function(){$("#emailFrameRecomModal .cancel").unbind("click")}}),$("#emailFrameRecomModalForm").validate({onfocusout:!1,onkeyup:!1,onclick:!1,errorClass:"required",errorElement:"span",rules:{FirstName:{required:!0},LastName:{required:!0},email:{required:!0,email:!0},optin_18yrs_frameRecomModel:{required:function(){return!!$("#optIn").is(":checked")}}},messages:{FirstName:{required:MessageHelper.messages.FIRSTNAME_FRAME_RECOMMENDATIONS_EMPTY_ERROR},LastName:{required:MessageHelper.messages.LASTNAME_FRAME_RECOMMENDATIONS_EMPTY_ERROR},email:{required:MessageHelper.messages.EMAIL_FRAME_RECOMMENDATIONS_EMPTY_ERROR,email:MessageHelper.messages.EMAIL_FRAME_RECOMMENDATIONS_INVALID_ERROR},optin_18yrs_frameRecomModel:{required:MessageHelper.messages.OPTIN_EMAIL_MARKETING_FRAME_RECOMMENDATIONS_ERROR}},errorPlacement:function(error,element){"optin_18yrs_frameRecomModel"==element.attr("name")?error.insertAfter("label[for=optin_18yrs_frameRecomModel]"):error.insertAfter(element)},submitHandler:RecommendationsJS.emailTabletResultsHandler}),$("#cancelEmailFrameRecomModalForm").click((function(){return $("#cancelEmailFrameRecomModalForm").dialog("close"),!1})),$(".shareLink").click((function(e){var $this=$(this),$isSpan=$(e.target).is("span"),$isOn=$this.hasClass("on"),$shareButton=$(".shareButton");return $isSpan&&$isOn?scrollToElement($shareButton,1e3):($this.toggleClass("on").closest(".tile").find(".productMainImage").toggleClass("shareSelected"),!$isOn&&$isSpan&&scrollToElement($shareButton,1e3)),0===$(".shareSelected").length?$shareButton.addClass("disabled"):$shareButton.removeClass("disabled"),$(".shareButton").find("small").text($(".shareSelected").length),!1})),$("#recomendationsSocialShareModal").dialog({autoOpen:!1,draggable:!1,resizable:!1,modal:!0,zIndex:9999,width:470,minHeight:70,open:function(){var $dialog=$("#recomendationsSocialShareModal").parent();$dialog.css({visibility:"hidden"});var scrollTop=$(window).scrollTop();$dialog[0].customScrollTop=scrollTop,$("#recomendationsSocialShareModal .cancel").bind("click",(function(){$("#recomendationsSocialShareModal").dialog("close")})),$("#message").val($("#message").data("message")),setTimeout((function(){$dialog.css({visibility:"visible"});var theTop=$(window).outerHeight()/2-$dialog.outerHeight()/2+scrollTop;theTop=theTop>=scrollTop?theTop:scrollTop,$dialog.css({top:theTop+"px"})}),100)},close:function(){$("#notEnoughError").hide(),$("#tooManyFramesError").hide(),$("#recoShareContainer").hide(),$("#recoEmailContainer").hide();var $dialog=$("#recomendationsSocialShareModal").parent();$("html, body").animate({scrollTop:$dialog[0].customScrollTop},"fast")}}),$(".shareButton").click((function(){if($("#recomendationsSocialShareModal").dialog("open"),$(".shareSelected").length<=1)$("#notEnoughError").show();else if($(".shareSelected").length>4)$("#tooManyFramesError").show();else{var count=0,mediaUrl="",description="",FaceShapeToolURL=$("#FaceShapeURL").val()+"?cid="+$("#fbCid").val(),desc=$("#pinIt_Desc").val(),partNumbers=[],brands=[];$(".shareSelected").each((function(){partNumbers[count]=$(this).attr("data-partNumber"),brands[count]=$(this).attr("data-brand"),count+=1})),(2==count||3==count||4==count)&&(mediaUrl="https://assets.lenscrafters.com/is/image/LensCrafters/"+partNumbers[0]+"__002.png?imwidth=",description=MessageHelper.messages.LENSCRAFTERS_GETS_ME+$("#yourStyle").val()+MessageHelper.messages.WHICH_DO_YOU_THINK_IS_BEST_QUIZ,$(".pin-it-button").attr({href:MessageHelper.messages.PINTREST_CREATE_PIN_URL+encodeURIComponent(FaceShapeToolURL)+"&media="+encodeURIComponent(mediaUrl)+"&description="+desc+"  "+FaceShapeToolURL})),fbImage=mediaUrl,fbDesc=description,$("#recoShareContainer").show()}return!1})),$("#fbShare").click((function(){var fb_Image=fbImage,FaceShapeToolURL=$("#FaceShapeURL").val()+"?cid="+$("#fbCid").val();FB.ui({method:"feed",name:" ",link:FaceShapeToolURL,picture:fb_Image,caption:" ",description:fbDesc,display:"popup"},(function(response){console.log(response)}))})),$(".emailButton").not("#openEmailFrameRecomModal").click((function(){$("#recomendationsSocialShareModal").dialog("open"),$("#recoEmailContainer").show()})),$("#recoShareForm").validate({onfocusout:!1,onkeyup:!1,onclick:!1,errorClass:"required",errorElement:"span",rules:{friendsEmail:{required:!0,email:!0},email:{required:!0,email:!0},FirstName:{required:!0},LastName:{required:!0}},messages:{friendsEmail:{required:MessageHelper.messages.ERROR_ENTER_FRIEND_EMAIL,email:MessageHelper.messages.ERROR_EMAIL_FORMAT},email:{required:MessageHelper.messages.ERROR_ENTER_EMAIL,email:MessageHelper.messages.ERROR_EMAIL_FORMAT},FirstName:{required:MessageHelper.messages.EXAM_VAL_FIRST_NAME},LastName:{required:MessageHelper.messages.EXAM_VAL_LAST_NAME}},errorPlacement:function(error,element){error.insertAfter(element)},submitHandler:RecommendationsJS.emailFYLResultsHandler})}catch(e){-1==window.location.href.indexOf("ScheduleExamView")?console.error("Logged: "+e):console.log("OEE - No need to set recommendations")}}));