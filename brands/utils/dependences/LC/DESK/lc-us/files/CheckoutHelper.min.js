dojo.require("dojox.collections.ArrayList"),dojo.require("wc.widget.Tooltip");var globalAddressUpdateIdentifier="";CheckoutHelperJS={langId:"-1",storeId:"",catalogId:"",orderId:"",shipmentTypeId:"",orderItemIds:[],updateWaitTimeOut:1500,keyPressCount:{},ajaxCheckOut:!0,singlePageCheckout:!0,selectedAddressesArray:{},dataDirty:{},fieldDirtyFlag:!1,resetRequestedShipDateValue:"1970-01-01T00:00:00.000Z",shoppingCartPage:!1,pendingOrderDetailsPage:!1,reviewSubmitPage:!1,RequestShippingDateAction:!1,shipChargeEnabled:!1,tempOrderId:"",tempUserType:"",tempEmailAddresses:"",tempIsQuote:!1,tempOrderTotal:"0",tempPaymentInstructions:{},orderPrepared:"false",appliedPromoCodes:{},applingPromoCodeIndex:0,lastRemovedItem:-1,setOrderPrepared:function(inPrepareIndicator){this.orderPrepared=inPrepareIndicator},isOrderPrepared:function(){return this.orderPrepared},saveCheckoutOrderParameters:function(orderId,userType,addressListForMailNotification,isQuote){this.tempOrderId=orderId,this.tempUserType=userType,this.tempEmailAddresses=addressListForMailNotification,this.tempIsQuote=isQuote},setOrderPayments:function(orderTotal,paymentInstructions){this.tempOrderTotal=orderTotal+0,this.tempPaymentInstructions=paymentInstructions},isOrderPaymentFullyAllocated:function(){var allocatedAmount=0;if(this.tempPaymentInstructions.length>=1)for(var i=0;i<this.tempPaymentInstructions.length;i++)allocatedAmount+=this.tempPaymentInstructions[i].amount.value;return allocatedAmount==this.tempOrderTotal||(allocatedAmount<this.tempOrderTotal?(MessageHelper.displayErrorMessage(MessageHelper.messages.EDPPaymentMethods_CANNOT_RECONCILE_PAYMENT_AMT),!1):allocatedAmount>this.tempOrderTotal?(MessageHelper.displayErrorMessage(MessageHelper.messages.EDPPaymentMethods_PAYMENT_AMOUNT_LARGER_THAN_ORDER_AMOUNT),!1):(MessageHelper.displayErrorMessage(MessageHelper.messages.EDPPaymentMethods_PAYMENT_AMOUNT_PROBLEM),!1))},getSavedParameter:function(paramName){return this[paramName]},setShipChargeEnabled:function(enabled){this.shipChargeEnabled=enabled},updateParamObject:function(params,key,value,toArray,index){if(null==params&&(params=[]),null!=params[key]&&toArray)if(dojo.lang.isArrayLike(params[key]))null!=index&&""!=index?params[key][index]=value:params[key].push(value);else{var tmpValue=params[key];params[key]=[],params[key].push(tmpValue),params[key].push(value)}else if(null!=index&&""!=index&&-1!=index)params[key+"_"+index]=value;else if(-1==index){for(var i=1;null!=params[key+"_"+i];)i++;params[key+"_"+i]=value}else params[key]=value;return params},checkRequestShippingDateBox:function(checkBoxName,divName,suffix){null!=suffix&&""!=suffix&&(checkBoxName=checkBoxName+"_"+suffix,divName=divName+"_"+suffix);var checkBox=dojo.byId(checkBoxName);checkBox.checked?(dojo.byId(divName).style.visibility="visible",dojo.byId(divName).style.display="block"):(dojo.byId(divName).style.visibility="hidden",dojo.byId(divName).style.display="none","1"==this.shipmentTypeId?dojo.byId("requestedShippingDate").blur():"2"==this.shipmentTypeId&&dojo.byId("MS_requestedShippingDate_"+suffix).blur());var addressId,shipModeId="";if("1"==this.shipmentTypeId?(addressId=document.getElementById("singleShipmentAddress").value,shipModeId=document.getElementById("singleShipmentShippingMode").value):"2"==this.shipmentTypeId?(addressId=document.getElementById("MS_ShipmentAddress_"+suffix).value,shipModeId=document.getElementById("MS_ShippingMode_"+suffix).value):console.debug("shipmentTypeId is undefined. Single shipment has Id 1; multiple shipment has Id 2."),!checkBox.checked&&this.isAjaxCheckOut()){var params=[];params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=".",this.updateParamObject(params,"addressId",addressId,!1,-1),this.updateParamObject(params,"shipModeId",shipModeId,!1,-1),null==dijit.byId("requestedShippingDate")&&null==dijit.byId("MS_requestedShippingDate_"+suffix)||this.updateParamObject(params,"requestedShipDate",this.resetRequestedShipDateValue,!1,-1);for(var orderItemId=null,qty=-1,totalItems=document.getElementById("totalNumberOfItems").value,i=0;i<totalItems;i++)if(null!=document.getElementById("qty_"+(i+1))&&(qty=document.getElementById("qty_"+(i+1)).value),orderItemId=document.getElementsByClassName("orderItem_"+(i+1)).value,-1!=qty){if("1"==this.shipmentTypeId){this.updateParamObject(params,"orderItemId",orderItemId,!1,-1);break}if("2"==this.shipmentTypeId){if(null!=suffix&&""!=suffix&&orderItemId==suffix){this.updateParamObject(params,"orderItemId",orderItemId,!1,-1);break}}else console.debug("shipmentTypeId is undefined. Single shipment has Id 1; multiple shipment has Id 2.")}if(!submitRequest())return;cursor_wait(),CheckoutHelperJS.RequestShippingDateAction=!0,wc.service.invoke("OrderItemAddressShipMethodUpdate",params)}},checkShippingInstructionsBox:function(checkBoxName,divName,suffix){var thisCheckBoxName,thisDivName;null!=suffix&&""!=suffix?(thisCheckBoxName=checkBoxName+"_"+suffix,thisDivName=divName+"_"+suffix):(thisCheckBoxName=checkBoxName,thisDivName=divName);var thisCheckBox=dojo.byId(thisCheckBoxName);thisCheckBox.checked?(dojo.byId(thisDivName).style.visibility="visible",dojo.byId(thisDivName).style.display="block"):(dojo.byId(thisDivName).style.visibility="hidden",dojo.byId(thisDivName).style.display="none");var addressId,shipModeId="";if("1"==this.shipmentTypeId)addressId=document.getElementById("singleShipmentAddress").value,shipModeId=document.getElementById("singleShipmentShippingMode").value;else if("2"==this.shipmentTypeId){var tempAddressId;addressId=document.getElementById("MS_ShipmentAddress_"+suffix).value,shipModeId=document.getElementById("MS_ShippingMode_"+suffix).value;for(var totalItems=document.getElementById("totalNumberOfItems").value,i=0;i<totalItems;i++)if(null!=document.getElementById("qty_"+(i+1))&&-1!=document.getElementById("qty_"+(i+1)).value&&(orderItemId=document.getElementsByClassName("orderItem_"+(i+1)).value,tempAddressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value,document.getElementById("MS_ShippingMode_"+orderItemId).value==shipModeId&&tempAddressId==addressId)){var tempDivName=divName+"_"+orderItemId,tempCheckBoxName=checkBoxName+"_"+orderItemId;thisCheckBox.checked?(dojo.byId(tempDivName).style.visibility="visible",dojo.byId(tempDivName).style.display="block",dojo.byId(tempCheckBoxName).checked="checked"):(dojo.byId(tempDivName).style.visibility="hidden",dojo.byId(tempDivName).style.display="none",dojo.byId(tempCheckBoxName).checked="")}}else console.debug("shipmentTypeId is undefined. Single shipment has Id 1; multiple shipment has Id 2.");if(!thisCheckBox.checked&&this.isAjaxCheckOut()){var params=[];params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=".";var orderItemId=null;if("1"==this.shipmentTypeId?(null!=document.getElementById("shipInstructions")&&(this.updateParamObject(params,"shipInstructions","",!1),document.getElementById("shipInstructions").value=""),orderItemId=document.getElementsByClassName("orderItem_1").value,this.updateParamObject(params,"addressId",addressId,!1),this.updateParamObject(params,"orderItemId",orderItemId,!1)):"2"==this.shipmentTypeId?null!=suffix&&""!=suffix&&(null!=document.getElementById("MS_shipInstructions_"+suffix)&&(this.updateParamObject(params,"shipInstructions","",!1),document.getElementById("MS_shipInstructions_"+suffix).value=""),this.updateParamObject(params,"addressId",addressId,!1,-1),this.updateParamObject(params,"orderItemId",suffix,!1),this.setShippingInstuctionsForAllOtherItems(addressId,shipModeId,"")):console.debug("shipmentTypeId is undefined. Single shipment has Id 1; multiple shipment has Id 2."),!submitRequest())return;cursor_wait(),wc.service.invoke("OrderShippingInfoUpdate",params)}},initializeShipmentPage:function(shipmentTypeId){this.shipmentTypeId=shipmentTypeId},setCommonParameters:function(langId,storeId,catalogId){this.langId=langId,this.storeId=storeId,this.catalogId=catalogId},deleteFromCart:function(orderItemId,forWishlist){if(this.isAjaxCheckOut()){var params=[];params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=null!=this.orderId&&"undefined"!=this.orderId&&""!=this.orderId?this.orderId:".",params.orderItemId=orderItemId,params.calculationUsage="-1,-2,-4,-5,-6,-7";for(var x=document.getElementById("totalNumberOfItems").value,y=x,i=0;i<x;i++){var qtyObj=document.getElementById("freeGift_qty_"+(i+1));null==qtyObj&&null==qtyObj||(qty=qtyObj.value,null!=qty&&null!=qty&&-1==qty&&(y-=1))}submitRequest()&&(cursor_wait(),1==y?wc.service.invoke("AjaxDeleteOrderItem1",params):forWishlist?wc.service.invoke("AjaxDeleteOrderItemFromCart",params):this.shoppingCartPage||this.pendingOrderDetailsPage||this.reviewSubmitPage?wc.service.invoke("AjaxDeleteOrderItem1",params):wc.service.invoke("AjaxDeleteOrderItemForShippingBillingPage",params))}},deleteFrameFromCart:function(frameOrderItemId,orderId,forGiftItem,_dl,number){this.lastRemovedItem=number;var params=[];if(params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=orderId,params.orderItemId=frameOrderItemId,params.calculationUsage="-1,-2,-4,-5,-6,-7",params.forGiftItem=forGiftItem,submitRequest()){cursor_wait(),(this.shoppingCartPage||this.pendingOrderDetailsPage||this.reviewSubmitPage)&&wc.service.invoke("AjaxFrameDeleteCmd",params);try{var obj={id:"WCS-D-Prods-Delete",Products:window.Products}}catch(err){obj={id:"WCS-D-Prods-Delete-Error",Error_Source:"Server",Error_Code:"utag_data syntax - "+err.message}}finally{tealium_data2track.push(obj)}}},deleteContactLensFromCart:function(leftLensorderItemId,rightLensorderItemId,oderID,_dl){var params=[];params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=null!=oderID&&"undefined"!=oderID&&""!=oderID?oderID:".",params.orderItemId_1=leftLensorderItemId,params.quantity_1=0,params.orderItemId_2=rightLensorderItemId,params.quantity_2=0,params.calculationUsage="-1,-2,-4,-5,-6,-7",submitRequest()&&(cursor_wait(),(this.shoppingCartPage||this.pendingOrderDetailsPage)&&wc.service.invoke("AjaxUpdateOrderItem1",params))},updateContactLensQuantity:function(lensOrderItemId,oderID,quantity){var params=[];params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderItemId=lensOrderItemId,params.quantity=quantity,params.calculationUsage="-1,-2,-4,-5,-6,-7",submitRequest()&&(cursor_wait(),wc.service.invoke("AjaxUpdateContactLensOrderItem",params))},deleteFrameNotStellaFromCart:function(orderItemsId,orderId){var orderItemsSplitted=orderItemsId.toString().replace(" ","").replace(/[\[\]']+/g,"").split(",").map(String),params=[];if(params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=orderId,params.orderItemId=orderItemsSplitted,params.calculationUsage="-1,-2,-4,-5,-6,-7",submitRequest()&&(cursor_wait(),this.shoppingCartPage||this.pendingOrderDetailsPage||this.reviewSubmitPage)){wc.service.invoke("AjaxFrameDeleteCmd",params);try{var obj={id:"Prods-Delete",Products:window.Products}}catch(err){obj={id:"Prods-Delete-Tentative",Error_Source:"Product",Error_Code:"Remove from cart"}}finally{tealium_data2track.push(obj)}}},deleteFromCartTO:function(orderItemId,isGlasses,forWishlist){"empty"!=$("#payMethodId_1").val()&&($("#payMethodId_1").val("empty").attr("selected","selected"),$("#payMethodId_1").change());var params=[];params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=null!=this.orderId&&"undefined"!=this.orderId&&""!=this.orderId?this.orderId:".",params.orderItemId=orderItemId,params.calculationUsage="-1,-2,-3,-4,-5,-6,-7","true"&&(params.field2="",params.checkWarranty="true");for(var x=document.getElementById("totalNumberOfItems").value,y=x,i=0;i<x;i++){var qtyObj=document.getElementById("freeGift_qty_"+(i+1));null==qtyObj&&null==qtyObj||(qty=qtyObj.value,null!=qty&&null!=qty&&-1==qty&&(y-=1))}submitRequest()&&(cursor_wait(),1==y?wc.service.invoke("AjaxDeleteOrderItem1",params):forWishlist?wc.service.invoke("AjaxDeleteOrderItemFromCart",params):this.shoppingCartPage||this.pendingOrderDetailsPage?wc.service.invoke("AjaxDeleteOrderItem",params):wc.service.invoke("AjaxDeleteOrderItemForShippingBillingPage",params))},addToWishListAndDeleteFromCart:function(catEntryIdentifier,orderItemId){if(this.isAjaxCheckOut()){var params=[];params.catEntryId=catEntryIdentifier,params.URL="SuccessfulAJAXRequest",params.orderItemId=orderItemId,params.updateable=0,params.langId=this.langId,params.storeId=this.storeId,params.catalogId=this.catalogId,submitRequest()&&(cursor_wait(),wc.service.invoke("AjaxInterestItemAddAndDeleteFromCart",params))}},updateAddressIdOFItemsOnCreateEditAddress:function(addressId){var params=[];if(params.orderId=".",params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.calculationUsage="-1,-2,-3,-4,-5,-6,-7",params.allocate="***",params.backorder="***",params.remerge="***",params.check="*n","1"==this.shipmentTypeId)params.addressId=addressId;else for(var orderItemId=null,i=0;i<this.orderItemIds.length;i++)orderItemId=this.orderItemIds[i],this.updateParamObject(params,"orderItemId",orderItemId,!1,-1),this.updateParamObject(params,"addressId",addressId,!1,-1);submitRequest()&&(cursor_wait(),wc.service.invoke("AjaxUpdateOrderItemsAddressId",params))},checkRedcard:function(checkbox){checkbox.checked?($("#WC_REDCARD_PromotionCodeDisplay_FormInput_page_In_PromotionCodeForm_1").val("A"),CheckoutHelperJS.applyPromotionCode("RedcardPromotionCodeForm","")):CheckoutHelperJS.removePromotionCode("RedcardPromotionCodeForm","REDCARD","")},verifySubmitMethod:function(){$("#savedCC_1:checked").length>0?($("#creditCardFormContainer").hide(),$("#payMethodId_1").val($("#saved_paymentMethod_1").val()),$("#account1_1").val($("#saved_cardNumber_1").val()),$("#cc_cvc_1").val($("#saved_ccv_1").val()),$("#expire_month_1").val($("#saved_expireMonth_1").val()),$("#expire_year_1").val($("#saved_expireYear_1").val()),$("#expdate_1").removeClass("required"),CheckoutHelperJS.paymentDataDirty(1,!0),CheckoutPayments.updatePaymentObject(1,"account"),CheckoutPayments.updatePaymentObject(1,"cc_cvc"),CheckoutPayments.updatePaymentObject(1,"expire_month"),CheckoutPayments.updatePaymentObject(1,"expire_year")):($("#creditCardFormContainer").show(),$("#payMethodId_1").val(""),$("#account1_1").val(""),$("#cc_cvc_1").val(""),$("#expire_month_1").val(""),$("#expire_year_1").val(""),$("#expdate_1").addClass("required"))},verifyExpDate:function(input){$("#paymentArea1").find("span.required").remove();var d=new Date,y=d.getFullYear()-2e3,m=d.getMonth();if(/^((0[1-9])|(1[0-2]))\/([1-3][0-9])$/.test($(input).val())){var values=$("#expdate_1").val().split("/");$("#expire_month_1").val(values[0]),$("#expire_year_1").val("20"+values[1]),parseInt(values[1])<y&&$('<span for="account1_1" generated="true" class="required" aria-live="rude">Invalid expiration year and month</span>').insertAfter($(input)),parseInt(values[0])<=m&&parseInt(values[1])==y&&$('<span for="account1_1" generated="true" class="required" aria-live="rude">Invalid expiration year and month</span>').insertAfter($(input))}else $('<span for="account1_1" generated="true" class="required" aria-live="rude">The format provided is not valid.</span>').insertAfter($(input))},verifyLuhn:function(luhn){for(var len=luhn.length,mul=0,prodArr=[[0,1,2,3,4,5,6,7,8,9],[0,2,4,6,8,1,3,5,7,9]],sum=0;len--;)sum+=prodArr[mul][parseInt(luhn.charAt(len),10)],mul^=1;return sum%10==0&&sum>0},clearLuhnError:function(){$(".input-container.card-number").removeClass("error"),$(".input-container.card-number span.luhn-check").remove()},verifyCC:function(cc){$("#cardImageContainer span").removeClass("active");var cardNum=cc;cardNum.length>14&&(/^4[0-9]{6,}$/.test(cardNum)&&($("#cardImageContainer .visa").addClass("active"),$("#payMethodId_1").val("Visa"),$("#card_type").val("Visa")),/^5[1-5][0-9]{5,}$/.test(cardNum)&&($("#cardImageContainer .mastercard").addClass("active"),$("#payMethodId_1").val("Master Card"),$("#card_type").val("Master Card")),/^3[47][0-9]{5,}$/.test(cardNum)&&($("#cardImageContainer .amex").addClass("active"),$("#payMethodId_1").val("AMEX"),$("#card_type").val("AMEX"),$("#cc_cvc").attr("placeholder","1234")),/^6[0245][0-9]{5,}$/.test(cardNum)&&($("#cardImageContainer .discover").addClass("active"),$("#payMethodId_1").val("Discover"),$("#card_type").val("Discover")),/^(?:2131|1800|35[0-9]{3})[0-9]{11}$/.test(cardNum)&&($("#cardImageContainer .jcb").addClass("active"),$("#payMethodId_1").val("JCB"),$("#card_type").val("JCB")))},toPaymentMethod:function(_dl){setCurrentId($("[name='singleShipmentShippingMode']:checked").attr("id")),CheckoutHelperJS.updateShipModeForAllItems($("[name='singleShipmentShippingMode']:checked")),$("#WC_ShipmentDisplay_div_30").removeClass("hide"),$("#shippingMethod").addClass("hide"),$("#checkout_left_nav ul li").removeClass("active"),$("#PaymentMethodEntry").addClass("active"),updateLastCompletedStepCookie(5)},saveOrderItemsList:function(orderItemId,addressId){if("-1"==orderItemId)for(var totalItems=document.getElementById("totalNumberOfItems").value,i=0;i<totalItems;i++)this.orderItemIds[i]=document.getElementsByClassName("orderItem_"+(i+1)).value;else{if(0==orderItemId&&"1"==this.shipmentTypeId){if(document.getElementById("singleShipmentAddress"))if(addressId==document.getElementById("singleShipmentAddress").value)for(totalItems=document.getElementById("totalNumberOfItems").value,i=0;i<totalItems;i++)this.orderItemIds[i]=document.getElementsByClassName("orderItem_"+(i+1)).value;else this.orderItemIds=[];else this.orderItemIds=[];return}totalItems=document.getElementById("totalNumberOfItems").value,orderItemId=null;var j=0;for(i=0;i<totalItems;i++)orderItemId=document.getElementsByClassName("orderItem_"+(i+1)).value,document.getElementById("MS_ShipmentAddress_"+orderItemId)&&document.getElementById("MS_ShipmentAddress_"+orderItemId).value==addressId&&(this.orderItemIds[j++]=orderItemId)}},setShippingInstuctionsForAllOtherItems:function(addressId,shipModeId,shipInstructions){for(var orderItemId,addressId1,totalItems=document.getElementById("totalNumberOfItems").value,i=0;i<totalItems;i++)null!=document.getElementById("qty_"+(i+1))&&-1!=document.getElementById("qty_"+(i+1)).value&&(orderItemId=document.getElementsByClassName("orderItem_"+(i+1)).value,addressId1=document.getElementById("MS_ShipmentAddress_"+orderItemId).value,document.getElementById("MS_ShippingMode_"+orderItemId).value==shipModeId&&addressId1==addressId&&(document.getElementById("MS_shipInstructions_"+orderItemId).value=shipInstructions))},shipAsComplete:function(checkBox){if(this.isAjaxCheckOut()){var params=[];params.orderId=".",params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.calculationUsage="-1,-2,-3,-4,-5,-6,-7",this.updateParamObject(params,"ShipAsComplete","Y",!0),orderItemId=document.getElementsByClassName("orderItem_1").value,this.updateParamObject(params,"orderItemId",orderItemId,!1),submitRequest()&&(cursor_wait(),wc.service.invoke("OrderShippingInfoUpdate",params))}},updateAddressIdForOrderItem:function(addressId){if(null==addressId||0==addressId.length)return!0;var params=[];params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=".",params.calculationUsage="-1,-2,-3,-4,-5,-6,-7",params.allocate="***",params.backorder="***",params.remerge="***",params.check="*n",this.updateParamObject(params,"addressId",addressId,!1),wc.service.invoke("AjaxSetAddressIdOfOrderItems",params)},updateAddressIdForOrderItemCustom:function(addressId,orderItemIdString){if(null==addressId||0==addressId.length)return!0;var params=[];if(params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=".",params.calculationUsage="-1,-2,-3,-4,-5,-6,-7",params.allocate="***",params.backorder="***",params.remerge="***",params.check="*n",null!=orderItemIdString)for(var orderItemsIdList=orderItemIdString.split(","),i=0;i<=orderItemsIdList.length;i++){params["orderItemId_"+(i+1)]=orderItemsIdList[i]}this.updateParamObject(params,"addressId",addressId,!1),wc.service.invoke("AjaxSetAddressIdOfOrderItems",params)},updateShipModeIdForOrder:function(shipModeId){var params=[];params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.shipModeId=shipModeId,params.calculationUsage="-1,-2,-3,-4,-5,-6,-7",params.allocate="***",params.backorder="***",params.remerge="***",params.check="*n",wc.service.invoke("AjaxSetShipModeIdForOrder",params)},removeAllOrderItemIds:function(orderId,isGlasses){var params=[];params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=orderId,params.isGlasses=isGlasses,wc.service.invoke("LCRemoveItemsCmd",params)},applyPromotionCode:function(formName,returnView){var form=$("form[id^="+formName+"]:first"),promoValue=form.find('input[name="promoCode"]').val().toUpperCase();if(form.find('input[name="promoCode"]').val(promoValue),$("#promoEmpty").hide(),$(".promo-field .label_input .promotionCodeFailureResponse").html(""),""!=trim(form.find('input[name="promoCode"]').val())){if(promoValue.startsWith("IDME"))$(".promo-field .label_input .promotionCodeFailureResponse").html("Promotion code "+promoValue+" is invalid.");else if(form=form[0],$(form).valid()&&(service=wc.service.getServiceById("AjaxPromotionCodeManage"),service.formId=formName,null!=form.URL&&(form.URL.value=""),submitRequest())){cursor_wait();var params=[];params.promoCode=promoValue,wc.service.invoke("AjaxPromotionCodeManage",params)}}else $("#promoEmpty").show()},applyHiddenPromotionCode:function(formName,returnView){var form=document.forms[formName],promoValue=form.promoCode.value;if(form.promoCode.value=promoValue.toUpperCase(),$(form).valid())if(this.isAjaxCheckOut()){if(service=wc.service.getServiceById("AjaxPromotionCodeManage"),service.formId=formName,null!=form.URL&&(form.URL.value=""),!submitRequest())return;cursor_wait(),wc.service.invoke("AjaxPromotionCodeManage")}else{null!=returnView&&""!=returnView&&"undefined"!=returnView||(returnView="OrderShippingBillingView");var input=document.createElement("INPUT");if(input.setAttribute("type","hidden"),input.setAttribute("name","errorViewName"),input.setAttribute("value",returnView),form.appendChild(input),form.URL.value="OrderCalculate?updatePrices=1&calculationUsageId=-1&calculationUsageId=-2&calculationUsageId=-3&calculationUsageId=-7&URL="+returnView,!submitRequest())return;form.submit()}},applyPromotionCodeOnLoad:function(index,formName){this.applingPromoCodeIndex=index;var promoCode=this.appliedPromoCodes[index],form=document.forms[formName];form.promoCode.value=promoCode.toUpperCase(),service=wc.service.getServiceById("AjaxPromotionCodeManage"),service.formId=formName,null!=form.URL&&(form.URL.value=""),submitRequest()&&(cursor_wait(),wc.service.invoke("AjaxPromotionCodeManage"))},removePromotionCode:function(formName,promoCode,returnView){var form=$("form[id^="+formName+"]:first");form.find('input[name="promoCode"]').val(promoCode),form.find('input[name="taskType"]').val("R"),service=wc.service.getServiceById("AjaxPromotionCodeManage"),service.formId=formName;try{$.each(_dl.order_promo_codes,(function(index,value){value==promoCode&&delete _dl.order_promo_codes}))}catch(err){console.log("Error deleting promo code from analytics object.")}submitRequest()&&(cursor_wait(),wc.service.invoke("AjaxPromotionCodeManage"))},applyCoupon:function(formName,returnView,couponId){var form=document.forms[formName];form.setAttribute("action","CouponsAddRemove"),form.couponId.value=couponId,form.taskType.value="A",submitRequest()&&(this.isAjaxCheckOut()?(service=wc.service.getServiceById("AjaxCouponsAddRemove"),service.formId=formName,cursor_wait(),wc.service.invoke("AjaxCouponsAddRemove")):(form.URL.value="OrderCalculate?updatePrices=1&calculationUsageId=-1&calculationUsageId=-2&calculationUsageId=-7&URL="+returnView,form.submit()))},removeCouponFromOrder:function(formName,returnView,couponId){var form=document.forms[formName];form.setAttribute("action","CouponsAddRemove"),form.couponId.value=couponId,form.taskType.value="R",submitRequest()&&(this.isAjaxCheckOut()?(service=wc.service.getServiceById("AjaxCouponsAddRemove"),service.formId=formName,cursor_wait(),wc.service.invoke("AjaxCouponsAddRemove")):(form.URL.value="OrderCalculate?updatePrices=1&calculationUsageId=-1&calculationUsageId=-2&calculationUsageId=-7&URL="+returnView,form.submit()))},setAjaxCheckOut:function(ajaxCheckOut){this.ajaxCheckOut=ajaxCheckOut},isAjaxCheckOut:function(){return this.ajaxCheckOut},setSinglePageCheckout:function(singlePageCheckout){this.singlePageCheckout=singlePageCheckout},isSinglePageCheckout:function(){return this.singlePageCheckout},checkoutOrder:function(orderId,userType,addressListForMailNotification,isQuote){if(null!=isQuote&&null!=isQuote||(isQuote=!1),"false"==this.isOrderPrepared())return this.saveCheckoutOrderParameters(orderId,userType,addressListForMailNotification,isQuote),$("#modal-loading-icon").show(),void wc.service.invoke("AjaxPrepareOrderForSubmit");params=[],params.orderId=orderId,params.notifyMerchant=1,params.notifyShopper=1,params.notifyOrderSubmitted=1,params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId;var purchaseOrderForm=document.forms.purchaseOrderNumberInfo;if(purchaseOrderForm){var purchaseOrderNumber=purchaseOrderForm.purchase_order_number.value;if("true"==purchaseOrderForm.purchaseOrderNumberRequired.value&&""==purchaseOrderForm.purchase_order_number.value)return void MessageHelper.formErrorHandleClient(purchaseOrderForm.purchase_order_number,MessageHelper.messages.ERROR_PONumberEmpty);if(!MessageHelper.isValidUTF8length(purchaseOrderForm.purchase_order_number.value,128))return void MessageHelper.formErrorHandleClient(purchaseOrderForm.purchase_order_number,MessageHelper.messages.ERROR_PONumberTooLong)}if(params.purchaseorder_id=purchaseOrderNumber,"G"==userType){var emailList;emailList=(addressListForMailNotification=trim(addressListForMailNotification)).split(" ");for(var uniqueList=[],j=0;j<emailList.length;j++)uniqueList[emailList[j]]=emailList[j];var totalLength=0;for(i in uniqueList)totalLength+=1;var temp="",k=0;for(i in uniqueList)k+=1,temp+=uniqueList[i],k<totalLength&&(temp+=",");params.notify_EMailSender_recipient=temp;var smsOrderNotificationCheckbox=document.getElementById("sendMeSMSNotification");if(null!=smsOrderNotificationCheckbox&&"undefined"!=smsOrderNotificationCheckbox&&smsOrderNotificationCheckbox.checked){var mobileCountryCode=document.getElementById("mobileCountryCode"),mobilePhone1=document.getElementById("mobilePhone1");null!=mobileCountryCode&&"undefined"!=mobileCountryCode&&null!=mobilePhone1&&"undefined"!=mobilePhone1&&(params.SMS=mobileCountryCode.value+mobilePhone1.value)}}var webchatCookie=$.cookie("WEBCHATIDENTIFIER");null!=webchatCookie&&(params.WEBCHATIDENTIFIER=webchatCookie),submitRequest()&&(cursor_wait(),isQuote?(params.URL="",this.setOrderId(orderId),wc.service.invoke("AjaxSubmitQuote",params)):wc.service.invoke("AjaxSubmitOrder",params))},prepareOrderSchedule:function(){if(null!=document.getElementById("scheduleOrderInputSection")){var scheduleOrderStartDateObj=dijit.byId("ScheduleOrderStartDate");if(!this.validateDate(scheduleOrderStartDateObj,"ScheduleOrderStartDate"))return;var interval=dojo.byId("ScheduleOrderFrequency").value,key1="WC_ScheduleOrder_"+document.getElementById("orderIdToSchedule").value+"_strStartDate",key2="WC_ScheduleOrder_"+document.getElementById("orderIdToSchedule").value+"_interval";if("undefined"==interval&&null==scheduleOrderStartDateObj.value)dojo.cookie(key1,null,{expires:-1}),dojo.cookie(key2,null,{expires:-1});else{var t=dojo.date.stamp.fromISOString(scheduleOrderStartDateObj),now=new Date;t.setHours(now.getHours(),now.getMinutes(),now.getSeconds(),now.getMilliseconds()),t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:!0,milliseconds:!0}),dojo.cookie(key1,t),dojo.cookie(key2,interval)}}},scheduleOrder:function(orderId,isRecurring,userType){if("G"===userType&&isRecurring)MessageHelper.displayErrorMessage(MessageHelper.messages.ERROR_GUEST_USER_SUBMIT_RECURRING_ORDER);else{var params=[];params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=orderId,null!=isRecurring&&1==isRecurring?(params.startDate=dojo.cookie("WC_ScheduleOrder_"+orderId+"_strStartDate"),"1"==dojo.cookie("WC_ScheduleOrder_"+orderId+"_interval")?(params.fulfillmentInterval="1",params.fulfillmentIntervalUOM="DAY",params.timePeriod="1",params.timePeriodUOM="DAY"):"2"==dojo.cookie("WC_ScheduleOrder_"+orderId+"_interval")?(params.fulfillmentInterval="1",params.fulfillmentIntervalUOM="DAY"):"3"==dojo.cookie("WC_ScheduleOrder_"+orderId+"_interval")?(params.fulfillmentInterval="1",params.fulfillmentIntervalUOM="WEE"):"4"==dojo.cookie("WC_ScheduleOrder_"+orderId+"_interval")?(params.fulfillmentInterval="2",params.fulfillmentIntervalUOM="WEE"):"5"==dojo.cookie("WC_ScheduleOrder_"+orderId+"_interval")?(params.fulfillmentInterval="3",params.fulfillmentIntervalUOM="WEE"):"6"==dojo.cookie("WC_ScheduleOrder_"+orderId+"_interval")&&(params.fulfillmentInterval="4",params.fulfillmentIntervalUOM="WEE")):(params.strStartDate=dojo.cookie("WC_ScheduleOrder_"+orderId+"_strStartDate"),params.interval=dojo.cookie("WC_ScheduleOrder_"+orderId+"_interval"));var purchaseOrderForm=document.forms.purchaseOrderNumberInfo;if(purchaseOrderForm){var purchaseOrderNumber=purchaseOrderForm.purchase_order_number.value;if("true"==purchaseOrderForm.purchaseOrderNumberRequired.value&&""==purchaseOrderForm.purchase_order_number.value)return void MessageHelper.formErrorHandleClient(purchaseOrderForm.purchase_order_number,MessageHelper.messages.ERROR_PONumberEmpty);if(!MessageHelper.isValidUTF8length(purchaseOrderForm.purchase_order_number.value,128))return void MessageHelper.formErrorHandleClient(purchaseOrderForm.purchase_order_number,MessageHelper.messages.ERROR_PONumberTooLong);params.purchaseorder_id=purchaseOrderNumber}submitRequest()&&(cursor_wait(),null!=isRecurring&&1==isRecurring?wc.service.invoke("SubmitRecurringOrder",params):wc.service.invoke("ScheduleOrder",params))}},validateDate:function(dateObj,elementId){var now=new Date;return!(null!=dateObj.getValue()&&dateObj.compare(dateObj.getValue(),now)<0)||(now.toDateString()===dateObj.getValue().toDateString()||(null!=elementId&&null!=document.getElementById(elementId)?MessageHelper.formErrorHandleClient(document.getElementById(elementId).id,MessageHelper.messages.PAST_DATE_ERROR):MessageHelper.displayErrorMessage(MessageHelper.messages.PAST_DATE_ERROR),!1))},createAddress:function(orderItemId,addressType){if(this.saveOrderItemsList(orderItemId,"-1"),submitRequest()){cursor_wait(!0),wc.render.updateContext("editShippingAddressContext",{shippingAddress:"-1",addressType:addressType}),this.showHideDivs("editAddressContents","mainContents")}},showHideDivs:function(showArea,hideArea){document.getElementById(hideArea).style.display="none",document.getElementById(showArea).style.display="block"},restorePreviousAddressDetails:function(){var valueRestored=!1;if(!this.isAjaxCheckOut())for(i in this.selectedAddressesArray)null!=document.getElementById(i)&&-1==document.getElementById(i).value&&(document.getElementById(i).value=this.selectedAddressesArray[i],valueRestored=!0,"1"==this.shipmentTypeId&&this.displayAddressDetails(document.getElementById("singleShipmentAddress").value,"Shipping"));if(this.isAjaxCheckOut()||!valueRestored)if("2"==this.shipmentTypeId)for(var i=0;i<this.orderItemIds.length;i++){var orderItemId=this.orderItemIds[i];null!=(element=document.getElementById("MS_ShipmentAddress_"+orderItemId))&&-1==element.value&&(element.value=document.getElementById("addressId_"+orderItemId).value)}else if("1"==this.shipmentTypeId){var element;null!=(element=document.getElementById("singleShipmentAddress"))&&document.getElementById("addressId_all")&&(this.isAjaxCheckOut()||this.displayAddressDetails(element.value,"Shipping"))}for(i=1;i<4;i++)if(null!=document.getElementById("PaymentForm"+i)){var paymentForm=document.getElementById("PaymentForm"+i);-1==paymentForm.billing_address_id.value&&(paymentForm.billing_address_id.value=document.getElementById("selectedAddressId_"+i).value,this.isAjaxCheckOut()||CheckoutPayments.displayBillingAddressDetailsWeb10(paymentForm.billing_address_id,i)),-1==wc.render.getContextById("billingAddressDropDownBoxContext").properties["billingAddress"+i]&&(wc.render.getContextById("billingAddressDropDownBoxContext").properties["billingAddress"+i]=paymentForm.billing_address_id.value)}},editAddress:function(addressSelectBoxName,orderItemId,profileshipping,profilebilling){var opts=$('select[name="'+addressSelectBoxName+'"]').find("option");opts.each((function(index){$(this).is(":selected")&&($(document).data("currentShippingIndex",index),$(document).data("shippingAddressCount",opts.length))})),globalAddressUpdateIdentifier="editShipping";var addressBox=document.getElementById(addressSelectBoxName);this.saveOrderItemsList(orderItemId,addressBox.value),addressBox.options[addressBox.selectedIndex].text!=profileshipping&&addressBox.options[addressBox.selectedIndex].text!=profilebilling?submitRequest()&&(cursor_wait(),wc.render.updateContext("editShippingAddressContext",{shippingAddress:addressBox.value}),this.showHideDivs("editAddressContents","mainContents"),editingShippingAddress="singleShipmentAddress"==addressSelectBoxName):null!=addressSelectBoxName?MessageHelper.formErrorHandleClient(addressSelectBoxName,MessageHelper.messages.ERROR_QUICKCHECKOUT_ADDRESS_CHANGE):MessageHelper.displayErrorMessage(MessageHelper.messages.ERROR_QUICKCHECKOUT_ADDRESS_CHANGE)},editBillingAddress:function(orderItemId,paymentArea,profileshipping,profilebilling){document.forms["PaymentForm"+paymentArea];var addressBox=document.getElementById("billing_address_id");this.saveOrderItemsList(orderItemId,addressBox.value),addressBox.options[addressBox.selectedIndex].text!=profileshipping&&addressBox.options[addressBox.selectedIndex].text!=profilebilling?submitRequest()&&(cursor_wait(),wc.render.updateContext("editShippingAddressContext",{shippingAddress:addressBox.value}),this.showHideDivs("editAddressContents","mainContents"),editingShippingAddress=!1):null!=addressBox?MessageHelper.formErrorHandleClient(addressBox,MessageHelper.messages.ERROR_QUICKCHECKOUT_ADDRESS_CHANGE):MessageHelper.displayErrorMessage(MessageHelper.messages.ERROR_QUICKCHECKOUT_ADDRESS_CHANGE)},editBillingAddressCustom:function(orderItemId,paymentArea,profileshipping,profilebilling){globalAddressUpdateIdentifier="editBilling";var addressBox=document.getElementById("billing_address_id");this.saveOrderItemsList(orderItemId,addressBox.value),addressBox.options[addressBox.selectedIndex].text!=profileshipping&&addressBox.options[addressBox.selectedIndex].text!=profilebilling?submitRequest()&&(cursor_wait(),wc.render.updateContext("editShippingAddressContext",{shippingAddress:addressBox.value}),this.showHideDivs("editAddressContents","mainContents"),editingShippingAddress=!1):null!=addressBox?MessageHelper.formErrorHandleClient(addressBox,MessageHelper.messages.ERROR_QUICKCHECKOUT_ADDRESS_CHANGE):MessageHelper.displayErrorMessage(MessageHelper.messages.ERROR_QUICKCHECKOUT_ADDRESS_CHANGE)},cancelEditAddress:function(){this.showHideDivs("mainContents","editAddressContents"),this.restorePreviousAddressDetails()},getShipmentTypeId:function(){return this.shipmentTypeId},paymentDataDirty:function(paymentAreaNumber,flag){this.verifyCC($("#account1_1").val()),this.dataDirty[paymentAreaNumber]=flag,console.debug("Information in payment area "+paymentAreaNumber+" has been modified.")},isPaymentDataDirty:function(paymentAreaNumber){return this.dataDirty[paymentAreaNumber]},displayStoreAddressDetails:function(addressSelectBox){var selectedAddressId=addressSelectBox.value;for(j=0;j<addressSelectBox.options.length;j++)addressSelectBox.options[j].value==selectedAddressId?dojo.byId("addressDetails_"+addressSelectBox.options[j].value).style.display="block":dojo.byId("addressDetails_"+addressSelectBox.options[j].value).style.display="none"},updateStoreAddressForAllItems:function(addressSelectBox){if(this.isAjaxCheckOut()){var addressId=addressSelectBox.value;params=[],params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=".",params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";for(var orderItemId=null,totalItems=document.getElementById("totalNumberOfItems").value,i=(addressId=document.getElementById("singleShipmentAddress").value,0);i<totalItems;i++)orderItemId=document.getElementsByClassName("orderItem_"+(i+1)).value,this.updateParamObject(params,"orderItemId",orderItemId,!1,-1),this.updateParamObject(params,"physicalStoreId",addressId,!1,-1);submitRequest()&&(cursor_wait(),wc.service.invoke("AjaxUpdateOrderItem",params))}},updateShippingModeAndAddressForOrderItem:function(shippingModeSelectBox,orderItemId,pickUpInstoreshipMode){if(this.isAjaxCheckOut()){var selectedShippingMode=shippingModeSelectBox.value;if(pickUpInstoreshipMode==selectedShippingMode?(document.getElementById("MS_ShipMode_Section_"+orderItemId).className="nodisplay",document.getElementById("MS_ShipAdvancedOptions_Section_"+orderItemId).className="nodisplay",document.getElementById("MS_ShippingAddress_Section_"+orderItemId).className="nodisplay",document.getElementById("MS_StoreAddress_Section_"+orderItemId).className=""):(document.getElementById("MS_ShipMode_Section_"+orderItemId).className="",document.getElementById("MS_ShipAdvancedOptions_Section_"+orderItemId).className="",document.getElementById("MS_ShippingAddress_Section_"+orderItemId).className="",document.getElementById("MS_StoreAddress_Section_"+orderItemId).className="nodisplay"),params=[],params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=".",params.orderItemId=orderItemId,params.shipModeId=selectedShippingMode,params.calculationUsage="-1,-2,-3,-4,-5,-6,-7",pickUpInstoreshipMode==selectedShippingMode){var physicalStoreId=document.getElementById("MS_StoreSelectBox_"+orderItemId).value;params.physicalStoreId=physicalStoreId}else if(document.getElementById("MS_ShipmentAddress_"+orderItemId)){var addressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;params.addressId=addressId}submitRequest()&&(cursor_wait(),wc.service.invoke("AjaxUpdateOrderItem",params))}},updateStoreAddressForOrderItem:function(storeAddressSelectBox,orderItemId){if(this.isAjaxCheckOut()){var selectedPickUpStoreId=storeAddressSelectBox.value;params=[],params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=".",params.orderItemId=orderItemId,params.physicalStoreId=selectedPickUpStoreId,params.calculationUsage="-1,-2,-3,-4,-5,-6,-7",submitRequest()&&(cursor_wait(),wc.service.invoke("AjaxUpdateOrderItem",params))}},setFieldDirtyFlag:function(value){this.fieldDirtyFlag=value},getFieldDirtyFlag:function(){return this.fieldDirtyFlag},checkForDirtyFlag:function(){return!!this.getFieldDirtyFlag()&&(null!=document.getElementById("ShoppingCart_NonAjaxUpdate")?(MessageHelper.formErrorHandleClient(document.getElementById("ShoppingCart_NonAjaxUpdate"),MessageHelper.messages.ERROR_UPDATE_FIRST_SHOPPING_CART),!0):null!=document.getElementById("MultipleShipment_NonAjaxShipInfoUpdate")?(MessageHelper.formErrorHandleClient(document.getElementById("MultipleShipment_NonAjaxShipInfoUpdate"),MessageHelper.messages.ERROR_UPDATE_FIRST),!0):null!=document.getElementById("SingleShipment_NonAjaxShipInfoUpdate")?(MessageHelper.formErrorHandleClient(document.getElementById("SingleShipment_NonAjaxShipInfoUpdate"),MessageHelper.messages.ERROR_UPDATE_FIRST),!0):(MessageHelper.displayErrorMessage(MessageHelper.messages.ERROR_UPDATE_FIRST),!0))},showHideCheckoutSMS:function(checkboxElementId,smsElementId){var smsOrderNotificationCheckbox=document.getElementById(checkboxElementId);null!=smsOrderNotificationCheckbox&&"undefined"!=smsOrderNotificationCheckbox&&(smsOrderNotificationCheckbox.checked?showElementById(smsElementId):hideElementById(smsElementId))},getCountryArray:function(){if(null==document.countries){countries=new Array;var theDiv=document.getElementById("countryListSelectionHelper");if(void 0===theDiv)return null;for(var divJSON=eval("("+theDiv.innerHTML+")"),countriesObject=divJSON.countries,i=0;i<countriesObject.length;i++){var countryObject=countriesObject[i];if(countries[countryObject.code]=new Object,countries[countryObject.code].name=countryObject.displayName,countries[countryObject.code].countryCallingCode=countryObject.callingCode,countryObject.states.length>0){countries[countryObject.code].states=new Object;for(var j=0;j<countryObject.states.length;j++){var state=countryObject.states[j];countries[countryObject.code].states[state.code]=state.displayName}}}}return countries},loadCountryCode:function(countryDropDownId,countryCallingCodeId){this.getCountryArray();var countryCode=document.getElementById(countryDropDownId).value;document.getElementById(countryCallingCodeId).value=countries[countryCode].countryCallingCode},expediteShipping:function(checkBox,inputOrderItemId){if(this.isAjaxCheckOut()){var params=[];params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,checkBox.checked?this.updateParamObject(params,"isExpedited","Y",!0):this.updateParamObject(params,"isExpedited","N",!0),null!=inputOrderItemId&&this.updateParamObject(params,"orderItemId",inputOrderItemId,!1),submitRequest()&&(cursor_wait(),wc.service.invoke("OrderShippingInfoUpdate",params))}},updateCartWait:function(quantityBox,orderItemId,event){event.keyCode!=dojo.keys.TAB&&this.isAjaxCheckOut()&&(null==this.keyPressCount[orderItemId]&&isNaN(this.keyPressCount[orderItemId])&&(this.keyPressCount[orderItemId]=0),this.keyPressCount[orderItemId]=parseInt(this.keyPressCount[orderItemId])+1,setTimeout(dojo.hitch(this,"updateCart",quantityBox,orderItemId,this.keyPressCount[orderItemId]),this.updateWaitTimeOut))},updateCart:function(quantityBox,orderItemId,keyPressCountValue){if(!(keyPressCountValue<this.keyPressCount[orderItemId])){var quantity=quantityBox.value;if(isNonNegativeInteger(quantity)){var params=[];if(params.orderId=".",params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.calculationUsage="-1,-2,-3,-4,-5,-6,-7",this.updateParamObject(params,"orderItemId",orderItemId,!1,-1),this.updateParamObject(params,"quantity",quantity,!1,-1),!submitRequest())return;if(cursor_wait(),0==quantity){for(var x=document.getElementById("totalNumberOfItems").value,y=x,i=0;i<x;i++){var qtyObj=document.getElementById("freeGift_qty_"+(i+1));null==qtyObj&&null==qtyObj||(qty=qtyObj.value,null!=qty&&null!=qty&&-1==qty&&(y-=1))}1==y?wc.service.invoke("AjaxUpdateOrderItem1",params):wc.service.invoke("AjaxUpdateOrderItem",params)}else wc.service.invoke("AjaxUpdateOrderItem",params)}else MessageHelper.formErrorHandleClient(quantityBox,MessageHelper.messages.QUANTITY_INPUT_ERROR)}},initDojoEventListenerShoppingCartPage:function(){if(null!=document.getElementById("totalNumberOfItems")){var totalItems=document.getElementById("totalNumberOfItems").value;if(!(null!=totalItems&&totalItems>0))return void console.debug("error: element 'totalNumberOfItems' was expected but undefined.");for(var i=0;i<totalItems;i++){var object=dojo.byId("quantity_"+(i+1));null!=object&&dojo.connect(object,"onchange",setDirtyFlag)}}},updateShoppingCart:function(form,validateQuantityOnly){if(null!=validateQuantityOnly&&1==validateQuantityOnly&&!this.isAjaxCheckOut())return!0;MessageHelper.hideAndClearMessage();var totalItems=document.getElementById("totalNumberOfItems").value;if(null!=totalItems){for(var i=0;i<totalItems;i++){var quantity=null;if(null!=form?quantity=form["quantity_"+(i+1)]:null!=dojo.byId("qty_"+(i+1))&&(quantity=dojo.byId("qty_"+(i+1))),null!=quantity||null!=quantity){var v=quantity.value;if(!isNonNegativeInteger(v))return void MessageHelper.formErrorHandleClient(quantity.id,MessageHelper.messages.QUANTITY_INPUT_ERROR)}}if(null!=validateQuantityOnly&&1==validateQuantityOnly)return!0;if(submitRequest()){var beginIndex=wc.render.getContextById("ShopCartPaginationDisplay_Context").properties.beginIndex;null!=beginIndex&&""!=beginIndex||(beginIndex=0),form.URL.value=form.URL.value+"&beginIndex="+beginIndex,form.submit(),this.setFieldDirtyFlag(!1)}}else console.debug("error: element 'totalNumberOfItems' was expected but undefined.")},canCheckoutContinue:function(userType){if(document.getElementById("recurringOrder")&&document.getElementById("recurringOrder").checked&&document.getElementById("shipTypeOnline")&&document.getElementById("shipTypeOnline").checked){if(document.getElementById("nonRecurringOrderItems")&&""!=document.getElementById("nonRecurringOrderItems").value)return MessageHelper.displayErrorMessage(MessageHelper.messages.RECURRINGORDER_ERROR),!1;if(null!=userType&&"G"===userType)return MessageHelper.displayErrorMessage(MessageHelper.messages.ERROR_GUEST_USER_SUBMIT_RECURRING_ORDER),!1}var isBossValid=!0,$rootScope=angular.element(document.body).scope().$root;return void 0!==$rootScope&&null!=$rootScope.validateBossSelection&&$rootScope.$apply((function(){isBossValid=$rootScope.validateBossSelection()})),isBossValid},updateCartWithQuickCheckoutProfile:function(quickOrderId){var params=[];params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.toOrderId=".",params.shippingAddressFromOrderProfile="1",params.shippingModeFromOrderProfile="1",params.URL="dummy",params.payInfoFrom=quickOrderId,wc.service.declare({id:"QuickCheckOutOrderCopy",actionId:"QuickCheckOutOrderCopy",url:"AjaxOrderCopy",successHandler:function(serviceResponse){cursor_clear(),document.location.href="OrderProcessServiceOrderPrepare?storeId="+CheckoutHelperJS.storeId+"&catalogId="+CheckoutHelperJS.catalogId+"&langId="+CheckoutHelperJS.langId+"&orderId=.&URL=OrderShippingBillingView?langId="+CheckoutHelperJS.langId+"&storeId="+CheckoutHelperJS.storeId+"&catalogId="+CheckoutHelperJS.catalogId+"&quickCheckoutProfileForPayment=true"},failureHandler:function(serviceResponse){serviceResponse.errorMessage?MessageHelper.displayErrorMessage(serviceResponse.errorMessage):serviceResponse.errorMessageKey&&MessageHelper.displayErrorMessage(serviceResponse.errorMessageKey),cursor_clear()}}),submitRequest()&&(cursor_wait(),wc.service.invoke("QuickCheckOutOrderCopy",params))},addNewShippingAddress:function(addressType){globalAddressUpdateIdentifier="createShipping",this.displayAddressDetails(-1,addressType)},updateAddressForAllItems:function(addressSelectBox){if((globalAddressUpdateIdentifier="updateAddressAllItems",-1!=addressSelectBox.value&&(this.selectedAddressesArray[addressSelectBox.name]=addressSelectBox.value),this.isAjaxCheckOut())&&-1!=(addressId=addressSelectBox.value)){params=[],params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=".",params.calculationUsage="-1,-2,-3,-4,-5,-6,-7",params.allocate="***",params.backorder="***",params.remerge="***",params.check="*n";var addressId=document.getElementById("singleShipmentAddress").value;this.updateParamObject(params,"addressId",addressId,!1),"undefined"!=typeof updateGiftRegistrantAddressForItemsExt&&null!=typeof updateGiftRegistrantAddressForItemsExt&&(params=updateGiftRegistrantAddressForItemsExt(params,addressId));var shipInstructions,enabledShipInstructions=!1;null!=document.getElementById("shipInstructions")&&(shipInstructions=document.getElementById("shipInstructions").value,reWhiteSpace=new RegExp(/^\s+$/),reWhiteSpace.test(shipInstructions)&&(shipInstructions=""),enabledShipInstructions=!0),submitRequest()&&(cursor_wait(),enabledShipInstructions&&null!=shipInstructions&&""!=shipInstructions?wc.service.invoke("OrderItemAddressShipInstructionsUpdate",params):wc.service.invoke("OrderItemAddressShipMethodUpdate",params))}},addWarranty:function(orderItemId,orderId,number,category){var indexEl=parseInt(number)-1,categoryTemp=category.toUpperCase();if("SUNGLASSES"==categoryTemp&&(categoryTemp="SUN"),"EYEGLASSES"==categoryTemp&&(categoryTemp="OPTICS"),"empty"!=$("#payMethodId_1").val()&&($("#payMethodId_1").val("empty").attr("selected","selected"),$("#payMethodId_1").change()),$("#warranty_"+orderItemId).is(":checked"))var action="ADD";else action="REM";var params=[];if(params.action=action,params.orderId=orderId,params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.calculationUsage="-1,-2,-3,-4,-5,-6,-7",params.allocate="***",params.backorder="***",params.remerge="***",params.check="*n",params.requesttype="ajax",params.orderItemId=orderItemId,submitRequest()){var warrantyPrice;cursor_wait();try{if("ADD"==action){if(null!=_dl.products_in_cart&&_dl.products_in_cart.length>indexEl){var contProd=0;for(var key in utag_data.Products)utag_data.Products.hasOwnProperty(key)&&"CONTACT LENSES"!=utag_data.Products[key].Category.toUpperCase()&&(contProd==indexEl&&(warrantyPrice=parseFloat($(".cart-frames > .cart-item-container input[name='warrantyPrice']")[contProd].value),utag_data.Products[key].Price=(parseFloat(utag_data.Products[key].Price)+warrantyPrice).toFixed(2),utag_data.Products[key].PriceFull=(parseFloat(utag_data.Products[key].PriceFull)+warrantyPrice).toFixed(2),utag_data.Products[key].Warranty=parseFloat(warrantyPrice).toFixed(2)+""),contProd++);var _dlCopy=$.extend(!0,{},_dl);_dlCopy.product_updated=[_dl.products_in_cart[indexEl]],_dlCopy.site_events={add_eyewear_protection:"true"},callTrackAnalytics(_dlCopy),_dl.products_in_cart[indexEl].eye_wear_protection="true",_dl.site_events={add_eyewear_protection:"true"},utag_data.Order_ProductsAmount=(parseFloat(utag_data.Order_ProductsAmount)+parseFloat($("input[name='warranty-price']").val())).toFixed(2),callTrackAnalytics(_dl)}}else if("REM"==action){contProd=0;for(var key in utag_data.Products)utag_data.Products.hasOwnProperty(key)&&"CONTACT LENSES"!=utag_data.Products[key].Category.toUpperCase()&&(contProd==indexEl&&(warrantyPrice=parseFloat($(".cart-frames > .cart-item-container input[name='warrantyPrice']")[contProd].value),utag_data.Products[key].Price=(parseFloat(utag_data.Products[key].Price)-warrantyPrice).toFixed(2),utag_data.Products[key].PriceFull=(parseFloat(utag_data.Products[key].PriceFull)-warrantyPrice).toFixed(2),utag_data.Products[key].Warranty="0"),contProd++);utag_data.Order_ProductsAmount=(parseFloat(utag_data.Order_ProductsAmount)-parseFloat($("input[name='warranty-price']").val())).toFixed(2),delete _dl.products_in_cart[indexEl].eye_wear_protection}}catch(e){console.log("error in tracking analytics warranty: "+e.stack)}wc.service.invoke("AjaxAddWarranties",params)}},updateShipModeForAllItems:function(shipmentSelectBox,customOrderId){var shipModeId=shipmentSelectBox.value;-1!=shipModeId&&("empty"!=$("#payMethodId_1").val()&&($("#payMethodId_1").val("empty").attr("selected","selected"),$("#payMethodId_1").change()),params=[],params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,""==params.langId&&(params.langId=langId||"-1"),params.orderId=".",params.calculationUsage="-1,-2,-5,-6,-7",params.allocate="***",params.backorder="***",params.remerge="***",params.check="*n",params.customOrderId=customOrderId,params.bossStore=shipmentSelectBox.bossStore,params.nickName=shipmentSelectBox.nickName,this.updateParamObject(params,"shipModeId",shipModeId,!1),submitRequest()&&(cursor_wait(),wc.service.invoke("OrderItemAddressShipMethodUpdate",params)))},updateTaxCalculation:function(zipCode){params=[],params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=".",params.calculationUsage="-1,-2,-3,-4,-5,-6,-7",params.allocate="***",params.backorder="***",params.remerge="***",params.check="*n",params.zipCode=zipCode,submitRequest()&&(cursor_wait(),wc.service.invoke("AjaxTaxCalculationUpdateLC",params))},updateShippingInstructionsForAllItems:function(){if(this.isAjaxCheckOut()){params=[],params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=".";var orderItemId,shipInstructions=document.getElementById("shipInstructions").value;reWhiteSpace=new RegExp(/^\s+$/),reWhiteSpace.test(shipInstructions)&&(shipInstructions=""),MessageHelper.isValidUTF8length(shipInstructions,4e3)?(orderItemId=document.getElementsByClassName("orderItem_1").value,this.updateParamObject(params,"orderItemId",orderItemId,!1),this.updateParamObject(params,"shipInstructions",shipInstructions,!1),submitRequest()&&(cursor_wait(),wc.service.invoke("OrderShippingInfoUpdate",params))):MessageHelper.formErrorHandleClient(document.getElementById("shipInstructions").id,MessageHelper.messages.ERROR_ShippingInstructions_TooLong)}},updateShippingChargeForShipModeAjax:function(curOrderId,shipModeId,shipChargeType,shipAcctNum){this.isAjaxCheckOut()&&(params=[],params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=curOrderId,params.URL="",params.shipModeId=shipModeId,params.shipChargTypeId=shipChargeType,params.shipCarrAccntNum=null!=shipAcctNum&&null!=shipAcctNum?shipAcctNum:"",submitRequest()&&(cursor_wait(),wc.service.invoke("AjaxOrderShipChargeUpdate",params)))},updateShippingChargeForShipMode:function(myForm){this.isAjaxCheckOut()||(myForm.URL.value="OrderProcessServiceOrderPrepare?storeId="+CheckoutHelperJS.storeId+"&catalogId="+CheckoutHelperJS.catalogId+"&langId="+CheckoutHelperJS.langId+"&orderId=.&URL=OrderShippingBillingView?forceShipmentType=2",myForm.submit())},hideShipChargeAccountField:function(selectValue,acctFieldId){document.getElementById(selectValue).value.indexOf("ByCarrier")>-1?document.getElementById(acctFieldId).style.display="block":document.getElementById(acctFieldId).style.display="none"},updateRequestedShipDate:function(jsDate){if(null!=jsDate&&null!=jsDate.getDisplayedValue()){var now=new Date;if(dojo.byId("requestShippingDateCheckbox").checked&&jsDate.compare(jsDate.getValue(),now)<=0)null!=document.getElementById("requestedShippingDate")?MessageHelper.formErrorHandleClient(document.getElementById("requestedShippingDate").id,MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR):MessageHelper.displayErrorMessage(MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR);else if(this.isAjaxCheckOut()){var t="";""!=jsDate.getDisplayedValue()?((t=dojo.date.stamp.fromISOString(jsDate)).setHours(12),t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:!0,milliseconds:!0})):""==jsDate.getDisplayedValue()&&(t=this.resetRequestedShipDateValue),jsDate._close(),this.updateShippingDateForAllItems(t)}}},updateShippingDateForAllItems:function(date){params=[],params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=".",params.calculationUsage="-1,-2,-3,-4,-5,-6,-7",params.allocate="***",params.backorder="***",params.remerge="***",params.check="*n",this.updateParamObject(params,"requestedShipDate",date,!1),submitRequest()&&(cursor_wait(),wc.service.invoke("OrderItemAddressShipMethodUpdate",params))},displayAddressDetails:function(addressSelectBoxValue,addressType){if(this.isAjaxCheckOut())if(-1!=addressSelectBoxValue){if(!submitRequest())return;cursor_wait(!0),wc.render.updateContext("shippingAddressContext",{shippingAddress:addressSelectBoxValue})}else this.createAddress(-1,addressType);else this.displayAddressDetailsWeb10(addressSelectBoxValue,addressType)},displayAddressDetailsWeb10:function(addressSelectBoxValue,addressType){var selectedAddressId=addressSelectBoxValue,addressSelectBox=dojo.byId("singleShipmentAddress");for(j=0;j<addressSelectBox.options.length;j++)addressSelectBox.options[j].value==selectedAddressId?dojo.byId("addressDetails_"+addressSelectBox.options[j].value).style.display="block":dojo.byId("addressDetails_"+addressSelectBox.options[j].value).style.display="none";-1==selectedAddressId&&this.createAddress(-1,addressType)},initDojoEventListenerSingleShipmentPage:function(){var totalItems=document.getElementById("totalNumberOfItems").value;if(null!=totalItems&&totalItems>0){if(null!=dojo.byId("singleShipmentAddress")&&dojo.connect(dojo.byId("singleShipmentAddress"),"onchange",setDirtyFlag),null!=dojo.byId("WC_ShippingAddressSelectSingle_div_2")&&dojo.connect(dojo.byId("WC_ShippingAddressSelectSingle_div_2"),"onclick",setDirtyFlag),null!=dojo.byId("singleShipmentShippingMode")&&dojo.connect(dojo.byId("singleShipmentShippingMode"),"onchange",setDirtyFlag),null!=dojo.byId("shippingInstructionsCheckbox")&&dojo.connect(dojo.byId("shippingInstructionsCheckbox"),"onclick",setDirtyFlag),null!=dojo.byId("requestShippingDateCheckbox")&&dojo.connect(dojo.byId("requestShippingDateCheckbox"),"onclick",setDirtyFlag),null!=dojo.byId("shipInstructions")&&dojo.connect(dojo.byId("shipInstructions"),"onchange",setDirtyFlag),null!=dojo.byId("expediteShipping")&&dojo.connect(dojo.byId("expediteShipping"),"onchange",setDirtyFlag),null!=dojo.byId("expediteShipping_1"))for(var i=0;i<totalItems;i++)if(null!=dojo.byId("qty_"+(i+1))&&"-1"!=dojo.byId("qty_"+(i+1)).value){var object=dojo.byId("expediteShipping_"+(i+1));dojo.connect(object,"onchange",setDirtyFlag)}}else console.debug("error: element 'totalNumberOfItems' was expected but undefined.")},updateSingleShipmentShoppingCart:function(form){var formAction="OrderChangeServiceShipInfoUpdate?",instructions=null,t=null;if(null!=dojo.byId("shippingInstructionsCheckbox"))if(dojo.byId("shippingInstructionsCheckbox").checked){if(null!=document.getElementById("shipInstructions")&&null!=document.getElementById("shipInstructions").value){if(!MessageHelper.isValidUTF8length(document.getElementById("shipInstructions").value,4e3))return void MessageHelper.formErrorHandleClient(document.getElementById("shipInstructions").id,MessageHelper.messages.ERROR_ShippingInstructions_TooLong);instructions=document.getElementById("shipInstructions").value}}else null!=document.getElementById("shipInstructions")&&(instructions="");if(null!=dojo.byId("requestShippingDateCheckbox")){var jsDateObj=dijit.byId("requestedShippingDate");if(dojo.byId("requestShippingDateCheckbox").checked){if(null!=jsDateObj&&null!=jsDateObj.getDisplayedValue()){var now=new Date;if(jsDateObj.compare(jsDateObj.getValue(),now)<=0)return void(null!=document.getElementById("requestedShippingDate")?MessageHelper.formErrorHandleClient(document.getElementById("requestedShippingDate").id,MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR):MessageHelper.displayErrorMessage(MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR));t="";""!=jsDateObj.getDisplayedValue()?((t=dojo.date.stamp.fromISOString(jsDateObj)).setHours(12),t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:!0,milliseconds:!0})):""==jsDateObj.getDisplayedValue()&&(t=this.resetRequestedShipDateValue)}}else null!=jsDateObj&&(t=this.resetRequestedShipDateValue)}if(-1!=document.getElementById("singleShipmentAddress").value){formAction=(formAction+="addressId="+document.getElementById("singleShipmentAddress").value)+"&shipModeId="+document.getElementById("singleShipmentShippingMode").value,this.shipChargeEnabled&&(formAction=(formAction=formAction+"&shippingChargeType="+document.getElementById("shipChargTypeId_1").value)+"&shipCarrAccntNum="+document.getElementById("shipCarrAccntNum_1").value);if(null!=instructions&&"shipInstructions="+instructions+"&orderItemId_1="+document.getElementsByClassName("orderItem_1").value,null!=t&&(formAction=formAction+"&requestedShipDate="+t),formAction+="&ShipAsComplete=Y",$(".orderItemIds").each((function(index,element){formAction+="&"+$(element).attr("name")+"="+encodeURIComponent($(element).val())})),null!=document.getElementById("expediteShipping_1"))for(var totalNumberOfItemsOnPage=document.getElementById("totalNumberOfItems").value,i=0;i<totalNumberOfItemsOnPage;i++)if(null!=document.getElementById("qty_"+(i+1))&&"-1"!=document.getElementById("qty_"+(i+1)).value){var orderItemId=document.getElementsByClassName("orderItem_"+(i+1)).value;null!=document.getElementById("orderItemId_"+(i+1))&&(document.getElementById("orderItemId_"+(i+1)).value=orderItemId),document.getElementById("expediteShipping_"+(i+1)).checked?document.getElementById("isExpedited_"+(i+1)).value="Y":document.getElementById("isExpedited_"+(i+1)).value="N"}form.action=formAction,form.URL.value="OrderShippingBillingView",submitRequest()&&form.submit()}else MessageHelper.formErrorHandleClient(document.getElementById("singleShipmentAddress").id,MessageHelper.messages.SHIPPING_INVALID_ADDRESS)},moveAllItemsToSingleShipment:function(){var orderItemId=document.getElementsByClassName("orderItem_1").value,addressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;if(params=[],params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=".",params.calculationUsage="-1,-2,-3,-4,-5,-6,-7",-3==addressId)for(var totalItems=document.getElementById("totalNumberOfItems").value,i=2;i<=totalItems&&(null!=document.getElementsByClassName("orderItem_"+i)&&"undefined"!=document.getElementsByClassName("orderItem_"+i));i++){var giftOrderItemId=document.getElementsByClassName("orderItem_"+i).value,validAddressId=document.getElementById("MS_ShipmentAddress_"+giftOrderItemId).value;if(-3!=validAddressId){this.updateParamObject(params,"addressId",validAddressId,!1);break}}else this.updateParamObject(params,"addressId",addressId,!1);submitRequest()&&(cursor_wait(),wc.service.invoke("OrderItemAddressShipMethodUpdate1",params))},addNewShippingAddressForMS:function(orderItemId){this.updateAddressIdForThisItem(-1,orderItemId),this.orderItemIds.push(orderItemId)},updateAddressIdForThisItem:function(addressBoxValue,orderItemId){if(-1!=addressBoxValue){var addressBox=dojo.byId("MS_ShipmentAddress_"+orderItemId);this.selectedAddressesArray[addressBox.name]=addressBoxValue}if(-1!=addressBoxValue&&this.isAjaxCheckOut()){params=[],params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=".",params.calculationUsage="-1,-2,-3,-4,-5,-6,-7",params.allocate="***",params.backorder="***",params.remerge="***",params.check="*n";var addressId=addressBoxValue;this.updateParamObject(params,"shipToRegistrant","0",!1,-1),this.updateParamObject(params,"addressId",addressId,!1,-1),this.updateParamObject(params,"orderItemId",orderItemId,!1,-1),"undefined"!=typeof updateGiftRegistrantAddressForThisItemExt&&null!=typeof updateGiftRegistrantAddressForThisItemExt&&(params=updateGiftRegistrantAddressForThisItemExt(params,addressId)),submitRequest()&&(cursor_wait(),wc.service.invoke("OrderItemAddressShipMethodUpdate",params))}},updateShipModeForThisItem:function(shipModeBox,orderItemId){var shipModeId=shipModeBox.value;-1!=shipModeId&&this.isAjaxCheckOut()&&(params=[],params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=".",this.updateParamObject(params,"orderItemId",orderItemId,!1,-1),this.updateParamObject(params,"shipModeId",shipModeId,!1,-1),params.calculationUsage="-1,-2,-3,-4,-5,-6,-7",params.allocate="***",params.backorder="***",params.remerge="***",params.check="*n",submitRequest()&&(cursor_wait(),wc.service.invoke("OrderItemAddressShipMethodUpdate",params)))},updateShippingInstructionsForThisItem:function(textArea,orderItemId){var addressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value,shipModeId=document.getElementById("MS_ShippingMode_"+orderItemId).value,shipInstructions=textArea.value;reWhiteSpace=new RegExp(/^\s+$/),reWhiteSpace.test(shipInstructions)&&(shipInstructions=""),!this.isAjaxCheckOut()||MessageHelper.isValidUTF8length(shipInstructions,4e3)?(this.setShippingInstuctionsForAllOtherItems(addressId,shipModeId,shipInstructions),this.isAjaxCheckOut()&&(params=[],params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=".",params.calculationUsage="-1,-2,-3,-4,-5,-6,-7",this.updateParamObject(params,"addressId",addressId,!1,-1),this.updateParamObject(params,"shipModeId",shipModeId,!1,-1),this.updateParamObject(params,"shipInstructions",shipInstructions,!1,-1),this.updateParamObject(params,"orderItemId",orderItemId,!1,-1),submitRequest()&&(cursor_wait(),wc.service.invoke("OrderShippingInfoUpdate",params)))):MessageHelper.formErrorHandleClient(textArea.id,MessageHelper.messages.ERROR_ShippingInstructions_TooLong)},updateRequestedShipDateForThisItem:function(jsDate,orderItemId){if(null!=jsDate&&null!=jsDate.getDisplayedValue()){var now=new Date;if(dojo.byId("MS_requestShippingDateCheckbox_"+orderItemId).checked&&jsDate.compare(jsDate.getValue(),now)<=0)null!=document.getElementById("MS_requestedShippingDate_"+orderItemId)?MessageHelper.formErrorHandleClient(document.getElementById("MS_requestedShippingDate_"+orderItemId).id,MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR):MessageHelper.displayErrorMessage(MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR);else if(this.isAjaxCheckOut()){var t="";""!=jsDate.getDisplayedValue()?((t=dojo.date.stamp.fromISOString(jsDate)).setHours(12),t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:!0,milliseconds:!0})):""==jsDate.getDisplayedValue()&&(t=this.resetRequestedShipDateValue),jsDate._close();document.getElementById("MS_ShipmentAddress_"+orderItemId).value,document.getElementById("MS_ShippingMode_"+orderItemId).value;params=[],params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId=this.langId,params.orderId=".",this.updateParamObject(params,"orderItemId",orderItemId,!1,-1),this.updateParamObject(params,"requestedShipDate",t,!1,-1),params.calculationUsage="-1,-2,-3,-4,-5,-6,-7",params.allocate="***",params.backorder="***",params.remerge="***",params.check="*n",submitRequest()&&(cursor_wait(),CheckoutHelperJS.RequestShippingDateAction=!0,wc.service.invoke("OrderItemAddressShipMethodUpdate",params))}}},createAddressForMS:function(orderItemId,addressType){submitRequest()&&(cursor_wait(),wc.render.updateContext("editShippingAddressContext",{shippingAddress:"-1",addressType:addressType}),this.showHideDivs("editAddressContents","mainContents"))},displayAddressDetailsForMSHelper:function(orderItemId,addressType){this.displayAddressDetailsForMS(-1,orderItemId,addressType)},displayAddressDetailsForMS:function(addressSelectBoxValue,orderItemId,addressType){this.isAjaxCheckOut()?-1==addressSelectBoxValue&&this.createAddressForMS(orderItemId,addressType):-1==addressSelectBoxValue?this.createAddressForMS(orderItemId,addressType):dojo.byId("MS_shippingAddressDisplayArea_"+orderItemId).innerHTML=dojo.byId("addressDetails_"+addressSelectBoxValue).innerHTML},initDojoEventListenerMultiShipmentPage:function(){var totalItems=document.getElementById("totalNumberOfItems").value;if(null!=totalItems&&totalItems>0){for(var list_clickable=new dojox.collections.ArrayList([]),list_editable=new dojox.collections.ArrayList([]),i=0;i<totalItems;i++){var orderItemId=document.getElementsByClassName("orderItem_"+(i+1)).value,object="";if(null!=orderItemId)null!=(object=dojo.byId("MS_shippingInstructionsCheckbox_"+orderItemId))&&list_clickable.add(object),null!=(object=dojo.byId("MS_requestShippingDateCheckbox_"+orderItemId))&&list_clickable.add(object),null!=(object=dojo.byId("editAddressButton"))&&list_clickable.add(object),null!=(object=dojo.byId("MS_expediteShipping_"+orderItemId))&&list_clickable.add(object),null!=(object=dojo.byId("MS_ShipmentAddress_"+orderItemId))&&list_editable.add(object),null!=(object=dojo.byId("MS_ShippingMode_"+orderItemId))&&list_editable.add(object),null!=(object=dojo.byId("MS_shipInstructions_"+orderItemId))&&list_editable.add(object),null!=(object=dojo.byId("qty_"+(i+1)))&&list_editable.add(object);else{var j=i+1;console.debug("error: element 'orderItem_'"+j+" was expected but undefined.")}}for(i=0;i<list_clickable.count;i++){var item=list_clickable.item(i);dojo.connect(item,"onclick",setDirtyFlag)}for(i=0;i<list_editable.count;i++){item=list_editable.item(i);dojo.connect(item,"onchange",setDirtyFlag)}}else console.debug("error: element 'totalNumberOfItems' was expected but undefined.")},updateMultiShipmentShoppingCart:function(form){for(var updateShippingURL="OrderShippingBillingView?",totalItems=document.getElementById("totalNumberOfItems").value,i=0;i<totalItems;i++){var orderItemId=document.getElementsByClassName("orderItem_"+(i+1)).value;null!=document.getElementById("orderItemId_"+(i+1))&&(document.getElementById("orderItemId_"+(i+1)).value=orderItemId);var addressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;if(-1==addressId)return void MessageHelper.formErrorHandleClient(document.getElementById("MS_ShipmentAddress_"+orderItemId).id,MessageHelper.messages.SHIPPING_INVALID_ADDRESS);null!=document.getElementById("addressId_"+(i+1))&&(document.getElementById("addressId_"+(i+1)).value=addressId),null!=form.elements["shipModeId_"+(i+1)]&&(form.elements["shipModeId_"+(i+1)].value=document.getElementById("MS_ShippingMode_"+orderItemId).value);var instructions=null,t=null,shippingInstructionsCheckbox=dojo.byId("MS_shippingInstructionsCheckbox_"+orderItemId);if(null!=shippingInstructionsCheckbox)if(shippingInstructionsCheckbox.checked){if(null!=document.getElementById("MS_shipInstructions_"+orderItemId)&&null!=document.getElementById("MS_shipInstructions_"+orderItemId).value){if(!MessageHelper.isValidUTF8length(document.getElementById("MS_shipInstructions_"+orderItemId).value,4e3))return void MessageHelper.formErrorHandleClient(document.getElementById("MS_shipInstructions_"+orderItemId).id,MessageHelper.messages.ERROR_ShippingInstructions_TooLong);instructions=document.getElementById("MS_shipInstructions_"+orderItemId).value}}else null!=document.getElementById("MS_shipInstructions_"+orderItemId)&&(instructions="");var requestShippingDateCheckbox=dojo.byId("MS_requestShippingDateCheckbox_"+orderItemId);if(null!=requestShippingDateCheckbox){t=this.resetRequestedShipDateValue;var jsDateObj=dijit.byId("MS_requestedShippingDate_"+orderItemId);if(requestShippingDateCheckbox.checked){if(null!=jsDateObj&&null!=jsDateObj.getDisplayedValue()){var now=new Date;if(jsDateObj.compare(jsDateObj.getValue(),now)<=0)return void(null!=document.getElementById("MS_requestedShippingDate_"+orderItemId)?MessageHelper.formErrorHandleClient(document.getElementById("MS_requestedShippingDate_"+orderItemId).id,MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR):MessageHelper.displayErrorMessage(MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR));t="";""!=jsDateObj.getDisplayedValue()?((t=dojo.date.stamp.fromISOString(jsDateObj)).setHours(12),t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:!0,milliseconds:!0})):""==jsDateObj.getDisplayedValue()&&(t=this.resetRequestedShipDateValue)}}else null!=jsDateObj&&(t=this.resetRequestedShipDateValue)}null!=instructions&&null!=document.getElementById("qty_"+(i+1))&&-1!=document.getElementById("qty_"+(i+1)).value&&null!=document.getElementById("shipInstructions_"+(i+1))&&(document.getElementById("shipInstructions_"+(i+1)).value=instructions),null!=t&&null!=document.getElementById("qty_"+(i+1))&&-1!=document.getElementById("qty_"+(i+1)).value&&null!=document.getElementById("requestedShipDate_"+(i+1))&&(document.getElementById("requestedShipDate_"+(i+1)).value=t),null!=document.getElementById("MS_expediteShipping_"+orderItemId)&&null!=document.getElementById("isExpedited_"+(i+1))&&null!=document.getElementById("qty_"+(i+1))&&-1!=document.getElementById("qty_"+(i+1)).value&&(document.getElementById("MS_expediteShipping_"+orderItemId).checked?document.getElementById("isExpedited_"+(i+1)).value="Y":document.getElementById("isExpedited_"+(i+1)).value="N")}document.getElementById("ShipAsComplete").value="Y",updateShippingURL+="orderItemId*=",updateShippingURL+="&quantity*=",updateShippingURL+="&addressId*=",updateShippingURL+="&shipModeId*=",updateShippingURL+="&shipInstructions*=",updateShippingURL+="&requestedShipDate*=",updateShippingURL+="&isExpedited*=",updateShippingURL+="&ShipAsComplete*=",updateShippingURL+="&orderItem*=",updateShippingURL+="&MS_ShipmentAddress*=",updateShippingURL+="&MS_ShippingMode*=",updateShippingURL+="&MS_shippingInstructionsCheckbox*=",updateShippingURL+="&MS_shipInstructions*=",updateShippingURL+="&MS_requestShippingDateCheckbox*=",updateShippingURL+="&MS_requestedShippingDate*=",updateShippingURL+="&MS_expediteShipping*=",updateShippingURL+="&qty*=",updateShippingURL+="&shipAsComplete*=";var beginIndex=wc.render.getContextById("multipleShipmentDetailsContext").properties.beginIndex;null!=beginIndex&&""!=beginIndex||(beginIndex=0),updateShippingURL=updateShippingURL+"&beginIndex="+beginIndex,form.action="OrderChangeServiceShipInfoUpdate",form.URL.value=updateShippingURL,submitRequest()&&form.submit()},showHideEditAddressLink:function(addressSelectBox,orderItemId){if("-3"!=addressSelectBox.value){var orgAddressList=document.getElementById("shippingOrganizationAddressList");if(orgAddressList){var orgAddressArray;orgAddressArray=orgAddressList.value.toString().split(",");for(var i=0;i<orgAddressArray.length;i++)if(null!=dojo.byId("editAddressLink_"+orderItemId)&&"undefined"!=dojo.byId("editAddressLink_"+orderItemId)){if(addressSelectBox.value==orgAddressArray[i]){dojo.byId("editAddressLink_"+orderItemId).style.display="none";break}dojo.byId("editAddressLink_"+orderItemId).style.display="block"}}else null!=dojo.byId("editAddressLink_"+orderItemId)&&"undefined"!=dojo.byId("editAddressLink_"+orderItemId)&&(dojo.byId("editAddressLink_"+orderItemId).style.display="block")}else null!=dojo.byId("editAddressLink_"+orderItemId)&&"undefined"!=dojo.byId("editAddressLink_"+orderItemId)&&(dojo.byId("editAddressLink_"+orderItemId).style.display="none")},showHideEditBillingAddressLink:function(addressSelectBox,orderItemId,paymentAreaNumber){if("-2"!=addressSelectBox.value){var orgAddressList=document.getElementById("shippingOrganizationAddressList");if(orgAddressList){var orgAddressArray;orgAddressArray=orgAddressList.value.toString().split(",");for(var i=0;i<orgAddressArray.length;i++)if(null!=dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)&&"undefined"!=dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)){if(addressSelectBox.value==orgAddressArray[i]){dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none";break}dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="block"}}else null!=dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)&&"undefined"!=dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)&&(dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none")}else dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none"},setOrderId:function(orderId){this.orderId=orderId},getOrderId:function(){return this.orderId},showHideCreateBillingAddressLink:function(addressSelectBox,orderItemId,paymentAreaNumber){if("-2"!=addressSelectBox.value){var orgAddressList=document.getElementById("shippingOrganizationAddressList");if(orgAddressList){var orgAddressArray;orgAddressArray=orgAddressList.value.toString().split(",");for(var i=0;i<orgAddressArray.length;i++)if(null!=dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)&&"undefined"!=dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)){if(addressSelectBox.value==orgAddressArray[i]){dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none";break}dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="block"}}else null!=dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)&&"undefined"!=dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)&&(dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none")}else dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none"},getShippingMode:function(selectBox){dojo.isString(selectBox)&&(selectBox=dojo.byId(selectBox));for(var option=null,i=0;i<selectBox.options.length;i++)selectBox[i].selected&&(option=selectBox[i]);if(option)return{id:option.value,code:option.getAttribute("shipModeCode"),description:option.text}},callOrderItemUpdate:function(newPageLink,qtyId){""!=dojo.byId(qtyId).value&&submitRequest()&&(newPageLink+="&quantity="+dojo.byId(qtyId).value,document.location.href=newPageLink)},orderItemDelete:function(orderItemDeleteUrl,index){return setPageLocation(orderItemDeleteUrl),!1},ajaxLogonService:function(form){var params=[];params.storeId=this.storeId,params.catalogId=this.catalogId,params.langId="-1",params.URL=form.URL.value,params.reLogonURL=form.reLogonURL.value,params.errorViewName=form.errorViewName.value,params.logonId=form.logonId.value,params.logonPassword=form.logonPassword.value,wc.service.invoke("ajaxLogonService",params)},addMessage:function(message){$("#shopCartMessageArea").removeClass("hide"),$(".shopCartMessage").html(message)},orderCanceledReorder:function(orderId,addressId){var params={storeId:storeId,catalogId:catalogId,langId:langId,fromOrderId_1:orderId,billingAddressId:addressId,toOrderId:".**.",rxCancelledOrder:!0,URL:"AjaxOrderCalculate?URL=MyAccount&updatePrices=1&calculationUsageId=-1"};$.ajax({type:"GET",url:getAbsoluteURL()+"AjaxOrderCopy",traditional:!0,data:params,dataType:"html",success:function(data){data.indexOf("errorCode")>0?console.error("Cannot reorder order "+orderId):window.location.href="AjaxOrderItemDisplayView?storeId="+storeId+"&catalogId="+catalogId+"&langId=-1&URL=AjaxOrderItemDisplayView1&orderId=."},error:function(jqXHR,textStatus,errorThrown){console.error("Cannot reorder order "+orderId)}})}},$(document).ready((function(){$("#singleShipmentShippingMode_PayPal")&&($("#PayPalShipMode").val($("#singleShipmentShippingMode_PayPal").val()),$("#singleShipmentShippingMode_PayPal").change((function(){$("#PayPalShipMode").val($(this).val()),$("#WC_SingleShipmentOrderTotalsSummary_td_8").html($("#singleShipmentShippingMode_PayPal option:selected").attr("rel")),$("#WC_SingleShipmentOrderTotalsSummary_td_10").html($("#singleShipmentShippingMode_PayPal option:selected").attr("class"))}))),"empty"==$("#payMethodId_1").val()&&($("#paymentAmountTotal").hide(),$("#paymentAmountLabel").hide()),$("a.edit-frame").click((function(){$.cookie("edit_orderitemid",$(this).data("orderitemid"),{path:"/"})})),$("#shippingBillingPageNext").on("click",(function(e){$("input[name=cc_brand]").val()!=$("#saved_paymentMethod_1").val()&&"savedCC_1"==$("input[name=savedCCFeature_1]:checked").prop("id")&&$("input[name=cc_brand]").val($("#saved_paymentMethod_1").val())}))}));