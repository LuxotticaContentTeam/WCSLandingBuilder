function detectmob(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function openNav(){$("#sticky-sidebar").css("width","364px")}function closeNav(){document.getElementById("sticky-sidebar").style.width="0"}function activeSpin(){var e=$("#spinviewer-container").width()+","+$("#spinviewer-container").height(),t=new s7viewers.SpinViewer({containerId:"s7_spinview",params:{asset:"TargetOptical/8053672552065_360",serverurl:"https://s7d9.scene7.com/is/image/",contenturl:"https://s7d9.scene7.com/skins/",stagesize:e,config:"Scene7SharedAssets/Universal_HTML5_SpinSet_light"}});t.setHandlers({initComplete:function(){}}),t.init()}function initCarouselMiniTiles(){$(window).width()>992&&$(".product--colors").each(function(){var e=$(this),t=$(this).parents(".single-prod").attr("id"),r=$(this).children();if($(r).on("mouseover",function(){$(".product--color-item").removeClass("product--color-item--default")}),e.find("div.product--color-item").length>3){if($("#"+t+" .product--colors").hasClass("slick-initialized"))return!0;$("#"+t).hasClass("d-none")||$("#"+t+" .product--colors").slick({dots:!1,infinite:!1,speed:300,slidesToShow:3,slidesToScroll:1})}})}function initCookieLawLayer(){if("undefined"!=typeof utag){void 0===utag.gdpr.getCookieValues().consent&&utag.gdpr.showExplicitConsent()}}function TealiumConsentPrivacyLink(){window.location.href="/cookie-policy"}function existFilterValueSelected(e,t){return $(".filters--selected-filters p").filter(function(){return $(this).attr(e).trim()==t.trim()})}function initSelectedFilters(){let e=$("#facetApplied").val();if(e){let t=e.split(",");$.each(t,function(e,t){$('.filter-mobile-modal .custom-control-input[facet-value="'+t+'"]').each(function(){let e=$(this)[0];e.checked||e.click()})})}}function initAccordion(){$(".filter-mobile-modal .custom-control-input").on("click",function(){$(".filters--box--top").show(),$(".filters--box--top").addClass("d-flex"),$(".filters--selected-filters").empty(),$(".filter-mobile-modal .custom-control-input:checked").each(function(){var e=$(this),t=$(this).val();let r=$(this).attr("facet-value"),a=existFilterValueSelected("filter-val",r);0==a.length&&($(".filters--selected-filters").append('<p filter-val=" '+r+'">'+t+"</p>"),a=existFilterValueSelected("filter-val",r)),a.on("click",function(){$(this).text()==t&&($(e).prop("checked",!1),$(this).remove()),0==$(".filters--selected-filters p").length&&($(".filters--box--top").hide(),$(".filters--box--top").removeClass("d-flex"))})})})}function activeToggleText(e,t,r){var a=$(e).parents(t),i=$(a).find(r);$(i).hasClass("show")||($(r).collapse("hide"),$(i).collapse("show")),$(t).removeClass("active"),$(a).addClass("active")}function checkStickyActionButtons(){if($(window).width()<=992){var e=$(window).scrollTop();if($(".sidebar .shopperActions").length>0){var t=0;$(".sidebar .shopperActions-wrapper").length>0&&(t=$(".sidebar .shopperActions-wrapper").offset().top),$(".sidebar .scalapay").length>0&&(t-=$(".pdp .sidebar  .scalapay").height()),e+$(window).height()>=t?($(".sidebar .shopperActions").removeClass("sticky-ing"),$(".pdp .sidebar .scalapay").hasClass("d-block")||$(".pdp .sidebar .scalapay").addClass("d-block").removeClass("d-none")):($(".sidebar .shopperActions").addClass("sticky-ing"),$(".pdp .sidebar .scalapay").hasClass("d-none")||$(".pdp .sidebar .scalapay").addClass("d-none").removeClass("d-block"))}}}function initPDPColorCarousel(){$(".product-color-picker__item").length>5&&($(window).width()>992?($(".product-color-picker").hasClass("slick-initialized")&&$(".product-color-picker").slick("unslick"),$(".product-color-picker").slick({dots:!1,infinite:!1,slidesToShow:5.5,slidesToScroll:1})):$(window).width()<=992&&$(".product-color-picker").wrap('<div class="fluid-slider"></div>'))}function initSelectCustom(e){$("select:not(.selectize)").each(function(){var t=$(this),r=$(this).children("option").length;if(!detectmob()||!t.hasClass("keep-native")){var a=r<=1;if(!e||t.attr("id")==e){e||(t.addClass("select-hidden"),t.wrap('<div class="select"></div>'),t.after('<div class="select-styled '+(a?"select-styled-single-option":"")+'"></div>'));var i=t.next("div.select-styled");if(i.text(t.children("option:selected").eq(0).text()),e&&(i.off("click"),i.closest(".select").find(".select-options").remove()),!a){for(var o=$("<ul />",{class:"select-options"}).insertAfter(i),n=0;n<r;n++)$("<li />",{text:t.children("option").eq(n).text(),rel:t.children("option").eq(n).val(),disabled:t.children("option").eq(n).attr("disabled"),"data-href":t.children("option").eq(n).attr("data-href")}).appendTo(o);var s=o.children("li");i.click(function(e){e.stopPropagation(),$("div.select-styled.active").not(this).each(function(){$(this).removeClass("active").next("ul.select-options").hide()}),$(this).toggleClass("active").next("ul.select-options").toggle()}),s.click(function(e){if(e.stopPropagation(),void 0===$(this).attr("disabled")){i.text($(this).text()).removeClass("active");var r=$(this).attr("rel");o.find("li").removeClass("active"),o.find('li[rel="'+r+'"]').addClass("active"),t.val($(this).attr("rel")).change(),o.hide();var a=$(this).attr("data-href");a&&(location.href=a),basicSelectLabel(t)}}),$(document).click(function(){i.removeClass("active"),o.hide()})}}}}),basicSelectLabel(),$("form select").each(function(){var e=$(this);""==e.val()||e.hasClass("ignoreValidation")||$(e).closest(".select").addClass("ok")}),$(".pdp .select-options").niceScroll({cursorcolor:"#222",cursorwidth:"2px",cursorborder:"0px solid #222",cursorborderradius:"100px",autohidemode:!1,cursorminheight:45,preservenativescrolling:!0,railoffset:{top:0,left:-20},railpadding:{top:5,right:0,left:0,bottom:0},directionlockdeadzone:6,scrollbarid:"select-scrollbar"})}function smoothScrollTo(e){const t=document.querySelector(e);return void 0===t.scrollIntoView||(t.scrollIntoView({behavior:"smooth"}),!1)}function closeFilterColumn(){$(".product-column").hasClass("open")&&$(".product-column").removeClass("open"),$("#accordion-filter").hasClass("open")&&($("#accordion-filter").removeClass("open"),$("#accordion-filter").modal("hide"))}var coverflow;$(document).ready(function(){$(".showmore--btn").click(function(){$(".showmore--btn").hide()}),$(".option .custom-radio input").on("change",function(){$(this).parents(".option").parent().find(".option").removeClass("active"),$(this).parents(".option").toggleClass("active")}),$(".option .custom-check input").on("change",function(){$(this).parents(".option").toggleClass("active")}),$(".card-header").click(function(){$(".showmore--btn").show(),$(".card-body .collapse.show").removeClass("show")}),$(".filters--box--top").hide(),$(".filters--box--top").removeClass("d-flex"),initAccordion(),$(".filters--btn-reset").on("click",function(){$(".filters--selected-filters p").remove(),$(".filter-mobile-modal .custom-control-input").prop("checked",!1),$(".filters--box--top").hide(),$(".filters--box--top").removeClass("d-flex")}),$(window).width()>900&&($(".filter-toggle").on("click",function(){$(this).toggleClass("open"),$(".filter-mobile-modal").toggleClass("open"),$(".product-column").toggleClass("open"),$(".filter-mobile-modal").modal(),initSelectedFilters()}),$(".filter-mobile-modal").on("show.bs.modal",function(e){setTimeout(function(){$(".modal-backdrop").attr("onclick","closeFilterColumn()")})}),$(".modal-backdrop").on("click",function(){$(this).hasClass("modal-backdrop--filters")&&closeFilterColumn()}),$(".filter-toggle").click(function(){if("Mostra filtri"==$(".filter-toggle .button-label").text()){var e=$(".filters--selected-filters p").length;$(this).append('<span class="filter-counter">'+e+"</span>"),0==e&&$(".filter-counter").remove()}else $(".filter-counter").remove()})),$(window).width()<900&&($(".filter-toggle").on("click",function(){$(".filter-mobile-modal").addClass("filter-mobile-modal"),$(".filter-mobile-modal").modal(),$(".modal-backdrop").hide(),initSelectedFilters()}),$("[data-dismiss='modal']").on("click",function(){var e=$(".filters--selected-filters p").length;console.log(e),$(".filter-toggle").append('<span class="filter-counter">'+e+"</span>"),0==e&&$(".filter-counter").remove()})),$(".mobile-sorting-menu button").click(function(){var e=$(this);e.is("[data-href]")&&(window.location.href=e.attr("data-href"))});try{picturefill()}catch(e){console.log(e)}initSelectCustom(),setTimeout(function(){initCookieLawLayer()},3e3),checkStickyActionButtons(),$(window).scroll(function(){$(window).scrollTop();checkStickyActionButtons()}),$(".go-top-btn").on("click",function(e){e.preventDefault(),$("html,body").animate({scrollTop:0},"slow")}),$("#store-slider").slick({dots:!1,infinite:!0,speed:300,slidesToShow:1,centerMode:!0,variableWidth:!0,swipe:!1,responsive:[{breakpoint:900,settings:{swipe:!0}}]}),$("#store-slider").on("beforeChange",function(e,t,r,a){$("#store-slider .text-wrapper .collapse").removeClass("show"),$("#store-slider .text-wrapper .showmore-warranty-btn").show()}),$(".showmore-warranty-btn").on("click",function(){$(this).next().toggleClass("show"),$(this).hide(),$(this).prevAll("h2.content-main-title").toggleClass("bigger")}),$(".showless-warranty-btn").on("click",function(){$(this).parents(".collapse").removeClass("show"),$(".showmore-warranty-btn").show(),$(this).parents(".collapse").prevAll("h2.content-main-title").removeClass("bigger"),event.preventDefault(),$("html,body").animate({scrollTop:0},"slow")}),$(".single-service").length>0&&($(".single-service").each(function(){var e=$(this).attr("id"),t=$(this).data("label");""==t||null==t||"undefined"==t||$("#anchor-wrapper").append('<a data-href="'+e+'" class="btn anchor-btn">'+t+"</a>")}),$(".anchor-btn").on("click",function(e){e.preventDefault();var t=$(this).data("href");$("#"+t).position().top;$("html,body").animate({scrollTop:$("#"+t).offset().top},"slow")})),$("#btn-sidemenu").on("click",function(){$("#btn-myaccount").hasClass("active")?$(".overlay-bkg").addClass("active"):$(".overlay-bkg").toggleClass("active"),$(this).toggleClass("active"),$("#sticky-sidebar").toggleClass("opened"),$("#btn-myaccount,#btn-search-mobile").removeClass("active"),$("#sticky-sidebar-myaccount").removeClass("opened"),$("#search-modal").modal("hide"),$(".modal-backdrop").hide(),$(".submenu-dropdown.show").removeClass("show"),$(window).width()<1e3&&$("#sticky-sidebar").hasClass("opened")?setTimeout(function(){$("body").addClass("modal-open"),$("html").addClass("modal-open")},400):($("body").removeClass("modal-open"),$("html").removeClass("modal-open"))}),$(".overlay-bkg").on("click",function(){$(this).removeClass("active"),$("#sticky-sidebar").removeClass("opened"),$("#btn-sidemenu").removeClass("active")}),$(window).scroll(function(){$(window).scrollTop()>100?$(".header").addClass("sticky-ing"):($(".header").removeClass("sticky-ing"),$(window).width()>1e3&&($("#btn-sidemenu").removeClass("active"),$("#sticky-sidebar").removeClass("opened"),setTimeout(function(){$(".overlay-bkg").removeClass("active")},500)))}),$("#daypicker-carousel").slick({dots:!1,infinite:!1,speed:300,slidesToShow:7,slidesToScroll:7,responsive:[{breakpoint:900,settings:{slidesToShow:2.9,slidesToScroll:3,infinite:!1,dots:!1,arrows:!1}}]}),$("#zoom-modal").length>0&&($("#zoom-modal").on("shown.bs.modal",function(e){$(".carouselMag").addClass("active").slick({dots:!0,infinite:!1,speed:300,slidesToShow:1,centerMode:!1,variableWidth:!1}),$(".zoom").magnify()}),$("#spinviewer-container").hide(),$("#spin-btn").on("click",function(){$(".carouselMagctn").hide(),$("#spinviewer-container").show(),$("#carousel-btn").removeClass("active"),$("#spin-btn").addClass("active"),activeSpin()}),$("#carousel-btn").on("click",function(){$("#spinviewer-container").hide(),$(".carouselMagctn").show(),$("#spin-btn").removeClass("active"),$("#carousel-btn").addClass("active")})),initCarouselMiniTiles(),initPDPColorCarousel(),$(".pin-wrapper").on("click",function(){$(this).toggleClass("active"),$(".close-btn").on("click",function(){$(this).removeClass("active")})}),$(".btn-trigger").on("click",function(){$(this).toggleClass("selected")}),$("#mobile-select-size-menu").collapse({toggle:!1}),$("#mobile-select-lenses-menu").collapse({toggle:!1}),$("#mobile-select-size-menu").on("show.bs.collapse",function(){$("#mobile-select-lenses-menu").collapse("hide")}),$("#mobile-select-lenses-menu").on("show.bs.collapse",function(){$("#mobile-select-size-menu").collapse("hide")}),$(window).width()>960?($("#store-select-modal-pdp").length>0?$(".store-col").niceScroll("div.store-wrapper",{cursorwidth:"3px",cursorcolor:"#222",cursorborderradius:"6px",cursorborder:"1px solid #222",autohidemode:!1,horizrailenabled:!1,cursorminheight:60,cursorfixedheight:60}):$(".store-col").niceScroll("div.store-wrapper",{cursorwidth:"6px",cursorcolor:"#acacac",cursorborderradius:"3px",autohidemode:!1,horizrailenabled:!1,background:"none",cursorminheight:210,cursorfixedheight:210,railpadding:{top:0,right:6,left:6,bottom:0}}),0==$("#techology-landing-page").length&&$(".new-arrival").slick({dots:!0,arrows:!0,infinite:!1,slidesToScroll:3,speed:300,slidesToShow:3,variableWidth:!1}),$("#slickbrand").length>0&&($("#slickbrand").slick({dots:!1,arrows:!0,infinite:!1,slidesToScroll:1,speed:300,slidesToShow:5,variableWidth:!1}),$("#slickbrand .single-brand").on("click",function(){$("#slickbrand .slick-slide").removeClass("slick-current"),$(this).parent().parent().addClass("slick-current");var e=$("#slickbrand .single-brand").index($(this));$(".brand-prodbox").removeClass("active"),$(".brand-prodbox:eq("+e+")").addClass("active")}))):($("#slickbrand").length>0&&($("#slickbrand").slick({dots:!1,arrows:!1,infinite:!1,slidesToScroll:1,speed:300,slidesToShow:2.6,variableWidth:!1}),$("#slickbrand .single-brand").on("click",function(){$("#slickbrand .slick-slide").removeClass("slick-current"),$(this).parent().parent().addClass("slick-current");var e=$(this).data("prod");$(".brand-prodbox").removeClass("active"),$("#"+e).addClass("active")})),$(".our-offer.hightimg").slick({dots:!1,arrows:!1,infinite:!0,centerMode:!0,slidesToShow:1}),0==$("#techology-landing-page").length&&$(".new-arrival").slick({dots:!1,infinite:!0,speed:300,slidesToShow:1,centerMode:!0,variableWidth:!0,arrows:!0}),$(".our-avaiableservice").slick({dots:!1,infinite:!0,speed:300,slidesToShow:1,centerMode:!0,arrows:!1}),$(".services-carousel").slick({dots:!1,infinite:!0,speed:300,slidesToShow:1,centerMode:!0,variableWidth:!0,arrows:!1})),$(window).width()<610&&$("#anchor-wrapper").slick({dots:!1,arrows:!1,variableWidth:!0,outerEdgeLimit:!0,infinite:!1})});var $cart,slickprev=0,eventdown="mousedown",eventleave="mouseleave",eventclick="click";function resizeNicescroll(e,t){setTimeout(function(){$(e).getNiceScroll().resize()},t)}function initPDPSidebar(){var e=$(".sidebar").width();$(".pdp-sidebar-wrapper").addClass("sidebar-fixed").css("width",e+"px"),$(window).on("scroll",function(){var t=Math.abs($(window).height()-$("#headerWrapper").outerHeight()-$(".pdp-sidebar-wrapper").outerHeight()),r=$(window).scrollTop()+$(window).height()+t,a=$(window).scrollTop(),i=$(".left-side-wrapper").offset().top+$(".left-side-wrapper").outerHeight(),o=$(".pdp-sidebar-wrapper").offset().top,n=($(".pdp-sidebar-wrapper").outerHeight(),$(".pdp-sidebar-wrapper").offset().top+$(".pdp-sidebar-wrapper").outerHeight());r<=i?n>=i&&a>o?$(".pdp-sidebar-wrapper").hasClass("sidebar-absolute")||$(".pdp-sidebar-wrapper").removeClass("sidebar-fixed").addClass("sidebar-absolute"):($(".pdp-sidebar-wrapper").hasClass("sidebar-absolute")&&$(".pdp-sidebar-wrapper").removeClass("sidebar-absolute").removeAttr("style"),$(".pdp-sidebar-wrapper").hasClass("sidebar-fixed")||$(".pdp-sidebar-wrapper").addClass("sidebar-fixed").css("width",e+"px")):$(".pdp-sidebar-wrapper").hasClass("sidebar-absolute")||$(".pdp-sidebar-wrapper").removeClass("sidebar-fixed").addClass("sidebar-absolute")})}function initFloatingBtnShowdown(){if($("#pdpCustomCarousel .imgShowdown").length>1)if($(window).width()>=992){if($("#customScrollbar").remove(),$(".widget_product_image_viewer").prepend('<div id="customScrollbar"><span class="scroll-pin"></span></div>'),$(".vto-btn").length>0){var e=$("#pdpCustomCarousel").offset().left+$("#pdpCustomCarousel").width()/2;$(".vto-btn").addClass("fixed-vto").css("left",e+"px")}$(window).on("scroll",function(){var e=$("#pdp-sun-banner-showdown").length>0,t=$(".vto-btn").length>0,r=$("#faq-container").length>0,a=$(window).scrollTop(),i=($("#customScrollbar").offset().top,100*a/($("#pdpCustomCarousel").offset().top+$("#pdpCustomCarousel").height()-$(window).height()));if(i>100)i=100,$("#customScrollbar").addClass("scrollbar-static"),t&&$(".vto-btn").removeClass("fixed-vto").removeAttr("style"),r&&($("#faq-container").addClass("position-absolute"),$("#faq-container").removeClass("position-fixed"));else{if($("#customScrollbar").removeClass("scrollbar-static"),t){var o=$("#pdpCustomCarousel").offset().left+$("#pdpCustomCarousel").width()/2;$(".vto-btn").addClass("fixed-vto").css("left",o+"px")}if(e){var n=$("#pdp-sun-banner-showdown").offset().top,s=$("#pdp-sun-banner-showdown").offset().top+$("#pdp-sun-banner-showdown").height();if(t){var l=$(".vto-btn").offset().top;$(".vto-btn").offset().top+$(".vto-btn").height()>=n&&l<=s?$(".vto-btn").addClass("hidden"):$(".vto-btn").removeClass("hidden")}if(r){var d=$("#faq-container").offset().top;$("#faq-container").offset().top,$("#faq-container").height();d>=n&&d<=s?$("#faq-container").addClass("hidden"):$("#faq-container").removeClass("hidden")}}r&&($("#faq-container").addClass("position-fixed"),$("#faq-container").removeClass("position-absolute"))}$("#customScrollbar .scroll-pin").css("top",i+"%"),$("#customScrollbar .scroll-pin").css("transform","translateY(-"+i+"%)")})}else void 0!==$("#pdp-sun-banner-showdown .emarketingspot-wrapped-div").html()&&""!=$("#pdp-sun-banner-showdown .emarketingspot-wrapped-div").html().trim()||$("#pdp-sun-banner-showdown").remove(),$("#pdpCustomCarousel").slick({dots:!1,arrows:!0,slidesToScroll:1,slidesToShow:1}),$("#pdpCustomCarousel").on("beforeChange",function(e,t,r,a){$("#pdpCustomCarousel").on("afterChange",function(e,t,r){1==$("#pdpCustomCarousel .slick-slide.slick-current.slick-active .imgShowdown").length&&$("#countCurrent").html(a+1)})});if($("#faq-container").length>0&&$(window).width()>=992){var t=$(".widget_product_image_viewer").offset().left+15;$("#faq-container").addClass("position-fixed").css("left",t+"px"),$(window).on("scroll",function(){var e=$("#pdp-sun-banner-showdown").length>0,t=100*$(window).scrollTop()/($(".imagePDPContainer").offset().top+$(".imagePDPContainer").height()-$(window).height());if(t>100)t=100,$("#faq-container").addClass("position-absolute").css("left","15px"),$("#faq-container").removeClass("position-fixed");else{var r=$("#faq-container").offset().top,a=$(".widget_product_image_viewer").offset().left+15;if($("#faq-container").addClass("position-fixed").css("left",a+"px"),$("#faq-container").removeClass("position-absolute"),e){var i=$("#pdp-sun-banner-showdown").offset().top,o=$("#pdp-sun-banner-showdown").offset().top+$("#pdp-sun-banner-showdown").height();r>=i&&r<=o?$("#faq-container").addClass("hidden"):$("#faq-container").removeClass("hidden")}}})}}function calculateSidebarWidth(){const e=document.createElement("div");e.className="modal-scrollbar-measure",document.body.appendChild(e);const t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t}function myAccHoverMenuOpen(e){"#myaccount-hover-logged"===e?($("#myaccount-hover-logged").addClass("show"),$("#sv-accountmenu-mobile-btn").css("z-index","1"),$("html,body").addClass("modal-open")):"#myaccount-hover-guest"===e&&($("#myaccount-hover-guest").addClass("show"),$("#sv-accountmenu-mobile-btn").css("z-index","1"),$("html,body").addClass("modal-open")),$("div[data-element-id='X_X_MainNav_Promo'], #headerRow2, #headerRow1, #page").css("padding-right",calculateSidebarWidth()+"px")}function myAccHoverMenuClose(e){"#myaccount-hover-logged"===e?($("#myaccount-hover-logged").removeClass("show"),$("#sv-accountmenu-mobile-btn").removeAttr("style"),$("html,body").removeClass("modal-open")):"#myaccount-hover-guest"===e&&($("#myaccount-hover-guest").removeClass("show"),$("#sv-accountmenu-mobile-btn").removeAttr("style"),$("html,body").removeClass("modal-open")),$("div[data-element-id='X_X_MainNav_Promo'], #headerRow2, #headerRow1, #page").removeAttr("style")}function accordionCardActiveClass(e,t){$(e).parents(".card").hasClass("active")?$(e).parents(".card").removeClass("active"):($(t).find(".card").removeClass("active"),$(e).parents(".card").addClass("active"))}function triggerStore(e){if($(window).width()>992)if($(".single-store").removeClass("active"),$(e).addClass("active"),$(e).prop("checked",!0),$(e).trigger("click"),$("#store-select-modal-pdp").length>0){let t=$(e).parent().position().top;$(".store-col").getNiceScroll(0).doScrollTop(t,0)}else{let t=$(e).position().top;$(".store-col").getNiceScroll(0).doScrollTop(t,0)}else $(".clickedStore").removeClass("d-none")}function analyticsCompilationJS(){$(".product .catalogEntryDisplayListViewProduct").each(function(e){var t=$(this).closest(".nav-item.dropdown").attr("data-element-id");t&&t.indexOf("MainNav")>=0&&$(this).attr("data-element-id",t+"-Product")}),setTimeout(function(){$(".single-prod .product.card").each(function(e){var t="";$(this).find("h5.product--name").html()&&(t=$(this).find("h5.product--name").html().replace(/\s+/g,""));var r=$(this).closest(".nav-item.dropdown").attr("data-element-id");r&&r.indexOf("MainNav")>=0&&($(this).attr("data-element-id",r+"-Product"),$(this).attr("data-description",t))})},100)}function selectize_setVal(e,t){var r=!1;try{var a=$("#"+e).selectize()[0].selectize;a.setValue(t),r=""!=a.getValue()}catch(e){console.error(e)}return r}function calcHeight(e){var t=$("#headerWrapper").height(),r=$(e).attr("href");$(r).css("top",t+"px")}function checkCvvMob(){setTimeout(function(){$("#cvv").parents(".materialize-input-wrapper").hasClass("ok")||$("#cvv").parents(".materialize-input-wrapper").hasClass("errorDiv")?$("a.tooltipInput").hide():$("a.tooltipInput").show()},5)}function confirmationPopup(){$("#contact-form").on("submit",function(e){$("#contact-form div").hasClass("error")?$("#submitFormPopup").modal("hide"):($("#submitFormPopup").modal("show"),e.preventDefault())})}function basicSelectLabel(e){$(e).each(function(e,t){""==$(t).val()||null==$(t).val()?($(".custom-label").remove(),$(t).parents(".basic-select").find(".select-styled").removeClass("basic-select-label")):void 0!==$(t).attr("data-label")&&$(t).attr("data-label").length>0&&(customSelectLabel(t),$(t).parents(".basic-select").find(".select-styled").addClass("basic-select-label"))})}function calculateTotal(e,t){$(".error-below-add-button").addClass("d-none"),null==e&&(e=$("#prescription-table_1"));var r=$(".total-price-value");null!=t&&(r=$(t));let a="single",i=$("#singlePurchase");productDisplayJS.isSubsPurchase()?(a="subs",i=$("#subsPurchase"),$("#accessories-reccomendation-CL").addClass("d-none")):$("#accessories-reccomendation-CL").removeClass("d-none");var o=0,n=(e.closest(".prescription-wrapper").data("prescription"),$("#right-boxes_"+a)),s=$("#left-boxes_"+a);"--"!==n.val()&&(o+=parseInt(n.val(),10)),"--"!==s.val()&&(o+=parseInt(s.val(),10));var l=parseFloat(i.closest(".partial-quantity-wrapper").find(".not-formatted-price").val()),d=l*o;let c=0;$("#priceAccRecommPrice").length>0&&(c=$("#priceAccRecommPrice").val()),d+=Number(c),$("#prescription-purchase").is(":checked")?$(".scalapay-widget-pdp").hide():$(".scalapay-widget-pdp").show(),d>=0?$(".price-subtext.with-shipping").addClass("d-none"):$(".price-subtext.with-shipping").removeClass("d-none"),productDisplayJS.validatePromotionApplication(o);let u="true"===$("#promoCustomAvailable").val();if("single"==a&&(o>3||u)){var p=d+Number(c);if(u){let e=Number($("#promoCustomDiscountPercentage").val());$("#percentageDiscountCL").html("-"+e+"%"),$("#percentageDiscountCL").removeClass("d-none"),d=l*((100-e)/100)*o+Number(c)}else{var m=Math.floor(o/4);o%4==0?$("#percentageDiscountCL").removeClass("d-none"):$("#percentageDiscountCL").addClass("d-none"),d=l*(o-m)+Number(c)}$(".old-total-price-value").html("&euro; "+p.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}).replace(",","|").replace(".",",").replace("|",".")),$(r).html("&euro; "+d.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}).replace(",","|").replace(".",",").replace("|",".")),$(".old-total-price").removeClass("d-none"),$(".total-price").addClass("red")}else $(".old-total-price").addClass("d-none"),$(".total-price").removeClass("red"),$(".total-price-label").removeClass("mt-3"),$("#percentageDiscountCL").addClass("d-none"),$(r).html("&euro; "+d.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}).replace(",","|").replace(".",",").replace("|","."));$("#analyticsPDPITotalPrice").val(d),updateScalapayWidgetAmount(".scalapay-widget-pdp",d);var h=$("#cartCurrentTotal").val();h<0&&(h=0);var g=Number($("#amount_free_shipping_charge").val())-(d+parseInt(h));g>0&&0==$(".isFreeShipping").length?($("#gapToFreeShip").text(g.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}).replace(",","|").replace(".",",").replace("|",".")),$("#price-tofreeshipping").removeClass("d-none")):$("#price-tofreeshipping").addClass("d-none");var f=$("#promo3piu1Available").val(),v=$("#promo5piu3Available").val();if("true"==f||"true"==v)if(detectmob())"true"==f&&o<4?($(".promo-alert5piu3").addClass("d-none"),$(".promo-alert3piu1").removeClass("d-none")):"true"==v&&o<8?($(".promo-alert3piu1").addClass("d-none"),$(".promo-alert5piu3").removeClass("d-none")):($(".promo-alert3piu1").addClass("d-none"),$(".promo-alert5piu3").addClass("d-none"));else if(!productDisplayJS.isSubsPurchase())if("true"==f&&o<4){template='<div class="tooltip tooltip--pine-green" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>';var C={placement:"bottom",trigger:"manual",html:!0,title:"Seleziona 4 confezioni. Una &eacute; in omaggio",template:template};$("#left-eye-qty").tooltip(C),$("#left-eye-qty").tooltip("show"),window.setTimeout(function(){$("#left-eye-qty").tooltip("dispose")},3e3)}else if("true"==v&&o<8){template='<div class="tooltip tooltip--pine-green" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>';C={placement:"bottom",trigger:"manual",html:!0,title:"Seleziona 8 confezioni. 3 sono in omaggio",template:template};$("#left-eye-qty").tooltip(C),$("#left-eye-qty").tooltip("show"),window.setTimeout(function(){$("#left-eye-qty").tooltip("dispose")},3e3)}else $("#left-eye-qty").tooltip("hide");productDisplayJS.refreshShippingDateCL()}function selectAllCHK(e,t){if($(t).is(":checked")){$("#"+e+' input[type="checkbox"]').each(function(){$(this).prop("checked",!0)}),$("#"+e+" #rightEyePrescr").removeClass("not-value"),$("#"+e+" #rightEyePrescr").addClass("same-value"),$("#"+e+" #rightEyePrescrLabel").removeClass("not-value"),$("#"+e+" #rightEyePrescrLabel").addClass("same-value");let t="";$("#"+e+" select").each(function(){var e=$(this).attr("id");-1===e.indexOf("right")&&-1===e.indexOf("boxes")&&(""==t&&(t=e.replace("left","right")),$("#"+e.replace("left","right")).val($(this).val()).trigger("change"),$("#"+e.replace("left","right")+" + div").text(""!==$(this).val()?$(this).val():"-"))}),$("#"+t).trigger("change")}else $("#"+e+' input[type="checkbox"]').each(function(){$(this).is(":checked")?$(this).closest("tr").addClass("active-this"):$(this).closest("tr").removeClass("active-this")}),$("#"+e+" #rightEyePrescr").addClass("not-value"),$("#"+e+" #rightEyePrescr").removeClass("same-value"),$("#"+e+" #rightEyePrescrLabel").addClass("not-value"),$("#"+e+" #rightEyePrescrLabel").removeClass("same-value");calculateTotal($(t).closest(".prescription-wrapper").find(".prescription-table"))}function selectTCHK(e){var t=$("#"+e);t.find("[name='allOd']").prop("checked",!1),t.find("tbody").addClass("not-value"),t.find("tbody").removeClass("same-value"),$(".prescription-table").find("tbody tr input[type=checkbox]").each(function(){$(this).is(":checked")?($(this).closest("tr").addClass("active-this"),$(this).prop("checked",!0)):($(this).closest("tr").removeClass("active-this"),$(this).prop("checked",!1))}),calculateTotal(t)}function initSelectCustomOnModal(e){$("#"+e).find("select").each(function(){var e=$(this),t=$(this).children("option").length,r=t<=1;if(!e.hasClass("select-hidden")){e.addClass("select-hidden"),e.wrap('<div class="select"></div>'),e.after('<div class="select-styled '+(r?"select-styled-single-option":"")+'"></div>');var a=e.next("div.select-styled");if(a.text(e.children("option:selected").eq(0).text()),a.off("click"),a.closest(".select").find(".select-options").remove(),!r){for(var i=$("<ul />",{class:"select-options"}).insertAfter(a),o=0;o<t;o++)$("<li />",{text:e.children("option").eq(o).text(),rel:e.children("option").eq(o).val(),"data-href":e.children("option").eq(o).attr("data-href")}).appendTo(i);var n=i.children("li");a.click(function(e){e.stopPropagation(),$("div.select-styled.active").not(this).each(function(){$(this).removeClass("active").next("ul.select-options").hide()}),$(this).toggleClass("active").next("ul.select-options").toggle()}),n.click(function(t){t.stopPropagation(),a.text($(this).text()).removeClass("active");var r=$(this).attr("rel");i.find("li").removeClass("active"),i.find('li[rel="'+r+'"]').addClass("active"),e.val($(this).attr("rel")).change(),i.hide();var o=$(this).attr("data-href");o&&(location.href=o)}),$(document).click(function(){a.removeClass("active"),i.hide()})}}})}function openModalDetailTech(e){return $("#"+e).modal("show"),$("#"+e).on("shown.bs.modal",function(t){technologyModalTrigger(e)}),$(".detail-tech-modal").on("hidden.bs.modal",function(e){$(".box-info-tech").removeClass("show").removeClass("opened"),$(".box-info-tech .mydiv").show(),$(".open-info-tech").hide()}),!1}function technologyModalTrigger(e){var t=$("#"+e+" .media-bkg-tech").data("originimg");$("#"+e+" .media-bkg-tech").css("background-image","url("+t+")"),$(window).width()<1e3&&closeTechInfobox(),setTimeout(function(){$("#"+e+" .box-info-tech").addClass("show")},250),$("#"+e+" .apply-filter-lences").on(eventdown,function(){if($("#"+e+" .box-info-tech").hide(),$(this).addClass("pressed"),$("#"+e+" .media-bkg-tech").data("hovervideo")){var t=$("#"+e+" .media-bkg-tech").data("hovervideo");$("#"+e+" .media-bkg-tech").append('<video autoplay playsinline webkit-playsinline loop muted class="bkg-video" src="'+t+'"></video>')}else{var r=$("#"+e+" .media-bkg-tech").data("hoverimg");$("#"+e+" .media-bkg-tech").css("background-image","url("+r+")")}}).on("mouseup",function(){$("#"+e+" .media-bkg-tech video ").remove(),$("#"+e+" .box-info-tech").show(),$(this).removeClass("pressed");var t=$("#"+e+" .media-bkg-tech").data("originimg");$("#"+e+" .media-bkg-tech").css("background-image","url("+t+")")}).on(eventleave,function(){$("#"+e+" .media-bkg-tech video ").remove(),$("#"+e+" .box-info-tech").show(),$(this).removeClass("pressed");var t=$("#"+e+" .media-bkg-tech").data("originimg");$("#"+e+" .media-bkg-tech").css("background-image","url("+t+")")})}function closeTechInfobox(){$(".box-info-tech").addClass("opened"),$(".box-info-tech .mydiv").hide(),$(".open-info-tech").show()}function openTechInfobox(){$(".box-info-tech").removeClass("opened"),$(".box-info-tech .mydiv").show(),$(".open-info-tech").hide()}function customSelectLabel(e){if(void 0!==$(e).attr("data-label")&&$(e).attr("data-label").length>0){customLabel=$(e).data("label"),$(e).next(".select-styled").prepend('<span class="custom-label">'+customLabel+"</span>");var t=$(this).next().children();$(t).length>1&&$(t).eq(1).remove(),$(e).on("change",function(){if(""==$(this).val()){$(this).parent(".select").addClass(".errorDiv");var e=$(this).data("error");$(e).show()}else{$(this).parent(".select").removeClass(".errorDiv");e=$(this).data("error");$(e).hide()}})}}function spinnerFunc(e){if($(e).append('<span class="spinner-border" role="status"><span class="sr-only">Loading...</span></span>'),$(e).hasClass("btn")){$(e).addClass("loading-button"),$(e).prop("disabled",!0),$(e).contents().first().wrap('<span class="loading-text"></span>');var t=$(e).outerWidth(),r=$(e).outerHeight(),a=(t-$(e).find(".spinner-border").outerWidth())/2,i=(r-$(e).find(".spinner-border").outerHeight())/2;$(e).find(".spinner-border").css({left:a,top:i})}else $(e).hasClass("fulldiv-spinner")&&$(e).append('<span class="overlay-spinner"></span>')}function disableSpinner(e){$(e).hasClass("btn")&&($(e).removeClass("loading-button"),$(e).prop("disabled",!1),$(".loading-text").contents().unwrap()),$(e).hasClass("fulldiv-spinner")&&$(".overlay-spinner").remove(),$(".spinner-border").remove()}function playVideo(){$(".stop").removeClass("play-ing").removeClass("play"),$("#landing-video-wrapper video").get(0).play(),$(".centered-content").css("opacity","0"),$(".overlay-bkg-video").css("background-color","rgba(0, 0, 0, 0)")}function middleActionVideo(){$(".stop").removeClass("play"),$(".stop").addClass("play-ing")}function stopVideo(){$("#landing-video-wrapper video").get(0).pause(),$(".stop").addClass("play"),$(".stop").removeClass("play-ing"),$(".centered-content").css("opacity","1"),$(".overlay-bkg-video").css("background-color","rgba(0, 0, 0, 0.5)")}function _openCart(e){if(!window.switchCartOpen){window.switchCartOpen=!0;var t=e||1e3;utagFiller.setMiniCart(),$(window).width()>480?($cart=$("#quick_cart_container"),setTimeout(function(){$cart.modal({backdrop:"static"}),$(".modal-backdrop").addClass("cart-backdrop").on("click",function(){$(this).remove()}),$cart.addClass("in")},t)):($cart=$("#quick_cart_mobile_container"),$("#quick_cart_container").on("click",function(){_closeCart()}),$cart.modal({backdrop:"static"}),$(".modal-backdrop").addClass("cart-backdrop").on("click",function(){$(this).remove()}),$("#quick_cart_mobile_container .svEnableListCarousel").length>0&&($("#quick_cart_mobile_container .svEnableListCarousel").carousel("dispose"),setTimeout(function(){$("#quick_cart_mobile_container .svEnableListCarousel .carousel-inner").slick({dots:!0,arrows:!1,infinite:!1,slidesToShow:1.3})},500)))}}function itemQtaButtons(e){$("#currentOrderId").val();var t=e.attr("id").replace("buttonQtn_",""),r=$("#mainElement"+t).val();let a=$("#qty_"+t),i=$(a).val();console.log("input value",i);let o=parseInt($("#maxQuantityBuyable-"+t).val());if($(e).hasClass("plus")){let e=parseInt(i)+1;$(a).val(e),console.log("input increment",a),e>=o&&$("buttonQtn_"+t).attr("disabled","disabled"),e>1&&($("#buttonQtn_"+t+" img.minus-ico").removeClass("d-none"),$("#buttonQtn_"+t+" img.remove-item-ico").addClass("d-none")),cartJS.changeItemQuantity(r,t)}else if(i>1){let e=parseInt(i)-1;$(a).val(e),console.log("input decrement",a),e<o&&$("buttonQtn_"+t).removeAttr("disabled"),1==e&&($("#buttonQtn_"+t+" img.minus-ico").addClass("d-none"),$("#buttonQtn_"+t+" img.remove-item-ico").removeClass("d-none")),cartJS.changeItemQuantity(r,t)}else{if(console.log("should remove product from cart"),"true"==$("#isContactLenses"+r).val()){var n=$("#contact-lenses-right-eye-"+r).val(),s=$("#contact-lenses-left-eye-"+r).val();n==t?cartJS.deleteFromCart(r,n):s==t&&cartJS.deleteFromCart(r,s)}else cartJS.deleteFromCart(r)}}function minicartTooltip(){}function _closeCart(){window.switchCartOpen&&setTimeout(function(){window.switchCartOpen=!1,$cart.modal("hide"),setTimeout(function(){$(".modal-backdrop").removeClass("cart-backdrop")},100)},200)}function myToggle(e,t,r){$(e).is(":checked")?r?$(t).show():$(t).hide():r?$(t).hide():$(t).show()}function myToggleDiv(e,t){$(t).toggle(),$(t).is(":visible")?$(e).hide():$(e).show(),$(window).width()<960&&$(t).on("click",".back",function(){$(t).hide(),$(e).show()})}function removeRadioSel(e){$(e).find('input[type="radio"]').prop("checked",!1),$(e).find(".addressItem").removeClass("active")}function toggleNew(e,t,r){var a=$(e).parents(".addressWrapGen");$(a).find(".addressItem").removeClass("active"),$(e).parents(".addressItem").addClass("active"),$(t).hide(),$(r).show()}function toggleNotNew(e,t){$(t).find(".addressItem").removeClass("active"),$(e).parents(".addressItem").addClass("active")}function switchPanels(e,t){$(e).hide(),$(t).show()}function activeDetailStore(e){$(".storedetail").hide(),$("#storedetail-"+e).show()}function getStoreList(){$("#store-select-modal").modal(),$("#store-select-modal").on("shown.bs.modal\t",function(){$(window).width()>992&&$(".store-col").niceScroll("div.store-wrapper",{cursorwidth:"6px",cursorcolor:"#acacac",cursorborderradius:"3px",autohidemode:!1,horizrailenabled:!1,background:"none",cursorminheight:210,cursorfixedheight:210,railpadding:{top:0,right:6,left:6,bottom:0}})}),setTimeout(function(){$("#store-locator-main-map-stores").show(),"undefined"==typeof map&&initMap(),$(window).width()>960&&$(".store-col").getNiceScroll().resize(),map.fitBounds(bounds)},400)}function triggerNiceScroll(e){$(e).getNiceScroll().length>0&&$(e).getNiceScroll().remove(),$(e).niceScroll({cursorwidth:"6px",cursorcolor:"#000",cursorborderradius:"4px",autohidemode:!1,horizrailenabled:!1,background:"none",cursorminheight:50,cursorfixedheight:50,railpadding:{top:0,right:0,left:0,bottom:0}})}function billingAddressFormTrigger(){triggerNiceScroll(".ccformInner"),myToggleDiv(this,"#newBilladdressForm"),$(".button-wrapper").toggleClass("abs-bottom-btn")}function expiry(e,t){if("Backspace"!=t.key){for(var r=String($(e).val()),a="",i=0;i<r.length;i++)1==i&&"/"==r.charAt(i)&&(a=0+r.charAt(0)),/^[0-9]+$/.test(r.charAt(i))&&(a+=r.charAt(i));var o="";for(i=0;i<a.length;i++)/^[0-9]+$/.test(a.charAt(i))&&(0==i&&a.charAt(i)>1?(o+=0,o+=a.charAt(i),o+="/"):1==i?(o+=a.charAt(i),o+="/"):o+=a.charAt(i));$(e).val(o)}}function customModalClasses(e,t){$("#btn-myaccount").removeClass("active"),$("#search-modal").modal("show"),$(e).toggleClass("active"),$(t).addClass("white-backdrop")}function openMobileUsermenu(e){return!($(window).width()<990)||($("#btn-sidemenu").hasClass("active")?$(".overlay-bkg").addClass("active"):$(".overlay-bkg").toggleClass("active"),$("#search-modal").modal("hide"),$(".modal-backdrop").show(),$("#btn-search-mobile").removeClass("active"),$(e).toggleClass("active"),$("#sticky-sidebar-myaccount").toggleClass("opened"),$("#sticky-sidebar-myaccount").hasClass("opened")?($("body").addClass("modal-open"),$("html").addClass("modal-open")):($("body").removeClass("modal-open"),$("html").removeClass("modal-open")),!1)}function changeAddressDiv(e,t){var r=$(t).html(),a=$(t).data("optionid"),i=$("#"+e+" .dropdown-toggle .addressItemVal").html(),o=$("#"+e+' input[type="hidden"]').val();$(t).remove(),$("#"+e+" .dropdown-toggle .addressItemVal").empty().html(r),$("#"+e+" .dropdown-menu").append("<div class='addressItemVal' onclick='changeAddressDiv(\""+e+"\",this)' data-optionid='"+o+"'>"+i+"</div>"),$("#"+e+' input[type="hidden"]').val(a)}async function triggerSlick(e){var t=$(e).attr("href");if($(t).find(".slick-initialized").length<=0)if($(t).is("#lenses-submenu-dropdown")){var r=$("#daily-cta-box").html();$(t).find(".catalogEntryRecommendationWidget.carousel:first-of-type .carousel-inner").slick({arrows:!1,infinite:!1,slidesToShow:1.5}),$(t).find(".catalogEntryRecommendationWidget.carousel:first-of-type .carousel-inner").slick("slickAdd",r)}else $(t).find(".carousel .carousel-inner").slick({arrows:!1,infinite:!1,slidesToShow:1.55})}async function triggerTabSlick(){var e=$("#monthly-cta-box").html();$("#lenses-submenu-dropdown .catalogEntryRecommendationWidget.carousel:nth-child(5) .slick-initialized").length<=0&&($("#lenses-submenu-dropdown .catalogEntryRecommendationWidget.carousel:nth-child(5) .carousel-inner").slick({arrows:!1,infinite:!1,slidesToShow:1.4}),$("#lenses-submenu-dropdown .catalogEntryRecommendationWidget.carousel:nth-child(5) .carousel-inner").slick("slickAdd",e))}function customTab(e){var t=$(e).attr("data-target"),r=$(e).attr("parent");$(".tab").removeClass("active"),$(e).addClass("active"),$(r).find(".tab-body").hide(),$(r).find(t).show()}function switchTab(e,t){$(".tab").removeClass("active"),t.addClass("active");var r=1;$("#lenses-submenu-dropdown .scrollable-div #slot-6 .catalogEntryRecommendationWidget").each(function(){e==r?$(this).show():$(this).hide(),r++})}function openVirtualMirrorSpinner(e){var t=$(e);$(t).addClass("active"),spinnerFunc(e)}function closeVirtualMirrorSpinner(e){var t=$(e);$(t).removeClass("active"),disableSpinner(e)}function getRealTimeStock(e,t,r,a,i,o){let n={};return n.requestBody=JSON.stringify(createVisionDirectObject(e,t,r,a,i)),new Promise((e,t)=>{$.ajax({url:"GetRealTimeStock",data:n,type:"POST",success:function(r){let a=cartJS.toJson(r);if(a&&a.response){let t=a.response,r=t.allocationInfo.allocationStatus;if("Error"!=r){let e;t.validResponse=!0,$.each(t.shippingMethod,function(t,r){(!o&&"UPS_Standard_11"==r.serviceCode||o&&"UPS_Standard_11_GREEN"==r.serviceCode)&&(e=r)});let a="",i="";e?(a=formatDate(new Date(e.deliveryDate)),i=new Date(e.deliveryDate).toShortFormat()):(a="3-5 giorni",i="3-5 giorni"),t.deliveryDateFormatted=a,t.deliveryDateFormattedShort=i,t.oneDayDeliveryAvailable="Full"==r?"true":"false"}else t.validResponse=!1;e(t)}else t(a)},error:function(e,r){t(r)}})})}function formatDate(e){var t=new Date(e),r=""+(t.getMonth()+1),a=""+t.getDate(),i=t.getFullYear();return r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),[a,r,i].join("-")}function getDateFromShortFormat(e){let t=null,r=["gennaio","febbraio","marzo","aprile","maggio","giugno","luglio","agosto","settembre","ottobre","novembre","dicembre"],a=e.split(" ");if(3==a.length){let e=r.indexOf(a[1]),i=a[0],o=a[2];(t=new Date).setDate(i),t.setMonth(e),t.setFullYear(o)}return t}function createVisionDirectObject(e,t,r,a,i){let o={storeCode:"SV",forcedWarehouses:"WAREHOUSE_11",totalPrice:"",shippingAddress:{address1:"",address2:"",region:"",city:"",postcode:"",countryId:"IT"},items:[{upc:"",quantity:""}]};return o.items[0].upc=e||"",o.totalPrice=t||"",o.items[0].quantity=r||"",o.shippingAddress.postcode=a||"",o.shippingAddress.region=i||"",o}detectmob()&&(eventdown="touchstart",eventleave="touchend",eventclick="touchstart"),$(window).on("load",function(){if($("#technology-carousel-swiper").length>0){$("#techology-landing-page .svEnableListCarousel").hide(),$("#techology-landing-page #carousel-0").css("display","flex"),coverflow=new Swiper("#technology-carousel-swiper",{effect:"coverflow",grabCursor:!0,loop:!0,loopAdditionalSlides:$("#technology-carousel-swiper .swiper-slide").length,loopedSlides:$("#technology-carousel-swiper .swiper-slide").length,slidesPerView:"auto",centeredSlides:!0,initialSlide:0,keyboardControl:!0,mousewheelControl:!1,lazyLoading:!0,preventClicks:!1,preventClicksPropagation:!1,lazyLoadingInPrevNext:!1,allowTouchMove:!1,nextButton:"",prevButton:"",slideToClickedSlide:!0,coverflowEffect:{rotate:0,stretch:0,depth:250,modifier:1.25,slideShadows:!1},breakpoints:{1000:{allowTouchMove:!0}}}),$("#technology-match").slick({slidesToShow:5,infinite:!0,centerMode:!0,focusOnSelect:!0,swipe:!1,responsive:[{breakpoint:1e3,settings:{infinite:!0,centerPadding:"60px",slidesToShow:1,variableWidth:!0,arrows:!1}}]});var e=!1,t=0,r=!1;$("#technology-match .slick-slide, #technology-match .slick-arrow").on("click",function(t){t.preventDefault(),t.stopPropagation(),e=!1}),$("#technology-match").on("beforeChange",function(t,a,i,o){setTimeout(function(){if(!e){r=!0,coverflow.activeIndex;var t=i-o;1!=t&&t!=-1*(a.slideCount-1)||coverflow.slidePrev(),-1!=t&&t!=a.slideCount-1||coverflow.slideNext(),-2!=t&&t!=-1*(a.slideCount-2)||(coverflow.slideNext(),setTimeout(function(){coverflow.slideNext()},500)),2!=t&&t!=a.slideCount-2||(coverflow.slidePrev(),setTimeout(function(){coverflow.slidePrev()},500))}},500)}),coverflow.on("click",function(e){e.preventDefault(),e.stopPropagation();var a=$(e.target).data("idmodal");t!=coverflow.activeIndex&&0!=coverflow.previousIndex||openModalDetailTech(a),r=!1}),$(window).width()>1e3&&coverflow.on("slideChange",function(){e=!0,setTimeout(function(){if(!r){var e=coverflow.activeIndex-coverflow.previousIndex,a=$("#technology-carousel-swiper .swiper-slide").length;1!=e&&e!=-1*a||$("#technology-match").slick("slickNext"),-1!=e&&e!=a||$("#technology-match").slick("slickPrev"),2==e&&($("#technology-match").slick("slickNext"),setTimeout(function(){$("#technology-match").slick("slickNext")},500)),-2==e&&($("#technology-match").slick("slickPrev"),setTimeout(function(){$("#technology-match").slick("slickPrev")},500))}t=coverflow.activeIndex,myindexlencesdiv=$(".swiper-slide-active").data("swiper-slide-index"),$("#techology-landing-page .svEnableListCarousel").hide(),$("#techology-landing-page #carousel-"+myindexlencesdiv).css("display","flex"),setTimeout(function(){},500),slickprev=myindexlencesdiv},500)}),$(window).width()<1e3&&coverflow.on("transitionEnd",function(){e=!0,t=coverflow.activeIndex;var r=$("#technology-carousel-swiper .swiper-slide:eq("+t+")").data("slick"),a=$("#technology-match  div."+r).parents(".slick-slide").data("slick-index");$("#technology-match").slick("slickGoTo",a,!0)})}}),$(function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",e+"px"),window.addEventListener("resize",function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",e+"px")}),this.header=$("#headerRow2"),this.navbarLeft=this.header.find("#navbarSupportedContent"),this.underline=this.navbarLeft.find(".navbar-underline");let t=!1;if(this.navbarLeft.on("click",".navbar-nav .main-menu-btn",e=>{const t=$(e.target),r=t.parents("li").position();this.underline.addClass("show").css({left:r.left,width:t.outerWidth()})}),this.navbarLeft.on("mouseenter",".navbar-nav .main-menu-btn",e=>{const t=$(e.target),r=t.parents("li").position();$(".nav-item.show").length>0||this.underline.addClass("show").css({left:r.left,width:t.outerWidth()})}),this.navbarLeft.on("mouseleave",()=>{t=setTimeout(()=>{this.underline.removeClass("show")},500)}),$(window).width()<=1200&&$(".menuProfile").length>0){$(".menuProfile .sv-accountmenu").wrap('<div class="collapse" id="sv-accountmenu-mobile"></div>');var r=$(".menuProfile .sv-accountmenu").find("li.active a").html();$("#sv-accountmenu-mobile-btn").html(r)}if($(".pdp .contact-lenses").length>0)if($(window).width()>=992){$(".contact-lenses .sidebar").niceScroll({autohidemode:"hidden",cursorwidth:"0px",railoffset:{top:0,left:-16}});var a=$(".left-side").width();$(".left-side-wrapper").addClass("left-side-fixed").css("width",a+"px"),$(window).on("scroll",function(){$(window).scrollTop()+$(window).height()<=$(".sidebar").offset().top+$(".sidebar").outerHeight()?($(".left-side-wrapper").hasClass("left-side-absolute")&&($(".left-side-wrapper").removeClass("left-side-absolute").removeAttr("style"),$(".ct_sv_strip").addClass("fixed")),$(".left-side-wrapper").addClass("left-side-fixed").css("width",a+"px"),$(window).scrollTop()>0?($(".ct_sv_strip").addClass("fixed"),$("#contentWrapper").css("padding-top",$(".ct_sv_strip").height()+"px")):($(".ct_sv_strip").removeClass("fixed"),$("#contentWrapper").removeAttr("style"))):($(".left-side-wrapper").removeClass("left-side-fixed").addClass("left-side-absolute"),$(".ct_sv_strip").addClass("slideup-transition"),setTimeout(function(){$(".ct_sv_strip").removeClass("fixed slideup-transition")},1e3))})}else $(".sidebar").getNiceScroll().remove();else $(".pdp").length>0&&!$(".contact-lenses").length>0&&$(window).width()>=992&&initPDPSidebar();$("#store-select-modal-pdp").length>0&&($("#store-select-modal-pdp").on("click",function(e){e.target===e.currentTarget&&$("#store-select-modal-pdp").modal("hide")}),$("#nav-list").length>0&&$("#nav-list").on("scroll",function(){var e=$("#nav-list").scrollTop()+$("#nav-list").height();$("#store-locator-left-list .single-store").length>0&&(e>$("#store-locator-left-list .single-store:last-child").position().top+$("#store-locator-left-list .single-store:last-child").height()?$(".store-col").addClass("noblur")||$(".store-col").addClass("noblur"):$(".store-col").addClass("noblur")&&$(".store-col").removeClass("noblur"))})),initFloatingBtnShowdown(),$(".widget_product_image_viewer")&&($(window).width()>992&&$("#pdpCustomCarousel .imgShowdown").on("click",function(){$("#zoom-modal").modal("show")}),$("#zoom-modal").on("shown.bs.modal",function(e){$(window).width()<=992?($("#zoom-carousel .brand").remove(),window.zoom.initZoom()):$("#zoom-carousel").slick({dots:!0,arrows:!1,slidesToScroll:1,slidesToShow:1,vertical:!0,verticalSwiping:!0,infinite:!1}).on("wheel",onSliderWheel)})),$("#modify-payment-modal").on("shown.bs.modal\t",function(){triggerNiceScroll(".ccformInner"),$("#modify-payment-modal select").each(function(){let e=$(this).selectize()[0].selectize;e.on("focus",function(){setTimeout(function(){$(".ccformInner").getNiceScroll().resize()},200)}),e.on("blur",function(){setTimeout(function(){$(".ccformInner").getNiceScroll().resize()},200)})})}),$(".overlay-bkg").on("click",function(e){$(e).hasClass("active")&&$(e).removeClass("active"),$(".nav-item.dropdown.show").length>0&&$(".nav-item.dropdown.show").removeClass("show")}),lockDownloadImg(),initScalaPayWidgetGraphic(),$("#store-locator-filters").on("show.bs.collapse",function(){$("#nav-tabContent").addClass("overlay"),$("#nav-map").addClass("overlay")}),$("#store-locator-filters").on("hidden.bs.collapse",function(){$("#nav-tabContent").removeClass("overlay"),$("#nav-map").removeClass("overlay")}),$(".store-info-wrapper .collapse").on("hidden.bs.collapse",function(){$(".store-col").getNiceScroll().resize()}),$(".store-info-wrapper .collapse").on("shown.bs.collapse",function(){$(".store-col").getNiceScroll().resize()}),$(".btn-qta-picker button").on("click",function(){itemQtaButtons($(this))});let i=0;if($("#headerRow1").is(":visible")&&(i+=$("#headerRow1").outerHeight()),$("#headerRow2").is(":visible")&&(i+=$("#headerRow2").outerHeight()),$(".promotop").length>0){var o=$(".promotop").outerHeight();i=o+i}if($("#headerWrapper").css("height",i+"px"),$(".banner-ddm").length>0&&($(window).width>1e3?$(".banner-ddm").parents(".two-slots-glasses-layout-slot-two").addClass("banner-ddm-wrapper"):$(".banner-ddm").parents(".submenu-dropdown").addClass("banner-ddm-wrapper-mob")),$("#email-input, .focusTargetCollapse").on("focusin",function(){$(".focusTargetCollapse").removeClass("hidden")}),$("#email-input, .focusTargetCollapse").on("focusout",function(){$(".focusTargetCollapse").addClass("hidden")}),$(".product_listing_container.row .single-prod").length>0){var n=$(".product_listing_container.row .single-prod").height();$(".single-prod.banner").css("height",n+"px")}if($(window).width()<400&&$(".product-column .products-listing--list .product.card .product--price--old").length>0&&$(".product-column .products-listing--list .product.card .product--price--old").prev().css("flex","100%"),$("form select").each(function(){$(this).hasClass("selectize")&&!$(this).hasClass("select-modal")&&($(this).selectize(),""!=$(this).val()&&$(this).parents(".select").find(".selectize-input").addClass("ok"))}),$(".section[data-scroll]").length>0)var s=$(".section[data-scroll]");if(1==$("#landing-menu").length)var l=$("#landing-menu"),d=l.outerHeight(),c=l.find("button.anchor-btn-space"),u=$("#landing-menu").offset().top;$("#login-form .materialize-input-wrapper input").each(function(){""!=$(this).val()&&setTimeout(function(){$(this).trigger("click")},300)}),$(".ignoreValidation").focus(function(){$(this).removeClass("ignoreValidation")}),$(".materialize-input-wrapper input").focusout(function(){$(this).hasClass("norequired")&&""==$(this).val()?($(this).addClass("ignoreValidation"),$(this).siblings("label").removeClass("optionalFilledLabel")):$(this).siblings("label").addClass("optionalFilledLabel")}),$(".detail-tech-modal .nav").slick({mobileFirst:!0,slidesToShow:2.5,arrows:!1,infinite:!1,responsive:[{breakpoint:1e3,settings:"unslick"}]}),$(".square").each(function(){var e=$(this).outerWidth();$(this).css("height",e+"px"),$(e).empty()}),1==$("#landing-menu").length&&$(".anchor-btn-space").on("click",function(e){e.preventDefault();var t=$(this).data("href"),r=($("#"+t).position().top,80);if($(".anchor-btn-space").removeClass("active"),$(window).width()<992&&(r=40),$(this).addClass("active"),$("html,body").animate({scrollTop:$("#"+t).offset().top-r},"slow"),$(window).width()<992){var a=$(this).parents(".slick-slide").data("slick-index"),i=$("#landing-menu").slick("slickCurrentSlide");i<a?setTimeout(function(){$("#landing-menu").slick("slickNext"),$(".anchor-btn-space").removeClass("active"),$("#landing-menu .slick-current .anchor-btn-space").addClass("active")},600):i>a&&setTimeout(function(){$("#landing-menu").slick("slickPrev"),$(".anchor-btn-space").removeClass("active"),$("#landing-menu .slick-current .anchor-btn-space").addClass("active")},600)}}),$("#landing-video-wrapper .overlay-bkg-video").on(eventclick,function(e){e.preventDefault(),$(".stop").hasClass("play")?playVideo():(middleActionVideo(),stopVideo())}),$("#landing-video-wrapper .stop").on(eventclick,function(e){e.preventDefault(),$(".stop").hasClass("play")?playVideo():(middleActionVideo(),setTimeout(function(){stopVideo()},500))}),$("#landing-video-wrapper .audio").on("click",function(){$("#landing-video-wrapper video").prop("muted")?($("#landing-video-wrapper video").prop("muted",!1),$(this).removeClass("muted")):($("#landing-video-wrapper video").prop("muted",!0),$(this).addClass("muted"))});var p=null;($("#landing-video-wrapper .overlay-bkg-video").mousemove(function(e){$(".stop").hasClass("play")||(middleActionVideo(),clearTimeout(p),p=setTimeout(function(){$("#landing-video-wrapper .stop.play-ing").is(":hover")?middleActionVideo():$(".stop").removeClass("play-ing")},50))}),$('[data-toggle="tooltip"]').tooltip(),$('input[name="methodofPayment"]').length>0&&($("ccform.guest").length>0&&setTimeout(function(){$(".ccform.guest").collapse("show")},2e3),$('input[name="methodofPayment"]').on("change",function(){var e=$(this).val();"paypal"==e||"scalapay"==e||"satispay"==e?$(".ccform").collapse("hide"):$(".ccform").collapse("show")})),$('.main-style-tab a[data-toggle="tab"]').on("shown.bs.tab",function(e){openTechInfobox()}),$('[aria-labelledby="services-btn"] .single-service .banner').on("click",function(){$(".overlay-bkg").removeClass("active"),setTimeout(function(){$('[aria-labelledby="services-btn"]').removeAttr("style")},150),$('[aria-labelledby="services-btn"]').css("display","none")}),$(".addressWrapGen").length>0&&$(window).width()<992&&$("#modify-payment-modal").length<=0&&($(".addressWrapGen").hasClass("noslick")||$(".addressWrapGen").slick({slidesToShow:1.1,arrows:!1,infinite:!1})),$("body").click(function(){$(".closeOnClick").hide(),$(".openOnclick").show()}),$("#price_display .partial-quantity-wrapper .underline-btn").on("click",function(e){e.preventDefault();var t=$(this).attr("href");$(t).position().top;$("html,body").animate({scrollTop:$(t).offset().top-120},"slow")}),$(".detail-tech-modal").hasClass("pdp-tech-content"))&&(technologyModalTrigger($(".detail-tech-modal .nav-item:first-of-type").data("idmodal")),$(".detail-tech-modal .nav-item").on("click",function(){technologyModalTrigger($(this).data("idmodal"))}));$(".detail-tech-modal").hasClass("pdp-tech-single-content")&&technologyModalTrigger($(".detail-tech-modal div").find("[aria-labelledby]").attr("aria-labelledby"));$(".detail-tech-modal").hasClass("single-page-modal")&&(technologyModalTrigger($(".detail-tech-modal").attr("aria-labelledby")),$(".detail-tech-modal").modal());if($("#loginFormActivate").click(function(e){e.stopPropagation()}),$("button.collapsible-btn").on("click",function(){$(this).hasClass("close-btn")&&$(".fixed-btn.collapsible-btn").removeClass("active"),event.stopPropagation()}),$("div.collapsible-btn").on("click",function(){$(".fixed-btn").hasClass("active")||$(this).addClass("active")}),$(window).width()<1e3&&($(".our-offer").length>0&&$(".our-offer .slick-mobile").slick({arrows:!1,infinite:!1,slidesToShow:1.1,dots:!0}),$(".our-brands").length>0&&$(".our-brands .slick-mobile").slick({arrows:!1,infinite:!1,rows:2,slidesPerRow:2,dots:!0}),$("#detail-tech-modal.pdp-tech-content .slick-slide").on("click",function(){var e=$(this).find(".nav-item").attr("id"),t=$('#main-style-tab-body .tab-pane[aria-labelledby = "'+e+'"] .box-info-tech');setTimeout(function(){$(t).addClass("opened"),$(t).find(".mydiv").hide(),$(t).find(".open-info-tech").show()},200)}),$("#store-select-modal #store-locator-search-place").on("click",function(){setTimeout(function(){$("#store-select-modal .store-col").getNiceScroll().remove()},500)}),$("#store-select-modal #use-my-location").on("click",function(){setTimeout(function(){$("#store-select-modal .store-col").getNiceScroll().remove()},500)}),checkCvvMob(),$("#cvv").on("input",function(){checkCvvMob()}),$("#cvv").on("focusout",function(){checkCvvMob()}),$(".search-tabs .nav-item").on("click",function(){$(".filter-mobile-modal").modal("hide")}),$(".detail-tech-modal .main-style-tab a").on("click",function(e){e.preventDefault(),$(".detail-tech-modal .main-style-tab a").removeClass("active"),$(this).tab("show")}),$("#landing-menu").slick({mobileFirst:!0,slidesToShow:2.5,arrows:!1,infinite:!1,centerMode:!0,variableWidth:!0,responsive:[{breakpoint:1e3,settings:"unslick"}]})),$(window).width()<450&&($("#product-filter-toggle").on("click",function(){$("html").addClass("modal-open"),$("#page").addClass("modal-open")}),$('.filter-mobile-modal [data-dismiss="modal"]').on("click",function(){$("html").removeClass("modal-open"),$("#page").removeClass("modal-open")})),basicSelectLabel(),setTimeout(function(){initCookieLawLayer()},3e3),$(".lens-option").length>0&&basicSelectLabel(".lens-option select"),$(".lens-delivery").length>0&&basicSelectLabel(".lens-delivery select"),$(".lens-quantity").length>0&&basicSelectLabel(".lens-quantity select"),$("#acc-quantity-select").length>0&&basicSelectLabel("#acc-quantity-select"),$(".overlay-bkg-video").length>0)var m=$(".overlay-bkg-video").offset().top,h=$(".overlay-bkg-video").height(),g=$("#headerWrapper #headerRow2").height();if($("input#Checkout").length>0){var f=$("input#Checkout").offset().top;$("input#Checkout").outerHeight()}if($(v).length<=0&&$("#home-carousel").length>0)var v=$("#home-carousel").offset().top+$("#home-carousel").outerHeight();if($(".dash-buttons").length>0)var C=$(".dash-buttons").offset().top;$(window).scroll(function(){var e=$(window).scrollTop(),t=e+$(window).height();if($(".baet-hp-wrapper").length>0&&$(".fixed-btn.show").length<=0&&t>v&&$(".fixed-btn").addClass("show"),$("#landing-video-wrapper").length>0){var r=$("#video-anchor").offset().top+$("#video-anchor").outerHeight(),a=$("#landing-video-wrapper").position().top+$("#landing-video-wrapper").outerHeight()+20,o=$(window).scrollTop()+$(window).height();r>a&&($("#video-anchor").addClass("static"),$("#video-anchor").removeClass("sticky")),o<a&&($("#video-anchor").removeClass("static"),$("#video-anchor").addClass("sticky")),e>=m+h-g&&stopVideo()}if($("input#Checkout").length>0&&$(window).width()<1e3&&(t<f?$("input#Checkout").parent().hasClass("sticky-bar")||$("input#Checkout").parent().hasClass("sticky-bar-with-bottom")||($("#paypal-button-container").length?$("input#Checkout").wrap('<div class="sticky-bar sticky-bar-with-bottom"></div>'):$("input#Checkout").wrap('<div class="sticky-bar"></div>'),$(".paypal-button-container-container").addClass("sticky-bar sticky-bar-ppl"),$("#promotions").css("margin-top","80px")):($("input#Checkout").parent().hasClass("sticky-bar")||$("input#Checkout").parent().hasClass("sticky-bar-with-bottom"))&&($("input#Checkout").unwrap(),$(".paypal-button-container-container").removeClass("sticky-bar sticky-bar-ppl"),$("#promotions").removeAttr("style"))),$(".sidebar .shopperActions").length>0){let t=e+$(window).height(),r=$(".sidebar .shopperActions-wrapper").offset().top+30;t<r?$(".sidebar .shopperActions").addClass("sticky-ing"):t>=r&&$(".sidebar .shopperActions.sticky-ing")&&$(".sidebar .shopperActions").removeClass("sticky-ing")}if($("#landing-menu").length>0){var n=u-g;if(e>=n&&e<=n+g){var l=$("#landing-menu").height();$("#landing-video-wrapper").css("margin-bottom",l),$("#landing-menu").css({position:"fixed",top:u-e,"z-index":990,margin:0}),$("#headerRow2").css({transform:"translateY("+(u-e-g)+"px)"}),$("#headerRow2 .navbar").css("box-shadow","none")}else e<n?($("#headerRow2").css("transform","initial"),$("#landing-menu").css({position:"relative",top:"0","box-shadow":"none","z-index":0}),$("#landing-video-wrapper").removeAttr("style")):e>2*g+u&&($("#headerRow2").css("transform","translateY(-"+g+"px)"),$("#headerRow2 .navbar").css("box-shadow","none"),$("#landing-menu").css({position:"fixed",top:"0","z-index":1e3}),$("#landing-menu").css("box-shadow","0 1px 3px 0 rgba(0, 0, 0, 0.25)"));s.each(function(){var t=$(this).offset().top-d,r=t+$(this).outerHeight();if(e>=t&&e<=r&&(c.removeClass("active"),s.parents(".col-12").attr("data-slot-id").length>0)){var a=$(this).attr("data-scroll");$('#landing-menu .col-lg-3 button[data-href="'+a+'"]').addClass("active"),currgoto=a;var i=$('#landing-menu .col-lg-3 button[data-href="'+a+'"]').parents(".col-lg-3"),o=$("#landing-menu .col-lg-3").index(i);$(window).width()<992&&setTimeout(function(){$("#landing-menu").slick("slickGoTo",o)},600)}})}var p=e+$("#headerWrapper").height();$(".dash-buttons").length>0&&$(window).width()<992&&(p>C?($(".dash-buttons").addClass("sticky"),$(".dash-buttons").parent().css("height",$(".dash-buttons").height()+"px"),$(".dash-buttons").css("top",i+"px")):($(".dash-buttons").removeClass("sticky"),$(".dash-buttons").parent().removeAttr("style")))}),$(".benefit-wrapper .btn-trigger-sidebar").on("click",function(){$(".sidebar-benefits").toggleClass("open")}),$(".content-border-btn").on("click",function(){var e=$(this).data("target"),t=$(e).data("parent");$("#"+t+" .content-accordion").removeClass("active"),$("#"+t+" .content-border-btn").removeClass("active"),$(e).toggleClass("active")}),$(".sidebar-benefits .close-btn").on("click",function(){$(".sidebar-benefits").removeClass("open")}),$("#suggested-productsLC").slick({dots:!0,arrows:!0,infinite:!0,slidesToScroll:2,speed:300,slidesToShow:2,variableWidth:!1,responsive:[{breakpoint:1e3,settings:{slidesToShow:1,slidesToScroll:1,dots:!1}}]}),$("#new-arrivalCL").slick({dots:!0,arrows:!0,infinite:!0,slidesToScroll:1,speed:300,slidesToShow:2,variableWidth:!1,responsive:[{breakpoint:1e3,settings:{slidesToShow:1,slidesToScroll:1,dots:!1}}]}),$(".musthave-carousel").slick({dots:!1,arrows:!0,infinite:!0,slidesToScroll:1,speed:300,slidesToShow:3,variableWidth:!1,responsive:[{breakpoint:1e3,settings:{slidesToShow:2,slidesToScroll:2,dots:!1,arrows:!0}},{breakpoint:450,settings:{slidesToShow:1,slidesToScroll:1,dots:!1,arrows:!0}}]}),$(".partial-quantity-wrapper select").on("change",function(){var e=$(this),t=e.attr("id");$("#"+t+" + div").removeClass("red-border").removeClass("blue-border"),$prescription=e.closest(".prescription-table"),$prescription.find("[name='allOd']").is(":checked")&&-1===t.indexOf("left")&&-1===t.indexOf("boxes")&&($("#"+t.replace("right","left")).val(e.val()).trigger("change"),$("#"+t.replace("right","left")+" + div").text(e.val()),$("#"+t.replace("right","left")+" + div + ul li").removeClass("active"),$("#"+t.replace("right","left")+" + div + ul li[rel='"+e.val()+"']").addClass("active")),calculateTotal($prescription)}),$(".prescription-wrapper select").on("change",function(){var e=$(this),t=e.attr("id");$("#contactLensesCarousel").hasClass("slick-initiliazed")&&$("#contactLensesCarousel").slick("slickGoTo",2),$("#"+t+" + div").removeClass("red-border").removeClass("blue-border"),$prescription=e.closest(".prescription-table");let r=$prescription.find("[name='allOd']").is(":checked");r&&-1===t.indexOf("right")&&-1===t.indexOf("boxes")&&($("#"+t.replace("left","right")+" + div").text(e.val()),$("#"+t.replace("left","right")+" + div + ul li").removeClass("active"),$("#"+t.replace("left","right")+" + div + ul li[rel='"+e.val()+"']").addClass("active")),calculateTotal($prescription);var a=e.closest(".prescription-wrapper").data("prescription"),i=e.attr("id").substring(0,e.attr("id").indexOf("-")),o=$("#"+i+"-item_"+a),n=$prescription.find("select[id^="+i+"]"),s=!0;if(n.each(function(){var e=$(this);"--"!==e.val()&&""!==e.val()||(s=!1),-1!==e.attr("id").indexOf("boxes")&&"0"===e.val()&&(s=!1)}),s){let e=function(t,n){let s=cartJS.toJson(t);if(s&&s.response&&void 0!==s.response.catentryId&&productDisplayJS.validateResponsePrescription(i,s)){let e=s.response.catentryId,t=s.response.partNumber;r?($("#left-item_"+a).val(e),$("#left-item_"+a).attr("data-partnumber",t),$("#right-item_"+a).val(e),$("#right-item_"+a).attr("data-partnumber",t)):(o.val(e),o.attr("data-partnumber",t)),productDisplayJS.changeStatusAddToCartBtn(!0),productDisplayJS.ValidatePrescriptionContactLenses("prescription-wrapper_1",!1)?($(".addPrescriptionFlag").addClass("d-none"),$(".prescription-not-available-error").addClass("d-none"),$(".addToCartFlag").removeClass("d-none")):($(".addPrescriptionFlag").removeClass("d-none"),$(".prescription-not-available-error").addClass("d-none"),$(".addToCartFlag").addClass("d-none"))}else s?s&&s.response&&void 0===s.response.catentryId?($(".addPrescriptionFlag").removeClass("d-none"),$(".prescription-not-available-error").removeClass("d-none"),$(".addToCartFlag").addClass("d-none"),productDisplayJS.changeStatusAddToCartBtn(!0)):productDisplayJS.changeStatusAddToCartBtn(!0):(setTimeout(function(){n?productDisplayJS.changeStatusAddToCartBtn(!0):productDisplayJS.checkPrescriptionValid(i,function(t){e(t,!0)})},500),o.val(""));productDisplayJS.refreshShippingDateCL()};productDisplayJS.changeStatusAddToCartBtn(!1),productDisplayJS.checkPrescriptionValid(i,function(t){e(t,!1)})}else o.val("");""===o.val()?e.closest("tr").removeClass("complete"):e.closest("tr").addClass("complete")}),$(".partial-quantity-wrapper input[name=purchaseType]").on("change",function(){productDisplayJS.resetAccessoryAddToCart(),calculateTotal()}),switchTab(1,$("#cl-tab-daily")),productDisplayJS.prepopulatePrescription(),productDisplayJS.initCLPricePromotion(),$("#newAddressForm #cap1").keyup(function(){getCityAndProvinceFromZipCode($(this).val(),"1")}),$("#cap2").keyup(function(){getCityAndProvinceFromZipCode($(this).val(),"2")}),analyticsCompilationJS(),null==zipString&&$.ajax({url:"/wcsstore/SalmoiraghiStorefrontAssetStore/javascript/cap-odd-eligible.json",type:"GET",success:function(e){e&&(zipString=JSON.parse(e))}}),null==framesLeadTime&&$.ajax({url:"/wcsstore/SalmoiraghiStorefrontAssetStore/javascript/frames-leadtime.json",type:"GET",success:function(e){e&&(framesLeadTime=JSON.parse(e))}}),$(window).width()<=992&&$(".address-autofill-input").length>0&&$(".address-autofill-input input").on("focus",function(e){var t=e.target,r=$(t).offset().top-50;setTimeout(()=>window.scrollTo(0,r),50)})}),$(window).on("resize",function(){if($(window).width()<=1200&&$(".menuProfile").length>0&&0==$("#sv-accountmenu-mobile").length){$(".menuProfile .sv-accountmenu").wrap('<div class="collapse" id="sv-accountmenu-mobile"></div>');var e=$(".menuProfile .sv-accountmenu").find("li.active a").html();$("#sv-accountmenu-mobile-btn").html(e)}else $(window).width()>1200&&$(".menuProfile").length>0&&$("#sv-accountmenu-mobile").length>0&&($(".menuProfile .sv-accountmenu").unwrap(),$("#sv-accountmenu-mobile-btn").empty())}),window.switchCartOpen=!1,Date.prototype.toShortFormat=function(){return`${this.getDate()} ${["gennaio","febbraio","marzo","aprile","maggio","giugno","luglio","agosto","settembre","ottobre","novembre","dicembre"][this.getMonth()]} ${this.getFullYear()}`},Date.prototype.toDDMMYYYY=function(e="-"){let t=this.getDate(),r=this.getMonth()+1;return t<10&&(t="0"+t),r<10&&(r="0"+r),t+e+r+e+this.getFullYear()},String.prototype.toCapitalize=function(){let e=this.split(" "),t="";return $.each(e,function(e,r){t+=r.charAt(0).toUpperCase()+r.substring(1).toLowerCase()+" "}),t.trim()};var validator,zipString=null,framesLeadTime=null,forbiddenZipCode=null,allowedZipCode=null;function getCapJson(e){return zipString.includes(e.toString())}function lockDownloadImg(){$("img").each(function(){0==$(this).parents(".single-prod").length&&$(this).bind("contextmenu",function(){return!1})})}function getCityAndProvinceFromZipCode(e,t){if(e.match(/^\d{5}$/)){var r=r||new google.maps.Geocoder;r.geocode({address:e,componentRestrictions:{country:"IT"}},function(e,r){if(r!==google.maps.GeocoderStatus.OK)return!1;var a={administrative_area_level_2:"stateName",administrative_area_level_3:"civilCity",locality:"cityName",country:"countryName"},i={};$.each(e[0].address_components,function(e,t){switch(a[t.types[0]]){case"stateName":i.stateName=t.short_name;break;case"civilCity":i.civilCity=t.long_name;break;case"cityName":i.cityName=t.long_name;break;case"countryName":i.countryName=t.short_name;break;case"streetNumber":i.streetNumber=t.short_name;break;case"addressLineOne":i.addressLineOne=t.long_name;break;case"zipcode":i.zipcode=t.short_name}}),console.log(i),i.civilCity&&$("#city"+t).val(i.civilCity),i.stateName&&selectize_setVal("province"+t,i.stateName),i.countryName&&$("#nazione"+t).length>0&&selectize_setVal("nazione"+t,i.countryName)})}}function updateScalapayWidgetAmount(e,t){let r=$(e),a=""!=t&&!isNaN(t)&&null!=t;r&&a&&r.attr("amount",t)}function initScalaPayWidgetGraphic(){$(".scalapay-widget").length>0&&$("scalapay-widget").each(function(){if($(this).hasClass("is-initialized"))return;const e=this.shadowRoot,t=document.createElement("style");t.innerHTML='.sp-container{position:relative;display:inline-flex!important;align-items:center;justify-content:flex-start;width:auto}.sp-container .sp--nowrap{color:#303030;display:inline-block;padding-right:3px}.checkout-widget.sp-container:before{content:"";position:absolute;top:auto;bottom:3px;left:0;display:block;width:calc(100% - 97px);height:1px;background-color:#303030}.sp-icon{line-height:1;font-size:0px;margin-left:2px;width:14px;height:14px;position:relative}.sp-icon svg{width: 14px;height: 14px;}.sp-logo svg{width:67px}.sp-logo{bottom:0!important}.checkout-widget .sp-link{border-radius:50px;background:linear-gradient(107.48deg, #F7CBCF 26.11%, #FBE8E9 92.87%);padding:3px 6px;display:flex;align-items:center;justify-content:flex-start;margin-left:10px;height:auto}.sp-button{padding-left:4px;display:flex;align-items:center;justify-content:flex-start;margin-left:0;height:auto;width:14px}.sp-price{font-weight:400;color:#303030!important}.sp-button .sp-link{height:15px;}.sp-link{bottom:0;margin-left:5px}.checkout-widget .sp-logo svg{width:52px;height:auto}.sp-container.checkout-widget{font-size:12px}@media screen and (min-width:992px){.sp-container{font-size:14px;white-space:nowrap;color:#303030;letter-spacing:.5px}.sp-container.checkout-widget{margin-left:-2px;flex-wrap:nowrap;letter-spacing:0}.checkout-widget .sp-button{padding-left:4px; width:14px}.checkout-widget.sp-container:before{width:calc(100% - 97px)}}',e.appendChild(t),$(e).find("#sp-icon").wrap("<div class='sp-button' data-element-id='X_X_Prod_ScalaPay'></div>");const r=$(e).find(".sp-button");r.prepend(r.prev()),$(".sv-cart-detail-summary").length>0&&$(e).find(".sp-container").addClass("checkout-widget"),$(this).addClass("is-initialized"),$(e).find("#sp-logo").html('<svg width="127px" height="25px" viewBox="0 0 127 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><path d="M0.285911156,8.72733552 L4.1303487,4.76243596 C4.52003466,4.36053954 5.16173897,4.350641 5.5636354,4.74032696 C5.57111829,4.74758251 5.57848884,4.75495306 5.58574439,4.76243596 L8.53395546,7.80302654 C8.9236414,8.20492296 9.56534566,8.2148215 9.96724214,7.82513553 C9.97472506,7.81787998 9.98209554,7.81050944 9.98935109,7.80302654 L12.8532172,4.84942377 C13.2429032,4.44752734 13.8846075,4.43762881 14.2865039,4.82731478 C14.2939869,4.83457033 14.3013573,4.84194087 14.3086129,4.84942377 L18.1393956,8.80024049 C18.5063996,9.17874435 18.5219645,9.77539288 18.1751945,10.172517 L10.0132484,19.5196515 C9.64504689,19.9413191 9.00473158,19.984662 8.58306395,19.6164606 C8.54881086,19.5865507 8.51660945,19.5543697 8.48667778,19.5201356 L0.250535218,10.1000961 C-0.0966491375,9.70300605 -0.0812647624,9.10601655 0.285911156,8.72733552 Z M22.4934623,16.5549255 L24.0296061,14.2043788 C24.8342527,14.9626197 26.0777977,15.4175642 27.2725761,15.4175642 C28.1259893,15.4175642 28.7843365,14.9878944 28.7843365,14.3813016 C28.7843365,12.5362489 23.0542768,13.193391 23.0542768,9.25053851 C23.0542768,6.89999184 25.2487677,5.4340595 27.5895581,5.4340595 C29.1257018,5.4340595 30.8081448,6.04065219 31.5884083,6.67251958 L30.1010311,9.04834093 C29.4914503,8.5933964 28.6868036,8.214276 27.8333905,8.214276 C26.955594,8.214276 26.2240971,8.56812171 26.2240971,9.19998914 C26.2240971,10.7922949 31.9541568,10.1604276 31.9541568,14.4065764 C31.9541568,16.757123 29.7352827,18.1977807 27.2481928,18.1977807 C25.6145162,18.1977807 23.8833067,17.6164626 22.4934623,16.5549255 Z M43.1704441,13.5472367 L45.6087674,15.4428389 C44.2189231,17.3637157 42.4633304,18.1977807 40.2444562,18.1977807 C36.5869711,18.1977807 33.9048155,15.3670148 33.9048155,11.8285574 C33.9048155,8.26482539 36.6601208,5.4340595 40.2688394,5.4340595 C42.317031,5.4340595 44.1457734,6.41977263 45.243019,7.88570496 L42.9997615,9.93295531 C42.3657974,9.07361562 41.4148513,8.46702297 40.2688394,8.46702297 C38.4400969,8.46702297 37.0746359,9.95823 37.0746359,11.8285574 C37.0746359,13.7494343 38.4157136,15.1648173 40.3419891,15.1648173 C41.6343005,15.1648173 42.6583962,14.3560269 43.1704441,13.5472367 Z M56.2154739,13.6483355 L56.2154739,9.98350468 C55.5571266,9.07361562 54.5086476,8.46702297 53.2894859,8.46702297 C51.4363602,8.46702297 50.2415818,10.0593287 50.2415818,11.8285574 C50.2415818,13.7494343 51.5826596,15.1648173 53.3626356,15.1648173 C54.557414,15.1648173 55.605893,14.5582245 56.2154739,13.6483355 Z M59.3852942,5.68680646 L59.3852942,17.9450337 L56.3373901,17.9450337 L56.3373901,16.9593206 C55.3620607,17.8186602 54.240432,18.1977807 53.0456536,18.1977807 C51.2900608,18.1977807 49.6320009,17.3889905 48.5835219,16.1252556 C47.656959,15.0131691 47.0717615,13.4966873 47.0717615,11.8285574 C47.0717615,8.214276 49.6563842,5.4340595 52.8749709,5.4340595 C54.2160488,5.4340595 55.4108272,5.88900402 56.3373901,6.67251958 L56.3373901,5.68680646 L59.3852942,5.68680646 Z M66.2125995,0 L66.2125995,17.9450337 L63.0427792,17.9450337 L63.0427792,0 L66.2125995,0 Z M78.0384676,13.6483355 L78.0384676,9.98350468 C77.3801203,9.07361562 76.3316413,8.46702297 75.1124797,8.46702297 C73.2593539,8.46702297 72.0645755,10.0593287 72.0645755,11.8285574 C72.0645755,13.7494343 73.4056533,15.1648173 75.1856294,15.1648173 C76.3804078,15.1648173 77.4288868,14.5582245 78.0384676,13.6483355 Z M81.2082879,5.68680646 L81.2082879,17.9450337 L78.1603838,17.9450337 L78.1603838,16.9593206 C77.1850544,17.8186602 76.0634257,18.1977807 74.8686473,18.1977807 C73.1130545,18.1977807 71.4549947,17.3889905 70.4065156,16.1252556 C69.4799528,15.0131691 68.8947552,13.4966873 68.8947552,11.8285574 C68.8947552,8.214276 71.4793779,5.4340595 74.6979647,5.4340595 C76.0390425,5.4340595 77.233821,5.88900402 78.1603838,6.67251958 L78.1603838,5.68680646 L81.2082879,5.68680646 Z M84.8657728,24.0109606 L84.8657728,5.68680646 L87.9136768,5.68680646 L87.9136768,6.67251958 C88.8402403,5.88900402 90.0350182,5.4340595 91.3760964,5.4340595 C94.5946833,5.4340595 97.1793056,8.214276 97.1793056,11.8285574 C97.1793056,13.4966873 96.6184915,15.0131691 95.6919289,16.1252556 C94.6434495,17.3889905 92.9610063,18.1977807 91.2054135,18.1977807 C90.0106355,18.1977807 88.9865397,17.8439349 88.0355936,17.0856941 L88.0355936,24.0109606 L84.8657728,24.0109606 Z M88.0355936,9.98350468 L88.0355936,13.6483355 C88.6451739,14.5582245 89.6936532,15.1648173 90.8884311,15.1648173 C92.6684075,15.1648173 94.0094857,13.7494343 94.0094857,11.8285574 C94.0094857,10.0593287 92.8147069,8.46702297 90.9615808,8.46702297 C89.7424194,8.46702297 88.6939409,9.07361562 88.0355936,9.98350468 Z M108.273677,13.6483355 L108.273677,9.98350468 C107.61533,9.07361562 106.56685,8.46702297 105.347689,8.46702297 C103.494563,8.46702297 102.299785,10.0593287 102.299785,11.8285574 C102.299785,13.7494343 103.640862,15.1648173 105.420838,15.1648173 C106.615617,15.1648173 107.664096,14.5582245 108.273677,13.6483355 Z M111.443497,5.68680646 L111.443497,17.9450337 L108.395593,17.9450337 L108.395593,16.9593206 C107.420264,17.8186602 106.298635,18.1977807 105.103856,18.1977807 C103.348263,18.1977807 101.690204,17.3889905 100.641725,16.1252556 C99.7151617,15.0131691 99.1299641,13.4966873 99.1299641,11.8285574 C99.1299641,8.214276 101.714587,5.4340595 104.933174,5.4340595 C106.274251,5.4340595 107.46903,5.88900402 108.395593,6.67251958 L108.395593,5.68680646 L111.443497,5.68680646 Z M118.856,24.0109606 L115.53988,24.0109606 L118.807233,16.7065737 L113.516072,5.68680646 L117.002874,5.68680646 L120.465294,13.0417428 L123.659497,5.68680646 L127,5.68680646 L118.856,24.0109606 Z" id="Combined-Shape" fill="#000000" fill-rule="nonzero"></path></g></svg>'),$("#sticky-shopper .scalapay-widget-pdp").each(function(){let e=this.shadowRoot,t=$(e).find(".sp-container").get(0),r=$(t).find(".sp-button").get(0);$(r).attr("data-element-id","X_X_Stickybar_ScalaPay")}),$("#sticky-shopper #add2CartBtn").attr("data-element-id","X_X_StickyBar_AddCart")}),scalapayAnalyticsSetter()}function scalapayAnalyticsSetter(){setTimeout(function(){$(".scalapay-widget").length>0&&($(".sp_modal__container").each(function(){$(this).attr("data-element-id","X_X_Prod_ScalaPay")}),$(".sp_modal__close").each(function(){$(this).attr("data-analytics_available_call","0")}))},4e3)}function addDaysToDate(e,t,r){let a=null;if("[object Date]"===Object.prototype.toString.call(e)){let i=isSatOrSun(a=e);if(r){let e=0;for(;e<t;)a.setDate(a.getDate()+1),a.getDay()>0&&a.getDay()<=5&&e++;i&&a.setDate(a.getDate()+1)}else a.setDate(a.getDate()+t)}return a}function isSatOrSun(e){return e.getDay()>5||0==e.getDay()}function round(e,t){var r=Math.pow(10,t||0);return Math.round(e*r)/r}function ajaxResponseToJson(e){var t;e=e.replace(/^\/\*/,"").replace(/\*\/$/,"");try{t=JSON.parse(e)}catch(e){return null}return t}function resetScroll(e){let t=$(e).attr("data-target");$(t).find(".scrollable-div").scrollTop(0)}function toggleSubmenu(e){let t=$(e),r=$(e).attr("id"),a=t.parent();var i;$(".nav-item.dropdown.show").length>0?$(".nav-item.dropdown").each(function(){if($(this).hasClass("show"))return i=$(this).find("button").attr("id"),$(this).removeClass("show"),r==i?($(".overlay-bkg").removeClass("active"),!1):($(a).addClass("show"),!1)}):(a.addClass("show"),$(".overlay-bkg").addClass("active"))}function onSliderWheel(e){var t=e.originalEvent.deltaY,r=$(e.currentTarget),a=r.data("current-slide");t<0&&0==a||t>0&&a==r.data("slider-length")-1||(e.preventDefault(),t<=0?r.slick("slickPrev"):r.slick("slickNext"))}function refreshSizeInfo(){if($(".size-wrapper-container").length>0){$(".frame-sku").text($("#modelCodeDisplay").val()),$(".lens-height").text($("#lensHeight").val()),$(".temple-width").text($("#templeWidth").val()),$(".lens-width").text($("#lensWidth").val()),$(".bridge-width").text($("#bridge").val()),$(".size-description").addClass("d-none");let e=$("#frameSizeDisplay").val();e&&$("#size-description-"+e.toLowerCase()).removeClass("d-none")}}function togglePwd(e){var t=$(e).parent();"password"===$(e).attr("type")?($(e).attr("type","text"),t.addClass("clicked")):($(e).attr("type","password"),t.removeClass("clicked"))}function getProductInfo(e,t){if(!e)return{};"[object Array]"===Object.prototype.toString.call(e)&&(e=e.join(",")),$.ajax({url:"ProductInfoGetterView?storeId=10750&catalogId=12101&upc="+e,type:"GET",success:t,error:function(e){return{}}})}function setCookie(e,t,r){let a;"[object Date]"===Object.prototype.toString.call(r)?a=r:(a=new Date).setTime(a.getTime()+864e5*r),document.cookie=e+"="+t+";path=/;expires="+a.toGMTString()}function getCookie(e){var t=document.cookie.match("(^|;) ?"+encodeURIComponent(e)+"=([^;]*)(;|$)");return t?decodeURIComponent(t[2]):null}function toggleFavorite(e,t){if($(e).hasClass("active"))$(e).removeClass("active"),wishlistJS.removeItem(t);else if($(e).addClass("active"),$(".pwr-selector-wrapper").length>0){let e="";$(".pwr-selector-wrapper .custom-radio .custom-control-input").each(function(r,a){let i=$(a).val();console.log("itemProductId -> "+i),t!=i&&wishlistJS.isProductInWishlist(i)&&(e=i)}),e.length>0?wishlistJS.updateItemWishlist(e,t,"pdp"):wishlistJS.addItem(t)}else wishlistJS.addItem(t);$("#contentWrapper").hasClass("pdp")?("R"!=wishlistJS.currentWishlist(!0).userType?($(".toast-registered").addClass("d-none"),$(".toast-guest").removeClass("d-none"),$("a.toast-guest").removeClass("d-none").addClass("d-inline-block")):($(".toast-guest").addClass("d-none"),$(".toast-registered").removeClass("d-none"),$("a.toast-guest").addClass("d-none").removeClass("d-inline-block")),$(".wishlist-toast").addClass("show"),$(e).hasClass("active")?($("#wishlist-added-product").removeClass("d-none"),$("#wishlist-removed-product").addClass("d-none")):($("#wishlist-removed-product").removeClass("d-none"),$("#wishlist-added-product").addClass("d-none")),setTimeout(function(){closeWishlistToast()},5e3)):$(e).hasClass("active")&&$(".wishlist-toast").length>0&&"R"!=wishlistJS.currentWishlist(!0).userType&&($(".wishlist-toast").addClass("show"),setTimeout(function(){closeWishlistToast()},5e3))}function closeWishlistToast(){$(".wishlist-toast").removeClass("show"),setTimeout(function(){$("#contentWrapper").hasClass("pdp")||$(".wishlist-toast").detach()},1e3)}function closeEditProfileToast(){$(".success-edit-profile-toast").removeClass("show")}function isValidZipCode(e){return!isForbiddenZipCode(e)&&(framesLeadTime[e]||isAllowedZipCode(e))}function isForbiddenZipCode(e){return null==forbiddenZipCode&&(forbiddenZipCode=window.CHECKOUT.CO_ZIPCODE_EXCLUSION.split(",")),-1!=forbiddenZipCode.indexOf(e)}function isAllowedZipCode(e){return null==allowedZipCode&&(allowedZipCode=window.CHECKOUT.CO_ZIPCODE_ALLOWED.split(",")),-1!=allowedZipCode.indexOf(e)}function isExcludedZipCode(e){switch(e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toLowerCase().replace(/[\W_]/g,"")){case"cittadelvaticano":case"campioneditalia":case"livigno":case"sanmarino":return!1;default:return!0}return!0}function getLeadTimeFramesByZipCode(e){let t=3;if(null!=framesLeadTime){let r=framesLeadTime[e];r&&(t=r.leadTime)}return t}function GetURLParameter(e){var t=window.location.href.replace("#","").split("?")[1];if(void 0!==t)for(var r=t.split("&"),a=0;a<r.length;a++){var i=r[a].split("=");if(i[0]==e)return i[1]}}function initBillingAddressCheckout(){$(".addressItemWrapBill").length>0&&$(window).width()<992&&$(".addressItemWrapBill").hasClass("slick-initialized")&&($(".addressItemWrapBill").slick("unslick"),$(".addressItemWrapBill").slick({slidesToShow:1.1,arrows:!1,infinite:!1}))}function initComponentToBeValidated(){if($("form.validate").length>0&&$("form.validate").each(function(){initValidator($(this).attr("id"))}),$("#ccNum").length>0)new Cleave("#ccNum",{creditCard:!0,delimiter:"-",onCreditCardTypeChanged:function(e){$("#ccNum").parent("div").attr("data-cc",""),$("#ccNum").data("valid","ko"),"visa"!=e&&"mastercard"!=e&&"amex"!=e||($("#ccNum").data("valid","ok"),$("#ccNum").parent("div").attr("data-cc",e))}});if($("#cvv").length>0)new Cleave("#cvv",{numeral:!0,numeralThousandsGroupStyle:"none",stripLeadingZeroes:!1});if($("#dob").length>0)new Cleave("#dob",{date:!0,delimiter:"/",datePattern:["d","m","Y"]});if($(".dateFormatter").length>0&&$(".dateFormatter").toArray().forEach(function(e){new Cleave(e,{date:!0,delimiter:"/",datePattern:["d","m","Y"]})}),$("[id*='phone']").length>0)new Cleave('[id*="phone"]',{numeral:!0,numeralThousandsGroupStyle:"none",stripLeadingZeroes:!1});$("form select").on("change",function(){var e=$(this).data("error");if(""==$(this).val()||null==$(this).val()||"undefined"==$(this).val())$(this).parents(".select").removeClass("ok").addClass("error"),$(e).show();else{e=$(this).data("error");$(this).parents(".select").removeClass("error").addClass("ok"),$(e).hide()}}),$(".custom-check input").on("click",function(){$(this).removeClass("errormessage");var e=$(this).data("error");$(e).hide()}),$(".custom-checkbox input").on("click",function(){$(this).removeClass("errormessage");var e=$(this).data("error");$(e).hide()}),$("#login-form input#password").length>0&&$("#login-form input#password").trigger("focus"),$("#login-form input#username").length>0&&$("#login-form input#username").trigger("focus"),$("#password1").keyup(function(){var e=this.value;e=e.replace(/\s+/g,"");var t=window.REGEX_PASSWORD_POLICY.REGEX_PASSWORD_POLICY_ALL;t=new RegExp(t);var r=window.REGEX_PASSWORD_POLICY.REGEX_PASSWORD_POLICY_NUM;r=new RegExp(r);var a=window.REGEX_PASSWORD_POLICY.REGEX_PASSWORD_POLICY_SPEC;a=new RegExp(a);var i=window.REGEX_PASSWORD_POLICY.REGEX_PASSWORD_POLICY_CHAR_UP;i=new RegExp(i);var o=window.REGEX_PASSWORD_POLICY.REGEX_PASSWORD_POLICY_CHAR_LOW;o=new RegExp(o),e.match(t)?($("#password-valid-message").removeClass("d-none"),$("#password-valid-message").addClass("d-block"),$("#password-error-message").addClass("d-none"),$("#password-error-message").removeClass("d-block"),$("#password-min-char").addClass("checked"),$("#password-upp-char").addClass("checked"),$("#password-low-char").addClass("checked"),$("#password-num").addClass("checked"),$("#password-special-char").addClass("checked")):($("#password-valid-message").addClass("d-none"),$("#password-valid-message").removeClass("d-block"),$("#password-error-message").removeClass("d-none"),$("#password-error-message").addClass("d-block"),e.length>7?$("#password-min-char").addClass("checked"):$("#password-min-char").removeClass("checked"),e.match(r)?$("#password-num").addClass("checked"):$("#password-num").removeClass("checked"),e.match(a)?$("#password-special-char").addClass("checked"):$("#password-special-char").removeClass("checked"),e.match(i)?$("#password-upp-char").addClass("checked"):$("#password-upp-char").removeClass("checked"),e.match(o)?$("#password-low-char").addClass("checked"):$("#password-low-char").removeClass("checked"))})}function initValidator(e){$.validator.setDefaults({errorElement:"div",validClass:"ok",errorClass:"errormessage",ignore:":hidden:not(.select-hidden):not(.selectize), .ignoreValidation",rules:{privacyok:{required:!0},agecheck:{required:!0}},errorPlacement:function(e,t){var r=$(t).data("error");r||$(t).closest(".select").addClass("errorDiv"),$(t).parent("div").addClass("errorDiv"),r?$(r).html($(e).html()).show():e.insertAfter(t).show()},onkeyup:function(e){var t=$(e).data("error");$(e).parent("div").removeClass("errorDiv").removeClass("ok"),$(e).closest(".select").removeClass("errorDiv").removeClass("ok"),$(t).empty().hide();validator.numberOfInvalids()},unhighlight:function(e){var t=$(e).attr("id");validator.check("#"+t)&&($(e).removeClass("errorDiv"),$(e).parent("div").removeClass("errorDiv").addClass("ok"),$(e).closest(".select").removeClass("errorDiv").removeClass("ok"))}}),validator=jQuery("#"+e).validate()}function initBaetDatepicker(){$("#daypicker-carousel").slick({dots:!1,infinite:!1,speed:300,slidesToShow:7,slidesToScroll:7,responsive:[{breakpoint:900,settings:{slidesToShow:2.9,slidesToScroll:3,infinite:!1,dots:!1,arrows:!1}}]})}function nativeEventFire(e,t){if(e.fireEvent)e.fireEvent("on"+t);else{var r=document.createEvent("Events");r.initEvent(t,!0,!1),e.dispatchEvent(r)}}function setPrimaryAddress(e,t,r,a){if(e!=window["addressPrimaryId"+a]){var i={addressId:e,primary:"true"};$.post("AjaxPersonChangeServiceAddressUpdate",i,function(i){var o=cartJS.toJson(i);if(null!=o&&null!=o.addressId&&o.addressId.length>0){$(".address-delete-button-"+a).show(),$(t).parents(".addressItem").find(".address-delete-button-"+a).hide();var n=o.addressId[0],s=$(t).attr("onclick").replace(e,n);$(t).attr("onclick",s),window["addressPrimaryId"+a]=n,$(t).parent().next().find("a").each(function(t,r){var a=r.href.replace(e,n);r.href=a}),toggleNotNew(t,r)}else alert("Si è verificato un errore provando a cambiare l'indirizzo principale. Si prega di riprovare.")}).fail(function(){alert("Si è verificato un errore provando a cambiare l'indirizzo principale. Si prega di riprovare.")})}}function setPrimaryPayment(e,t,r,a,i,o,n){if(r!=window.paymentPrimarySuffix){var s="responseFormat=json&authToken="+n+"&storeId="+a+"&catalogId="+i+"&langId="+o;null!=window.paymentPrimarySuffix&&window.paymentPrimarySuffix.length>0&&(s+="&pay_primary#"+window.paymentPrimarySuffix+"=false"),s+="&pay_primary#"+r+"=true",$("#payment-ajax-error-message").hide(),$.ajax({url:getAbsoluteURL()+"AjaxPersonChangeServiceCheckoutProfileUpdate",type:"POST",data:s,success:function(a){window.paymentPrimarySuffix=r,$(".payment-delete-button").show(),$(e).parents(".addressItem").find(".payment-delete-button").hide(),toggleNotNew(e,t)},error:function(e,t,r){$("#payment-ajax-error-message").text("Si è verificato un errore provando a cambiare il metodo di pagamento principale. Si prega di riprovare."),$("#payment-ajax-error-message").show()}})}}function deletePayment(e,t,r,a,i){return $("#payment-ajax-error-message").hide(),$.ajax({url:getAbsoluteURL()+"AjaxPersonChangeServiceCheckoutProfileUpdate",type:"POST",data:"pay_ordPayInfoNameSuffix=#"+e+"&responseFormat=json&authToken="+i+"&storeId="+t+"&catalogId="+r+"&langId="+a,success:function(e){location.reload()},error:function(e,t,r){$("#payment-ajax-error-message").text(r),$("#payment-ajax-error-message").show()}}),!1}function fidelityCardShowForm(){return $("#fidelity-card-box-intro").hide(),$("#fidelity-card-box-form").show(),!1}function myAccountFidelityCardCall(){$("#fidelityCardErrorMessageBox").hide();var e=$("#fidelityStoreId").val(),t={};t.storeId=e,t.catalogId=$("#fidelityCatalogId").val(),t.langId=$("#fidelityLangId").val(),t["FidelityCardNumber_"+e+"_a_null"]=$("#userFidelityCardNumber").val(),t["FidelityCardSurname_"+e+"_a_null"]=$("#userFidelityCardSurname").val(),t.requesttype="ajax",$.ajax({url:"AjaxUserFidelityCardRetrieveCmd",data:t,method:"POST",success:function(e){var t=cartJS.toJson(e);null!=t?null!=t.balance?$("#fidelityCardBalance").text(t.balance):null!=t.error_msg?($("#fidelityCardBalance").text("-"),$("#fidelityCardErrorMessageBox").text(t.error_msg),$("#fidelityCardErrorMessageBox").show()):($("#fidelityCardBalance").text("-"),$("#fidelityCardErrorMessageBox").text("Si è verificato un errore. Si prega di controllare i dati inseriti e riprovare."),$("#fidelityCardErrorMessageBox").show()):($("#fidelityCardBalance").text("-"),$("#fidelityCardErrorMessageBox").text("Si è verificato un errore. Si prega di controllare i dati inseriti e riprovare."),$("#fidelityCardErrorMessageBox").show())},error:function(e,t,r){$("#fidelityCardBalance").text("-"),$("#fidelityCardErrorMessageBox").text("Si è verificato un errore. Si prega di controllare i dati inseriti e riprovare."),$("#fidelityCardErrorMessageBox").show()}})}function myAccountFidelityCardRegistration(){$("#fidelitySave").submit(function(){if(!$(this).attr("validated")&&null!=$("#fidCard").val()&&""!=$("#fidCard").val()&&null!=$("#surnameCard").val()&&""!=$("#surnameCard").val()){$("#fidelityCardErrorMessageBox").hide(),spinnerFunc($("#fidelityCardRegisterButton"));var e=$("#fidelityStoreId").val(),t={};return t.storeId=e,t.catalogId=$("#fidelityCatalogId").val(),t.langId=$("#fidelityLangId").val(),t["FidelityCardNumber_"+e+"_a_null"]=$("#fidCard").val(),t["FidelityCardSurname_"+e+"_a_null"]=$("#surnameCard").val(),t.requesttype="ajax",$.ajax({url:"AjaxUserFidelityCardRetrieveCmd",data:t,method:"POST",success:function(e){var t=cartJS.toJson(e);null!=t?null!=t.balance?($("#fidelitySave").attr("validated",!0),$("#fidelitySave").submit()):null!=t.error_msg?(disableSpinner($("#fidelityCardRegisterButton")),console.log(t.error_msg),$("#fidelityCardErrorMessageBox").text(t.error_msg),$("#fidelityCardErrorMessageBox").show()):(disableSpinner($("#fidelityCardRegisterButton")),$("#fidelityCardErrorMessageBox").text("Si è verificato un errore. Si prega di controllare i dati inseriti e riprovare."),$("#fidelityCardErrorMessageBox").show()):(disableSpinner($("#fidelityCardRegisterButton")),$("#fidelityCardErrorMessageBox").text("Si è verificato un errore. Si prega di controllare i dati inseriti e riprovare."),$("#fidelityCardErrorMessageBox").show())},error:function(e,t,r){$("#fidelityCardErrorMessageBox").text("Si è verificato un errore. Si prega di controllare i dati inseriti e riprovare."),$("#fidelityCardErrorMessageBox").show()}}),!1}return!0})}function SVStringToCapitalCase(e){return e=e.toLowerCase().replace(/^[\u00C0-\u1FFF\u2C00-\uD7FF\w]|\s[\u00C0-\u1FFF\u2C00-\uD7FF\w]/g,function(e){return e.toUpperCase()})}function SVLoginAutocompleteWrap(){$(document).ready(function(){setTimeout(function(e){null!=$("#username").val()&&$("#username").val().trim().length>0&&$("#username").parent().addClass("ok"),null!=$("#password").val()&&$("#password").val().trim().length>0&&$("#password").parent().addClass("ok")},400)})}function homeGoToBookExam(){var e=$("#city-input-baet").val();if(null!=e&&e.trim().length>0)return e=e.trim(),window.location.href="/esame-della-vista-scegli-negozio?location="+e,!1}$.validator.addMethod("codfiscale",function(e,t){var r,a,i,o;if(""==e||!e)return!0;if(16!=(e=e.toUpperCase()).length)return!1;for("ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",r=0;r<16;r++)if(-1=="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".indexOf(e.charAt(r)))return!1;for(i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",o="ABCDEFGHIJABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","BAKPLCQDREVOSFTGUHMINJWZYX",a=0,r=1;r<=13;r+=2)a+="ABCDEFGHIJKLMNOPQRSTUVWXYZ".indexOf(o.charAt(i.indexOf(e.charAt(r))));for(r=0;r<=14;r+=2)a+="BAKPLCQDREVOSFTGUHMINJWZYX".indexOf(o.charAt(i.indexOf(e.charAt(r))));return a%26==e.charCodeAt(15)-"A".charCodeAt(0)},"Immettere un codice fiscale valido"),$.validator.addMethod("fullemail",function(e,t){return e.match(/^[+a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i)},"Please insert a valid email address"),$.validator.addMethod("onlyLetters",function(e,t){return e.match(/^[a-zA-Z\s]*$/)}),$.validator.addMethod("onlyNumbers",function(e,t){return e.match(/^[0-9]*$/)}),$.validator.addMethod("oneLetterOneNumber",function(e,t){return e=e.replace(/\s+/g,""),this.optional(t)||e.length>6&&e.match(/[a-z].*[0-9]|[0-9].*[a-z]/i)},"Soddisfare i requisiti della password"),$.validator.addMethod("oneLetterOneNumberOneSpecial",function(e,t){e=e.replace(/\s+/g,"");var r=window.REGEX_PASSWORD_POLICY.REGEX_PASSWORD_POLICY_ALL;return r=new RegExp(r),this.optional(t)||e.match(r)},"Soddisfare i requisiti della password"),$.validator.addMethod("typeCard",function(e,t,r){return"ok"==$(t).data("valid")},"Carta non supportata"),$.validator.addMethod("selectRule",function(e,t,r){return!$(t).parents(".select").is(":visible")||""!=$(t).val()&&null!=$(t).val()&&"undefined"!=$(t).val()}),$.validator.addMethod("ExpCC",function(e,t){if(e.match(/^((0[1-9])|(1[0-2]))\/(\d{2})$/)){var r=new Date,a=new Date(r.getFullYear(),r.getMonth(),1,0,0,0,0),i=e,o=i.indexOf("/"),n=new Date("20"+i.substr(o+1),i.substr(0,o)-1,1,0,0,0,0);return Date.parse(a)<=Date.parse(n)}return!1}),$.validator.addMethod("dob16yo",function(e,t){var r=e.split("/"),a=r[1];return parseInt(r[1])<10&&(a=r[1].substr(1,1)),new Date(parseInt(r[2])+16,parseInt(a)-1,parseInt(r[0]))<=new Date&&new Date(parseInt(r[2])+150,parseInt(a)-1,parseInt(r[0]))>=new Date}),$(document).ready(function(){initComponentToBeValidated()}),jsLogger={orderId:"NULL",userId:"NULL",userType:"NULL",init:function(){jsLogger.orderId=$("#currentOrderId").val()||$("#orderId").val()||"NULL",jsLogger.userId=$("#userId").val()||$(".userId").first().val()||"NULL",jsLogger.userType=$("#userType").val()||$(".userType").first().val()||"NULL"},info:function(e,t,r){jsLogger.init(),jsLogger.log("N",jsLogger.orderId,jsLogger.userId,jsLogger.userType,e,t,r)},severe:function(e,t,r){jsLogger.init(),jsLogger.log("Y",jsLogger.orderId,jsLogger.userId,jsLogger.userType,e,t,r)},log:function(e,t,r,a,i,o,n){if(Array.isArray(n)){var s=[];for(index=0;index<n.length;++index)try{s.push(JSON.stringify(n[index]))}catch(e){console.error("JsLogger: conversion error (object Array)"+e.message)}n=s.join(", ")}else if("object"==typeof n)try{n=JSON.stringify(n)}catch(e){console.error("JsLogger: conversion error (object Object)"+e.message)}var l={isSevere:e,userId:r,orderId:t,userType:a,context:i,message:o,stringObject:n,location:window.location.href},d=new FormData;for(var c in l)d.append(c,l[c]);navigator.sendBeacon("/webapp/wcs/stores/servlet/jsLogger",d)},executeAfterPendingRequests:function(e,t){$.active>0?setTimeout(function(){jsLogger.executeAfterPendingRequests(e,t)},t):e()}},userdataJS={userType:"",User_Id:"",userEmail:"",userPhone:"",userFirstName:"",userGender:"",User_LoginStatus:"Guest",User_Email_MD5:"",User_Email_SHA256:"",User_Phone_MD5:"",User_Phone_SHA256:"",User_Country:"",readyAjaxInfos:function(e){userdataJS.userType=e.userRegisterType,userdataJS.User_Id=e.userId,userdataJS.userEmail=e.userEmail||"",userdataJS.userPhone=e.userPhone,userdataJS.userFirstName=e.firstName,userdataJS.userGender=e.gender,"R"===userdataJS.userType&&(userdataJS.User_LoginStatus="Logged",null!=userdataJS.userEmail&&""!=userdataJS.userEmail&&(userdataJS.User_Email_MD5=md5(userdataJS.userEmail.toLowerCase()),userdataJS.User_Email_SHA256=sha256(userdataJS.userEmail.trim().toLowerCase())),null!=userdataJS.userPhone&&""!=userdataJS.userPhone&&(userdataJS.User_Phone_MD5=md5(userdataJS.userPhone.trim().toLowerCase()),userdataJS.User_Phone_SHA256=sha256(userdataJS.userPhone.trim().toLowerCase())),userdataJS.User_Country="IT")},callAjaxForInfos:function(e){let t,r=!1;return $.ajax({url:"AjaxCustomerHeaderInfos",data:"flag="+e,dataType:"json",async:!1,success:function(e){try{"undefined"!==e&&(r=!0,t=e)}catch(e){console.log(e)}},error:function(e,t,r){console.log(e.responseText)}}),{rc:r,data:t}}},console.log("userdata.js - inizializing"),$(document).ready(function(){var e=getCookie("analyticsUserType_"+WCParamJS.storeId);null==e&&(e="G");var t={data:{userRegisterType:e,userId:"",userEmail:"",userPhone:"",firstName:""}},r=e,a=sessionStorage.getItem("userType");if(null==a&&(a=""),a!=r){if("R"==r)null!=(t=userdataJS.callAjaxForInfos("2")).data&&sessionStorage.setItem("userData",JSON.stringify(t.data));else if("G"==r){let e=sessionStorage.getItem("userData");if(null!=e&&null!=e){sessionStorage.removeItem("userData");try{var i=JSON.parse(e);if(i){var o=i.userId;let e="crm_"+o,t=sessionStorage.getItem(e);null!=t&&null!=t&&sessionStorage.removeItem(e);let r="contact_"+o,a=sessionStorage.getItem(r);null!=a&&null!=a&&sessionStorage.removeItem(r),i=null}}catch(e){console.log("remove order list from sessionStorage error ",e)}let t=sessionStorage.getItem("registered-wishlist");null!=t&&null!=t&&sessionStorage.removeItem("registered-wishlist")}}}else if("R"==r){let e=sessionStorage.getItem("userData");null!=e&&null!=e&&(t.data=JSON.parse(sessionStorage.getItem("userData")))}sessionStorage.setItem("userType",r),null!=t.data&&userdataJS.readyAjaxInfos(t.data)}),cartJS={threshold3piu1:4,lastDataFetched:"",cartObjectProcessed:"",toggleButtonSpinner:function(e){spinnerFunc(e)},disableButtonSpinner:function(e){disableSpinner(e)},getCart:function(){return cartJS.cartObjectProcessed?cartJS.cartObjectProcessed:null},updateCartDeliveryCallback:function(e,t){$("#oneDayDeliveryEligible-"+t).val(e.oneDayDeliveryAvailable),$("#expectedDeliveryDate-"+t).val(e.deliveryDateFormattedShort),$("#deliveryDate"+t).text(e.deliveryDateFormattedShort)},updateCartDeliveryWithSaveCallback:function(e,t){for(let e of cartJS.getCart().orderItem)if(e.orderItemId==t){selectedItem=e;break}let r=[];selectedItem.rightCL||selectedItem.leftCL?(selectedItem.rightCL&&r.push(selectedItem.rightCL.orderItemId),selectedItem.leftCL&&r.push(selectedItem.leftCL.orderItemId)):r.push(selectedItem.orderItemId),cartJS.UpdateOrderItemDeliveryDate(r,formatDate(getDateFromShortFormat(e.deliveryDateFormattedShort)),cartJS.updateCartDeliveryCallback(e,selectedItem.orderItemId))},calculateOrder:function(e){var t="calculationUsageId=-1&calculationUsageId=-7&updatePrices=1&errorViewName=AjaxCheckoutDisplayView&orderId=.",r=cartJS.getBaseParams();$.ajax({url:getAbsoluteURL()+"AjaxRESTOrderCalculate?"+r,type:"POST",data:t,dataType:"html",success:e,error:function(e,a){setTimeout(function(){jsLogger.severe("AjaxRESTOrderCalculate calculateOrder","param="+t+", baseParams="+r+" (net error)",a)},50)}})},getBaseParams:function(){return"storeId="+WCParamJS.storeId+"&catalogId="+WCParamJS.catalogId+"&langId="+WCParamJS.langId+"&authToken="+encodeURI($("#csrf_authToken").val())},changeItemQuantity:function(e,t,r){let a=cartJS.getOrderItem(e);if(a.isCL){if(void 0!==t&&void 0!==r)var i="orderId=.&orderItemId_1="+t+"&orderItemId_2="+r+"&quantity_1="+(o=$("#qty_"+t).val())+"&quantity_2="+$("#qty_"+r).val()+"&calculateOrder=1&calculationUsage=-1%2C-2%2C-3%2C-4%2C-5%2C-6%2C-7";else if(void 0!==t&&void 0===r)i="orderId=.&orderItemId="+t+"&quantity="+(o=$("#qty_"+t).val())+"&calculateOrder=1&calculationUsage=-1%2C-2%2C-3%2C-4%2C-5%2C-6%2C-7";else if(void 0===t&&void 0!==r)i="orderId=.&orderItemId="+r+"&quantity="+(o=$("#qty_"+r).val())+"&calculateOrder=1&calculationUsage=-1%2C-2%2C-3%2C-4%2C-5%2C-6%2C-7";cartJS.updateOrderItem(i,e)}else{var o=$("#qty_"+e).val();Number(o)>Number(a.quantity)?productDisplayJS.Add2ShopCartAjaxFromCartIncreaseQuantity(a.productId,1):cartJS.deleteOrderItemOnCart(e)}},updateOrderItem:function(e,t){var r=cartJS.getBaseParams();setTimeout(function(){jsLogger.info("cartJS - updateOrderItem(param,mainOrderItemId)","before AjaxRESTOrderItemUpdate")},50),$.ajax({url:getAbsoluteURL()+"AjaxRESTOrderItemUpdate?"+r,type:"POST",data:e,dataType:"html",success:function(e){cartJS.cartDetailsPromise().then(e=>{cartJS.updateOrderDetails(),cartJS.updateSummary(),cartJS.getOrderItemODDInfo(t,"",function(e,t){$("#oneDayDeliveryEligible-"+t).val(e.oneDayDeliveryAvailable),$("#expectedDeliveryDate-"+t).val(e.deliveryDateFormattedShort),$("#deliveryDate"+t).text(e.deliveryDateFormattedShort)})})},error:function(t,a){setTimeout(function(){jsLogger.severe("AjaxRESTOrderItemUpdate updateOrderItem","param="+e+", baseParams="+r+" (net error)",a)},50)}})},deleteOrderItemOnCart:function(e){cartJS.deleteFromCart(e,void 0,void 0,!1)},deleteFromCart:function(e,t,r,a=!0){var i="URL=OrderItemDisplay&calculateOrder=1&calculationUsage=-1,-2,-5,-6,-7";if(void 0===t&&void 0===r){let t=cartJS.getOrderItem(e);t.partNumber;if(a=a){let e=1;for(let r of t.orderItemsId)i="orderItemId_"+e+"="+r+"&"+i,e++}else{let e=t.orderItemsId.length-1,r=t.orderItemsId[e];i="orderItemId="+r+"&"+i}}else void 0!==t&&void 0===r?(i="orderItemId="+t+"&"+i,nodeToDelete=$("#prodDetail"+e)):void 0!==r&&void 0===t?(i="orderItemId="+r+"&"+i,nodeToDelete=$("#prodDetail"+e)):void 0!==t&&void 0!==r&&(i="orderItemId_1="+t+"&orderItemId_2="+r+"&"+i);null!=cartJS.lastDataFetched&&1==cartJS.lastDataFetched.recordSetTotal&&(cartJS.removePromoCode($("#promocode-input").val(),!1),couponJS.checkCouponId()&&couponJS.removeCoupon());var o=cartJS.getBaseParams();$.ajax({url:getAbsoluteURL()+"AjaxRESTOrderItemDelete?"+o,type:"POST",data:i,dataType:"html",success:function(t){cartJS.cartDetailsPromise().then(t=>{if(cartJS.lastDataFetched)if(0==cartJS.lastDataFetched.recordSetTotal)if(cartJS.lastDataFetched.promotionCode&&0!=cartJS.lastDataFetched.promotionCode.length){let e=cartJS.lastDataFetched.promotionCode[0].code;cartJS.removePromoCode(e,!1,!0)}else location.reload();else{cartJS.updateSummary(),cartJS.refreshOrderItemUI(e),cartJS.updateOrderDetails(),cartJS.refreshAccessories();var r=$("#maxQuantityBuyable-"+e).val();$("#qty_"+e).val()<=r&&$("#buttonQtn_"+e+".plus").removeAttr("disabled")}})},error:function(e,t){setTimeout(function(){jsLogger.severe("AjaxRESTOrderItemDelete deleteFromCart","param="+i+", baseParams="+o+" (net error)",t)},50)}})},cartDetailsPromise:function(){return new Promise((e,t)=>{$.ajax({url:getAbsoluteURL()+"AjaxRESTCartDetails?"+cartJS.getBaseParams()+"&sortOrderItemBy=orderItemID",type:"POST",data:"responseFormat=json",success:function(t){let r=cartJS.toJson(t);cartJS.lastDataFetched=r,cartJS.checkCartIntegrityData(),cartJS.enrichmentCartObject(),e(t)},error:function(e,r){t(r)}})})},calculatePromoApplied:function(e){if(e||(e=cartJS.cartObjectProcessed),e){var t=!1,r=[],a="";if($.each(e.adjustment,function(e,i){if("Discount"==i.usage){t=!0;var o=i.code.split("-"),n=(o.pop(),o.join("-"));r.push(n),a=r.join()}}),!t)a=""}return a},updateSummary:function(e){let t=cartJS.lastDataFetched;if(e||(e=!1),t){$("#userType").val();var r,a=Number(t.totalProductPrice).toFixed(2).replace(".",","),i=Number(t.grandTotal).toFixed(2).replace(".",","),o=Number(t.totalShippingCharge).toFixed(2).replace(".",","),n=Number(t.totalAdjustment).toFixed(2),s="",l=!1,d=!1,c=!1,u=!1,p=!1,m=0,h=!1,g=0;$.each(t.orderItem,function(e,t){g+=Number(t.quantity);var a,i,o=!1;s=t.shipModeCode,$.each(t.orderItemExtendAttribute,function(e,t){"RecurringFrequency"==t.attributeName&&(a=t),"OrderItemTimestamp"==t.attributeName&&(i=t)}),null!=a&&(o=!0,l=!0,null!=i&&(null!=r&&i.attributeValue!==r&&(h=!0),r=i.attributeValue)),d||o||(d=!0);var n=$("#orderItemCategory-"+t.orderItemId).val();void 0!==n&&"optical"==n.toLowerCase()&&(c=!0),t.isStella?(u=!0,m+=g):p=!0}),n=Number(t.totalAdjustment).toFixed(2),totalShippingAdjustment=0;Number($("#amount_free_shipping_charge").val());let y=!1;$.each(t.adjustment,function(e,t){"Shipping Adjustment"==t.usage&&(y=!0,n-=Number(t.amount).toFixed(2),totalShippingAdjustment-=Number(t.amount).toFixed(2))}),y&&(n=Number(n).toFixed(2)),e||(l&&(d||h)?($("#Checkout").attr("disabled","disabled"),d?($("#recurringOrderError").removeClass("d-none"),$("#recurringOrderError").addClass("d-lg-flex")):($("#recurringOrderError").addClass("d-none"),$("#recurringOrderError").removeClass("d-lg-flex"))):p&&u||m>1?$("#Checkout").attr("disabled","disabled"):($("#Checkout").removeAttr("disabled"),$("#recurringOrderError").addClass("d-none"),$("#recurringOrderError").removeClass("d-lg-flex")),p&&u?($("#mixedCartStella").removeClass("d-none"),$("#mixedCartStella").addClass("d-flex"),utagFiller.asyncCartError("1")):($("#mixedCartStella").addClass("d-none"),$("#mixedCartStella").removeClass("d-flex")),m>1?($("#moreProductStella").removeClass("d-none"),$("#moreProductStella").addClass("d-flex")):($("#moreProductStella").addClass("d-none"),$("#moreProductStella").removeClass("d-flex")),c?($("#opticalOrderItemInCart").removeClass("d-none"),$("#opticalOrderItemInCart").addClass("d-flex")):($("#opticalOrderItemInCart").removeClass("d-flex"),$("#opticalOrderItemInCart").addClass("d-none")),u||$("#stellaInfo").addClass("d-none"),$("#promocode-input").val()?($("#promocode-input").attr("disabled","disabled"),$("#promocode-input").parent().css("opacity","0.5"),$("#applycode").addClass("d-none"),$("#promocode-input").val()&&$("#removecode").removeClass("d-none")):($("#promocode-input").removeAttr("disabled"),$("#promocode-input").parent().css("opacity","1.0"),$("#applycode").removeClass("d-none"),$("#removecode").addClass("d-none"),$("#promoCodeInvalidRecurring").removeClass("show"),$("#promoCodeInvalid").removeClass("show"),$("#promoCodeNotApplied").removeClass("show"))),o="Express"==s||0!=t.totalShippingCharge&&t.totalShippingCharge-totalShippingAdjustment!=0?"&euro; "+o:"Gratis";let b=!1;for(let e of cartJS.getCart().orderItem)e.isCL&&(b=!0);b?($("#deliveryOpticalMessage").addClass("d-none"),$("#deliveryCLMessage").removeClass("d-none")):($("#deliveryOpticalMessage").removeClass("d-none"),$("#deliveryCLMessage").addClass("d-none"));var f=cartJS.getCart().hasGiftCard;$("#summaryShippingTotal").html(o);let S=Number(-1*n).toFixed(2).replace(".",",");if($("#summaryAdjustmentTotal").html("- &euro; "+S),f){var v=cartJS.getCart().giftCard.grandTotalWithGiftCard;v=Number(v).toFixed(2).replace(".",",");var C=cartJS.getCart().giftCard.giftCardPaymentAmount;C=Number(C).toFixed(2).replace(".",","),$("#grantotalOrder").html("&euro; "+v)}else $("#grantotalOrder").html("&euro; "+i),$("#applycode").removeClass("disabled"),$("#applyGiftCard").removeClass("disabled"),$("#summaryDiscountLabel").addClass("d-none"),$("#summaryDiscountLabel").removeClass("d-flex"),$("#discount_gift_card_total").addClass("d-none"),$("#discount_gift_card_total").removeClass("d-flex"),$("#giftCardRecurringOrderError").addClass("d-none"),$("#giftCardRecurringOrderError").removeClass("d-lg-flex"),l&&(d||h)?cartJS.getCart().orderItem.length>1&&$("#Checkout").attr("disabled","disabled"):$("#Checkout").removeAttr("disabled"),$("#giftCardErrorWithSubscription").removeClass("show");if($("#summarySubtotal").html("&euro; "+a),$("#itemsCounter").html(g),$("#minishopcart_total-dsk").html(g),$("#minishopcart_total").html(g),0==n?($("#discount_total").addClass("d-none"),$("#discount_total").removeClass("d-flex"),$("#summaryDiscountLabel").addClass("d-none"),$("#summaryDiscountLabel").removeClass("d-flex")):($("#discount_total").removeClass("d-none"),$("#discount_total").addClass("d-flex"),$("#summaryDiscountAmount").html(" &euro;  "+S),$("#summaryDiscountLabel").removeClass("d-none"),$("#summaryDiscountLabel").addClass("d-flex")),f?(0==cartJS.getCart().giftCard.grandTotalWithGiftCard?$("#paypalExpressButton").hide():$("#paypalExpressButton").show(),$("#applyGiftCard").addClass("disabled"),$("#giftCardValid").addClass("show"),$("#giftcardInput").addClass("valid"),$("#giftcardInput").attr("disabled","disabled"),$("#removeGiftCard").removeClass("d-none"),$("#checkout-error-gift-card").addClass("d-none"),$("#giftcardInputWrapper").addClass("valid"),$("#summaryGiftCardPaymentAmount").html("- &euro;  "+C),$("#discount_gift_card_total").removeClass("d-none"),$("#discount_gift_card_total").addClass("d-flex"),l&&($("#giftCardRecurringOrderError").addClass("d-lg-flex"),$("#giftCardRecurringOrderError").removeClass("d-none"),$("#Checkout").attr("disabled","disabled"))):($("#paypalExpressButton").show(),$("#applyGiftCard").removeClass("disabled"),$("#giftCardValid").removeClass("show"),$("#giftcardInput").removeClass("valid"),$("#giftcardInput").removeAttr("disabled"),$("#giftcardInput").val(""),$("#removeGiftCard").addClass("d-none"),$("#giftcardInputWrapper").removeClass("valid"),$("#promoCodeInvalidGiftCard").removeClass("show")),$("scalapay-widget").length){let e=Number(t.grandTotal).toFixed(2);$("scalapay-widget").attr("amount",e)}l?$("scalapay-widget").hide():$("scalapay-widget").show()}},updateOrderDetails:function(){let e=cartJS.cartObjectProcessed,t=0;if(e){for(let r of e.orderItem)cartJS.refreshOrderItemUI(r.orderItemId),t+=Number(r.getQuantity());MonetateHelper.addCartRows(),MonetateHelper.pushTrackData(),$("#itemsCounter").html(t),$("#minishopcart_total-dsk").html(t),$("#minishopcart_total").html(t)}},checkPromoApplied:function(e){let t=cartJS.lastDataFetched;if(t){t.promotionCode[0].code;var r=t.promotionCode[0].associatedPromotion,a=!1;$.each(r,function(e,r){let i=r.promotionId;$.each(t.adjustment,function(e,t){t.code.includes(i)&&(a=!0)})}),a?(console.log("Promo code applied"),$("#applycode").addClass("d-none"),$("#promoCodeInvalid").removeClass("show"),$("#promoCodeInput").removeClass("error"),$("#promoCodeInvalidRecurring").removeClass("show"),$("#removecode").removeClass("d-none"),$("#promoCodeValid").addClass("show"),$("#promoCodeInput").addClass("valid"),$("#promoCodeNotApplied").removeClass("show")):(console.log("Promo code not applied"),$("#promoCodeNotApplied").addClass("show"),$("#promoCodeInput").removeClass("error"),$("#promoCodeInvalid").removeClass("show"))}},updateShipmentMethod:function(e){var t="orderId=.";t+="&calculationUsage=-1%2C-2%2C-3%2C-4%2C-5%2C-6%2C-7",t+="&allocate=***",t+="&backorder=***",t+="&remerge=***",t+="&check=*n",t+="&calculateOrder=1",t+="&shipModeId="+e,t+="&requesttype=ajax";var r=cartJS.getBaseParams();setTimeout(function(){jsLogger.info("cartJS - updateShipmentMethod(shipModeId)","before AjaxRESTOrderShipInfoUpdate")},50),$.ajax({url:getAbsoluteURL()+"AjaxRESTOrderShipInfoUpdate?"+r,type:"POST",data:t,dataType:"html",success:function(t){$("#BOPIS_shipmode_id").val(e),$("#selected_shipmode_id").val(e),cartJS.cartDetailsPromise().then(e=>{cartJS.lastDataFetched&&cartJS.updateSummary(!0)})},error:function(e,t){setTimeout(function(){jsLogger.severe("AjaxRESTOrderShipInfoUpdate updateShipmentMethod","param="+param+", baseParams="+r+" (net error)",t)},50)}})},applyPromoCode:function(){var e=$("#promocode-input").val().trim(),t="finalView=AjaxOrderItemDisplayView&orderId=.&promoCode="+e+"&requesttype=ajax&taskType=A&calculationUsage=-1%2C-2%2C-3%2C-4%2C-5%2C-6%2C-7";$.ajax({url:getAbsoluteURL()+"AjaxRESTPromotionCodeApply?"+cartJS.getBaseParams(),type:"POST",data:t,dataType:"html",success:function(r){r=cartJS.toJson(r.trim());t="finalView=AjaxOrderItemDisplayView&orderId=.&requesttype=ajax",r.errorCode?-42==r.errorCode?($("#promoCodeInvalidRecurring").addClass("show"),utagFiller.asyncPromocodeTentative(e,"Server",r.errorCode,"Promocode not applicable with Easy Contacts")):($("#promoCodeInvalid").addClass("show"),$("#promoCodeInput").addClass("error"),$("#promoCodeNotApplied").removeClass("show"),$("#promoCodeInvalidRecurring").removeClass("show"),utagFiller.asyncPromocodeTentative(e,"Server",r.errorCode,"Promocode invalid")):cartJS.cartDetailsPromise().then(t=>{if(cartJS.lastDataFetched){cartJS.updateSummary(),cartJS.updateOrderDetails(),cartJS.checkPromoApplied(e);let t=cartJS.cartObjectProcessed;var r=cartJS.calculatePromoApplied(t);setTimeout(function(){utagFiller.asyncPromocodeApplied(e,r)},50)}})},error:function(e,t){}})},removePromoCode:function(e,t,r){var a=$("#promocode-input").val();void 0!==e&&(a=e),void 0===t&&(t=!0),void 0===r&&(r=!1);var i="finalView=AjaxOrderItemDisplayView&orderId=.&promoCode="+a+"&requesttype=ajax&taskType=R";$.ajax({url:getAbsoluteURL()+"AjaxRESTPromotionCodeRemove?"+cartJS.getBaseParams(),type:"POST",data:i,dataType:"html",success:function(e){r&&location.reload(),$("#applycode").removeClass("d-none"),$("#removecode").addClass("d-none"),$("#promoCodeValid").removeClass("show"),$("#promoCodeInput").removeClass("valid"),$("#promocode-input").val(""),$("#giftCardInvalidPromoCode").removeClass("show"),couponJS.recalculateCart(),t&&cartJS.cartDetailsPromise().then(e=>{if(cartJS.lastDataFetched){cartJS.updateSummary(),cartJS.updateOrderDetails();let e=cartJS.cartObjectProcessed;var t=cartJS.calculatePromoApplied(e);setTimeout(function(){utagFiller.asyncPromocodeRemove(t)},50)}})},error:function(e,t){}})},applyGiftCard:function(){var e=$("#giftcardInput").val().trim();if($("#giftCardErrorCodeGeneral").removeClass("show"),cartJS.getCart().isRecurringOrder||$("#customCheck").is(":checked"))return $("#giftCardRecurringOrderError").addClass("show"),void $("#giftCardErrorWithSubscription").addClass("show");GiftCardJS.giftCardCheck(e,function(t){let r=ajaxResponseToJson(t);if(r.body){let t=r.body,i=cartJS.getGiftCardStatus(t);if("OK"==i.result)if("Active"==i.status){let r=Number(t.CurrentAmount);r>0&&(cartJS.giftCardAddUpdate(e,r),setTimeout(function(){utagFiller.asyncGiftCardApplied(e)},50))}else{$("#giftCardErrorCodeGeneral").addClass("show");var a="";"Burned"==i.status?(a="Ops, sembra che tu abbia usato il credito a disposizione sulla tua Gift Card",$("#errorGiftCardCodeText").html(a)):$("#errorGiftCardCodeText").html(i.description),utagFiller.asyncGiftCardTentative(e)}else"Error"==i.result&&($("#giftCardErrorCodeGeneral").addClass("show"),$("#errorGiftCardCodeText").html("Gift Card non trovata"),utagFiller.asyncGiftCardTentative(e))}})},removeGiftCard:function(){cartJS.giftCardDelete()},getGiftCardStatus:function(e){let t={};if(e){if(e.ErrorCode)t.result="Error",t.errorDescription=e.ErrorDescription;else if("OK"==e.Result)switch(t.result="OK",e.CardStatus){case 0:t.status="Non Issued",t.description="Carta non attiva";break;case 1:t.status="Active",t.description="Carta attiva";break;case 2:t.status="Expired",t.description="Carta scaduta";break;case 3:t.status="Burned",t.description="Credito esaurito";break;case 4:t.status="Blocked",t.description="Carta bloccata";break;case 5:t.status="Partially Blocked",t.description="Carta bloccata";break;case 6:t.status="Disabled",t.description="Carta disabilitata"}return t}},checkGiftCardOpenModal:function(){this.disableButtonSpinner("#btn-check-gift-card"),$("#gcFormPanel").removeClass("d-none"),$("#gcRemainingCreditPanel").addClass("d-none"),$("#gcRunOutCreditPanel").addClass("d-none")},checkGiftCardCredit:function(){var e=this;if(e.toggleButtonSpinner("#btn-check-gift-card"),$(".errorOnCaptcha").hide(),window.grecaptcha){var t=grecaptcha.getResponse();if(!t)return $(".errorOnCaptcha").show(),e.disableButtonSpinner("#btn-check-gift-card"),!1;console.log("Valid ReCaptcha")}var r=$("#gcNumberInput").val().trim();GiftCardJS.giftCardCheck(r,function(t){let r=ajaxResponseToJson(t);if(r.body){let t=r.body,a=cartJS.getGiftCardStatus(t);if("OK"==a.result){let e=Number(t.Amount).toFixed(2).replace(".",","),r=Number(t.CurrentAmount).toFixed(2).replace(".",",");"Active"==a.status?Number(t.CurrentAmount)>0&&($("#gcFormPanel").addClass("d-none"),$("#gcRemainingCreditPanel").removeClass("d-none"),$("#giftCardCreditActiveAmount").html("&#128;"+e),$("#giftCardCredit").html("&#128;"+r)):($("#gcTitleCardNonIssued").addClass("d-none"),$("#gcTitleCardExpired").addClass("d-none"),$("#gcTitleCardBurned").addClass("d-none"),$("#gcTitleCardBlocked").addClass("d-none"),$("#gcTitleCardDisabled").addClass("d-none"),$("#gcDescriptionCardNonIssued").addClass("d-none"),$("#gcDescriptionCardExpired").addClass("d-none"),$("#gcDescriptionCardBurned").addClass("d-none"),$("#gcDescriptionCardBlocked").addClass("d-none"),$("#gcDescriptionCardDisabled").addClass("d-none"),$("#gcIconCardOutCredit").addClass("d-none"),$("#gcValuesCardOutCredit").addClass("d-none"),$("#gcButtonContinueShopping").addClass("d-none"),$("#gcButtonContactUs").addClass("d-none"),$("#gcFormPanel").addClass("d-none"),$("#gcRunOutCreditPanel").removeClass("d-none"),"Non Issued"==a.status?($("#gcTitleCardNonIssued").removeClass("d-none"),$("#gcDescriptionCardNonIssued").removeClass("d-none"),$("#gcButtonContinueShopping").removeClass("d-none")):"Expired"==a.status?($("#gcTitleCardExpired").removeClass("d-none"),$("#gcDescriptionCardExpired").removeClass("d-none"),$("#gcIconCardOutCredit").removeClass("d-none"),$("#gcButtonContinueShopping").removeClass("d-none")):"Burned"==a.status?($("#gcTitleCardBurned").removeClass("d-none"),$("#gcDescriptionCardBurned").removeClass("d-none"),$("#gcIconCardOutCredit").removeClass("d-none"),$("#gcValuesCardOutCredit").removeClass("d-none"),$("#giftCardCreditAmount").html("&#128;"+e),$("#giftCardOutCredit").html("&#128;"+r),$("#gcButtonContinueShopping").removeClass("d-none")):"Blocked"==a.status||"Partially Blocked"==a.status?($("#gcTitleCardBlocked").removeClass("d-none"),$("#gcDescriptionCardBlocked").removeClass("d-none"),$("#gcIconCardOutCredit").removeClass("d-none"),$("#gcButtonContactUs").removeClass("d-none")):"Disabled"==a.status&&($("#gcTitleCardDisabled").removeClass("d-none"),$("#gcDescriptionCardDisabled").removeClass("d-none"),$("#gcIconCardOutCredit").removeClass("d-none"),$("#gcButtonContactUs").removeClass("d-none")))}else"Error"==a.result&&($(".errorGCNumber").show(),e.disableButtonSpinner("#btn-check-gift-card"))}},t)},toJson:function(e){var t;e=e.replace(/^\/\*/,"").replace(/\*\/$/,"");try{t=JSON.parse(e)}catch(e){return null}return t},getFormattedDate:function(e,t){var r=e.getFullYear(),a=(1+e.getMonth()).toString();a=a.length>1?a:"0"+a;var i=e.getDate().toString();return i=i.length>1?i:"0"+i,"dd-MM-yyyy"==t?i+"-"+a+"-"+r:"dd/MM/yyyy"==t?i+"/"+a+"/"+r:void 0},setModalSubscriptionOrderItemIdsAndOpen:function(e){var t=e.split("|");if(null==(r=$("#mainElement"+t[0]).val()))var r=$("#mainElement"+t[1]).val();$("#easy-contacts-subscription-modal").find("#easy-contacts-mainElement").val(r),$("#easy-contacts-subscription-modal").find("#easy-contacts-right-eye").val(t[0]),$("#easy-contacts-subscription-modal").find("#easy-contacts-left-eye").val(t[1]),detectmob()?($("#easy-contacts-banner-mobile").removeClass("d-none"),$("#easy-contacts-banner").addClass("d-none")):($("#easy-contacts-banner-mobile").addClass("d-none"),$("#easy-contacts-banner").removeClass("d-none")),$("#easy-contacts-subscription-modal").on("shown.bs.modal",function(){initSelectCustomOnModal("delivery-select")}),$("#easy-contacts-subscription-modal").modal("show")},UpdateOrderItemRecurrency:function(e,t,r){this.UpdateOrderItem(e,["attributeName=RecurringFrequency&attributeValue="+t],r)},UpdateOrderItemDeliveryDate:function(e,t,r){this.UpdateOrderItem(e,["attributeName=ExpectedDeliveryDate&attributeValue="+t],r)},UpdateOrderItemProductCategory:function(e,t,r){this.UpdateOrderItem(e,["attributeName=ProductCategory&attributeValue="+t],r)},UpdateOrderItem:function(e,t,r){Array.isArray(e)||(e=e.split("|"));var a="?"+cartJS.getBaseParams();a+="&calculationUsage=-1,-2,-5,-6,-7";for(var i=0,o=1;o<=e.length;o++)e[o-1].length>0&&(i++,t.push("orderItemId_"+i+"="+e[o-1]));setTimeout(function(){jsLogger.info("cartJS - UpdateOrderItem(orderItems, params, successCallback)","before AjaxRESTOrderItemUpdate")},50),$.ajax({url:getAbsoluteURL()+"AjaxRESTOrderItemUpdate"+a,type:"POST",data:t.join("&"),dataType:"html",async:!0,success:r,error:function(e,r){console.log("Error:"+r),setTimeout(function(){jsLogger.severe("AjaxRESTOrderItemUpdate UpdateOrderItem","params="+t+", urlParams="+a+" (net error)",r)},50)}})},UpdateOrderAttribute:function(e,t,r,a){if(!t||!r||!e||"delete"!=e&&!a)return;Array.isArray(r)||(r=[r]);let i=["orderId="+t,"updateType="+e];for(var o=0;o<r.length;o++)i.push("attributeName_"+(o+1)+"="+r[o]);if("delete"!=e){Array.isArray(a)||(a=[a]);for(o=0;o<a.length;o++)i.push("attributeValue_"+(o+1)+"="+a[o])}$.ajax({url:getAbsoluteURL()+"/UpdateOrderAttribute",type:"POST",data:i.join("&"),dataType:"html",success:function(e){cartJS.cartDetailsPromise().then(e=>{cartJS.updateSummary()})},error:function(e,t){setTimeout(function(){jsLogger.severe("UpdateOrderAttribute ","params = "+param,t)},50)}})},giftCardAddUpdate:function(e,t){this.UpdateOrderAttribute("add",cartJS.getCart().orderId,["GiftCardNumber","GiftCardCredit"],[e,t])},giftCardDelete:function(){this.UpdateOrderAttribute("delete",cartJS.getCart().orderId,["GiftCardNumber","GiftCardCredit"])},updateRefillTimeSelect:function(e,t,r){void 0!==r&&r&&e.find$(".delivery-select").val(t).trigger("change"),e.find(".delivery-select + div").html(e.find(".delivery-select + div + ul li[rel='"+t+"']").text()),e.find(".delivery-select + div + ul li").removeClass("active"),e.find(".delivery-select + div + ul li[rel='"+t+"']").addClass("active")},setupShipmentMethod:function(e){var t=!1,r=!1,a="true"==$("#isExpressAvailableStoreconf").val(),i="true"==$("#isPickupInStoreSVAvailableStoreconf").val(),o="true"==$("#isStandardAvailableStoreconf").val();$.each(e.orderItem,function(e,i){var o=$("#orderItemAvailable"+i.orderItemId).val();a&&"false"==o&&(a=!1);var n=!1;shipModeCode=i.shipModeCode,$.each(i.orderItemExtendAttribute,function(e,r){"RecurringFrequency"==r.attributeName&&(n=!0,t=!0)}),r||n||(r=!0)}),t&&(a=!1),a?$("#shopSpedExOption").removeClass("d-none"):$("#shopSpedExOption").addClass("d-none"),o?$("#shopSpedStdOption").removeClass("d-none"):$("#shopSpedStdOption").addClass("d-none"),i?$("#shopSpedPickUpOption").removeClass("d-none"):$("#shopSpedPickUpOption").addClass("d-none");var n=$("input[name='shipType']:checked").val();void 0===n||a||$("#shopSpedEx").val()!=n||cartJS.updateShipmentMethod($("#shipTypeOnline").val()),void 0===n||i||$("#shipTypePickUp").val()!=n||cartJS.updateShipmentMethod($("#shipTypeOnline").val())},orderItemsRecurringStatus:function(e){var t={};return $.each(e.orderItem,function(e,r){var a=!1,i=$("#orderItemAvailable"+r.orderItemId).val();showExpress&&"false"==i&&(showExpress=!1);var o=!1;$.each(r.orderItemExtendAttribute,function(e,a){"RecurringFrequency"==a.attributeName&&(o=!0,!0,t[r.orderItemId]="REC")}),a||o||(a=!0,t[r.orderItemId]="NOREC")}),t},refreshAccessories:function(){var e=!1,t=!1,r=!1,a=!1;$.each(cartJS.getCart().orderItem,function(i,o){var n=$("#orderItemCategory-"+o.orderItemId).val();"undefined"!=n&&(n=n.toLowerCase()),"contact_lens"==n?e=!0:"sun"==n||"optical"==n?t=!0:"accessory"!=n&&"accessories"!=n||(r=!0),$.each(o.orderItemExtendAttribute,function(e,t){"RecurringFrequency"==t.attributeName&&(a=!0)})}),r||(!e||a?($("#accessorySuggestionCL").hide(),t&&!a&&$("#accessorySuggestionSun").show()):e&&$("#accessorySuggestionCL").show(),t||$("#accessorySuggestionSun").hide())},checkCartIntegrityData:function(e){if(e||(e=cartJS.lastDataFetched),null!=e&&e.orderItem){let t=new Map;for(let r of e.orderItem){let e=!1,a="",i="";for(let t of r.orderItemExtendAttribute)"ParentProductId"==t.attributeName&&(e=!0,i=t.attributeValue),"OrderItemTimestamp"==t.attributeName&&(a=t.attributeValue);if(e&&0==a.length){let e=t.get(i);if(!e){(new Date).getTime();(e={}).candidateList=[],e.candidateList.push({}),t.set(i,e)}if(e){let t=e.candidateList;if("right"==r.comments){let e=!1;for(let a of t)if(!a.rightCL){a.rightCL=r,e=!0;break}e||t.push({rightCL:r})}else{let e=!1;for(let a of t)if(!a.leftCL){a.leftCL=r,e=!0;break}e||t.push({leftCL:r})}}}}if(t.size>0){let e=(new Date).getTime();for(let r of t.values())for(let t of r.candidateList){let r=[],a=[];t.rightCL&&(r.push(t.rightCL.orderItemId),t.rightCL.orderItemExtendAttribute.push({attributeName:"OrderItemTimestamp",attributeValue:e}),a.push(e)),t.leftCL&&(r.push(t.leftCL.orderItemId),t.leftCL.orderItemExtendAttribute.push({attributeName:"OrderItemTimestamp",attributeValue:e}),a.push(e)),e++;let i=[];for(let e=1;e<=a.length;e++)i.push("attributeName_"+e+"=OrderItemTimestamp&attributeValue_"+e+"="+a[e-1]);this.UpdateOrderItem(r,i)}return!0}return!1}},enrichmentCartObject:function(e){if(e||(e=cartJS.lastDataFetched),null!=e&&e.orderItem){let a=Object.assign({},e),i=[],o=new Map;a.isRecurringOrder=!1;var t=!1,r=!1;for(let n of e.orderItem){let e=!1,s=!1,l=!1;if(null!=n.orderItemExtendAttribute)for(let a of n.orderItemExtendAttribute)"ParentProductId"==a.attributeName&&(e=!0),"ProductCategory"==a.attributeName&&("ACCESSORY"==a.attributeValue?s=!0:"ELECTRONICS"==a.attributeValue?(l=!0,r=!0):t=!0,n.category=a.attributeValue);if(n.isAccessory=s,n.isStella=l,cartJS.enrichOrderItem(n),e){for(let e of n.orderItemExtendAttribute)if("OrderItemTimestamp"==e.attributeName){let t=o.get(e.attributeValue);t?"right"==n.comments?(t.rightCL=n,t.rightCL.isCL=!0):(t.leftCL=n,t.leftCL.isCL=!0):((t=Object.assign({},n)).isCL=!0,"right"==n.comments?(t.rightCL=n,t.rightCL.isCL=!0):(t.leftCL=n,t.leftCL.isCL=!0),i.push(t),o.set(e.attributeValue,t))}}else{n.isCL=!1;let e=o.get(n.partNumber);if(e){e.orderItemsId.push(n.orderItemId),e.orderItemsList.set(n.orderItemId,n);let t=Number(e.quantity)+Number(n.quantity);e.quantity=Number(t).toFixed(2);let r=Number(e.orderItemPrice)+Number(n.orderItemPrice);e.orderItemPrice=Number(r).toFixed(2);let a=Number(e.shippingCharge)+Number(n.shippingCharge);e.shippingCharge=Number(a).toFixed(2);let i=Number(e.getAdjustmentAmount())+Number(n.getAdjustmentAmount());if(e.totalAdjustment.value=Number(i).toFixed(2),void 0!==n.adjustment){void 0===e.adjustment&&(e.adjustment=[]);for(let t of n.adjustment)e.adjustment.push(t)}}else(e=Object.assign({},n)).orderItemsId=[],e.orderItemsId.push(n.orderItemId),e.orderItemsList=new Map,e.orderItemsList.set(n.orderItemId,n),i.push(e),o.set(n.partNumber,e)}n.getExtrAttr("RecurringFrequency")&&(a.isRecurringOrder=!0)}if(t&&r&&utagFiller.asyncCartError("1"),delete a.orderItem,a.orderItem=i,a.hasGiftCard=!1,null!=a.orderExtendAttribute){let e={};for(let t of a.orderExtendAttribute)"GiftCardNumber"==t.attributeName?(a.hasGiftCard=!0,e.giftCardNumber=t.attributeValue):"GiftCardCredit"==t.attributeName&&(e.giftCardCredit=Number(t.attributeValue));a.hasGiftCard&&(a.giftCard=e)}if(a.hasGiftCard){let e=Number(a.grandTotal)-a.giftCard.giftCardCredit;e>0?(a.giftCard.giftCardPaymentAmount=a.giftCard.giftCardCredit,a.giftCard.giftCardRemain=0,a.giftCard.grandTotalWithGiftCard=round(e,2)):(a.giftCard.giftCardPaymentAmount=round(Number(a.grandTotal),2),a.giftCard.giftCardRemain=round(a.giftCard.giftCardCredit-a.giftCard.giftCardPaymentAmount,2),a.giftCard.grandTotalWithGiftCard=0)}a.getShipModeSelected=function(){return a.orderItem[0].shipModeCode},a.getOrdExtAttr=function(e){let t="";if(null!=a.orderExtendAttribute)for(let r of a.orderExtendAttribute)if(r.attributeName==e){t=r.attributeValue;break}return t},a.getOrdItem=function(t){let r=null;for(let a of e.orderItem)if(t==a.orderItemId){r=a;break}return r},cartJS.cartObjectProcessed=a}},enrichOrderItem:function(e){e.getSubtotal=function(){let e=0;return this.isCL?(this.rightCL&&(e+=Number(this.rightCL.orderItemPrice)),this.leftCL&&(e+=Number(this.leftCL.orderItemPrice))):e=Number(this.orderItemPrice),e},e.getAdjustments=function(e){let t=[],r="";switch(e){case"discount":r="Discount";break;case"shipping":r="Shipping Adjustment";break;default:r=""}if(this.isCL){if(this.rightCL&&this.rightCL.adjustment)for(let e of this.rightCL.adjustment)r&&e.usage!=r||t.push(e);if(this.leftCL&&this.leftCL.adjustment)for(let e of this.leftCL.adjustment)r&&e.usage!=r||t.push(e)}else if(this.adjustment)for(let e of this.adjustment)r&&e.usage!=r||t.push(e);return t},e.getAdjustmentAmount=function(e){let t=0,r="";switch(e){case"discount":r="Discount";break;case"shipping":r="Shipping Adjustment";break;default:r=""}if(this.isCL){if(this.rightCL&&this.rightCL.adjustment)for(let e of this.rightCL.adjustment)r&&e.usage!=r||(t+=Number(e.amount));if(this.leftCL&&this.leftCL.adjustment)for(let e of this.leftCL.adjustment)r&&e.usage!=r||(t+=Number(e.amount))}else if(this.adjustment)for(let e of this.adjustment)r&&e.usage!=r||(t+=Number(e.amount));return t},e.getQuantity=function(){let e=0;return this.isCL?(this.rightCL&&(e+=Number(this.rightCL.quantity)),this.leftCL&&(e+=Number(this.leftCL.quantity))):e=Number(this.quantity),e},e.getExtrAttr=function(e){let t="";if(this.orderItemExtendAttribute)for(let r of this.orderItemExtendAttribute)if(r.attributeName==e){t=r.attributeValue;break}return t},e.getExpectedDeliveryDate=function(){let e="01-01-1970";if(this.orderItemExtendAttribute)for(let t of this.orderItemExtendAttribute)if("ExpectedDeliveryDate"==t.attributeName){e=t.attributeValue;break}return e}},getOrderItem:function(e){let t=null;for(let r of cartJS.getCart().orderItem)if(r.orderItemId==e){t=r;break}return t},refreshOrderItemUI:function(e){let t=$("#shoppingCart_rowHeader_product"+e),r=$("#shoppingCart_rowHeader_subscription"+e),a=null,i=null;for(let t of cartJS.getCart().orderItem){if(t.orderItemId==e){a=t;break}$("#contact-lenses-left-eye-"+e).val()==t.orderItemId&&(i=t)}if(a||i){let t="";!a&&i?(a=i,t=e):t=a.orderItemId;let r=a.getQuantity();$("#productQta_"+t).html(r);let n=a.getSubtotal(),s=parseInt($("#maxQuantityBuyable-"+t).val());if(a.isCL){if($("#subTotal"+t).html("&euro; "+Number(n).toFixed(2).replace(".",",")),a.rightCL){let e=a.rightCL.orderItemId,r=a.rightCL.quantity,i=$("#monetateCLDXObj-"+t).val();if(i){let e=JSON.parse(i);e.quantity=r,$("#monetateCLDXObj-"+t).val(JSON.stringify(e))}$("#promo31EffectDX"+e).removeClass("promo31-effect"),r<s?$("buttonQtn_"+e).removeAttr("disabled"):$("buttonQtn_"+e).attr("disabled","disabled"),r>1?$("#buttonQtn_"+e+" img.minus-ico").removeClass("d-none"):$("#buttonQtn_"+e+" img.minus-ico").addClass("d-none"),r>1?$("#buttonQtn_"+e+" img.remove-item-ico").addClass("d-none"):$("#buttonQtn_"+e+" img.remove-item-ico").removeClass("d-none")}else $("#contact-lens-details-dx-"+t).remove();if(a.leftCL){let e=a.leftCL.orderItemId,r=a.leftCL.quantity,i=$("#monetateCLSXObj-"+t).val();if(i){let e=JSON.parse(i);e.quantity=r,$("#monetateCLSXObj-"+t).val(JSON.stringify(e))}$("#promo31EffectSX"+e).removeClass("promo31-effect"),r<s?$("buttonQtn_"+e).removeAttr("disabled"):$("buttonQtn_"+e).attr("disabled","disabled"),r>1?$("#buttonQtn_"+e+" img.minus-ico").removeClass("d-none"):$("#buttonQtn_"+e+" img.minus-ico").addClass("d-none"),r>1?$("#buttonQtn_"+e+" img.remove-item-ico").addClass("d-none"):$("#buttonQtn_"+e+" img.remove-item-ico").removeClass("d-none")}else $("#contact-lens-details-sx-"+t).remove();let e=!1,i=a.getAdjustments("discount");for(let t of i)(t.code.toLowerCase().indexOf("3+1")>-1||t.code.toUpperCase().indexOf("SUBSCRIPTION_3PIU1")>-1)&&(e=!0);let o=$("#customPromoCLAvailable").val();if(r<cartJS.threshold3piu1&&!e&&!o){let e=cartJS.threshold3piu1-r;$("#remainingTo3piu1-"+t).html("Aggiungi "+e),$("#promo3piu1badge"+t).removeClass("d-none")}else $("#promo3piu1badge"+t).addClass("d-none");let l=a.getAdjustmentAmount("discount"),d=Number(a.getSubtotal()),c=Number(d).toFixed(2).replace(".",",");if(l<0){let e=Number(d+l).toFixed(2).replace(".",",");$("#subTotal"+t).html('<span class="old-price">&euro; '+c+"</span> &euro; "+e),$("#subTotal-mobile-"+t).html('<span class="old-price">&euro; '+c+"</span> &euro; "+e)}else $("#subTotal"+t).html("&euro; "+c),$("#subTotal-mobile-"+t).html("&euro; "+c)}else{let e=Number(a.orderItemPrice).toFixed(2).replace(".",","),r=Number($("#oldPriceSingleItem"+t).val()),i=Number(a.unitPrice),n=a.getAdjustmentAmount("discount"),l=Number(a.getSubtotal());if(r>0&&r>i||n<0)if(n<0){let r=Number(l+n).toFixed(2).replace(".",",");$("#subTotal"+t).html('<span class="old-price">&euro; '+e+"</span> &euro; "+r),$("#subTotal-mobile-"+t).html('<span class="old-price">&euro; '+e+"</span> &euro; "+r)}else{var o=Number(r*a.quantity).toFixed(2).replace(".",",");$("#subTotal"+t).html('<span class="old-price">&euro; '+o+"</span> &euro; "+e),$("#subTotal-mobile-"+t).html('<span class="old-price">&euro; '+o+"</span> &euro; "+e)}else $("#subTotal"+t).html("&euro; "+e),$("#subTotal-mobile-"+t).html("&euro; "+e);let d=a.quantity,c=$("#monetateObj-"+t).val();if(c){let e=JSON.parse(c);e.quantity=d,$("#monetateObj-"+t).val(JSON.stringify(e))}d<s?$("buttonQtn_"+t).removeAttr("disabled"):$("buttonQtn_"+t).attr("disabled","disabled"),d>1?$("#buttonQtn_"+t+" img.remove-item-ico").addClass("d-none"):$("#buttonQtn_"+t+" img.remove-item-ico").removeClass("d-none"),d>1?$("#buttonQtn_"+t+" img.minus-ico").removeClass("d-none"):$("#buttonQtn_"+t+" img.minus-ico").addClass("d-none")}let l=a.getAdjustmentAmount("discount");if(l<0){let e=Number(-1*l).toFixed(2).replace(".",",");$("#ordItemDiscountLabel-"+t+" .discountAmount").html("&euro; "+e),$("#ordItemDiscountLabel-"+t).show(),$("#ordItemDiscountLabel-mobile-"+t+" .discountAmount").html("&euro; "+e),$("#ordItemDiscountLabel-mobile-"+t).show()}else $("#ordItemDiscountLabel-"+t).attr("style","display:none !important"),$("#ordItemDiscountLabel-mobile-"+t).attr("style","display:none !important");let d=$("#expectedDeliveryDate"+t).val();$("#deliveryDate"+t).html(d)}else t.length>0&&(t.remove(),r.remove(),$("#shoppingCart_ODD_Disclaimer_product"+e).length>0&&$("#shoppingCart_ODD_Disclaimer_product"+e).remove())},closeGapTo3piu1:function(e){let t=cartJS.getOrderItem(e);if(t){let r=$("#mainElement"+e).val(),a=t.getQuantity(),i=cartJS.threshold3piu1-a,o="both";if(1==i&&(o=t.rightCL.quantity>t.leftCL.quantity?"left":"right"),t.rightCL&&t.leftCL&&"both"==o){let e=t.rightCL.orderItemId,a=t.leftCL.orderItemId,o=parseInt(i/2)+i%2,n=parseInt(i/2);$("#promo31EffectDX"+e).addClass("promo31-effect"),$("#promo31EffectSX"+a).addClass("promo31-effect");let s=$("#qty_"+e);$(s).val(Number(t.rightCL.quantity)+o);let l=$("#qty_"+a);$(l).val(Number(t.leftCL.quantity)+n),cartJS.changeItemQuantity(r,e,a)}else if(!t.leftCL||t.rightCL&&"left"!=o){if(t.rightCL&&(!t.leftCL||"right"==o)){let e=t.rightCL.orderItemId;$("#promo31EffectDX"+e).addClass("promo31-effect");let a=$("#qty_"+e);$(a).val(Number(t.rightCL.quantity)+i),cartJS.changeItemQuantity(r,t.rightCL.orderItemId)}}else{let e=t.leftCL.orderItemId;$("#promo31EffectSX"+e).addClass("promo31-effect");let a=$("#qty_"+e);$(a).val(Number(t.leftCL.quantity)+i),cartJS.changeItemQuantity(r,t.leftCL.orderItemId)}}},checkOneDayDeliveryEligible:function(){if(cartJS.cartObjectProcessed&&cartJS.getCart().orderItem)for(let e of cartJS.getCart().orderItem)cartJS.getOrderItemODDInfo(e.orderItemId,"",cartJS.updateCartDeliveryWithSaveCallback)},getOrderItemODDInfo:function(e,t,r,a,i){let o=null;for(let t of cartJS.getCart().orderItem)if(t.orderItemId==e){o=t;break}if(null!=o){if(!o.isCL){if(o.isAccessory){return getRealTimeStock(o.partNumber,o.orderItemPrice,o.quantity,t,a,i).then(t=>{t.validResponse&&r(t,e)})}{let e=new Date,a=Number(getLeadTimeFramesByZipCode(t));a+=Number(window.SHIPPING_DATE.EYESUN_EXTRA_SHIPPING_DAYS),e.toLocaleTimeString()>window.SHIPPING_DATE.CUTOFF_FRAMES&&!isSatOrSun(e)&&(a+=1);let i=addDaysToDate(e,a,!0),n={oneDayDeliveryAvailable:"false"};return n.deliveryDateFormattedShort=i?i.toShortFormat():"data non disponibile",cartJS.updateCartDeliveryCallback(n,o.orderItemId),r(n,o.orderItemId),Promise.resolve("Success")}}{let n=!1;o.rightCL&&o.leftCL&&(n=o.rightCL.partNumber==o.leftCL.partNumber);let s=null;if(o.rightCL){let e=o.rightCL,r=e.partNumber,i=o.orderItemPrice,l=Number(e.quantity);o.leftCL&&n&&(l+=Number(o.leftCL.quantity)),s={partNumber:r,totalPrice:i,totQuantityLenses:l*Number($("#packageQuantity-"+o.orderItemId).val()),zipCode:t,province:a}}let l=null;if(o.leftCL&&!n){let e=o.leftCL,r=e.partNumber,i=o.orderItemPrice,n=Number(e.quantity),s=Number($("#packageQuantity-"+o.orderItemId).val());l={partNumber:r,totalPrice:i,totQuantityLenses:n*s,zipCode:t,province:a}}if(null!=s&&null!=l)return getRealTimeStock(s.partNumber,s.totalPrice,s.totQuantityLenses,s.zipCode,s.province,i).then(t=>getRealTimeStock(l.partNumber,l.totalPrice,l.totQuantityLenses,l.zipCode,l.province,i).then(a=>{if(t&&t.validResponse&&a&&a.validResponse){let i=new Date(t.deliveryDate),o=new Date(a.deliveryDate),n=t;i.getTime()<o.getTime()&&(n=a),n&&r(n,e)}}));if(null!=l||null!=s){let t=null!=l?l:s;return getRealTimeStock(t.partNumber,t.totalPrice,t.totQuantityLenses,t.zipCode,t.province,i).then(t=>{t.validResponse&&r(t,e)})}}}return Promise.resolve("Success")},checkAllItemsCategory:function(e){if(cartJS.getCart()){let t=!1;for(let e of cartJS.getCart().orderItem)if(!e.getExtrAttr("ProductCategory")){let r=$("#orderItemCategory-"+e.orderItemId).val();if(r&&""!=r){let a=[];e.rightCL||e.leftCL?(e.rightCL&&a.push(e.rightCL.orderItemId),e.leftCL&&a.push(e.leftCL.orderItemId)):a.push(e.orderItemId),t=!0,cartJS.UpdateOrderItemProductCategory(a,r)}}t?cartJS.cartDetailsPromise().then(t=>{e()}):e()}},removeGiftCardFromPayment(){cartJS.giftCardDelete(),$("#gift-card-section").addClass("d-none"),$("#ccmethod").removeAttr("disabled"),$("#paypallmethod").removeAttr("disabled"),$("#scalapaylmethod").removeAttr("disabled"),0==cartJS.getCart().giftCard.grandTotalWithGiftCard&&($("#ccform-div").addClass("show"),$("#ccmethod").attr("checked","checked"))}},couponJS={langId:"",storeId:"",catalogId:"",promotionName:"",couponId:"",assigned:!1,promiseCartUpdate:!1,setCommonParameters:function(e,t,r,a,i,o){couponJS.langId=e,couponJS.storeId=t,couponJS.catalogId=r,couponJS.promotionName=a,couponJS.orderId=$("#currentOrderId").val(),couponJS.couponId=i,couponJS.assigned=o,void 0!==couponJS.promotionName&&""!==couponJS.promotionName&&couponJS.getCoupon(!0)},getCoupon:function(e){var t=!1;if(void 0!==e&&!0===e&&(t=!0),couponJS.checkCouponId())return couponJS.couponId;$.ajax({url:"AjaxRESTWalletCouponsShowAssigned?"+cartJS.getBaseParams(),type:"GET",success:function(e){var r=couponJS.toJson(e);if(void 0!==r.orderId&&r.orderId===couponJS.orderId&&void 0!==r.couponCode)for(var a=0;a<r.couponCode.length;a++)"2"===r.couponCode[a].status&&(couponJS.couponId=r.couponCode[a].couponId);couponJS.checkCouponId()?couponJS.promiseCartUpdate&&(couponJS.promiseCartUpdate=!1,couponJS.cartUpdate()):$.ajax({url:"AjaxRESTWalletCouponsShow?promotionName="+couponJS.promotionName+"&"+cartJS.getBaseParams(),type:"GET",success:function(e){var r=couponJS.toJson(e);if(void 0!==r.Coupon&&null!==r.Coupon&&r.Coupon.length>0)for(var a=0;a<r.Coupon.length;a++)couponJS.promotionName.indexOf(r.Coupon[a].promotion.uniqueID)&&(couponJS.couponId=r.Coupon[a].couponId);""===couponJS.couponId&&t?(couponJS.promiseCartUpdate=!0,$.ajax({url:"AjaxRESTWalletCouponsIssue?promotionName="+couponJS.promotionName+"&"+cartJS.getBaseParams(),type:"POST",success:function(){couponJS.getCoupon(!1)}})):couponJS.promiseCartUpdate&&(couponJS.promiseCartUpdate=!1,couponJS.cartUpdate())}})},error:function(e){console.log(e)}})},populateParams:function(){params.promotionName=couponJS.promotionName,params.couponId=couponJS.couponId,params.orderId=couponJS.orderId,params.catalogId=couponJS.catalogId,params.storeId=couponJS.storeId},checkCouponId:function(){return""!==couponJS.couponId},applyCoupon:function(e){couponJS.checkCouponId()?(params={},this.populateParams(),params.taskType="A",$.ajax({url:"AjaxCouponsAddRemove?"+cartJS.getBaseParams(),type:"POST",data:params,success:function(t){couponJS.assigned=!0,couponJS.recalculateCart(e)}})):e()},removeCoupon:function(e){couponJS.checkCouponId()?(params={},this.populateParams(),params.taskType="R",$.ajax({url:"AjaxCouponsAddRemove?"+cartJS.getBaseParams(),type:"POST",data:params,success:function(t){couponJS.assigned=!1,couponJS.recalculateCart(e)}})):e()},recalculateCart:function(e){var t="calculationUsageId=-1&calculationUsageId=-2&calculationUsageId=-5&calculationUsageId=-6&calculationUsageId=-7&updatePrices=1&errorViewName=AjaxCheckoutDisplayView&orderId=.",r=cartJS.getBaseParams();$.ajax({url:getAbsoluteURL()+"AjaxRESTOrderCalculate?"+r,type:"POST",data:t,dataType:"html",success:function(t){"function"==typeof e&&e()},error:function(e,a){setTimeout(function(){jsLogger.severe("AjaxRESTOrderCalculate recalculateCart","param="+t+", baseParams="+r+" (net error)",a)},50)}})},cartUpdate:function(e){var t=!1;$(".sv-order_item").each(function(){var r=$(this);r.attr("id").replace("shoppingCart_rowHeader_product","")===e||"true"!==r.data("recurring")&&!r.data("recurring")||(t=!0)}),!t&&couponJS.assigned?couponJS.removeCoupon(function(){cartJS.cartDetailsPromise().then(t=>{cartJS.lastDataFetched&&(cartJS.refreshOrderItemUI(e),cartJS.updateSummary())})}):t&&!couponJS.assigned?couponJS.applyCoupon(function(){cartJS.cartDetailsPromise().then(t=>{cartJS.lastDataFetched&&(cartJS.refreshOrderItemUI(e),cartJS.updateSummary())})}):cartJS.cartDetailsPromise().then(t=>{cartJS.lastDataFetched&&(cartJS.refreshOrderItemUI(e),cartJS.updateSummary())})},toJson:function(e){var t;e=e.replace(/^\/\*/,"").replace(/\*\/$/,"").trim();try{t=JSON.parse(e)}catch(e){return null}return t}},$(document).ready(function(){try{var e=window.location.pathname.split("/")[1];$("#header a[href*='"+e+"'].btn-link").addClass("active")}catch(e){console.log("window.location.pathname is "+window.location.pathname),console.log(e.getMessage())}}),$(document).ready(function(){location.href.indexOf("polarizzat")>-1&&$("#filter-heading-ads_f34501_ntk_cs").parent().addClass("d-none")}),$(".step-container").length>0&&$("#bookeyetest-btn").addClass("active"),$(document).ready(function(){$(".selectize-input.required").map(function(){$(this).focusout(function(){$(this).removeClass("errorDiv")})})}),inventoryJS={cachedMap:{},getInventoryStatus:function(e,t){void 0!==this.cachedMap[e]?t(e,inventoryJS.getAvailabilityFromData(inventoryJS.cachedMap[e])):$.ajax({url:"AjaxRESTInventoryAvailability",type:"POST",data:"storeId=10750&catalogId=12051&langId=-4&itemId="+e,success:function(r){var a=inventoryJS.toJson(r);null!==a?(inventoryJS.cachedMap[e]=a,t(e,inventoryJS.getAvailabilityFromData(a))):t(e,!1)}})},getAvailabilityFromData:function(e){var t=e.InventoryAvailability;if(null==t)return!1;var r=t[0];if(null==r)return!1;var a=r.availableQuantity;if(null==a)return!1;var i=parseFloat(a);if(isNaN(i))return!1;var o=0;return $("#delta-contact-lenses").length>0&&void 0!==$("#delta-contact-lenses").val()&&(o=parseInt($("#delta-contact-lenses").val())),i-o},toJson:function(e){var t;e=e.replace(/^\/\*/,"").replace(/\*\/$/,"");try{t=JSON.parse(e)}catch(e){return null}return t}},"undefined"!=typeof MessageHelper&&MessageHelper&&MessageHelper.topicNamespace||(MessageHelper={messages:{},identifier:"",focusElement:"",getCurrentYear:function(){return(new Date).getFullYear()},getCurrentMonth:function(){return(new Date).getMonth()+1},getCurrentDay:function(){return(new Date).getDate()},getRenderContextProperty:function(e,t){if(console.debug("enter getRenderContextProperty with propertyName = "+t),null==e)return console.debug("context is null. Return null..."),null;var r=e.properties[t];return console.debug("the found property value is: "+r),r},setMessage:function(e,t){this.messages[e]=t},setFocusElement:function(e){this.focusElement=e},showHideMessageArea:function(e){cursor_clear(),null!=e&&null!=e||(e=0);var t=$("#MessageArea");null!==$("#MessageArea_ACCE_Title")&&$("#MessageArea_ACCE_Title").css("display","block"),$(t).fadeIn(200)},hideMessageArea:function(){cursor_clear();var e="";""!==this.focusElement&&null!==$("#"+this.focusElement)&&(e=$("#"+this.focusElement));var t=$("#MessageArea");null!==$("#MessageArea_ACCE_Title")&&$("#MessageArea_ACCE_Title").css("display","none"),null!=document.getElementById(e)&&e.focus(),$(t).fadeOut(500),$("#ErrorMessageText").html(""),this.focusElement=""},displayErrorMessage:function(e,t,r){(null!=t&&null!=t||(t=0),null==r||null==r||1==r)&&(null!=this.messages.ERROR_MESSAGE_TYPE&&"undefined"!=this.messages.ERROR_MESSAGE_TYPE&&(e=this.messages.ERROR_MESSAGE_TYPE+e));this.setMessageAreaStyle("error_icon"),$("#ErrorMessageText").html(e),this.showHideMessageArea(t),$("#clickableErrorMessageImg").focus(),setTimeout(function(){null!==$("#ErrorMessageText")&&$("#ErrorMessageText").focus()},1e3),"undefined"!=typeof TealeafWCJS&&TealeafWCJS.logClientValidationCustomEvent({fieldId:"-1",message:e})},setMessageAreaStyle:function(e){$("#success_icon").css("display","none"),$("#error_icon").css("display","none"),null!=$("#"+e)&&$("#"+e).css("display","inline")},displayStatusMessage:function(e,t){null!=t&&null!=t||(t=0),this.setMessageAreaStyle("success_icon"),$("#ErrorMessageText").html(e),this.showHideMessageArea(t),$("#clickableErrorMessageImg").focus(),setTimeout(function(){null!==$("#ErrorMessageText")&&$("#ErrorMessageText").focus()},1e3)},hideAndClearMessage:function(){$("#ErrorMessageText").html(""),$("#MessageArea").css("display","none")},adjustCoordinates:function(e){if("none"!=$("#MessageArea").css("display")){var t=$("#page"),r=$("#MessageArea");if(null!=t&&null!=r){var a=$(t).position(),i=$(t).width();null!=e&&null!=e||(e=0),$(r).css({width:i+20+"px",left:a.left-10+"px",top:a.top+e+"px"})}}},formErrorHandle:function(e,t){this.formErrorHandleClient(e.errorMessageParam,e.errorMessage)},formErrorHandleClient:function(e,t){e.id&&(e=e.id);var r=$("#"+e);if(null!=t){if(r){if(Utils.has_ios())this.setMessageAreaStyle("error_icon"),$("#MessageArea").css("display","block"),$("#ErrorMessageText").html(t),window.setTimeout(function(){window.scrollTo(0,0)},0);else if(this.identifier!=e+"_tooltip"){r.focus(),this.identifier=e+"_tooltip";var a=document.createElement("span"),i=getImageDirectoryPath();if(Utils.get_IE_version()<7?a.innerHTML=t+"<iframe id='errorMessageIFrame' scrolling='no' frameborder='0' src='"+i+"images/empty.gif'></iframe>":a.innerHTML=t,Utils.hasTouch()){var o=this;setTimeout(function(){var r=this;this.tooltip=$("<div class='WCTooltip'><div class='container' style='padding:5px;' ><div class='connector''></div>"+t+"</div></div>"),$("#"+e).after(this.tooltip),this.tooltip.position({my:"center top",at:"center bottom",of:$("#"+e)}),$("#"+e).blur(function(){r.tooltip&&(r.tooltip.hide(),r.tooltip.remove()),MessageHelper.clearCurrentIdentifier()})},1e3)}else{o=this;this.tooltip=$("<div class='WCTooltip'><div class='container' style='padding:5px;' ><div class='connector''></div>"+t+"</div></div>"),$("#"+e).after(this.tooltip),this.tooltip.position({my:"center top",at:"center bottom",of:$("#"+e)}),$("#"+e).blur(function(){o.tooltip&&(o.tooltip.hide(),o.tooltip.remove()),MessageHelper.clearCurrentIdentifier()})}}"undefined"!=typeof TealeafWCJS&&TealeafWCJS.logClientValidationCustomEvent({fieldId:r.id,message:t})}}else console.debug("formErrorHandleClient: The error message is null.")},hideFormErrorHandle:function(){null!=this.tooltip&&(this.tooltip.destroyRecursive(),this.tooltip=null,this.clearCurrentIdentifier())},clearCurrentIdentifier:function(){this.identifier=""},emptyFunc:function(e){},containsDoubleByte:function(e){for(var t=new String(e),r=0;r<t.length;r++)if(chr=t.charCodeAt(r),chr>127)return!0;return!1},isValidEmail:function(e){return!this.containsDoubleByte(e)&&(0==e.length||!(e.length<5)&&(!(e.indexOf(" ")>0)&&(!(e.indexOf("@")<1)&&(!(e.lastIndexOf(".")<e.indexOf("@")+2)&&!(e.lastIndexOf(".")>=e.length-2)))))},isValidUTF8length:function(e,t){return!(this.utf8StringByteLength(e)>t)},utf8StringByteLength:function(e){if(null===e)return 0;var t=String(e),r=t.length;for(i=0;i<t.length;i++)chr=t.charCodeAt(i),chr>127&&(r+=1),chr>2047&&(r+=1);return r},IsNumeric:function(e,t){if(t)var r="0123456789.";else r="0123456789";var a,o=!0;for(i=0;i<e.length&&1==o;i++)a=e.charAt(i),-1==r.indexOf(a)&&(o=!1);return o},IsValidPhone:function(e){var t,r=!0;for(i=0;i<e.length&&1==r;i++)t=e.charAt(i),-1=="0123456789()-+ ".indexOf(t)&&(r=!1);return r},showConfirmationDialog:function(e,t){$("#confirmationPopupMessage").html(t);var r=$("#confirmationPopup").data("wc-WCDialog"),a="click.MessageHelper";r.primary_button.one(a,function(t){t.preventDefault(),r.secondary_button.off(a),wcTopic.publish(e,{action:"YES"})}),r.secondary_button.one(a,function(t){t.preventDefault(),r.primary_button.off(a),wcTopic.publish(e,{action:"NO"})}),r.open()}});const ZOOM_MIN=1;var ZOOM_MAX;ZOOM_MAX=window.matchMedia("(min-width: 768px)").matches?3:6;const PINCH_FRICTION=.04;function ZoomNode(e){const t=this;var r=0,a=0,i=0,o=0,n=1,s=[],l=-1,d=!1,c=0;function u(t){s.push(t),i=t.offsetX,o=t.offsetY,e.style.transition="",t.preventDefault()}function p(u){if(0!=s.length)if(function(e){for(var t=0;t<s.length;t++)if(e.pointerId==s[t].pointerId){s[t]=e;break}}(u),2==s.length){var p=function(e,t){var r=e.x-t.x,a=e.y-t.y;return Math.hypot(r,a)}(s[0],s[1]);if(l>0){var m=p/l*PINCH_FRICTION;p>l&&((c=n+m)<ZOOM_MAX?t.zoom(c):c=ZOOM_MAX),p<l&&((c=n-m)>ZOOM_MIN?t.zoom(c):c=ZOOM_MIN),window.zoom.scale=c,window.zoom.updateZoomButtons()}l=p}else if(1==s.length&&-1==l&&!d){var g=e.getBoundingClientRect();u.pageX,u.pageY,r=r+u.pageX-i*n-g.left,a=a+u.pageY-o*n-g.top,h(r,a,n)}}function m(e){!function(e){for(var t=0;t<s.length;t++)if(s[t].pointerId==e.pointerId){s.splice(t,1);break}}(e),s.length<2&&(l=-1,d=!1),1==s.length&&(d=!0),e.preventDefault()}function h(t,r,a){e.style.transform=`matrix(${a}, 0, 0, ${a}, ${t}, ${r})`}e.classList.add("zooming"),t.zoom=function(t,i){n=Math.min(Math.max(t,ZOOM_MIN),ZOOM_MAX),e.style.transition=i||"",h(r,a,n)},t.reset=function(){r=0,a=0,n=1,e.style.transition="",e.classList.remove("zooming"),h(0,0,1)},t.bindEvents=function(){e.addEventListener("pointerdown",u),e.addEventListener("pointermove",p),e.addEventListener("pointerup",m),e.addEventListener("pointerout",m),e.addEventListener("pointercancel",m)},t.unbindEvents=function(){e.removeEventListener("pointerdown",u),e.removeEventListener("pointermove",p),e.removeEventListener("pointerup",m),e.removeEventListener("pointerout",m),e.removeEventListener("pointercancel",m)},t.destroy=function(){t.unbindEvents(),t.reset()},t.bindEvents()}!function(){var e,t,r,a=!0;function i(){if(VirtualMirror.initialize(r).then(function(){return VirtualMirrorManager.showUpc(r.firstUpc)}).catch(e=>{console.error(e)}),$(".virtual-mirror-wrapper").show(),$(".virtual-mirror-wrapper").css("width",$(".widget_product_image_viewer").width()+"px"),$(".widget_product_image_viewer, #brand-and-badges").addClass("invisible"),$("body, html").addClass("modal-open"),$(window).width()<=991){$(".virtual-mirror-wrapper").addClass("partial-modal"),$("body, html").addClass("modal-noscroll"),$(".shopperActions").addClass("sticky-ing");var e=$(".virtual-mirror-variants");e.slick({arrows:!1,slidesToShow:5,infinite:!1,centerMode:!0,centerPadding:"10px",swipeToSlide:!0,swipe:!0});var t=$("#virtual-mirror-tooltip"),a=$("#tooltip-frame"),i=$("#tooltip-lenses");e.offset().top;function o(e){var r=e.find("[data-lenses]").data("lenses"),o=e.find("[data-frame]").data("frame");a.text(o),i.text(r),t.show(),setTimeout(function(){t.hide()},2500)}var n=e.slick("slickCurrentSlide");o($(e.slick("getSlick").$slides.get(n))),e.on("afterChange",function(e,t,r){var a=$(t.$slides.get(r));o(a),VirtualMirrorManager.showUpc(""+a.find("[data-partnumber]").data("partnumber"));var i=a.find("img").attr("src");$("#virtual-mirror-modal-info img, #virtual-mirror-modal-info-desktop img").attr("src",i);var n=a.find("[data-frame]").data("frame"),s=a.find("[data-lenses]").data("lenses"),l="";s&&""!=s&&(l=" / ");var d=a.find("[data-displaysku]").data("displaysku")+"<br>"+n+l+s;$("#virtual-mirror-modal-info p").html(d)}),$("#quick_cart_mobile_container .sv-secondary").data("vm-active","true"),setTimeout(function(){$("#virtual-mirror-variants").slick("slickGoTo",$("#virtual-mirror-variants .slick-slide:has(.selected)").data("slick-index")),$("#virtual-mirror-variants .slick-slide").on("click",function(e){return $("#virtual-mirror-variants").slick("slickGoTo",$(this).data("slick-index")),e.preventDefault(),!1})},500)}}function o(){$(".virtual-mirror-terms").hasClass("checked")||$("#privacyCheckVm").prop("checked")||"accepted"==Cookies.get("cookievmacception",{path:"/"})?i():($(".virtual-mirror-terms").show(),$(window).width()<=991&&$("#wizard-terms-modal").modal())}function n(e){!function(e,t){let r={elements:["#main"],texts:[],attributes:{},changeHistory:!0,onLoad:function(){}};r=t,$.get(e,function(t){let a=$(t),i=$("body");if(r.changeHistory){let t=a.filter("title").text();history.replaceState(function(e){var t,r=0;for(t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return r}(e),t,e),document.title=t}for(var o in r.elements){var n=r.elements[o];$replacement=a.find(n),i.find(n).replaceWith($replacement)}"function"==typeof r.onLoad&&r.onLoad()})}(e,{elements:['[data-element-id="X_Pdp_Prod_Carousel"]',".carouselMagctn",".sidebar","#zoom-modal","#virtual-mirror-modal-info","#virtual-mirror-modal-info-desktop","#has-virtual-mirror",".description-wrapper",".definingAttributes","#analyticsPDPItemAvailability","#analyticsPDPItemProductType","#PageHeading >#product-model","#analyticsPDPItemModelName","#PageHeading >#product-name","#has-virtual-mirror","#analyticsPDPItemBrand","#analyticsPDPItemSize","#analyticsPDPItemMoco","#analyticsPDPItemModelName","#analyticsPDPItemDisplaySku","#brand-and-badges",".variant-update-stellaTitle",".variant-update-stellaTable",".variant-update-stellaVideo",".variant-update-stellaInfo",".variant-update-stellaFaq",".variant-update-stellaLenti",".svEnableListCarouselSlick.ymal",".pdp-lens-filter-tester",".product-info-wrapper"],texts:[],attributes:{},changeHistory:!0,onLoad:function(){if($(window).width()>992&&initPDPSidebar(),initPDPColorCarousel(),initFloatingBtnShowdown(),$(window).width()>992&&$(".product-color-picker__item").length>5){var e=$(".product-color-picker .product-color-picker__item.selected").closest(".slick-slide").attr("data-slick-index");let t=5,r=Math.floor(t/2),a=$(".product-color-picker__item").length,i=Number(e);i>=a-r?i=a-t:i>r?i-=r:i=0,$(".product-color-picker").slick("goTo",i)}$("#pdpCustomCarousel .imgShowdown").on("click",function(){$("#zoom-modal").modal("show")}),$("html, body").animate({scrollTop:0},"slow"),$("#zoom-modal").length>0&&($("#zoom-modal").on("shown.bs.modal",function(e){$(window).width()<=992?($("#zoom-carousel .brand").remove(),window.zoom.initZoom(),$(".mob-thumbnail-carousel .imgShowdown:first-child").addClass("active")):$("#zoom-carousel").slick({dots:!0,arrows:!1,slidesToScroll:1,slidesToShow:1,vertical:!0,verticalSwiping:!0,infinite:!1}).on("wheel",onSliderWheel)}),$("#spin-btn").on("click",function(){$(".carouselMagctn").hide(),$("#spinviewer-container").show(),$("#carousel-btn").removeClass("active"),$("#spin-btn").addClass("active"),activateSpin()}),$("#carousel-btn").on("click",function(){$("#spinviewer-container").hide(),$(".carouselMagctn").show(),$("#spin-btn").removeClass("active"),$("#carousel-btn").addClass("active")}),wishlistJS.initWishListItems(!0));let t=$(".catalogEntryRecommendation_productsPerSlide").val(),a=$(".catalogEntryRecommendation_slideScroll").val();$(".svEnableListCarouselSlick.ymal").hasClass("slick-initialized")&&$(".svEnableListCarouselSlick.ymal").slick("unslick"),$(window).width()>992?$(".svEnableListCarouselSlick.ymal .single-product").length>t&&$(".svEnableListCarouselSlick.ymal").slick({dots:!1,infinite:!1,slidesToShow:t,slidesToScroll:a}):$(".svEnableListCarouselSlick.ymal").slick({dots:!1,arrows:!1,infinite:!1,slidesToShow:1.2,slidesToScroll:1}),initSelectCustom(),refreshSizeInfo(),s(),VirtualMirrorManager.initButton();let i=$("#product-model-hidden").val();r.firstUpc=i,$("#mirror-video").length>0&&VirtualMirrorManager.showUpc(i),initScalaPayWidgetGraphic(),utagFiller.setPDP(i),utagFiller.asyncSendId("VirtualPage-View")}})}function s(){$(".product-color-picker__item a").off().on("click",function(e){return n(this.href),e.preventDefault(),!1}),$(".pwr-selector-wrapper .custom-control-label").off().on("click",function(e){return n($(this).attr("href")),!1}),$(".size-wrapper .size-selector").off().on("click",function(e){return n($(this).attr("href")),!1}),$("#size-and-fitting-sizes .size-selector").off().on("click",function(e){return n($(this).attr("href")),!1})}(r="undefined"==typeof initParams||null===initParams?{options:{key:"c59bd226-7af0-4c93-ba0b-6c2067c414a3",brand:"brand",locale:"it-IT",storeId:"10750",channel:"Sunglasses"},firstUpc:"805289063230"}:initParams).options.analyticsConfig={onInitializeSuccess:function(){utagFiller.asyncVMEvent("TryOn")},onInitializeError:function(){utagFiller.asyncVMError("1",upc)},onRequestWebcam:function(){utagFiller.asyncVMEvent("RequestWebcam")},onWebcamAllowed:function(){utagFiller.asyncVMEvent("WebcamAllowed")},onWebcamDenied:function(){utagFiller.asyncVMError("5")},onWebcamUnavailable:function(){utagFiller.asyncVMError("4")},onRender:function(e){utagFiller.asyncVMEvent("Render")},onMirrorRenderFailure:function(e){utagFiller.asyncVMError("6","virtual-mirror")},onMirrorWasmFailure:function(e){utagFiller.asyncVMError("7","virtual-mirror")},onGlassesOn:function(){t&&(t=!1,utagFiller.asyncVMEvent("FitGlasses")),a&&(a=!1,$(".nudging-guide.custom").removeClass("d-none"),setTimeout(function(){$(".nudging-guide.custom").addClass("d-none")},3500))},onGlassesOff:function(){}},r.privacy={bipaActive:!1,privacyPolicy:"/privacy-policy",termsAndConditions:"/termini-di-utilizzo",region:"EU",source:""},window.VirtualMirrorManager={initButton:function(){var e=document.querySelector("#btn-init");e&&(e.addEventListener("click",function(){o()}),e.removeAttribute("disabled"),document.querySelector("#btn-init .spinner-border").remove())},init:function(){this.initButton(),window.addEventListener("resize",function(){null!=e&&$("#mirror-video").length>0&&VirtualMirrorManager.rerender()});var t=document.querySelectorAll(".btn-accept-terms");Array.prototype.forEach.call(t,e=>{e.addEventListener("click",function(e){!function(){Cookies.set("cookievmacception","accepted",{expires:365,path:"/"}),$(window).width()<=991?$("#wizard-terms-modal").modal("hide"):$(".virtual-mirror-terms").addClass("checked");i()}()})});var r=document.querySelector("#btn-close-vm");r&&r.addEventListener("click",function(){!function(){VirtualMirror.closeMirror({target:"virtual-mirror"}),$(".widget_product_image_viewer, #brand-and-badges").removeClass("invisible"),$("body, html").removeClass("modal-open"),$(".virtual-mirror-wrapper").hide(),$(window).width()<=991&&($(".virtual-mirror-wrapper").removeClass("partial-modal"),$("body, html").removeClass("modal-noscroll"));utagFiller.asyncVMEvent("CloseMirror")}(),$("#quick_cart_mobile_container .sv-secondary").text("Continua lo shopping"),$("#quick_cart_mobile_container .sv-secondary").data("vm-active","false")});var a=document.querySelector("#btn-shot");a&&a.addEventListener("click",function(){VirtualMirror.getScreenshot({target:"virtual-mirror"}).then(e=>{!function(e){if(platform&&platform.parse(navigator.userAgent)&&platform.name&&"Safari"===platform.name&&platform.os&&platform.os.version)try{var t=platform.os.version.split("."),r=t[0],a=t[1];(parseInt(r)<13||13===parseInt(r)&&parseInt(a)<4)&&$(".btn-save").hide()}catch(e){}$("#virtual-mirror-screenshot").attr("src",e),$(".btn-save").click(function(){window.scrollTo(0,0),html2canvas(document.querySelector("#canvas"),{allowTaint:!0,useCORS:!0}).then(e=>{!function(e,t){var r=document.createElement("a");"string"==typeof r.download?(r.href=e,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r)):window.open(e)}(e.toDataURL("image/jpeg",.7),"I miei Salmoiraghi&Viganò.jpg")})}),$("#virtual-mirror-modal .modal-dialog").css("max-width",$(".virtual-mirror-wrapper").width()),$("#virtual-mirror-modal").modal("show")}(e.imgURI)}).catch(e=>console.error("FAILED TO GET SCREENSHOT",e))}),location.search.toLowerCase().includes("vto=true")&&o()},showUpc:function(r){$(".virtual-mirror-wrapper").removeClass("nomodel");var a=e;const i={target:"virtual-mirror",upc:r};return e=r,t=!0,VirtualMirror.renderMirror(i).then(function(){var e=document.querySelector(".vm-swipeable-container");e&&e.addEventListener("touchstart",function(){utagFiller.asyncVMEvent("AdjustGlasses"),VirtualMirror.fitMeBetter()})}).catch(function(t){utagFiller.asyncVMError("3"),$(".virtual-mirror-wrapper").addClass("nomodel"),e=a})},rerender:function(){const t={target:"virtual-mirror",upc:e};return VirtualMirror.renderMirror(t)}};var l=null,d=!1;window.scale=1,window.zoom={activateZoom(e){if(!e){window.scale=1;var t=document.getElementById("zoom-modal").querySelector("#zoom-carousel .slick-current img");l=new ZoomNode(t)}return!e},onItemChange(e,t){if(l){l.destroy(),window.scale=1,window.zoom.updateZoomButtons();var r=e.querySelector("img");l=new ZoomNode(r),d=!0}},initZoom(){window.scrollTo({top:0,left:0,behavior:"smooth"}),$("#zoom-carousel").hasClass("slick-initialized")&&($("#zoom-carousel").slick("unslick"),$(".mob-thumbnail-carousel").getNiceScroll().remove(),$(".mob-thumbnail-carousel .imgShowdown.active").removeClass("active"),window.zoom.destroyZoom(),$("#zoom-carousel .imgShowdown img").addClass("zooming")),$("#zoom-carousel").slick({slidesToShow:1,slidesToScroll:1,infinite:!0,dots:!1,arrows:!1,touchMove:!1,swipe:!1}).on("init",function(e){var t=document.querySelector("#zoom-carousel").querySelector("div.slick-slide[data-slick-index='0']");window.zoom.onItemChange(t)}).on("afterChange",function(e,t,r){var a=document.querySelector("#zoom-carousel").querySelector("div.slick-slide[data-slick-index='"+r+"']");$(window).width()>768&&(t.setOption("touchThreshold",5),t.setOption("swipe",!0),t.setOption("swipeToSlide",!0)),window.zoom.onItemChange(a)}),$(".mob-thumbnail-carousel").before('<div id="thumb-scrollbar-wrapper"><div class="scrollbar-element"></div></div>'),$(".mob-thumbnail-carousel").on("scroll",function(){var e=$(".mob-thumbnail-carousel").innerWidth(),t=$(".mob-thumbnail-carousel").scrollLeft(),r=$(".mob-thumbnail-carousel")[0].scrollWidth,a=t+e,i=r-$(window).width();if(a>=r)$("#thumb-scrollbar-wrapper .scrollbar-element").css("left","100%");else if(t<=0)$("#thumb-scrollbar-wrapper .scrollbar-element").css("left","0px");else{var o=100*t/i;o>=100&&(o=100),$("#thumb-scrollbar-wrapper .scrollbar-element").css("left",o+"%"),$("#thumb-scrollbar-wrapper .scrollbar-element").css("transform","translateX(-"+o+"%)")}}),$(".mob-thumbnail-carousel .imgShowdown").on("click",function(){var e=$(this).index();$(".mob-thumbnail-carousel .imgShowdown.active").removeClass("active"),$(this).addClass("active"),$("#zoom-carousel").slick("slickGoTo",e,!0)}),window.zoom.activateZoom(d)},zoomInFunction(){console.log(window.scale),window.scale+=.5,window.scale>ZOOM_MAX&&(window.scale=ZOOM_MAX),window.zoom.updateZoomButtons(),l.zoom(window.scale,"transform 0.4s ease-out")},zoomOutFunction(){window.scale-=.5,window.scale<ZOOM_MIN&&(window.scale=ZOOM_MIN),window.zoom.updateZoomButtons(),l.zoom(window.scale,"transform 0.4s ease-out")},updateButton(e,t){window.scale==t?e.setAttribute("disabled",""):e.removeAttribute("disabled")},updateZoomButtons(){var e=document.getElementById("zoom-in"),t=document.getElementById("zoom-out");window.zoom.updateButton(e,ZOOM_MAX),window.zoom.updateButton(t,ZOOM_MIN)},destroyZoom(){l&&(l.destroy(),window.scale=1,window.zoom.updateZoomButtons())}},$(document).ready(function(){if(document.querySelector("#btn-init")&&document.querySelector("#btn-init").hasAttribute("disabled")&&"undefined"!=typeof VirtualMirror&&null!==VirtualMirror&&(VirtualMirrorManager.init(),utagFiller.asyncVMEvent("OnPageLoad")),$("#contentWrapper.pdp").length>0&&(refreshSizeInfo(),s(),utagFiller.setPDP()),$("#tryItInStore").length>0&&null!=GetURLParameter("storeModalTab")&&($("#tryItInStore").click(),$("#field-booking-bet").val(GetURLParameter("storeModalTab")),$("#store-locator-search-place-bet").click()),$("#userWishlist").length>0&&wishlistJS.initWishListItems(!0),GetURLParameter("scrollTo")){GetURLParameter("scrollTo");$(".svEnableListCarouselSlick.ymal").length>0&&$(".svEnableListCarouselSlick.ymal").get(0).scrollIntoView({block:"center"})}})}(),pdpJS={findInStoreBTE:function(e){let t=new Map;if(null!=e){var r=!1;let h=$("#product-model-hidden").val(),g=$("#PDPItemStoreInv-"+h).html();var a=$("#productMinQuantity").val(),i=parseInt(a),o=null;if(null!=g&&void 0!==g&&(o=JSON.parse(g)),null!=o&&o.length>0){r=!0;for(var n=0,s=0;s<o.length;s++)if(null!=o[s]&&""!=o[s])for(var l=o[s].split(":"),d=l[0],c=l[1],u=parseInt(c),p=0;p<e.length;p++)e[p].storeNumber==d&&(e[p].minQuantity=u<=i?"true":"false",n++,t.set(d,e[p]))}if(0!=n&&r)null!=g&&void 0!==g&&($(".unavailable-message").addClass("d-none"),$(".available-message").removeClass("d-none"),$("#store-locator-main-map-stores .product-wrapper").removeClass("not-available"),$("#initTabModal").attr("product-available","true"),t=new Map([...t].sort(([e,t],[r,a])=>t.distance>a.distance?1:t.distance<a.distance?-1:0)));else{for(var m=0;m<10&&m<e.length;m++)t.set(e[m].storeNumber,e[m]);if(null!=g&&void 0!==g){$(".available-message").addClass("d-none"),$(".unavailable-message").removeClass("d-none"),$("#store-locator-main-map-stores .product-wrapper").addClass("not-available"),$("#initTabModal").attr("product-available","false");tealium_data2track.push({id:"Error",Error_Source:"User",Error_Code:"TAB OEE: Product not available",Error_Detail:"Product not available in stores near the user",Error_Message:"Gli occhiali che hai cercato non sono disponibili nei negozi vicini a te."})}}}return t}},searchSuggestJS={langId:"",storeId:"",catalogId:"",searchSuggestContainerId:"",searchSuggestMobileContainerId:"",mapViewRequested:{},waitTime:1e3,currentWait:-1,setWaitTime:function(e){searchSuggestJS.waitTime=e},setCommonParameters:function(e,t,r){searchSuggestJS.langId=e,searchSuggestJS.storeId=t,searchSuggestJS.catalogId=r},setSearchSuggestContainerId:function(e){searchSuggestJS.searchSuggestContainerId=e},setSearchSuggestMobileContainerId:function(e){searchSuggestJS.searchSuggestMobileContainerId=e},waitAndSend:function(e,t,r){clearTimeout(searchSuggestJS.currentWait),searchSuggestJS.currentWait=setTimeout(function(){""===e.trim()?($("#search-modal .default-search-btn-wrapper").show(),$(".suggested-search-container").hide()):($("#search-modal .default-search-btn-wrapper").hide(),$(".suggested-search-container").show(),searchSuggestJS.sendRequestSearch(e,t,r))},searchSuggestJS.waitTime)},sendRequestSearch:function(e,t,r){var a={};searchSuggestJS.populateParams(a),a.searchTerm=e,null==t&&(t=searchSuggestJS.defaultSearchTermSuccessCallback),searchSuggestJS.showBlankView(),searchSuggestJS.showSpinnerItems(),$.ajax({url:"SearchAutoSuggestKeywordsJson",data:a,type:"GET",success:function(r){t(r,e)},error:r})},populateParams:function(e){e.langId=searchSuggestJS.langId,e.storeId=searchSuggestJS.storeId,e.catalogId=searchSuggestJS.catalogId},defaultSearchTermSuccessCallback:function(e,t){try{var r,a=JSON.parse(e);if(void 0===a.suggestionView||null===a.suggestionView||void 0===a.suggestionView[0]||null===a.suggestionView[0]||void 0===a.suggestionView[0].entry||null===a.suggestionView[0].entry)return searchSuggestJS.showBlankView(),void searchSuggestJS.showNoResultItems();r=a.suggestionView[0].entry,searchSuggestJS.showSpinnerView(),searchSuggestJS.showSearchedItems(),0!==r.length&&r[0].term===t||r.push({term:t}),searchSuggestJS.emptyMobileItems(),searchSuggestJS.emptyDesktopItems();for(var i=0;i<r.length;i++){var o=!1;0===i&&(searchSuggestJS.loadViewWithTerm(r[i].term),o=!0),searchSuggestJS.createMobileEntryWithUrl(r[i].term,t),searchSuggestJS.createDesktopEntryWithUrl(r[i].term,t,o)}}catch(e){}},emptyMobileItems:function(){$(".suggested-item-mobile").remove()},emptyDesktopItems:function(){$(".suggested-item-desktop").remove()},loadViewWithTerm:function(e){if(searchSuggestJS.showSpinnerView(),$(".suggested-products-view[data-suggested-products-term='"+e+"']").length>0)searchSuggestJS.showViewWithTerm(e);else if(void 0===searchSuggestJS.mapViewRequested[e]||null===searchSuggestJS.mapViewRequested[e]||!searchSuggestJS.mapViewRequested[e]){searchSuggestJS.mapViewRequested[e]=!0;var t={};searchSuggestJS.populateParams(t),t.searchTerm=e,$.ajax({url:"SearchAutoSuggestProductsView",data:t,type:"GET",success:function(t){""===t?searchSuggestJS.mapViewRequested[e]=!1:(searchSuggestJS.appendToNavTabView(t),$(".suggested-item-desktop[data-item-term='"+e+"' ].selected").length>0&&searchSuggestJS.showViewWithTerm(e),productDisplayJS.initMiniTiles(),searchSuggestJS.initCurrentViewCarouselMiniTiles($(".suggested-products-view[data-suggested-products-term='"+e+"']")))}})}},showViewWithTerm:function(e){$(".suggested-products-spinner").hide(),$(".suggested-products-blank").hide(),$(".suggested-products-views").show(),$(".suggested-products-view[data-suggested-products-term='"+e+"']").show()},showSpinnerView:function(){$(".suggested-products-views").hide(),$(".suggested-products-view").hide(),$(".suggested-products-blank").hide(),$(".suggested-products-spinner").show()},showBlankView:function(){$(".suggested-products-spinner").hide(),$(".suggested-products-views").hide(),$(".suggested-products-view").hide(),$(".suggested-products-blank").show()},showSpinnerItems:function(){$(".suggested-items-spinner").show(),$(".suggested-items-container").hide(),$(".suggested-no-items").hide()},showSearchedItems:function(){$(".suggested-items-spinner").hide(),$(".suggested-items-container").show(),$(".suggested-no-items").hide()},showNoResultItems:function(){$(".suggested-items-spinner").hide(),$(".suggested-items-container").hide(),$(".suggested-no-items").show()},createMobileEntryWithUrl:function(e,t){var r=searchSuggestJS.getMobileItemTemplate(e,t.toLowerCase());$("."+searchSuggestJS.searchSuggestMobileContainerId+" .suggested-terms-items-mobile").append(r)},getMobileItemTemplate:function(e,t){return $("<div class='search-hints__item suggested-item-mobile' onclick='searchSuggestJS.goToSearchPageWithTerm(\""+t+"\")'>"+e.replace(t,"<strong>"+t+"</strong>")+"</div>")},createDesktopEntryWithUrl:function(e,t,r){var a=searchSuggestJS.getDesktopItemTemplate(e,t.toLowerCase(),r);$("."+searchSuggestJS.searchSuggestContainerId+" .suggested-items-container").append(a)},getDesktopItemTemplate:function(e,t,r){var a="<div ";return a+=" class='search-hints__item suggested-item-desktop ",a+=void 0!==r&&!0===r?" selected' ":"' ",a+="data-item-term='"+e+"' ",a+=" onclick='",a+='searchSuggestJS.goToSearchPageWithTerm("'+e+'")',a+="' ",a+=" onmouseover='",a+='searchSuggestJS.selectItemWithSearchTerm("'+e+'")',a+="' ",a+=">",a+=e.replace(t,"<strong>"+t+"</strong>"),a+="</div>",$(a)},appendToNavTabView:function(e){$("."+searchSuggestJS.searchSuggestContainerId).find(".suggested-products-views").append(e)},goToSearchPageWithTerm:function(e){location.href="/SearchDisplay?searchTerm="+encodeURIComponent(e)+"&storeId=10750"},selectItemWithSearchTerm:function(e){$(".suggested-item-desktop").removeClass("selected"),$("[data-item-term='"+e+"']").addClass("selected"),searchSuggestJS.loadViewWithTerm(e)},initCurrentViewCarouselMiniTiles:function(e){e.find(".product--colors").each(function(){var e=$(this),t=$(this).parents(".single-prod"),r=$(this).children();if($(r).on("mouseover",function(){$(".product--color-item").removeClass("product--color-item--default")}),e.find("div.product--color-item").length>3){if(t.find(".product--colors").hasClass("slick-initialized"))return!0;t.find(".product--colors").slick({dots:!1,infinite:!1,speed:300,slidesToShow:3,slidesToScroll:1})}})}},function(e){"use strict";function t(e){return"string"==typeof e}function r(e){return!!e&&e.nodeType>0}function a(e){return e&&e.nodeType&&3===e.nodeType}function i(e){return e&&"function"==typeof e}function o(e){return null!=e}function n(e){return!!o(e)&&("true"===e||"1"===e||!0===e||1===e||!("false"===e||"0"===e||!1===e||0===e||t(e)&&S(e))&&!!e)}function s(e){return e&&i(e.toString)&&"[object Expression]"===e.toString()}function l(e){return e&&e.parent&&re.get(e.element)}function d(e){return e.replace(H.escape,"\\$&")}function c(e,t){var r=F.start().replace(/\\/g,""),a="",i=t?e:r;i.length>1&&(a="|\\"+i.substr(0,1)+"(?!\\"+i.substr(1,1)+")[^"+i.substr(0,1)+"]*"),H.sequence=new RegExp(F.start()+".+?"+F.end()+"|[^"+F.start()+"]+"+a,"g"),H.token=new RegExp(F.start()+".*?"+F.end(),"g"),H.expression=new RegExp(F.start()+"|"+F.end(),"gm")}function u(e){return""===e[0]&&e.shift(),""===e[e.length-1]&&e.pop(),e}function p(e){return e.replace(H.expression,"")}function m(e,t){e.parentNode&&e.parentNode.insertBefore(t,e.nextSibling)}function h(e,t){("object"==typeof document&&document.documentElement.classList?function(e,t){e.classList.remove(t)}:function(e,t){if(!e||!e.className)return!1;var r=new RegExp("(^|\\s)"+t+"(\\s|$)","g");e.className=e.className.replace(r,"$2")})(e,t)}function g(e){function t(t){if(t){if("object"!=typeof t)return t;var r;try{r=t[e]?t[e]:t[e]=++a+e}catch(e){}return r}}var r={},a=0;this.remove=function(e){delete r[t(e)]},this.get=function(e){return r[t(e)]},this.put=function(e,a){r[t(e)]=a},this.has=function(e){return void 0!==r[t(e)]},this.getData=function(){return r},this.dispose=function(){for(var e in r)r.hasOwnProperty(e)&&delete r[e];this.length=0}}function f(e,t,r){var a=e.match(H.repeat);a&&(t[a[1]]=r)}function v(e,t,r){var a=new te(t);return $(e,a.pattern,a.path,a.params,void 0,void 0,void 0,r)}function $(e,t,r,a,n,s,l,d){if(t===V.element)return d[V.element];if(t===V.parentElement)return d[V.parentElement];if(t===V.attribute)return d[V.attribute];if(t===V.scope)return d[V.scope];if(H.string.test(t))return function(e){return H.string.test(e)?e.substr(1,e.length-2):e}(t);if(!isNaN(t))return+t;var c=[];if(!l&&a)for(var u=0,p=a.length;p>u;u++)c.push(v(e,a[u],d));else c=l;if(s)return c;var m=function(e,t){for(var r=y(t),a=e;r>0;)a=a._parent?a._parent:a,r--;return a}(e,t);if(t=t.replace(/..\//g,""),r=r.replace(/..\//g,""),m){var h=m,g=r.split(/\.|\[|\]/g);if(g.length>0)for(var f=0,C=g.length;C>f;f++)if(""!==g[f]&&(h=h[g[f]]),!o(h))return m._parent?$(m._parent,t,r,a,n,s,c):void 0;return i(h)?n?h:h.apply(null,c):h}}function C(e){var t=e.split("(")[0];return function(e){return e.replace(H.depth,"")}(t)}function y(e){var t=e.split("(")[0].match(H.depth);return t?t.length:0}function b(e,t,r){var a;return e.attributes=e.attributes||[],t===j.attributes.skip&&(e.skip=n(r)),t===j.attributes.html&&(e.html=n(r)),t!==j.attributes.repeat||e.isRepeaterDescendant||(e.repeater=r),(S(t+":"+r)||t===j.attributes.repeat||t===j.attributes.skip||t===j.attributes.html||t===j.attributes.show||t===j.attributes.hide||t===j.attributes.href||t===j.attributes.class||t===j.attributes.checked||t===j.attributes.disabled||t===j.attributes.multiple||t===j.attributes.readonly||t===j.attributes.selected||-1!==r.indexOf(j.attributes.cloak))&&(a=new K(t,r,e),e.attributes.push(a)),G[t]&&(a=new K(t,r,e),e.attributes.push(a)),a}function S(e){var t=e.match(H.token);return t&&t.length>0}function w(e){if(e){var t=e.nodeType;return!(!e||!t)&&(8!==t&&!(3===t&&!function(e){return H.content.test(e)}(e.nodeValue)&&!S(e.nodeValue)))}}function I(e,t,r,a){var i;if(w(t)&&(a?(i=a).parent=r:i=function(e,t){var r=new Y(e,t);r.previousSibling=e.previousSibling,r.nextSibling=e.nextSibling;for(var a,i=[],o=e.attributes,n=0,s=o&&o.length;s>n;n++)if((a=o[n]).specified||"value"===a.name){var l=b(r,a.name,a.value);G[a.name]&&G[a.name]&&!r.isRepeaterChild&&i.push({name:G[a.name],value:a.value,attr:l})}for(var d=0,c=i.length;c>d;d++)r.addEvent(i[d].name,i[d].value,i[d].attr);return r}(t,r?r.scope:new X(R)._createChild()),r&&(r.repeater||r.isRepeaterChild)&&(i.isRepeaterChild=!0),i.template=e,!i.skip)){for(var o=t.firstChild;o;){var n=I(e,o,i);n&&(n.parent=i,i.children.push(n)),o=o.nextSibling}return i}}function k(e){var t,r=function(e,t){var r=e.match(H.repeat);if(r){var a=r[2];return new te(a).getValue(t)}}(e.repeater,e.scope);if(function(e){return"[object Array]"===Object.prototype.toString.apply(e)}(r)){for(var a=0,i=r.length,o=e.childrenRepeater.length,n=i>o?i:o;n>a;a++)i>a?t=P(e,a,r[a],V.index,a,t):(e.parent.element.removeChild(e.childrenRepeater[a].element),e.childrenRepeater[a].dispose());e.childrenRepeater.length>r.length&&(e.childrenRepeater.length=r.length)}else{var s=-1;for(var l in r)r.hasOwnProperty(l)&&(t=P(e,++s,r[l],V.key,l,t));for(var d=s;s++<e.childrenRepeater.length-1;)e.parent.element.removeChild(e.childrenRepeater[s].element),e.childrenRepeater[s].dispose();e.childrenRepeater.length=d+1}e.element.parentNode&&e.element.parentNode.removeChild(e.element)}function T(e,t){var r=new Y(e,t.scope._createChild());return r.template=t.template,r.parent=t,r.isRepeaterChild=!0,r.isRepeaterDescendant=!0,function e(t,r){if(w(r.element)){if(t.attributes)for(var a=0,i=t.attributes.length;i>a;a++){var o=t.attributes[a],n=b(r,o.name,o.value);G[o.name]&&r.addEvent(G[o.name],o.value,n)}for(var s=t.element.firstChild,l=r.element.firstChild;s&&l;){var d=t.getNode(s),c=new Y(l,r.scope);r.children.push(c),c.parent=r,c.template=r.template,c.isRepeaterChild=!0;var u=e(d,c);u&&(u.parent=c,u.template=c.template,c.children.push(u)),s=s.nextSibling,l=l.nextSibling}return c}}(t,r),r}function P(e,t,r,a,i,o){var n=e.childrenRepeater[t];if(n)return f(e.repeater,n.scope,r),n.scope[a]=i,n.update(),n.render(),n.element;var s=e.element.cloneNode(!0);!function(e,t,r){e?m(e,r):t.element.previousSibling?m(t.element.previousSibling,r):t.element.nextSibling?function(e,t){e.parentNode&&e.parentNode.insertBefore(t,e)}(t.element.nextSibling,r):t.parent.element.appendChild(r)}(o,e,s);var l=T(s,e);return e.childrenRepeater[t]=l,f(e.repeater,l.scope,r),l.scope[a]=i,l.update(),l.render(),s}function A(e,t,r){if(e.addEventListener)e.addEventListener(t,r,!1);else{r.$$guid||(r.$$guid=A.guid++),e.events||(e.events={});var a=e.events[t];a||(a=e.events[t]={},e["on"+t]&&(a[0]=e["on"+t])),a[r.$$guid]=r,e["on"+t]=function(e){var t=!0;e=e||x(((this.ownerDocument||this.document||this).parentWindow||window).event);var r=this.events[e.type];for(var a in r)r.hasOwnProperty(a)&&(this.$$handleEvent=r[a],!1===this.$$handleEvent(e)&&(t=!1));return t}}}function _(e,t,r){e.removeEventListener?e.removeEventListener(t,r,!1):e.events&&e.events[t]&&delete e.events[t][r.$$guid]}function x(e){return e.preventDefault=x.preventDefault,e.stopPropagation=x.stopPropagation,e}function E(e,t){for(var r,a,o,n=e.attributes,s=0,l=n&&n.length;l>s;s++)if((r=n[s]).specified&&(a=r.name,o=r.value,G[a])){var d=O(t,o);d&&i(d)&&(A(e,G[a],d),oe.push({element:e,type:G[a],handler:d}))}}function O(e,t){var r=t.match(H.func);if(r){var a=r[1];if(i(e[a]))return e[a]}}function L(a,i){var o;if(t(a)){if(!r(i))throw new Error(e.template.errors.TEMPLATE_STRING_NO_ELEMENT);i.innerHTML=a,o=i}else{if(!r(a))throw new Error(e.template.errors.TEMPLATE_NO_PARAM);r(i)?(i.innerHTML=a.innerHTML,o=i):o=a}D(o)&&(D(o).dispose(),re.remove(o));var n=new ae(o);return re.put(o,n),n}function D(e){return re.get(e)}e.template=e.template||{},e.template.version="0.3.0",e.template.errors={TEMPLATE_STRING_NO_ELEMENT:"Error in soma.template, a string template requirement a second parameter: an element target - soma.template.create('string', element)",TEMPLATE_NO_PARAM:"Error in soma.template, a template requires at least 1 parameter - soma.template.create(element)"};var M="{{",N="}}",J={},R={},j=e.template.settings=e.template.settings||{};j.autocreate=!0;var F=j.tokens={start:function(e){return o(e)&&""!==e&&(M=d(e),c(e,!0)),M},end:function(e){return o(e)&&""!==e&&(N=d(e),c(e,!1)),N}},U=j.attributes={skip:"data-skip",repeat:"data-repeat",src:"data-src",href:"data-href",show:"data-show",hide:"data-hide",cloak:"data-cloak",checked:"data-checked",disabled:"data-disabled",multiple:"data-multiple",readonly:"data-readonly",selected:"data-selected",template:"data-template",html:"data-html",class:"data-class"},V=j.vars={index:"$index",key:"$key",element:"$element",parentElement:"$parentElement",attribute:"$attribute",scope:"$scope"},G=j.events={};j.eventsPrefix="data-";for(var W="click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup focus blur change select selectstart scroll copy cut paste mousewheel keypress error contextmenu input textinput drag dragenter dragleave dragover dragend dragstart dragover drop load submit reset search resize beforepaste beforecut beforecopy",B=(W+=" touchstart touchend touchmove touchenter touchleave touchcancel gesturestart gesturechange gestureend").split(" "),z=-1,q=B.length;++z<q;)G[j.eventsPrefix+B[z]]=B[z];var H={sequence:null,token:null,expression:null,escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,trim:/^[\s+]+|[\s+]+$/g,repeat:/(.*)\s+in\s+(.*)/,func:/(.*)\((.*)\)/,params:/,\s+|,|\s+,\s+/,quote:/\"|\'/g,content:/[^.|^\s]/gm,depth:/..\//g,string:/^(\"|\')(.*)(\"|\')$/},Z=function(){if("object"==typeof document){for(var e=3,t=!1,r=document.createElement("div");!t;)r.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e",r.getElementsByTagName("i")[0]||(t=!0);return e>4?e:void 0}}(),Q="object"!=typeof document?function(){}:document.documentElement.contains?function(e,t){var r=9===e.nodeType?e.documentElement:e,a=t&&t.parentNode;return e===a||!!(a&&1===a.nodeType&&r.contains&&r.contains(a))}:document.documentElement.compareDocumentPosition?function(e,t){return t&&!!(16&e.compareDocumentPosition(t))}:function(e,t){for(;t=t.parentNode;)if(t===e)return!0;return!1},X=function(e){function t(e){var t=r(e);return t._parent=a,a._children.push(t),t}function r(e){var r=e||{};return r._parent=null,r._children=[],r._createChild=function(){return a=r,t.apply(r,arguments)},r}var a;return r(e)},Y=function(e,t){this.element=e,this.scope=t,this.attributes=null,this.value=null,this.interpolation=null,this.invalidate=!1,this.skip=!1,this.repeater=null,this.isRepeaterDescendant=!1,this.isRepeaterChild=!1,this.parent=null,this.children=[],this.childrenRepeater=[],this.previousSibling=null,this.nextSibling=null,this.template=null,this.eventHandlers={},this.html=!1,a(this.element)&&(this.value=this.element.nodeValue,this.interpolation=new ee(this.value,this,void 0))};Y.prototype={toString:function(){return"[object Node]"},dispose:function(){var e,t;if(this.clearEvents(),this.children)for(e=0,t=this.children.length;t>e;e++)this.children[e].dispose();if(this.childrenRepeater)for(e=0,t=this.childrenRepeater.length;t>e;e++)this.childrenRepeater[e].dispose();if(this.attributes)for(e=0,t=this.attributes.length;t>e;e++)this.attributes[e].dispose();this.interpolation&&this.interpolation.dispose(),this.element=null,this.scope=null,this.attributes=null,this.value=null,this.interpolation=null,this.repeater=null,this.parent=null,this.children=null,this.childrenRepeater=null,this.previousSibling=null,this.nextSibling=null,this.template=null,this.eventHandlers=null},getNode:function(e){var t;if(e===this.element)return this;if(this.childrenRepeater.length>0)for(var r=0,a=this.childrenRepeater.length;a>r;r++)if(t=this.childrenRepeater[r].getNode(e))return t;for(var i=0,o=this.children.length;o>i;i++)if(t=this.children[i].getNode(e))return t;return null},getAttribute:function(e){if(this.attributes)for(var t=0,r=this.attributes.length;r>t;t++){var a=this.attributes[t];if(a.interpolationName&&a.interpolationName.value===e)return a}},update:function(){if(!l(this)){if(o(this.interpolation)&&this.interpolation.update(),o(this.attributes))for(var e=0,t=this.attributes.length;t>e;e++)this.attributes[e].update();!function(e){if(!e.repeater&&e.children&&!l(e))for(var t=0,r=e.children.length;r>t;t++)e.children[t].update()}(this)}},invalidateData:function(){if(!l(this)){var e,t;if(this.invalidate=!0,this.attributes)for(e=0,t=this.attributes.length;t>e;e++)this.attributes[e].invalidate=!0;for(e=0,t=this.childrenRepeater.length;t>e;e++)this.childrenRepeater[e].invalidateData();for(e=0,t=this.children.length;t>e;e++)this.children[e].invalidateData()}},addEvent:function(e,t,r){if(!this.repeater){this.eventHandlers[e]&&this.removeEvent(e);var a=this.scope,i=this,o=function(e){var o=new te(t,i,r),n=o.getValue(a,!0),s=o.getValue(a,!1,!0);s.unshift(e),n&&n.apply(null,s)};this.eventHandlers[e]=o,A(this.element,e,o)}},removeEvent:function(e){_(this.element,e,this.eventHandlers[e]),this.eventHandlers[e]=null,delete this.eventHandlers[e]},clearEvents:function(){if(this.eventHandlers)for(var e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&this.removeEvent(e);if(this.children)for(var t=0,r=this.children.length;r>t;t++)this.children[t].clearEvents();if(this.childrenRepeater)for(var a=0,i=this.childrenRepeater.length;i>a;a++)this.childrenRepeater[a].clearEvents()},render:function(){if(!l(this)){if(this.invalidate&&(this.invalidate=!1,a(this.element)&&(this.value=this.parent&&this.parent.html?this.parent.element.innerHTML=this.interpolation.render():this.element.nodeValue=this.interpolation.render())),this.attributes)for(var e=0,t=this.attributes.length;t>e;e++)this.attributes[e].render();this.repeater?k(this):function(e){if(e.children&&!l(e))for(var t=0,r=e.children.length;r>t;t++)e.children[t].render()}(this)}}};var K=function(e,t,r){this.name=e,this.value=t,this.node=r,this.interpolationName=new ee(this.name,null,this),this.interpolationValue=new ee(this.value,null,this),this.invalidate=!1};K.prototype={toString:function(){return"[object Attribute]"},dispose:function(){this.interpolationName&&this.interpolationName.dispose(),this.interpolationValue&&this.interpolationValue.dispose(),this.interpolationName=null,this.interpolationValue=null,this.node=null,this.name=null,this.value=null,this.previousName=null},update:function(){this.node.repeater||(this.interpolationName.update(),this.interpolationValue.update())},render:function(){function e(e,t,a){"value"===e&&void 0!==a.element.value?r.value=t:7===Z&&"class"===e?r.className=t:r.setAttribute(e,t)}function t(e,t){n(e)?r.setAttribute(t,t):r.removeAttribute(t)}if(!this.node.repeater){var r=this.node.element;if(this.invalidate&&(this.invalidate=!1,this.previousName=this.name,this.name=o(this.interpolationName.render())?this.interpolationName.render():this.name,this.value=o(this.interpolationValue.render())?this.interpolationValue.render():this.value,this.name===U.src?function(e){r.setAttribute("src",e)}(this.value):this.name===U.href?function(e){r.setAttribute("href",e)}(this.value):((7!==Z||7===Z&&!this.node.isRepeaterChild)&&this.node.element.removeAttribute(this.interpolationName.value),this.previousName&&(7===Z&&"class"===this.previousName?this.node.element.className="":(7!==Z||7===Z&&!this.node.isRepeaterChild)&&this.node.element.removeAttribute(this.previousName)),e(this.name,this.value,this.node))),this.name===U.class){var a,i,s,l;try{a=JSON.parse(this.value)}catch(e){throw new Error("Error, the value of a data-class attribute must be a valid JSON: "+this.value)}for(i in a)l=!!(s=a[i])&&n(s),!!s&&n(s),l?this.node.element.classList.add(i):h(this.node.element,i)}if("class"===this.name&&-1!==this.value.indexOf(j.attributes.cloak)&&h(this.node.element,j.attributes.cloak),this.name===U.hide){var d=n(this.value);e(this.name,d,this.node),r.style.display=d?"none":""}if(this.name===U.show){d=n(this.value);e(this.name,d,this.node),r.style.display=d?"":"none"}if(this.name===U.checked&&(t(this.value,"checked"),e(this.name,!!n(this.value),this.node),r.checked=!!n(this.value)),this.name===U.disabled&&(t(this.value,"disabled"),e(this.name,!!n(this.value),this.node)),this.name===U.multiple&&(t(this.value,"multiple"),e(this.name,!!n(this.value),this.node)),this.name===U.readonly){d=n(this.value);7===Z?r.readOnly=!!d:t(this.value,"readonly"),e(this.name,!!d,this.node)}this.name===U.selected&&(t(this.value,"selected"),e(this.name,!!n(this.value),this.node))}}};var ee=function(e,t,r){this.value=t&&!a(t.element)?function(e){return e.replace(H.trim,"")}(e):e,this.node=t,this.attribute=r,this.sequence=[],this.expressions=[];var i=this.value.match(H.sequence);if(i){for(var o=0,n=i.length;n>o;o++)if(i[o].match(H.token)){var s=new te(p(i[o]),this.node,this.attribute);this.sequence.push(s),this.expressions.push(s)}else this.sequence.push(i[o]);u(this.sequence)}};ee.prototype={toString:function(){return"[object Interpolation]"},dispose:function(){if(this.expressions)for(var e=0,t=this.expressions.length;t>e;e++)this.expressions[e].dispose();this.value=null,this.node=null,this.attribute=null,this.sequence=null,this.expressions=null},update:function(){for(var e=-1,t=this.expressions.length;++e<t;)this.expressions[e].update()},render:function(){var e="";if(this.sequence)for(var t=0,r=this.sequence.length;r>t;t++){var a="";o(a=s(this.sequence[t])?this.sequence[t].value:this.sequence[t])||(a=""),e+=a}return e}};var te=function(e,r,a){o(e)&&(this.pattern=e,this.isString=H.string.test(e),this.node=r,this.attribute=a,this.value=this.isString?this.pattern:void 0,this.isString?(this.isFunction=!1,this.depth=null,this.path=null,this.params=null):(this.isFunction=function(e){return!!t(e)&&!!e.match(H.func)}(this.pattern),this.depth=y(this.pattern),this.path=C(this.pattern),this.params=this.isFunction?function(e){return u(e.split(H.params))}(this.pattern.match(H.func)[2]):null))};te.prototype={toString:function(){return"[object Expression]"},dispose:function(){this.pattern=null,this.node=null,this.attribute=null,this.path=null,this.params=null,this.value=null},update:function(){var e=this.node;if(!e&&this.attribute&&(e=this.attribute.node),e||!e.scope){var t=this.getValue(e.scope);t=function(e,t){var r=e.node||e.attribute.node,n=r.template.watchers,s=r.element;if(!n)return t;var l=n.get(s);!l&&a(r.element)&&r.parent&&(l=n.get(r.parent.element));var d=l||n.get(e.pattern);if(i(d)){var c=d(e.value,t,e.pattern,r.scope,r,e.attribute);if(o(c))return c}return t}(this,t),this.value!==t&&(this.value=t,(this.node||this.attribute).invalidate=!0)}},getValue:function(e,t,r){var a=this.node;!a&&this.attribute&&(a=this.attribute.node);var i={};return a&&(i[V.element]=a.element,a.element&&(i[V.parentElement]=a.element.parentNode)),i[V.attribute]=this.attribute,i[V.scope]=e,$(e,this.pattern,this.path,this.params,t,r,void 0,i)}};var re=new g("st"),ae=function(e){this.watchers=new g("stw"),this.node=null,this.scope=null,this.compile(e)};ae.prototype={toString:function(){return"[object Template]"},compile:function(e){e&&(this.element=e),this.node&&this.node.dispose(),this.node=I(this,this.element),this.node.root=!0,this.scope=this.node.scope},update:function(e){o(e)&&function(e,t){for(var r in function(e){for(var t in e)e.hasOwnProperty(t)&&"_"!==t.substr(0,1)&&(e[t]=null,delete e[t])}(e),t)t.hasOwnProperty(r)&&(e[r]=t[r])}(this.node.scope,e),this.node&&this.node.update()},render:function(e){this.update(e),this.node&&this.node.render()},invalidate:function(){this.node&&this.node.invalidateData()},watch:function(e,a){(t(e)||r(e))&&i(a)&&this.watchers.put(e,a)},unwatch:function(e){this.watchers.remove(e)},clearWatchers:function(){this.watchers.dispose()},clearEvents:function(){this.node.clearEvents()},getNode:function(e){return this.node.getNode(e)},dispose:function(){re.remove(this.element),this.watchers&&this.watchers.dispose(),this.node&&this.node.dispose(),this.element=null,this.watchers=null,this.node=null}},A.guid=1,x.preventDefault=function(){this.returnValue=!1},x.stopPropagation=function(){this.cancelBubble=!0};var ie,oe=[];if("object"==typeof document){var ne=function(){function e(e){for(c=1;e=r.shift();)e()}var t,r=[],a=document,i=a.documentElement,o=i.doScroll,n="DOMContentLoaded",s="addEventListener",l="onreadystatechange",d="readyState",c=/^loade|c/.test(a[d]);return a[s]&&a[s](n,t=function(){a.removeEventListener(n,t,!1),e()},!1),o&&a.attachEvent(l,t=function(){/^c/.test(a[d])&&(a.detachEvent(l,t),e())}),o?function(e){self!=top?c?e():r.push(e):function(){try{i.doScroll("left")}catch(t){return setTimeout(function(){ne(e)},50)}e()}()}:function(e){c?e():r.push(e)}}();if(j.autocreate){var se=function(t){for(var r=t?t.firstChild:document.body;r;){if(1===r.nodeType){se(r);var a=r.getAttribute(U.template);if(a){var o=new Function("return "+a+";")();i(o)&&e.template.bootstrap(a,r,o)}}r=r.nextSibling}};ne(se)}}F.start(M),F.end(N),e.plugins=e.plugins||{};var le=function(t,a){t.constructor.prototype.createTemplate=function(t,i){if(!t||"function"!=typeof t)throw new Error("Error creating a template, the first parameter must be a function.");if(i&&r(i)){var o=e.template.create(i);for(var n in o)"function"==typeof o[n]&&(t.prototype[n]=o[n].bind(o));t.prototype.render=o.render.bind(o);var s=a.createChild();return s.mapValue("template",o),s.mapValue("scope",o.scope),s.mapValue("element",o.element),s.createInstance(t)}return null},e.template.bootstrap=function(e,r,a){t.createTemplate(a,r)}};e.plugins&&e.plugins.add&&e.plugins.add(le),e.template.Plugin=le,e.template.create=L,e.template.get=D,e.template.renderAll=function(){var e=re.getData();for(var t in re.getData())e.hasOwnProperty(t)&&re.get(t).render()},e.template.helpers=function(e){if(null===e&&(J={},R={}),o(e)&&function(e){return"object"==typeof e}(e))for(var t in e)e.hasOwnProperty(t)&&(J[t]=R[t]=e[t]);return J},e.template.bootstrap=function(e,t,r){var a=L(t);r(a,a.scope,a.element,a.node)},e.template.addEvent=A,e.template.removeEvent=_,e.template.parseEvents=function(e,t,a){ie=void 0===a?Number.MAX_VALUE:a,function e(t,a,i,o){if(!r(t))throw new Error("Error in soma.template.parseEvents, only a DOM Element can be parsed.");if(o&&E(t,a),0!==ie)for(var n=t.firstChild;n;)1===n.nodeType&&ie>i&&(e(n,a,++i),E(n,a)),n=n.nextSibling}(e,t,0,!0)},e.template.clearEvents=function(e){for(var t=oe.length;--t>=0;){var r=oe[t];(e===r.element||Q(e,r.element))&&(_(r.element,r.type,r.handler),oe.splice(t,1))}},e.template.ready=ne,"function"==typeof define&&void 0!==define.amd&&define("soma-template",e.template),"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=e.template),"undefined"!=typeof exports&&(exports=e.template)}(this.soma=this.soma||{}),TealeafWCJS={processDOMEvent:function(e){"undefined"!=typeof TLT&&TLT.processDOMEvent(e)},rebind:function(e){if("undefined"!=typeof TLT&&TLT.rebind){var t=$("#"+e);t&&TLT.rebind(t)}},logClientValidationCustomEvent:function(e){"undefined"!=typeof TLT&&(TLT.isInitialized()?TLT.logCustomEvent("WCClientValidation",e):setTimeout(function(){logClientValidationCustomEvent(e)},100))},createExplicitChangeEvent:function(e){if("undefined"!=typeof TLT)if(document.createEventObject&&dojo.isIE<9){var t=document.createEventObject();$("#"+e).fireEvent("onchange",t)}else{(t=document.createEvent("HTMLEvents")).initEvent("change",!0,!1),$("#"+e).dispatchEvent(t)}}},CheckoutManager={},CheckoutResources={},AjaxService={},PaSetup={},PIFunctions={},ThreeDsFlow={},Satispay={},ContactUsHelper={};const ajaxCompleteConfiguration=function(e,t,r){$(document).ajaxComplete(function(r,a,i){if(i.url.includes(e))try{let e=JSON.parse($.trim(a.responseText).replace(/^\/\*/,"").replace(/\*\/$/,""));t(e)}catch(e){}})};jQuery.extend(AjaxService,{initialCartPromise:new Promise((e,t)=>{ajaxCompleteConfiguration("/AjaxRESTCartDetails",e)})}),jQuery.extend(PIFunctions,{performPIAdd:function(e){console.log("***** performPIAdd ***** "),this.toggleButtonSpinner("#btn-submit-order"),this.toggleButtonSpinner("#btn-submit-order-mobile"),CheckoutResources.doAjax(CheckoutResources.PIAddCmd_post,e,e=>{if(e=this.toJson(e))if(["CC"].includes(e.paymentType[0]))"true"===e.success?(cartJS.cartObjectProcessed.hasGiftCard&&(this.performPIAddGiftCard(),setTimeout(function(){utagFiller.asyncCheckoutGateway("GiftCard,CC")},50)),window.lastPiId=e.piId,"cc"==$("input[name=methodofPayment]:checked").val()&&this.invokeOrderPrepare()):($("div.checkout-error-step2").show(),$("html, body").animate({scrollTop:0},"slow"),console.error("PiAddCmd error"),console.log(e),setTimeout(function(){utagFiller.asyncSendError("Error in the backend payment flow (CreditCard)","Server","PiAddCmd error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - PIAddCmd","Error in the backend payment flow (CreditCard)",JSON.stringify(e))},50));else if(["PPL"].includes(e.paymentType[0])){var t,r=!0;"true"!=e.success?r=!0:e.apSessionsReply_merchantURL?(t=e.apSessionsReply_merchantURL,r=!1):e.paypalToken&&(t=$("#paypal_redirection_url_for_rec").val()+e.paypalToken,r=!1),r?($("div.checkout-error-step2").show(),$("html, body").animate({scrollTop:0},"slow"),console.error("PiAddCmd error"),console.log(e),setTimeout(function(){utagFiller.asyncSendError("Error in the backend payment flow (PayPal)","Server","PiAddCmd error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - PIAddCmd","Error in the backend payment flow (PayPal)",JSON.stringify(e))},50)):(cartJS.cartObjectProcessed.hasGiftCard&&(this.performPIAddGiftCard(),setTimeout(function(){utagFiller.asyncCheckoutGateway("GiftCard,PPL")},50)),location.href=t)}else["SV_SCALA","Satispay"].includes(e.paymentType[0])&&(setTimeout(function(){jsLogger.info("PIFunctions - performPIAdd","Scalapay/Satispay before cartDetailsPromise")},50),cartJS.cartDetailsPromise().then(async t=>{if(t){var r=null;try{for(var a=cartJS.lastDataFetched.paymentInstruction[0].protocolData,i=0;i<a.length;++i)"checkoutUrl"==a[i].name&&(r=a[i].value)}catch(t){setTimeout(function(){utagFiller.asyncSendError("Invalid protocol format for Scalapay","Server","PiAddCmd error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - PIAddCmd","Invalid protocol format for Scalapay",JSON.stringify(e))},50)}if(r){if(cartJS.cartObjectProcessed.hasGiftCard&&["Satispay"].includes(e.paymentType[0])){await this.performPIAddGiftCard()}setTimeout(function(){jsLogger.info("PIFunctions - performPIAdd","before change location to checkoutUrl",r)},50),window.location=r}else this.showCustomError(null,e.error_mgs),setTimeout(function(){utagFiller.asyncSendError("checkoutUrl not found. mgs: "+e.error_mgs,"Server","PiAddCmd error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - PIAddCmd","checkoutUrl not found. mgs: "+e.error_mgs,JSON.stringify(e))},50)}else setTimeout(function(){utagFiller.asyncSendError("Processing error for Scalapay continue!","Server","PiAddCmd error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - PIAddCmd","Processing error for Scalapay continue!",JSON.stringify(e))},50)}));else setTimeout(function(){utagFiller.asyncSendError("Error in the backend payment flow (UnknowResponse)","Server","PiAddCmd error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - PIAddCmd","Error in the backend payment flow (UnknowResponse) - invalid response format",JSON.stringify(e))},50)},()=>{$("div.checkout-error-step2").show(),$("html, body").animate({scrollTop:0},"slow"),setTimeout(function(){utagFiller.asyncSendError("Error in the backend payment flow (NetError)","Server","PiAddCmd error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - PiAddCmd","Error in the backend payment flow (NetError) (net error)")},50)})}.bind(CheckoutManager),performPIAddGiftCard:function(){const e={storeId:this.storeId,catalogId:this.catalogId,langId:this.langId,orderId:$("#currentOrderId").val(),requesttype:"ajax",authToken:$("#csrf_authToken").val(),billingAddressId:this.getBillingAddressIdFromModel(),merchantReferenceCode:$("#currentOrderId").val(),payMethodId:"SV_GFT",paymentType:"SV_GFT",payment_method:"SV_GFT",partialAmount:Number(cartJS.cartObjectProcessed.giftCard.giftCardPaymentAmount)};return CheckoutResources.doAjaxPromise(CheckoutResources.PIAddCmd_post.url,e,"json")}.bind(CheckoutManager),extractProtocolData:(e,t)=>{return e.find(e=>e.name===t)}});const flagConfigurations={satispay:{success:"satispay_return",cancel:"satispay_return",status:"satispay_status",manager:Satispay}};$(document).ready(function(){ajaxCompleteConfiguration();const e=new URLSearchParams(window.location.search),t=Object.fromEntries(e);for(paymentMethod in flagConfigurations){let e=flagConfigurations[paymentMethod];if(t[e.success]){console.log("Got Success from "+paymentMethod+" redirect"),e.manager.continueAfterPreApproval(t[e.status]);break}if(t[e.cancel]){console.log("Got Cancel from "+paymentMethod+" redirect"),e.manager.cancelAfterPreApproval(t[e.status]);break}}});const clearLocalParameters=function(){console.log("***** clearLocalParameters ***** "),this.cardinalSessionId=null,this.serverParameters={},this.enrollResponse={}}.bind(ThreeDsFlow),runCardinalInit=function(){console.log("***** runCardinalInit ***** "),Cardinal.setup("init",{jwt:$("#cardinalJWT").val()})}.bind(ThreeDsFlow),onCardinalSetupComplete=function(e){console.log("***** setupCompleteData (WIP??) ***** "+e)}.bind(ThreeDsFlow),runBinDetection=function(){console.log("***** runBinDetection ***** ");let e=this.serverParameters.account;return Cardinal.trigger("bin.process",e).then(function(e){return e.Status?Promise.resolve(!0):Promise.resolve(!1)}).catch(function(e){return Promise.resolve(!1)})}.bind(ThreeDsFlow),runCheckEnrollment=async function(){console.log("***** runCheckEnrollment ***** "),this.enrollResponse={},delete this.serverParameters.doPaSetupCall,this.serverParameters.sessionId=this.cardinalSessionId,this.serverParameters.isRecurringOrder=isRecurringOrderInCart(),"addCard"==this.serverParameters.context?CheckoutManager.toggleButtonSpinner("#btn-submit-card"):(CheckoutManager.toggleButtonSpinner("#btn-submit-order"),CheckoutManager.toggleButtonSpinner("#btn-submit-order-mobile"));let e=await CheckoutResources.doAjaxPromise(CheckoutResources.CheckCardinalEnrollment_post.url,this.serverParameters,"json");if(!e||!e.reasonCode)return Promise.reject();if("475"==e.reasonCode&&e.payerAuthEnrollReply_acsURL&&e.payerAuthEnrollReply_paReq&&e.payerAuthEnrollReply_authenticationTransactionID)console.log("***** Card is Enrolled ***** "),console.log("***** Cardinal.continue ***** "),Cardinal.continue("cca",{AcsUrl:e.payerAuthEnrollReply_acsURL,Payload:e.payerAuthEnrollReply_paReq},{OrderDetails:{TransactionId:e.payerAuthEnrollReply_authenticationTransactionID}});else{console.log("***** Card not Enrolled or Frictionless flow ***** ");let t=e.payerAuthEnrollReply_commerceIndicator||"",r=e.payerAuthEnrollReply_cavv||"",a=e.payerAuthEnrollReply_xid||"",i=e.payerAuthEnrollReply_ucafCollectionIndicator||"",o=e.payerAuthEnrollReply_ucafAuthenticationData||"",n=e.payerAuthEnrollReply_veresEnrolled||"",s=e.payerAuthEnrollReply_threeDSServerTransactionID||"",l=e.payerAuthEnrollReply_specificationVersion||"";if(setTimeout(function(){jsLogger.info("CheckoutManager - CheckCardinalEnrollment","Card not enrolled or Frictionless flow",JSON.stringify(e))},50),"addCard"==this.serverParameters.context){if($("#commerceIndicator").val(t),$("#cavv").val(r),$("#xid").val(a),$("#ucafCollectionIndicator").val(i),$("#ucafAuthenticationData").val(o),$("#veresEnrolled").val(n),$("#threeDSServerTransactionID").val(s),$("#specificationVersion").val(l),$("#credCardInfo").length>0)$("#credCardInfo").trigger("submit",[!0]);else if($("#formNewPaymentChange").length>0){$("#paymentIdSelected").val(e.billingAddressId[0]);let t={cardinalFluxDone:!0},r=function(e){if("0"!=$("#paymentIdSelected").val()){var t=$.trim(e).replace(/^\/\*/,"").replace(/\*\/$/,""),r=JSON.parse(t);subscriptionJS.changePaymentMethod(r,!0)}};subscriptionJS.saveNewCardPayment(t,r)}}else jQuery.extend(ThreeDsFlow.serverParameters,{commerceIndicator:t,cavv:r,xid:a,ucafCollectionIndicator:i,ucafAuthenticationData:o,veresEnrolled:n,threeDSServerTransactionID:s,specificationVersion:l}),CheckoutManager.performPIAdd(this.serverParameters)}}.bind(ThreeDsFlow),is3DSOnGoing=function(){return!!this.cardinalSessionId}.bind(ThreeDsFlow);function openPixelAndSubmit(e,t){console.log("***** openPixelAndSubmit ***** ");let r='<iframe id="cardinal_collection_iframe" name="collectionIframe" height="10" width="10" style="display: none;"></iframe><form id="cardinal_collection_form" method="POST" target="collectionIframe" action="'+t+'">   <input id="cardinal_collection_form_input" type="hidden" name="JWT" value="'+e+'"></form>';$("#cardinal_collection_form").remove(),$("#cardinal_collection_iframe").remove();let a=document.createElement("div");a.innerHTML=r,document.body.appendChild(a),addWindowListenerOnce("message",async function(e){if("https://centinelapistag.cardinalcommerce.com"===e.origin||"https://centinelapi.cardinalcommerce.com"===e.origin){console.log("***** onMessageReceived ***** ");let t=JSON.parse(e.data);this.cardinalSessionId=t.SessionId,this.runCardinalInit();try{let e=await this.runBinDetection();console.log("***** onMessageReceivedResult ***** "+e)}catch(e){console.log("***** onMessageReceivedError ***** "+e.message)}this.runCheckEnrollment()}}.bind(ThreeDsFlow)),document.querySelector("#cardinal_collection_form").submit()}function addWindowListenerOnce(e,t){window.addEventListener(e,t,{once:!0})}function isRecurringOrderInCart(){return $("#isRecurringOrderItem").length?"true"===$("#isRecurringOrderItem").val():"true"==$("#isRecurringOrder").val()}jQuery.extend(ThreeDsFlow,{cardinalSessionId:null,setupCompletePromise:null,serverParameters:{},enrollResponse:{},runCardinalInit:runCardinalInit,onCardinalSetupComplete:onCardinalSetupComplete,runBinDetection:runBinDetection,runCheckEnrollment:runCheckEnrollment,is3DSOnGoing:is3DSOnGoing,clearLocalParameters:clearLocalParameters}),$(document).ready(function(){window.Cardinal&&(Cardinal.on("payments.validated",async function(e,t){console.log("** payments.validated triggered **"),jsLogger.info("Cardinal payments.validated action","Entering payments.validated","cardinalRes="+JSON.stringify(e)+", jwt="+t);const r=$("#currentOrderId").val()||$(".qukOrderId").val();switch(e.ActionCode&&jsLogger.info("Cardinal payments.validated action","cardinalRes.ActionCode is setted and its value is=",e.ActionCode),e.ErrorNumber){case 0:jsLogger.info("Cardinal payments.validated action","Switch case 0",e.ErrorNumber),$("body").after('<div class="loading-spinner"></div>');var a={orderId:r,jwt:t};let i=await CheckoutResources.doAjaxPromise(CheckoutResources.ValidateCardinalJWT_post.url,a,"json");i&&i.success?this.isCheckoutPage()?(jQuery.extend(ThreeDsFlow.serverParameters,ThreeDsFlow.enrollResponse,{authenticationTransactionID:e.Payment.ProcessorTransactionId}),this.performPIAdd(ThreeDsFlow.serverParameters)):($("#authenticationTransactionID").val(e.Payment.ProcessorTransactionId),$("#credCardInfo").length?$("#credCardInfo").trigger("submit",[!0]):$("#newPaymentMethodForm").length&&window.subscriptionJS.saveNewPayment({cardinalFluxDone:!0})):(jsLogger.severe("Cardinal payments.validated action","ValidateCardinalJWT error callback, (net error?)"),$(".checkout-error-step2").show(),$("html, body").animate({scrollTop:0},"slow"),$(".loading-spinner").remove());break;default:jsLogger.severe("Cardinal payments.validated action","Default swith case. This error is not handled!"),$(".checkout-error-step2").show(),$("html, body").animate({scrollTop:0},"slow")}}.bind(CheckoutManager)),Cardinal.on("payments.setupComplete",ThreeDsFlow.onCardinalSetupComplete),Cardinal.configure({logging:{level:"verbose"}}))}),jQuery.extend(PaSetup,{runPaSetup:async function(e){CheckoutManager.toggleButtonSpinner("#btn-submit-card"),CheckoutManager.toggleButtonSpinner("#btn-submit-order"),CheckoutManager.toggleButtonSpinner("#btn-submit-order-mobile"),this.clearLocalParameters(),this.serverParameters=e,e.doPaSetupCall=!0;let t=await CheckoutResources.doAjaxPromise(CheckoutResources.CheckCardinalEnrollment_post.url,e,"json"),r=t.payerAuthSetupReply_deviceDataCollectionURL;openPixelAndSubmit(t.payerAuthSetupReply_accessToken,r)}.bind(ThreeDsFlow),isRecurringOrderInCart:isRecurringOrderInCart}),jQuery.extend(CheckoutManager,{storeId:"10750",catalogId:"12101",langId:"-4",shippingType:"Shipping",billingType:"Billing",template:null,paymentFormValidator:null,paypalEC:{isCartPage:function(){return $("#isCartPage").length>0},isPayPalExpressFlux:function(){return"true"==$("#PayPal-EC").val()},isRecurringOrder:function(){return $("#isRecurringOrderItem").length?"true"===$("#isRecurringOrderItem").val():"true"==$("#isRecurringOrder").val()},shouldOpenThePopUp:!1},oneClickCheckout:{isOneClickCheckoutFlux:function(){return!!window.location.search.match(/ddkey.*?OrderCopy/)}},isFromRedirectPayment:function(){return!!window.location.search.match(/satispay=true/)||!!window.location.search.match(/scalapay=true/)||!!window.location.search.match(/action=PPL_success/)},signUpEmailForPolicyNotice:null,enrollReplyFields:{},model:{ShippingAddress:{list:[]},BillingAddress:{list:[],selectedId:null}},init:function(){var e=soma.template.create(document.getElementById("contentWrapper"));soma.template.helpers({isEmpty:function(e){return null==e||(!e||0===e.length)},isNotEmpty:function(e){return null!=e&&(!!e&&0!==e.length)}}),e.scope.model=this.model,e.scope.submitStep1=this.submitStep1,e.scope.paypalECSubmit=this.paypalECSubmit,e.render(),this.template=e,"G"!=window.storeUserType||"true"==window.guestAbandonedCart?(this.initData(),$(".addressItem input[type=radio]:checked").click().change()):this.paypalEC.isPayPalExpressFlux()||this.showShippingOrBillingFormByDefault(),this.paypalEC.isPayPalExpressFlux()&&this.continuePayPalExpressFlux(),google.maps.event.addDomListener(window,"load",function(){var e=document.getElementById("address1"),t=new google.maps.places.Autocomplete(e);t.setComponentRestrictions({country:"it"});e=document.getElementById("address2");var r=new google.maps.places.Autocomplete(e);r.setComponentRestrictions({country:"it"}),t.addListener("place_changed",function(){let e=this.getPlace(),t="",r="";for(let a in e.address_components){let i=e.address_components[a];switch(i.types[0]){case"postal_code":let e=i.long_name;$("#cap1").val(e),$("#cap1").valid();break;case"locality":let a=i.long_name;$("#city1").val(a),$("#error-city1").hide(),$("#city1").valid();break;case"administrative_area_level_2":let o=i.short_name;CheckoutManager.selectize_setVal("province1",o);break;case"street_number":t=i.short_name;break;case"route":r=i.short_name}}t.length>0&&(r+=", "+t),$("#address1").val(r),CheckoutManager.checkoutCartOneDayDeliveryEligible()}),r.addListener("place_changed",function(){let e=this.getPlace(),t="",r="";for(let a in e.address_components){let i=e.address_components[a];switch(i.types[0]){case"postal_code":let e=i.long_name;$("#cap2").val(e);break;case"locality":let a=i.long_name;$("#city2").val(a),$("#error-city2").hide(),$("#city2").valid();break;case"administrative_area_level_2":let o=i.short_name;CheckoutManager.selectize_setVal("province2",o);break;case"country":let n=i.short_name;CheckoutManager.selectize_setVal("nazione2",n);break;case"street_number":t=i.short_name;break;case"route":r=i.short_name}}t.length>0&&(r+=", "+t),$("#address2").val(r)})}),$.validator.addMethod("isValidZipCode",function(e,t,r){return isValidZipCode($(r).val())},"Insere un codice postale italiano valido"),$.validator.addMethod("isExcludedZipCode",function(e,t,r){return isExcludedZipCode($(r).val())},"Non è possibile consegnare in questa città"),this.prepareStep1OnSubmit(),this.prepareStep2OnSubmit(),$("#province1").on("change",function(){$("#province1").val().length>=0&&CheckoutManager.checkoutCartOneDayDeliveryEligible()});let t=$("#cap1").val();if(""==t&&$(".shipping-address-list-item.active").length>0&&(t=$(".shipping-address-list-item.active").data("cap").toString()),!CheckoutManager.isFromRedirectPayment())if(cartJS.cartObjectProcessed){t.length>=5?cartJS.checkAllItemsCategory(CheckoutManager.checkoutCartOneDayDeliveryEligible):cartJS.checkAllItemsCategory(CheckoutManager.checkoutFixDeliveryDateNotAvailable);let e=!1;for(let t of cartJS.cartObjectProcessed.orderItem)"Mail"==t.shipModeCode&&(e=!0);e&&$("#greenShipping").click()}else cartJS.cartDetailsPromise().then(e=>{t.length>=5?cartJS.checkAllItemsCategory(CheckoutManager.checkoutCartOneDayDeliveryEligible):cartJS.checkAllItemsCategory(CheckoutManager.checkoutFixDeliveryDateNotAvailable);let r=!1;for(let e of cartJS.cartObjectProcessed.orderItem)"Mail"==e.shipModeCode&&(r=!0);r&&$("#greenShipping").click()});$("#shipTypePickUp:checked").length>0&&$("#shipTypePickUpLabel").click(),setTimeout(function(){jsLogger.info("CheckoutManager","CheckoutManager was initialized",window.location.href)},1e3)},initPayPalECFromCart:function(e){if(this.paypalEC.isCartPage()&&$("#paypal-button-container").length>0&&e.paypalExpressEnabled&&!this.paypalEC.isRecurringOrder()||e.paypalExpressEnabledRec&&this.paypalEC.isRecurringOrder()&&"G"!==window.storeUserType){var t,r={style:{color:"blue",label:"checkout",height:"Desktop"==this.deviceType()?40:50},onApprove:this.onApproveCallback_PPL_EC};this.paypalEC.isRecurringOrder()?(r.createBillingAgreement=this.createOrderOrBACallback_PPL_EC,t=e.paypalSDKREC):(r.createOrder=this.createOrderOrBACallback_PPL_EC,t=e.paypalSDK),$.ajaxSetup({cache:!0}),$.getScript(t,function(e,t,a){paypal.Buttons(r).render("#paypal-button-container")}),$.ajaxSetup({cache:void 0})}},continueScalapayFlux:function(){setTimeout(function(){jsLogger.info("CheckoutManager - continueScalapayFlux()","Continue scalapay flux after user approval (redirect from Scalapay to Site)")},50),$("body").after('<div class="loading-spinner"></div>'),CheckoutManager.invokeOrderPrepare()},toJson:function(e){var t;e=$.trim(e).replace(/^\/\*/,"").replace(/\*\/$/,"");try{t=JSON.parse(e)}catch(e){return null}return t},getBillingAddressIdFromModel:function(){var e=this.model.BillingAddress.selectedId;return e||(e=window.localStorage.getItem("billingAddressId")),e||(e=$("#billing_address_id").val()),e&&window.localStorage.setItem("billingAddressId",e),console.log("billingAddressId="+e),e},gotoStep1:function(){disableSpinner("#btn-go-step-2"),$("#checkout-box-step2").hide(),$("#checkout-box-step1").show(),$("#checkout-header-steps p").removeClass("active done"),$("#checkout-header-steps").children("p").eq(0).addClass("active"),$(".shipping-summary").hide(),$("html, body").animate({scrollTop:0},"slow"),$("#loginFormActivate").removeClass("d-lg-block d-none"),this.paymentFormValidator&&this.paymentFormValidator.destroy(),setTimeout(function(){jsLogger.info("CheckoutManager","jumped to step1",window.location.href)},1e3)},gotoStep2:function(){$("#checkout-box-step2").show(),$("#checkout-box-step1").hide(),$("#checkout-header-steps p").removeClass("active"),$("#checkout-header-steps").children("p").eq(0).addClass("active done"),$("#checkout-header-steps").children("p").eq(1).addClass("active"),$(".shipping-summary").show(),$("html, body").animate({scrollTop:0},"slow"),$("#loginFormActivate").addClass("d-none"),"true"==$("#checkoutIsPickingUpInStore").val()?($(".pickUpShipInfo").show(),$(".deliveryShipInfo").hide()):($(".deliveryShipInfo").show(),$(".pickUpShipInfo").hide());var e=this.paypalEC.isPayPalExpressFlux(),t=this.paypalEC.shouldOpenThePopUp;if(e){if($(".disclosureChkLabel").show(),$("#checkout-div").css("visibility","visible"),$("#btn-submit-order").prop("disabled",!0),$("#btn-submit-order-mobile").prop("disabled",!0),t){spinnerFunc(".billingAddressSummaryText"),$(".paypalEmailAccountLabel").text($("#email1").val());var r=parseFloat($.trim($("#cartShipping").val())),a=r;r+parseFloat($.trim($("#cartDiscountTotal").val()))===0?$(".paypalShippingSummary").text("gratis"):a?($(".paypalShippingSummary").html($("#summaryShippingTotal").text()),$(".paypalShippingSummaryContainer").show()):$(".paypalShippingSummaryContainer").hide(),$(".paypalTotalSummary").html($("#grantotalOrder").text()),$("#PayPal-EC-modal").modal("show"),this.paypalEC.shouldOpenThePopUp=!1}$(".loading-spinner").remove()}this.paymentFormValidator=$("#purchaseOrderNumberInfo").validate(),setTimeout(function(){jsLogger.info("CheckoutManager","jumped to step2, isPayPalExpressFlux="+e+", shouldOpenThePopUp="+t,[window.location.href,e,t])},1e3)},submitStep1:function(e){var t=CheckoutManager;if(t.errorsInForm())return $("#billingAddressCreateEditFormDiv_1 .errorDiv:visible").length>0?$("html, body").animate({scrollTop:$("#billingAddressCreateEditFormDiv_1 .errorDiv").offset().top-100},"slow"):0==$("#billingAddressCreateEditFormDiv_1 .errorDiv:visible").length&&$("#billingAddressCreateEditFormDiv_1 .errorCheck:visible").length>0&&$("html, body").animate({scrollTop:$("#billingAddressCreateEditFormDiv_1 .errorCheck").offset().top-100},"slow"),!1;if(e=isNaN(e)?null:e,$("#checkout-pickup-errormessage").hide(),$("#btn-go-step-2-mobile").removeClass("d-block"),$("#btn-go-step-2-mobile").addClass("d-none"),$("#btn-submit-order-mobile").addClass("d-block"),$("#btn-submit-order-mobile").removeClass("d-none"),!e&&(t.signUpEmailForPolicyNotice=null,$("#policynotice").is(":visible")&&$("#policynotice").is(":checked"))){console.log("POLICY NOTICE LOGIC ON"),t.signUpEmailForPolicyNotice=$.trim($("#email1").val());if(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t.signUpEmailForPolicyNotice)){var r={storeId:t.storeId,catalogId:t.catalogId,langId:t.langId,email1:t.signUpEmailForPolicyNotice+"|"+t.storeId,signUpType:"offers"};CheckoutResources.doAjax(CheckoutResources.UserEmailSignUpCmd_post,r,function(e){},function(e){setTimeout(function(){utagFiller.asyncSendError("Error in the backend guest email newsletter registration flow","Server","UserEmailSignUpCmd error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - UserEmailSignUpCmd","Error in the backend guest email newsletter registration flow (net error)")},50)})}}let a="true"==$("#checkoutIsPickingUpInStore").val();var i=$(".shippingList:checked").attr("data-id");if(!a&&i||e){t.toggleButtonSpinner("#btn-go-step-2"),console.log("SHIPPING ADDRESS CHOSED FROM ADDRESSBOOK LIST");var o=e||i;r={storeId:t.storeId,catalogId:t.catalogId,langId:t.langId,orderId:".",calculationUsage:"-1,-2,-3,-4,-5,-6,-7",allocate:"***",backorder:"***",remerge:"***",check:"*n",calculateOrder:"1",addressId:o,requesttype:"ajax",authToken:$("#csrf_authToken").val()};console.log("ATTACHING THE SHIPPING ADDRESS TO THE ORDER"),setTimeout(function(){jsLogger.info("CheckoutManager - submitStep1( shippingIdToSaveWith )","before AjaxRESTOrderShipInfoUpdate")},50),CheckoutResources.doAjax(CheckoutResources.AjaxRESTOrderShipInfoUpdate_post,r,function(e){t.errorsInForm()?(setTimeout(function(){utagFiller.asyncSendError("Error trying to go to checkout step 2 - form not valid","User","Checkout-Step-Payment tentative error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - AjaxRESTOrderShipInfoUpdate","Error trying to go to checkout step 2 - form not valid",JSON.stringify(e))},50)):(t.gotoStep2(),"true"==$("#checkoutIsPickingUpInStore").val()?($(".shippingRecipientSummaryText").html("{1}".replace(/\{1\}/,$("#firstName").val()+" "+$("#lastName").val())),$(".shippingStoreSummaryText").html("Salmoiraghi & Viganò<br/>{2}<br/>{3}, {4} {5}".replace(/\{2\}/,$("#address1").val()).replace(/\{3\}/,$("#city1").val()).replace(/\{4\}/,$("#province1").val()).replace(/\{5\}/,$("#cap1").val())),$("#analyticsCheckoutStep2Data").append('<input type="hidden" class="analyticsHelpItem" id="analyticsCheckoutAddress" value="'+$("#address1").val()+'">'),$("#analyticsCheckoutStep2Data").append('<input type="hidden" class="analyticsHelpItem" id="analyticsCheckoutCity" value="'+$("#city1").val()+'">'),$("#analyticsCheckoutStep2Data").append('<input type="hidden" class="analyticsHelpItem" id="analyticsCheckoutProvince" value="'+$("#province1").val()+'">'),$("#analyticsCheckoutStep2Data").append('<input type="hidden" class="analyticsHelpItem" id="analyticsCheckoutCap" value="'+$("#cap1").val()+'">')):1===$(".shipping-address-list-item.active").length?($(".shippingAddressSummaryText").html($(".shipping-address-list-item.active").attr("data-summary")),$("#analyticsCheckoutStep2Data").append('<input type="hidden" class="analyticsHelpItem" id="analyticsCheckoutAddress" value="'+$(".shipping-address-list-item.active").attr("data-address")+'">'),$("#analyticsCheckoutStep2Data").append('<input type="hidden" class="analyticsHelpItem" id="analyticsCheckoutCity" value="'+$(".shipping-address-list-item.active").attr("data-city")+'">'),$("#analyticsCheckoutStep2Data").append('<input type="hidden" class="analyticsHelpItem" id="analyticsCheckoutProvince" value="'+$(".shipping-address-list-item.active").attr("data-province")+'">'),$("#analyticsCheckoutStep2Data").append('<input type="hidden" class="analyticsHelpItem" id="analyticsCheckoutCap" value="'+$(".shipping-address-list-item.active").attr("data-cap")+'">')):($(".shippingAddressSummaryText").html("{1}<br/>{2}<br/>{3}, {4} {5}".replace(/\{1\}/,$("#firstName").val()+" "+$("#lastName").val()).replace(/\{2\}/,$("#address1").val()).replace(/\{3\}/,$("#city1").val()).replace(/\{4\}/,$("#province1").val()).replace(/\{5\}/,$("#cap1").val())),$("#analyticsCheckoutStep2Data").append('<input type="hidden" class="analyticsHelpItem" id="analyticsCheckoutAddress" value="'+$("#address1").val()+'">'),$("#analyticsCheckoutStep2Data").append('<input type="hidden" class="analyticsHelpItem" id="analyticsCheckoutCity" value="'+$("#city1").val()+'">'),$("#analyticsCheckoutStep2Data").append('<input type="hidden" class="analyticsHelpItem" id="analyticsCheckoutProvince" value="'+$("#province1").val()+'">'),$("#analyticsCheckoutStep2Data").append('<input type="hidden" class="analyticsHelpItem" id="analyticsCheckoutCap" value="'+$("#cap1").val()+'">')),utagFiller.asyncCheckoutPaymentPage())}.bind(this),function(){setTimeout(function(){utagFiller.asyncSendError("Error in the order address update flow","Server","AjaxRESTOrderShipInfoUpdate error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - AjaxRESTOrderShipInfoUpdate","Error in the order address update flow (net error)")},50)})}else{if(console.log("NEW SHIPPING ADDRESS PROMPTED (check if valid)"),t.errorsInForm())return!1;if("true"==$("#checkoutIsPickingUpInStore").val()&&""==$("#address1").val())return $("#checkout-pickup-errormessage").show(),$("html, body").animate({scrollTop:parseInt($("#checkout-pickup-errormessage").offset().top)-300},1e3),!1;t.toggleButtonSpinner("#btn-go-step-2"),console.log("NEW SHIPPING ADDRESS PROMPTED (is valid)");var n="false";0===t.model.ShippingAddress.list.filter(function(e){return"true"===e.primary}).length&&(n="true");var s="Indirizzo "+parseInt(1e4*Math.random())+(new Date).getTime();let e="";if($("#phone1").val()){let t=$("#phonePrefix1").val();e=3==t.length?t+$("#phone1").val():"+39"+$("#phone1").val()}let i="Shipping";$("#sameaddr").is(":checked")&&!a&&(i="ShippingAndBilling");r={storeId:t.storeId,catalogId:t.catalogId,langId:t.langId,status:"Billing",addressType:i,authToken:$("#csrf_authToken").val(),nickName:s,addressField2:"Indirizzo da Checkout",firstName:$("#firstName").val(),lastName:$("#lastName").val(),addressField3:$.trim($("#CF").val()).toUpperCase(),address1:$("#address1").val(),address2:$("#extrainfo1").val(),city:$("#city1").val(),country:"IT",state:$("#province1").val(),zipCode:$("#cap1").val(),phone1:e,email1:$("#email1").val(),email2:$("#email2").val(),primary:n,requesttype:"ajax"};var l=$("#shipping_address_id").val();if(l){console.log("Update shipping address case"),r.addressId=l,delete r.nickName;for(var d=0;d<t.model.ShippingAddress.list.length;d++)t.model.ShippingAddress.list[d].addressId==l&&(r.primary=t.model.ShippingAddress.list[d].primary)}CheckoutResources.doAjax(CheckoutResources[l?"AjaxPersonChangeServiceAddressUpdate_post":"AjaxPersonChangeServiceAddressAdd_post"],r,function(e){try{if(e=t.toJson(e)){var r=e.addressId[0];$("#sameaddr").is(":checked")&&!a&&(t.model.BillingAddress.selectedId=r),a&&$("#billing_address_id").val(r),$("#shipping_address_id").val(r),console.log("going to add the new shipping address id "+r+" to order"),r?CheckoutManager.submitStep1(r):(setTimeout(function(){utagFiller.asyncSendError("Error in the shipping address creation flow","Server","AjaxPersonChangeServiceAddressAdd error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - AjaxPersonChangeServiceAddressAdd","Error in the shipping address creation flow",JSON.stringify(e))},50))}else setTimeout(function(){utagFiller.asyncSendError("Error in the shipping address creation flow","Server","AjaxPersonChangeServiceAddressAdd error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - AjaxPersonChangeServiceAddressAdd","Error in the shipping address creation flow - invalid response format",JSON.stringify(e))},50)}catch(t){console.log(t),setTimeout(function(){utagFiller.asyncSendError("Error in the shipping address creation flow","Server","AjaxPersonChangeServiceAddressAdd error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - AjaxPersonChangeServiceAddressAdd","Error in the shipping address creation flow - logic exception","message="+t.message+", response="+JSON.stringify(e))},50)}}.bind(this),function(){setTimeout(function(){utagFiller.asyncSendError("Error in the shipping address creation flow","Server","AjaxPersonChangeServiceAddressAdd error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - AjaxPersonChangeServiceAddressAdd","Error in the shipping address creation flow (net error)")},50)})}if(e)return!1;if($("#sameaddr").is(":checked")&&!a)console.log("BILLING ADDRES IS THE SAME AS SHIPPING ADDRESS"),i?(console.log("Copy from current selected shipping id (list)"),t.model.BillingAddress.selectedId=i,$(".billingAddressSummaryText").html($(".shipping-address-list-item.active").attr("data-summary"))):($(".billingAddressSummaryText").html("{1}<br/>{2}<br/>{3}, {4} {5}".replace(/\{1\}/,$("#firstName").val()+" "+$("#lastName").val()).replace(/\{2\}/,$("#address1").val()).replace(/\{3\}/,$("#city1").val()).replace(/\{4\}/,$("#province1").val()).replace(/\{5\}/,$("#cap1").val())),$("#shippingAddressSame").removeClass("d-none"),$("#billingAddressSummary").addClass("d-none"));else{$("#shippingAddressSame").addClass("d-none"),$("#billingAddressSummary").removeClass("d-none");var c=$(".billingList:checked").attr("data-id");if(c)t.model.BillingAddress.selectedId=c,$(".billingAddressSummaryText").html($(".billing-address-list-item.active").attr("data-summary"));else{if(t.errorsInForm())return!1;var u,p="false";if(0===t.model.BillingAddress.list.filter(function(e){return"true"===e.primary}).length&&(p="true"),"G"!==window.storeUserType&&window.userEmail)u=window.userEmail.replace("10750|","");else if(u=$("#email1").val(),i||e){var m=e||i;for(var h in t.model.ShippingAddress.list)if(null!=t.model.ShippingAddress.list[h]&&t.model.ShippingAddress.list[h].addressId==m){u=t.model.ShippingAddress.list[h].email1;break}}s="Indirizzo "+parseInt(1e4*Math.random())+(new Date).getTime(),r={storeId:t.storeId,catalogId:t.catalogId,langId:t.langId,status:"Billing",addressType:"Billing",authToken:$("#csrf_authToken").val(),nickName:s,addressField2:"Indirizzo da Checkout",firstName:$("#firstName2").val(),lastName:$("#lastName2").val(),addressField3:$.trim($("#CF2").val()).toUpperCase(),address1:$("#address2").val(),address2:$("#extrainfoinput2").val(),city:$("#city2").val(),country:$("#nazione2").val(),state:$("#province2").val(),zipCode:$("#cap2").val(),email1:u,primary:p,requesttype:"ajax"};var g=$("#billing_address_id").val();g&&(console.log("Update billing address case"),r.addressId=g,delete r.nickName),t.executeAfterPendingRequests(function(){CheckoutResources.doAjax(CheckoutResources[g?"AjaxPersonChangeServiceAddressUpdate_post":"AjaxPersonChangeServiceAddressAdd_post"],r,function(e){try{if(e=t.toJson(e)){var r=e.addressId[0];t.model.BillingAddress.selectedId=r,$("#billing_address_id").val(r),$(".billingAddressSummaryText").html("{1}<br/>{2}<br/>{3}, {4} {5}".replace(/\{1\}/,$("#firstName2").val()+" "+$("#lastName2").val()).replace(/\{2\}/,$("#address2").val()).replace(/\{3\}/,$("#city2").val()).replace(/\{4\}/,$("#province2").val()).replace(/\{5\}/,$("#cap2").val())),$(".myCoolPPEXbutton").prop("disabled",!1),$("#btn-submit-order").prop("disabled",!1),$("#btn-submit-order-mobile").prop("disabled",!1)}else setTimeout(function(){utagFiller.asyncSendError("Error in the billing address creation flow","Server","AjaxPersonChangeServiceAddressAdd error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - AjaxPersonChangeServiceAddressAdd","Error in the billing address creation flow - invalid response format",JSON.stringify(e))},50)}catch(t){setTimeout(function(){utagFiller.asyncSendError("Error in the billing address creation flow","Server","AjaxPersonChangeServiceAddressAdd error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - AjaxPersonChangeServiceAddressAdd","Error in the billing address creation flow - logic exception","message="+t.message+", response="+JSON.stringify(e))},50)}}.bind(this),function(){setTimeout(function(){utagFiller.asyncSendError("Error in the billing address creation flow","Server","AjaxPersonChangeServiceAddressAdd error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - AjaxPersonChangeServiceAddressAdd","Error in the billing address creation flow (net error)")},50)})})}}cartJS.cartObjectProcessed?CheckoutManager.updateOrderItemDeliveryDate():cartJS.cartDetailsPromise().then(e=>{CheckoutManager.updateOrderItemDeliveryDate()})},initData:function(){try{var e=JSON.parse($("#contact").text());if(e){for(var t in e){if(isNaN($.trim(e[t].nickName))||(e[t].nickName="Nuovo indirizzo"),e[t].nicknameEditable="",e[t].attributes)for(var r in e[t].attributes)null!=e[t].attributes[r]&&"addressField2"==e[t].attributes[r].key&&(e[t].nicknameEditable=e[t].attributes[r].value);e[t].addressType.includes(this.shippingType)?(this.model.ShippingAddress.list.push(e[t]),this.model.ShippingAddress.list.sort(function(e,t){return e.primary<t.primary?1:t.primary<e.primary?-1:0})):e[t].addressType.includes(this.billingType)&&(this.model.BillingAddress.list.push(e[t]),this.model.BillingAddress.list.sort(function(e,t){return e.primary<t.primary?1:t.primary<e.primary?-1:0}))}this.model.ShippingAddress.list.length>0&&0===this.model.ShippingAddress.list.filter(function(e){return"true"===e.primary}).length&&(console.log("THERE ARE NO PRIMARY SHIPPING ADDRESSES IN LIST"),this.model.ShippingAddress.list[0].primary="true"),this.model.BillingAddress.list.length>0&&0===this.model.BillingAddress.list.filter(function(e){return"true"===e.primary}).length&&(console.log("THERE ARE NO PRIMARY BILLING ADDRESSES IN LIST"),this.model.BillingAddress.list[0].primary="true")}}catch(e){console.log(e)}this.showShippingOrBillingFormByDefault(),this.template.render(),$(".addressWrapGen").length>0&&$(window).width()<992&&($(".addressWrapGen").hasClass("noslick")||($(".addressWrapGen").slick("unslick"),$(".addressWrapGen").slick({slidesToShow:1.1,arrows:!1,infinite:!1})))},cleanStep2Form:function(e){$("#ccNum").val(""),$("#titCard").val(""),$("#expirationCC").val(""),$("#cvv").val(""),$("#savecc").prop("checked",!1),$("#ccNum").val(""),$("#hidden_paytoken").val(""),$("#hidden_payaccount").val(""),$("#hidden_paytempaccount").val(""),$("#hidden_payexpiremonth").val(""),$("#hidden_payexpireyear").val(""),$("#card_nickname").val("Carta "+e),$("#payment_method").val(""),$("#payMethodId").val(""),$("#cc_brand").val("")},fillStep2Form:function(e){var t=$(e);$("#ccNum").val(""),$("#titCard").val(t.attr("data-cc_nameoncard")),$("#expirationCC").val(t.attr("data-expire_month")+"/"+t.attr("data-expire_year")),$("#cvv").val(""),$("#savecc").prop("checked",!1),$("#hidden_payaccount").val(""),$("#hidden_paytoken").val(t.attr("data-account")),$("#hidden_paytempaccount").val(t.attr("data-temp_account")),$("#hidden_payexpiremonth").val(t.attr("data-expire_month")),$("#hidden_payexpireyear").val(t.attr("data-expire_year")),$("#card_nickname").val(t.attr("data-card_nickname")),$("#payment_method").val(t.attr("data-payment_method")),$("#payMethodId").val(t.attr("data-payMethodId")),$("#cc_brand").val(t.attr("data-cc_brand"))},invokeOrderPrepare:function(){CheckoutManager.toggleButtonSpinner("#btn-submit-order"),CheckoutManager.toggleButtonSpinner("#btn-submit-order-mobile"),CheckoutManager.toggleButtonSpinner("#btn-go-step-2"),CheckoutManager.toggleButtonSpinner("#btn-go-step-2-mobile");var e=this,t={storeId:e.storeId,catalogId:e.catalogId,langId:e.langId,orderId:$("#currentOrderId").val(),authToken:$("#csrf_authToken").val(),requesttype:"ajax"};setTimeout(function(){jsLogger.severe("CheckoutManager - AjaxRESTOrderPrepare",Date.now()+" - Before OrderPrepare call for order: "+t.orderId)},50),CheckoutResources.doAjax(CheckoutResources.AjaxRESTOrderPrepare_post,t,function(r){setTimeout(function(){jsLogger.severe("CheckoutManager - AjaxRESTOrderPrepare",Date.now()+" - OrderPrepare done for order: "+t.orderId+" responseBody: "+r)},50),e.invokeOrderSubmit()}.bind(this),function(){CheckoutManager.disableSpinner("#btn-submit-order"),CheckoutManager.disableSpinner("#btn-submit-order-mobile"),CheckoutManager.disableSpinner("#btn-go-step-2"),CheckoutManager.disableSpinner("#btn-go-step-2-mobile"),$("div.checkout-error-step2").show(),$("html, body").animate({scrollTop:0},"slow"),setTimeout(function(){utagFiller.asyncSendError("Error in the backend order prepare flow","Server","AjaxRESTOrderPrepare error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - AjaxRESTOrderPrepare","Error in the backend order prepare flow (net error)")},50)})},invokeOrderSubmit:function(){var e=this,t={storeId:e.storeId,catalogId:e.catalogId,langId:e.langId,orderId:$("#currentOrderId").val(),authToken:$("#csrf_authToken").val(),requesttype:"ajax",notifyMerchant:1,notifyShopper:1,notifyOrderSubmitted:1,storeId:10750,catalogId:12101,langId:-4,purchaseorder_id:"",deviceFingerprint:(new ClientJS).getFingerprint()};$("input[name=PPL_payerID]").val()?(t.attributeName_1="PPL_paymentId",t.attributeValue_1=$("input[name=PPL_paymentId]").val(),t.attributeType_1="string",t.attributeName_2="PPL_token",t.attributeValue_2=$("input[name=PPL_token]").val(),t.attributeType_2="string",t.attributeName_3="PPL_payerID",t.attributeValue_3=$("input[name=PPL_payerID]").val(),t.attributeType_3="string"):e.paypalEC.isPayPalExpressFlux()&&(t.attributeName_1="billingAddressId",t.attributeValue_1=e.getBillingAddressIdFromModel(),t.billing_address_id=e.getBillingAddressIdFromModel()),"true"!=$("#isRecurringOrder").val()?(setTimeout(function(){jsLogger.severe("CheckoutManager - invokeOrderSubmit",Date.now()+" - Before invokeOrderSubmit call for order: "+t.orderId)},50),CheckoutResources.doAjax(CheckoutResources.AjaxRESTOrderSubmit_post,t,function(t){if(t=e.toJson(t))if(t.errorCode||t.errorMessageKey)$("div.checkout-error-step2").show(),$("html, body").animate({scrollTop:0},"slow"),setTimeout(function(){utagFiller.asyncSendError("Error in the backend order submit flow","Server","AjaxRESTOrderSubmit error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - AjaxRESTOrderSubmit","Error in the backend order submit flow - invalid response format",JSON.stringify(t))},50);else{setTimeout(function(){e.paypalEC.isPayPalExpressFlux()?window.localStorage.setItem("isPayPalEC","true"):window.localStorage.setItem("isPayPalEC","false")},50);let r=$("#isReorder").val();window.location.href=getAbsoluteURL()+"OrderShippingBillingConfirmationView?storeId=10750&catalogId=12101&langId=-4&isReOrder="+r+"&orderId="+t.orderId}else $("div.checkout-error-step2").show(),$("html, body").animate({scrollTop:0},"slow"),setTimeout(function(){utagFiller.asyncSendError("Error in the backend order submit flow","Server","AjaxRESTOrderSubmit error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - AjaxRESTOrderSubmit","Error in the backend order submit flow - empty response",JSON.stringify(t))},50)}.bind(this),function(){setTimeout(function(){utagFiller.asyncSendError("Error in the backend order submit flow","Server","AjaxRESTOrderSubmit error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - AjaxRESTOrderSubmit","Error in the backend order submit flow (net error)")},50)},function(){$(".loading-spinner").remove()})):(t.startDate=$("#recurringStartDate").val(),t.fulfillmentInterval=$("#recurringFrequency").val(),t.fulfillmentIntervalUOM=$("#recurringUOM").val(),$("input[name=PPL_token]").length&&$.ajax({type:"POST",data:{paymentID:"",orderID:"",payerID:"",facilitatorAccessToken:"",orderId:$("#currentOrderId").val(),storeId:e.storeId},url:"/webapp/wcs/stores/servlet/CyberSourceGetPayPalStatus",async:!1}).responseText,CheckoutResources.doAjax(CheckoutResources.AjaxRESTOrderRecurringSubmit_post,t,function(t){if(t=e.toJson(t))if(t.errorCode||t.errorMessageKey)setTimeout(function(){utagFiller.asyncSendError("Error in the backend recurring order submit flow","Server","AjaxRESTOrderRecurringSubmit error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - AjaxRESTOrderRecurringSubmit","Error in the backend recurring order submit flow - invalid response format",JSON.stringify(t))},50);else{setTimeout(function(){e.paypalEC.isPayPalExpressFlux()?window.localStorage.setItem("isPayPalEC","true"):window.localStorage.setItem("isPayPalEC","false")},50);let r=$("#isReorder").val();window.location.href=getAbsoluteURL()+"OrderShippingBillingConfirmationView?storeId=10750&catalogId=12101&langId=-4&isReOrder="+r+"&orderId="+t.orderId}else setTimeout(function(){utagFiller.asyncSendError("Error in the backend recurring order submit flow","Server","AjaxRESTOrderRecurringSubmit error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - AjaxRESTOrderRecurringSubmit","Error in the backend recurring order submit flow - empty response",JSON.stringify(t))},50)}.bind(this),function(){setTimeout(function(){utagFiller.asyncSendError("Error in the backend recurring order submit flow","Server","AjaxRESTOrderRecurringSubmit error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - AjaxRESTOrderRecurringSubmit","Error in the backend recurring order submit flow (net error)")},50)}))},prepareStep1OnSubmit:function(){var e=this;$("#nazione2").change(function(){"IT"!=$("#nazione2").val().toUpperCase()?($(".province2-container").hide(),$("#province2").selectize()[0].selectize.clear()):$(".province2-container").show()}),$("#cap1").keyup(function(){var t=$(this).val();t.match(/^\d{5}$/)&&(e.geocoder=e.geocoder||new google.maps.Geocoder,e.geocoder.geocode({address:t,componentRestrictions:{country:"IT"}},function(t,r){if(r!==google.maps.GeocoderStatus.OK)return!1;var a={administrative_area_level_2:"stateName",administrative_area_level_3:"civilCity",locality:"cityName",country:"countryName"},i={};$.each(t[0].address_components,function(e,t){switch(a[t.types[0]]){case"stateName":i.stateName=t.short_name;break;case"civilCity":i.civilCity=t.long_name;break;case"cityName":i.cityName=t.long_name;break;case"countryName":i.countryName=t.short_name;break;case"streetNumber":i.streetNumber=t.short_name;break;case"addressLineOne":i.addressLineOne=t.long_name;break;case"zipcode":i.zipcode=t.short_name}}),console.log(i),i.civilCity&&$("#city1").val(i.civilCity),i.stateName&&e.selectize_setVal("province1",i.stateName)}))})},prepareStep2OnSubmit:function(){var e=this;$("#purchaseOrderNumberInfo").submit(function(){if(CheckoutManager.resetCheckoutError(),$(this).valid(),$(this).find(".materialize-input-wrapper.errorDiv").length>0)return!1;if(e.toggleButtonSpinner("#btn-submit-order"),e.toggleButtonSpinner("#btn-submit-order-mobile"),"true"==$("#checkoutIsPickingUpInStore").val()){let e=$("#pickupStoreNumber").val(),t=$("#pickupStoreName").val(),r=$("#pickupStoreInfo").val();e&&cartJS.UpdateOrderAttribute("add",cartJS.getCart().orderId,["StoreNumber","StoreName","StoreInfo"],[e,t,r])}else""!=cartJS.getCart().getOrdExtAttr("StoreNumber")&&cartJS.UpdateOrderAttribute("delete",cartJS.getCart().orderId,["StoreNumber"]),""!=cartJS.getCart().getOrdExtAttr("StoreName")&&cartJS.UpdateOrderAttribute("delete",cartJS.getCart().orderId,["StoreName"]);return"paypal"==$("input[name=methodofPayment]:checked").val()&&e.paypalEC.isPayPalExpressFlux()?(e.invokeOrderPrepare(),!1):(cartJS.cartObjectProcessed.hasGiftCard&&0==cartJS.getCart().giftCard.grandTotalWithGiftCard?e.checkoutFormSubmit("gift-card"):e.checkoutFormSubmit(),!1)})},checkoutFormSubmit:async function(e){$(".sv-error-message").hide();var t=$.trim($("#hidden_paytoken").val()),r={},a=e||$("input[name=methodofPayment]:checked").val();if("cc"==a){if(t)r={storeId:this.storeId,catalogId:this.catalogId,langId:this.langId,orderId:$("#currentOrderId").val(),token:$("#hidden_paytoken").val(),account:$("#hidden_paytempaccount").val(),billingAddressId:this.getBillingAddressIdFromModel(),payMethodId:$("#payMethodId").val(),paymentType:$("#paymentType").val(),cc_brand:$("#cc_brand").val(),cc_cvc:$("#cvv").val(),expire_month:$("#hidden_payexpiremonth").val(),expire_year:$("#hidden_payexpireyear").val(),requesttype:"ajax",authToken:$("#csrf_authToken").val(),card_nickname:$("#card_nickname").val(),payment_method:$("#payment_method").val(),cc_nameoncard:$("#titCard").val(),temp_account:$("#hidden_paytempaccount").val(),fidelityCN:$("input[id^=FidelityCN]").val(),fidelityCS:$("input[id^=FidelityCS]").val(),deviceFingerprint:(new ClientJS).getFingerprint()};else{var i=$("#ccNum").val();if(null!=i&&i.length>0){var o=i.split("-");i=o.join("");var n=o.slice(-1)[0];$("#hidden_payaccount").val(i),$("#hidden_paytempaccount").val(n)}var s=$("#expirationCC").val();if(null!=s&&s.length>2){var l=s.trim().split("/");$("#hidden_payexpiremonth").val(l[0]),$("#hidden_payexpireyear").val(l[1])}var d=$("#input-card-account").attr("data-cc");null!=d&&d.length>0&&("visa"==d?($("#cc_brand").val("VISA"),$("#payMethodId").val("SV_VISA"),$("#payment_method").val("SV_VISA")):"amex"==d?($("#cc_brand").val("AMEX"),$("#payMethodId").val("SV_AMEX"),$("#payment_method").val("SV_AMEX")):"mastercard"==d&&($("#cc_brand").val("MASTERCARD"),$("#payMethodId").val("SV_MC"),$("#payment_method").val("SV_MC")));var c=$("#card_nickname").val();if(null==c||0==c.trim().length){var u=$("#suffixToUse").val();$("#card_nickname").val("Carta "+u)}r={storeId:this.storeId,catalogId:this.catalogId,langId:this.langId,orderId:$("#currentOrderId").val(),cc_nameoncard:$("#titCard").val(),account:$("#hidden_payaccount").val(),billingAddressId:this.getBillingAddressIdFromModel(),payMethodId:$("#payMethodId").val(),paymentType:$("#paymentType").val(),cc_brand:$("#cc_brand").val(),cc_cvc:$("#cvv").val(),expire_month:$("#hidden_payexpiremonth").val(),expire_year:$("#hidden_payexpireyear").val(),requesttype:"ajax",authToken:$("#csrf_authToken").val(),savecc:""+$("#savecc").is(":checked"),suffixToUse:$("#suffixToUse").val(),card_nickname:$("#card_nickname").val(),payment_method:$("#payment_method").val(),primary:$("#hidden_payprimary").val(),temp_account:$("#hidden_paytempaccount").val(),merchantReferenceCode:$("#currentOrderId").val(),deviceFingerprint:(new ClientJS).getFingerprint(),fidelityCN:$("input[id^=FidelityCN]").val(),fidelityCS:$("input[id^=FidelityCS]").val(),signUpEmailForPolicyNotice:this.signUpEmailForPolicyNotice},cartJS.cartObjectProcessed.hasGiftCard&&(r.partialAmount=Number(cartJS.cartObjectProcessed.giftCard.grandTotalWithGiftCard))}if(CheckoutManager.isCardinalEnabled())return console.log("Cardinal is enabled"),PaSetup.runPaSetup(r),!1;setTimeout(function(){utagFiller.asyncCheckoutGateway(r.cc_brand)},50),setTimeout(function(){jsLogger.info("CheckoutManager - prepareStep2OnSubmit",r.cc_brand+" chosen")},50)}else if("paypal"==a)r={storeId:this.storeId,catalogId:this.catalogId,langId:this.langId,orderId:$("#currentOrderId").val(),billingAddressId:this.getBillingAddressIdFromModel(),requesttype:"ajax",authToken:$("#csrf_authToken").val(),merchantReferenceCode:$("#currentOrderId").val(),deviceFingerprint:(new ClientJS).getFingerprint(),payMethodId:"SV_PAYPAL",paymentType:"PPL",isRecurringOrder:this.paypalEC.isRecurringOrder(),fidelityCN:$("input[id^=FidelityCN]").val(),fidelityCS:$("input[id^=FidelityCS]").val(),signUpEmailForPolicyNotice:this.signUpEmailForPolicyNotice},setTimeout(function(){utagFiller.asyncCheckoutGateway("PayPal")},50),setTimeout(function(){jsLogger.info("CheckoutManager - prepareStep2OnSubmit","PayPal classic chosen")},50);else{if("paypal-ec"==a)return r={storeId:this.storeId,catalogId:this.catalogId,langId:this.langId,orderId:$("#currentOrderId").val(),requesttype:"ajax",authToken:$("#csrf_authToken").val(),merchantReferenceCode:$("#currentOrderId").val(),payMethodId:"SV_PAYPAL_EC",paymentType:"PPL",isRecurringOrder:this.paypalEC.isRecurringOrder()},setTimeout(function(){jsLogger.info("CheckoutManager - prepareStep2OnSubmit","PayPal-EC chosen")},50),r;"scalapay"==a?(r={storeId:this.storeId,catalogId:this.catalogId,langId:this.langId,orderId:$("#currentOrderId").val(),billingAddressId:this.getBillingAddressIdFromModel(),requesttype:"ajax",authToken:$("#csrf_authToken").val(),merchantReferenceCode:$("#currentOrderId").val(),pluginAction1:"CREATE_ORDER",payMethodId:"SV_SCALA",paymentType:"SV_SCALA",payment_method:"SV_SCALA",fidelityCN:$("input[id^=FidelityCN]").val(),fidelityCS:$("input[id^=FidelityCS]").val(),signUpEmailForPolicyNotice:this.signUpEmailForPolicyNotice},setTimeout(function(){utagFiller.asyncCheckoutGateway("Scalapay")},50),setTimeout(function(){jsLogger.info("CheckoutManager - prepareStep2OnSubmit","Scalapay classic chosen")},50)):"satispay"==a&&(r=Satispay.getPiPayload(),setTimeout(function(){utagFiller.asyncCheckoutGateway("Satispay")},50),setTimeout(function(){jsLogger.info("CheckoutManager - prepareStep2OnSubmit","Satispay chosen")},50))}if("gift-card"==a&&cartJS.cartObjectProcessed.hasGiftCard){await this.performPIAddGiftCard();this.invokeOrderPrepare(),setTimeout(function(){utagFiller.asyncCheckoutGateway("GiftCard")},50)}else cartJS.cartObjectProcessed.hasGiftCard&&"scalapay"!=a&&(r.partialAmount=Number(cartJS.cartObjectProcessed.giftCard.grandTotalWithGiftCard)),setTimeout(function(){jsLogger.info("CheckoutManager - prepareStep2OnSubmit","before invoke performPIAdd")},50),this.performPIAdd(r)},performPIAdd:PIFunctions.performPIAdd,performPIAddGiftCard:PIFunctions.performPIAddGiftCard,showShippingOrBillingFormByDefault:function(){0===this.model.ShippingAddress.list.length&&($("#btn-add-address").click().hide(),$(".shipping-main-title").hide(),$(".shipping-subtitle-with-address-list").hide(),$(".shipping-subtitle-with-no-address-list").show()),0===this.model.BillingAddress.list.length&&($("#btn-add-billing-address").click().hide(),$(".billing-main-title").hide(),$(".billing-subtitle-with-address-list").hide(),$(".billing-subtitle-with-no-address-list").show())},showCustomError:function(e,t){var r=$("div.checkout-error-step2").clone().insertAfter("div.checkout-error-step2:last");e&&r.find(".message-title").text(e),t&&r.find(".message-content").text(t),r.show(),$("html, body").animate({scrollTop:0},"slow"),setTimeout(function(){r.remove()},2e4)},createOrderOrBACallback_PPL_EC:async function(){setTimeout(function(){utagFiller.fullClickEvent("X_CartPage_Summary_PayPalCheckout")},50);var e=CheckoutManager,t=await e.checkoutFormSubmit("paypal-ec");return $.post(CheckoutResources.PIAddCmd_post.url,t).done(function(e){}).fail(function(){}).then(function(t){if((t=e.toJson(t))&&t.paypalToken)return t.paypalToken})},onApproveCallback_PPL_EC:function(e,t){console.log(e,t);var r=CheckoutManager;$("body").after('<div class="loading-spinner"></div>');var a={paymentID:e.paymentID,orderID:e.orderID,payerID:e.payerID,facilitatorAccessToken:e.facilitatorAccessToken,billingToken:e.billingToken,orderId:$("#currentOrderId").val(),storeId:r.storeId};CheckoutResources.doAjax(CheckoutResources.CyberSourceGetPayPalStatus_post,a,function(e){try{e=CheckoutManager.toJson(e);var t=!0;if(e)if("true"==e.success){t=!1,$("#PayPal-EC").val("true");var r=$("#CheckoutCartForm");r.attr("action",r.attr("action")+"&PayPal-EC=true"),r.find("[name=PayPal-EC]").val(!0),r.submit()}else"UNVERIFIED"==e.error_mgs?$("#checkout-error-unverified").show():"INCOMPATIBLE_ADDRESS"==e.error_mgs?$("#checkout-error-incompatible-address").show():$("#checkout-error-paypal-ec-generic").show(),$("html, body").animate({scrollTop:0},"slow"),setTimeout(function(){utagFiller.asyncSendError("Error in the CyberSourceGetPayPalStatus flow","Server","CyberSourceGetPayPalStatus. success=false")},50),setTimeout(function(){jsLogger.severe("Error in the CyberSourceGetPayPalStatus flow","CyberSourceGetPayPalStatus - success=false",JSON.stringify(e))},50);else $("#checkout-error-paypal-ec-generic").show(),$("html, body").animate({scrollTop:0},"slow"),setTimeout(function(){utagFiller.asyncSendError("Error in the CyberSourceGetPayPalStatus flow","Server","CyberSourceGetPayPalStatus error invalid response format")},50),setTimeout(function(){jsLogger.severe("Error in the CyberSourceGetPayPalStatus flow","CyberSourceGetPayPalStatus - invalid response format",JSON.stringify(e))},50)}catch(t){$("#checkout-error-paypal-ec-generic").show(),$("html, body").animate({scrollTop:0},"slow"),setTimeout(function(){utagFiller.asyncSendError("Error in the CyberSourceGetPayPalStatus flow","Server","CyberSourceGetPayPalStatus fatal error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - Fatal onApproveCallback_PPL_EC (CyberSourceGetPayPalStatus)","Exception - invalid json?","message="+t.message+", response="+JSON.stringify(e))},50)}t&&$(".loading-spinner").remove()},function(){$("#checkout-error-paypal-ec-generic").show(),$("html, body").animate({scrollTop:0},"slow"),$(".loading-spinner").remove(),setTimeout(function(){utagFiller.asyncSendError("Error in the backend payment CyberSourceGetPayPalStatus flow","Server","CyberSourceGetPayPalStatus error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - onApproveCallback_PPL_EC (CyberSourceGetPayPalStatus) flow","Error in the CyberSourceGetPayPalStatus flow (net error)")},50)},function(){})},continuePayPalExpressFlux:function(){var e=this;$("body").after('<div class="loading-spinner"></div>'),$("#checkout-div").css("visibility","hidden");var t={orderId:$("#currentOrderId").val(),storeId:e.storeId,intent:"local"};CheckoutResources.doAjax(CheckoutResources.CyberSourceGetPayPalStatus_post,t,function(t){try{if(t=CheckoutManager.toJson(t))if("true"==t.success){var r=[],a="true"===$("#checkoutIsPickingUpInStore").val();$("#sameaddr").click(),$("#btn-add-address").click(),$("#btn-add-billing-address").click(),$(".itemToExcludePayPalExpress").hide();var i=t.profile;if(i.shipTo_state&&i.shipTo_state.length>2)try{i.shipTo_state=e.selectize_searchKey("province1",i.shipTo_state)}catch(e){setTimeout(function(){jsLogger.severe("Soft Error in the CyberSourceGetPayPalStatus local flow","Unable to map shipTo_state="+shipTo_state)},50)}if(i.billTo_state&&i.billTo_state.length>2)try{i.billTo_state=e.selectize_searchKey("province2",i.billTo_state)}catch(e){setTimeout(function(){jsLogger.severe("Soft Error in the CyberSourceGetPayPalStatus local flow","Unable to map billTo_state="+shipTo_state)},50)}i.shipTo_firstName&&$("#firstName").val(i.shipTo_firstName),i.shipTo_lastName&&$("#lastName").val(i.shipTo_lastName),i.billTo_email&&$("#email1").val(i.billTo_email),i.billTo_phoneNumber&&($("#phone1").val(i.billTo_phoneNumber),$("#phone1").parent().addClass("ok")),!a&&i.shipTo_street1&&$("#address1").val(i.shipTo_street1),!a&&i.shipTo_street2&&($("#extrainfo1-button").click(),$("#extrainfo1").val(i.shipTo_street2)),!a&&i.shipTo_postalCode&&($("#cap1").val(i.shipTo_postalCode),getCityAndProvinceFromZipCode(i.shipTo_postalCode,"1")),!a&&i.shipTo_city&&$("#city1").val(i.shipTo_city),!a&&i.shipTo_state&&(e.selectize_setVal("province1",i.shipTo_state)||r.push('shipping - "'+i.shipTo_state+'"not found for "province1" field')),i.billTo_firstName&&$("#firstName2").val(i.billTo_firstName),i.billTo_lastName&&$("#lastName2").val(i.billTo_lastName),i.billTo_email&&$("#email1").val(i.billTo_email),i.billTo_street1&&$("#address2").val(i.billTo_street1),i.billTo_street2&&($("#extrainfo2-button").click(),$("#extrainfoinput2").val(i.billTo_street2)),i.billTo_postalCode&&$("#cap2").val(i.billTo_postalCode),i.billTo_city&&$("#city2").val(i.billTo_city),i.billTo_country&&(e.selectize_setVal("nazione2",i.billTo_country)||r.push('billing - "'+i.billTo_country+'"not found for "nazione2" field')),i.billTo_state&&(e.selectize_setVal("province2",i.billTo_state)||r.push('billing - "'+i.billTo_state+'"not found for "province2" field')),$("#paypallmethod").parent().click(),$("#phone1").valid(),e.errorsInForm()||a?($("#checkout-div").css("visibility","visible"),$(".loading-spinner").remove(),$(".disclosureChkLabel").show(),console.log("PayPal-EC: hold to step1"),a?($("#checkout-pickup-errormessage").show(),setTimeout(function(){jsLogger.info("Info in the CyberSourceGetPayPalStatus local flow","checkoutIsPickingUpInStore=true",JSON.stringify(r))},50)):($(".checkout-error-step2-paypal-missing-data").show(),setTimeout(function(){jsLogger.info("Info in the CyberSourceGetPayPalStatus local flow","errorsInForm=true",JSON.stringify(r))},50))):(console.log("PayPal-EC: automatically submit to step2"),e.paypalEC.shouldOpenThePopUp=!0,e.submitStep1())}else setTimeout(function(){utagFiller.asyncSendError("Error in the CyberSourceGetPayPalStatus local flow","Server","CyberSourceGetPayPalStatus. success=false")},50),setTimeout(function(){jsLogger.severe("Error in the CyberSourceGetPayPalStatus local flow","CyberSourceGetPayPalStatus - success=false",JSON.stringify(t))},50);else setTimeout(function(){utagFiller.asyncSendError("Error in the CyberSourceGetPayPalStatus local flow","Server","CyberSourceGetPayPalStatus error invalid response format")},50),setTimeout(function(){jsLogger.severe("Error in the CyberSourceGetPayPalStatus local flow","CyberSourceGetPayPalStatus - invalid response format",JSON.stringify(t))},50)}catch(e){setTimeout(function(){utagFiller.asyncSendError("Error in the CyberSourceGetPayPalStatus local flow","Server","CyberSourceGetPayPalStatus fatal error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - Fatal on CyberSourceGetPayPalStatus local flow","Exception - invalid json?","message="+e.message+", response="+JSON.stringify(t))},50)}},function(){setTimeout(function(){utagFiller.asyncSendError("Error in the backend payment CyberSourceGetPayPalStatus local flow","Server","CyberSourceGetPayPalStatus error")},50),setTimeout(function(){jsLogger.severe("CheckoutManager - CyberSourceGetPayPalStatus local flow","Error in the CyberSourceGetPayPalStatus local flow (net error)")},50)},function(){})},paypalECSubmit:function(){var e=CheckoutManager;!$("#disclosureChk_ppl").is(":visible")||$("#disclosureChk_ppl").is(":checked")?(setTimeout(function(){utagFiller.asyncCheckoutGateway("PayPal-EC")},50),e.toggleButtonSpinner("#paypalECSubmit"),e.invokeOrderPrepare()):($("#error-disclosureChk_ppl").show(),e.scrollDivToButton("modal-body-ppl"),$("#disclosureChk_ppl").one("change",function(){$("#error-disclosureChk_ppl").hide()}))},errorsInForm:function(){return $("#billingAddressCreateEditFormDiv_1").valid(),$("#billingAddressCreateEditFormDiv_1 .errorDiv:visible").length>0||$("#billingAddressCreateEditFormDiv_1 .errorCheck:visible").length>0?(console.log("FORM IS INVALID"),!0):(console.log("FORM IS VALID"),!1)},executeAfterPendingRequests:function(e,t){var r=this;t=t||1e4,$.active>0?setTimeout(function(){r.executeAfterPendingRequests(e)},t):e()},toggleButtonSpinner:function(e){spinnerFunc(e),setTimeout(function(){disableSpinner(e)},3e4)},scrollDivToButton:function(e){var t=$("#"+e);t.length>0&&t.scrollTop(t[0].scrollHeight-t[0].clientHeight)},getCookie:function(e){var t=("; "+document.cookie).split("; "+e+"=");if(2==t.length)return t.pop().split(";").shift()},isCardinalEnabled:function(){return"TRUE"==$("#CARDINAL_ENABLED").val().toUpperCase()},step1CFCompile:function(){$("#sameaddr").is(":checked")||$("#CF2").val()||!$("#CF").val()||$("#CF").parent().hasClass("errorDiv")||($("#CF2").val($("#CF").val()),$("#CF2").parent().addClass("ok"))},isCheckoutPage:function(){return!!$("#btn-submit-order").length},deviceType:function(){return device.tablet()?"Tablet":device.mobile()?"Smartphone":"Desktop"},selectize_searchKey:function(e,t){var r=null;try{r=$("#"+e).selectize()[0].selectize.search(t).items[0].id}catch(e){console.error(e)}return r},selectize_setVal:function(e,t){var r=!1;try{var a=$("#"+e).selectize()[0].selectize;a.setValue(t),r=""!=a.getValue()}catch(e){console.error(e)}return r},populateUpdateAddress:function(e,t,r){$("#newaddressForm").hide(),$("#firstName").val(""),$("#lastName").val(""),$("#CF").val(""),$("#phone1").val(""),$("#address1").val(""),$("#cap1").val(""),$("#city1").val("");var a=$("#province1").selectize()[0].selectize;if(a.setValue(""),1==r)$("#addressDataLabel").removeClass("d-none"),$("#addressLabel").addClass("d-none"),$("#updAddressLabel").addClass("d-none"),$("#newAddressLabel").removeClass("d-none"),$("#shipping_address_id").val(""),myToggleDiv(e,"#newaddressForm"),removeRadioSel(".addressItemWrap"),CheckoutManager.model.ShippingAddress.selected=null;else{var i=CheckoutManager.model.ShippingAddress.list[t];$("#addressLabel").addClass("d-none"),$("#newAddressLabel").addClass("d-none"),$("#updAddressLabel").removeClass("d-none"),$("#shipping_address_id").val(i.addressId),$("#btn-add-address").show(),myToggleDiv("","#newaddressForm"),removeRadioSel(".addressItemWrap"),CheckoutManager.model.ShippingAddress.selected=i.addressId,$("#firstName").val(i.firstName),$("#lastName").val(i.lastName),$("#email1").val(i.email1);for(var o=0;o<i.attributes.length;o++)"addressField3"==i.attributes[o].key&&($("#CF").val(i.attributes[o].value),$("#CF").addClass("norequired"),$("#CF").removeClass("ignoreValidation"));let e=i.phone1;if(e&&(e=e.replace("+","").replace(" ","")).length>10){let t=e.length-10;e=e.substring(t)}$("#phone1").val(e),$("#address1").val(i.addressLine[0]),$("#cap1").val(i.zipCode),$("#city1").val(i.city),a.setValue(i.state)}$("html,body").animate({scrollTop:$("#newaddressForm").offset().top-100},"slow")},oneDayDeliveryAvailable:function(){let e=$("#cap1").val();""==e&&$(".shipping-address-list-item.active").length>0&&(e=$(".shipping-address-list-item.active").data("cap").toString());let t=$("#cartIsOneDayEligible").val();$("#greenShipping").is(":checked");if(e.length>=5){let r=getCapJson(e);"available"!=t&&"mixed"!=t||!r?($(".no-ship-one-day").removeClass("d-none"),$(".ship-one-day").addClass("d-none")):($(".ship-one-day").removeClass("d-none"),$(".no-ship-one-day").addClass("d-none"))}else $(".no-ship-one-day").removeClass("d-none"),$(".ship-one-day").addClass("d-none")},changeShipMethod:function(e,t){t?($(".pickUpShipOption").show(),$(".deliveryShipOption").hide(),$("#newaddressForm").show(),$("#checkoutIsPickingUpInStore").val("true")):($(".deliveryShipOption").show(),$(".pickUpShipOption").hide(),$("#loggedUserAddresses .addressWrapGen").length>0?$("#newaddressForm").hide():$("#newaddressForm").show(),$("#checkoutIsPickingUpInStore").val("false"),$("#greenShipping").attr("checked","checked")),$(".addressWrapGen").length>0&&$(window).width()<992&&$(".addressWrapGen").slick("setPosition"),cartJS.updateShipmentMethod(e)},checkoutFixDeliveryDateNotAvailable:function(){if(cartJS.cartObjectProcessed&&cartJS.cartObjectProcessed.orderItem){let e=$("#greenShipping").is(":checked");for(let t of cartJS.cartObjectProcessed.orderItem)t.isCL||t.isAccessory?cartJS.getOrderItemODDInfo(t.orderItemId,"",cartJS.updateCartDeliveryCallback,"",e):cartJS.getOrderItemODDInfo(t.orderItemId,"",cartJS.updateCartDeliveryWithSaveCallback,"",e)}},checkoutCartOneDayDeliveryEligible:function(){if(cartJS.cartObjectProcessed&&cartJS.cartObjectProcessed.orderItem){let e=$("#cap1").val();""==e&&$(".shipping-address-list-item.active").length>0&&(e=$(".shipping-address-list-item.active").data("cap").toString());let t=e.length>4?e:"",r=$("#province1").val();""==r&&$(".shipping-address-list-item.active").length>0&&(r=$(".shipping-address-list-item.active").data("province").toString());let a=$("#greenShipping").is(":checked");CheckoutManager.checkAllItemsODDElibigility(0,t,cartJS.updateCartDeliveryCallback,r,a)}},checkAllItemsODDElibigility:function(e,t,r,a,i){if(cartJS.cartObjectProcessed&&cartJS.cartObjectProcessed.orderItem){if(e<cartJS.cartObjectProcessed.orderItem.length){let o=cartJS.cartObjectProcessed.orderItem[e];return cartJS.getOrderItemODDInfo(o.orderItemId,t,r,a,i).then(o=>{e+=1,CheckoutManager.checkAllItemsODDElibigility(e,t,r,a,i)})}{let e="";$('[id^="oneDayDeliveryEligible"]').each(function(){let t="true"==this.value;""==e?e=t?"available":"not-available":"available"!=e||t?"not-available"==e&&t&&(e="mixed"):e="mixed"}),$("#cartIsOneDayEligible").val(e),CheckoutManager.oneDayDeliveryAvailable()}}},updateOrderItemDeliveryDate:function(){let e=function(e){e.includes("\x3c!--")&&CheckoutManager.updateOrderItemDeliveryDate()};if(cartJS.cartObjectProcessed&&cartJS.cartObjectProcessed.orderItem)for(let t of cartJS.cartObjectProcessed.orderItem){let r=t.orderItemId,a=t.getExpectedDeliveryDate(),i=$("#expectedDeliveryDate-"+r).val(),o=formatDate(getDateFromShortFormat(i));if(""!=i&&""!=a&&a!=o){let a=[];t.isCL?(t.rightCL&&a.push(t.rightCL.orderItemId),t.leftCL&&a.push(t.leftCL.orderItemId)):a.push(r),cartJS.UpdateOrderItemDeliveryDate(a,o,e)}}},resetCheckoutError:function(){$("div.checkout-error-step2").attr("style","display: none !important;"),$(".checkout-generic-error").removeClass("d-none"),$(".checkout-satispay-error").addClass("d-none")}}),jQuery.extend(CheckoutResources,{AjaxPersonChangeServiceAddressAdd_post:{url:"/webapp/wcs/stores/servlet/AjaxPersonChangeServiceAddressAdd",method:"POST",returnType:"json"},AjaxPersonChangeServiceAddressUpdate_post:{url:"/webapp/wcs/stores/servlet/AjaxPersonChangeServiceAddressUpdate",method:"POST",returnType:"json"},AjaxRESTOrderShipInfoUpdate_post:{url:"/webapp/wcs/stores/servlet/AjaxRESTOrderShipInfoUpdate",method:"POST",returnType:"json"},PIAddCmd_post:{url:"/webapp/wcs/stores/servlet/PIAddCmd",method:"POST",returnType:"json"},PIEditCmd_post:{url:"/webapp/wcs/stores/servlet/AjaxRESTOrderPIUpdate",method:"POST",returnType:"json"},AjaxRESTOrderPrepare_post:{url:"/webapp/wcs/stores/servlet/AjaxRESTOrderPrepare",method:"POST",returnType:"json"},AjaxRESTOrderSubmit_post:{url:"/webapp/wcs/stores/servlet/AjaxRESTOrderSubmit",method:"POST",returnType:"json"},AjaxRESTOrderRecurringSubmit_post:{url:"/webapp/wcs/stores/servlet/AjaxRESTSubmitRecurringOrSubscription",method:"POST",returnType:"json"},UserEmailSignUpCmd_post:{url:"/webapp/wcs/stores/servlet/UserEmailSignUpCmd",method:"POST",returnType:"json"},CheckCardinalEnrollment_post:{url:"/webapp/wcs/stores/servlet/CheckCardinalEnrollment",method:"POST",returnType:"json"},ValidateCardinalJWT_post:{url:"/webapp/wcs/stores/servlet/ValidateCardinalJWT",method:"POST",returnType:"json"},CyberSourceGetPayPalStatus_post:{url:"/webapp/wcs/stores/servlet/CyberSourceGetPayPalStatus",method:"POST",returnType:"json"},doAjax:function(e,t,r,a,i,o){void 0===o&&(o=!1),$.ajax({type:e.method,url:e.url,data:t,dataType:e.dataType,async:!o,success:function(e){r(e)},complete:function(e){i&&i(e)}}).fail(function(e){a(),console.log("API Error"+e)})},doAjaxPromise:async(e,t,r,a)=>$.ajax({url:e,type:a||"POST",dataType:"text",data:t}).then(e=>e?(e=$.trim(e).replace(/^\/\*/,"").replace(/\*\/$/,""),Promise.resolve("json"==r?JSON.parse(e):e)):Promise.reject())});const baseParams={storeId:WCParamJS.storeId,catalogId:WCParamJS.catalogId,langId:WCParamJS.langId,requesttype:"ajax"};jQuery.extend(Satispay,{getPiPayload:function(){let e={authToken:$("#csrf_authToken").val(),orderId:$("#currentOrderId").val(),merchantReferenceCode:$("#currentOrderId").val(),payMethodId:"Satispay",paymentType:"Satispay",billingAddressId:CheckoutManager.getBillingAddressIdFromModel(),signUpEmailForPolicyNotice:CheckoutManager.signUpEmailForPolicyNotice,pluginAction1:"CREATE_SESSION"};return PaSetup.isRecurringOrderInCart()&&(e.isRecurringPayment="true"),Object.assign(baseParams,e)},continueAfterPreApproval:async function(e){$("body").after('<div class="loading-spinner"></div>');let t=(await AjaxService.initialCartPromise).paymentInstruction[0].piId;const r=Object.assign(baseParams,{authToken:$("#csrf_authToken").val(),pluginAction1:"CHECK_STATUS"});CheckoutManager.gotoStep2();let a=!1;for(let e=0;e<3;e++){await CheckoutResources.doAjaxPromise(CheckoutResources.PIEditCmd_post.url,Object.assign({piId:t},r),"json");let e=await cartJS.cartDetailsPromise();t=(e=cartJS.lastDataFetched).paymentInstruction[0].piId;let i=PIFunctions.extractProtocolData(e.paymentInstruction[0].protocolData,"status");if(i=i?i.value:i,["AUTHORIZED","ACCEPTED"].includes(i)){a=!0;break}await new Promise(e=>setTimeout(e,2e3))}if(!a)return $(".checkout-generic-error").addClass("d-none"),$(".checkout-satispay-error").removeClass("d-none"),$("div.checkout-error-step2").show(),void $(".loading-spinner").remove();CheckoutManager.invokeOrderPrepare()}.bind(CheckoutManager),cancelAfterPreApproval:function(e){alert("cancelAfterPreApproval")}}),miniCartJS={lastOrderItemId:"",cartInitialized:!1,setCommonParameters:function(e,t,r,a,i){this.langId=e,this.storeId=t,this.catalogId=r,this.userType=a,this.currencySymbol=i,miniCartJS.cartInitialized||miniCartJS.initCartBadge()},loadMiniCart:function(e){void 0===e&&(e=!0);var t="?storeId="+this.storeId+"&catalogId="+this.catalogId+"&langId="+this.langId;$.ajax({url:getAbsoluteURL()+"MiniShopCartDisplayView"+t,type:"POST",dataType:"html",data:"status=load&relativeId=widget_minishopcart&contentId=quick_cart_container&contentType=orderItemsList&page_view=dropdown&fetchCartContents=true"+this.lastOrderItemId,success:function(t){if(e){var r="true"===$("#quick_cart_mobile_container .sv-secondary").data("vm-active"),a=$(t);$("#quick_cart_mobile_container").replaceWith(a.filter("#quick_cart_mobile_container")),$("#quick_cart_container").replaceWith(a.filter("#quick_cart_container")),$("#minishopcart_total-dsk").html(a.filter("#quick_cart_container").find("#currentOrderQuantity").val()),$("#minishopcart_total").html(a.filter("#quick_cart_container").find("#currentOrderQuantity").val()),$("#scalapay-widget-minicart-dsk").replaceWith(a.filter("#scalapay-widget-minicart-dsk")),$("#scalapay-widget-minicart-mob").replaceWith(a.filter("#scalapay-widget-minicart-mob")),initScalaPayWidgetGraphic(),r&&$("#quick_cart_mobile_container .sv-secondary").text("Continua l'esperienza"),CatalogEntryRecommendation.initMinicart(),_openCart()}},error:function(e,t){console.log(t),setTimeout(function(){utagFiller.asyncSendError("Error trying to load the MiniCart in page","Anomaly","MiniShopCartDisplayView error")},50),setTimeout(function(){jsLogger.severe("MiniShopCartDisplayView","Error trying to load the MiniCart in page (net error)",JSON.stringify(t))},50)}})},initCartBadge:function(){var e="?storeId="+this.storeId+"&catalogId="+this.catalogId+"&langId="+this.langId;$.ajax({url:getAbsoluteURL()+"MiniShopCartDisplayView"+e,type:"POST",dataType:"html",data:"status=load&relativeId=widget_minishopcart&contentId=quick_cart_container&contentType=orderItemsList&page_view=dropdown&fetchCartContents=true"+this.lastOrderItemId,success:function(e){var t=$(e);$("#minishopcart_total-dsk").html(t.filter("#quick_cart_container").find("#currentOrderQuantity").val()),$("#minishopcart_total").html(t.filter("#quick_cart_container").find("#currentOrderQuantity").val()),$("#minishopcart_total-dsk").removeClass("d-none"),$("#minishopcart_total").removeClass("d-none"),miniCartJS.cartInitialized=!0},error:function(e,t){console.log(t),$("#minishopcart_total-dsk").removeClass("d-none"),$("#minishopcart_total").removeClass("d-none"),setTimeout(function(){utagFiller.asyncSendError("Error trying to init the MiniCart in page","Anomaly","MiniShopCartDisplayView error")},50),setTimeout(function(){jsLogger.severe("MiniShopCartDisplayView","Error trying to init the MiniCart in page (net error)",JSON.stringify(t))},50)}})}},GiftCardJS={getBaseParams:function(){return"storeId="+WCParamJS.storeId+"&catalogId="+WCParamJS.catalogId+"&langId="+WCParamJS.langId+"&authToken="+encodeURI($("#csrf_authToken").val())},giftCardCheck:function(e,t,r){let a=[],i=cartJS.cartObjectProcessed.buyerId||Date.now();a.push("cardCodex="+e),a.push("sessionId="+i),a.push("action=check"),null!=r&&""!=r&&a.push("usrToken="+r);let o=GiftCardJS.getBaseParams();$.ajax({url:getAbsoluteURL()+"/GiftCardAction?"+o,type:"POST",data:a.join("&"),dataType:"html",success:t,error:function(e,t){setTimeout(function(){jsLogger.severe("giftCardCheck ","params = "+a,t)},50)}})}},wishlistJS={pendingRemove:[],currentWishlistObj:{listId:"",items:[],userType:"U"},initWishlist:function(e,t){$.ajax({url:"AjaxCustomerHeaderWishlist?tm="+(new Date).getTime(),dataType:"json",success:function(r){try{if(null!=r){let a=JSON.stringify(r);"R"===userdataJS.userType&&sessionStorage.setItem("registered-wishlist",a),t(e)}}catch(e){console.log(e)}},error:function(e,t,r){console.log(e.responseText)}})},currentWishlist:function(e=!1){if("U"==wishlistJS.currentWishlistObj.userType||e){if("G"==userdataJS.userType){let e=localStorage.getItem("guest-wishlist");wishListObj=e?JSON.parse(e):{listId:"",items:[],userType:"G"}}else{let e=sessionStorage.getItem("registered-wishlist");wishListObj=JSON.parse(e)}wishlistJS.currentWishlistObj=wishListObj;let e=wishlistJS.currentWishlistObj.items.length;return $(".fav-btn-counter").html(e),e>0?$(".fav-btn-counter").removeClass("d-none"):$(".fav-btn-counter").addClass("d-none"),wishlistJS.currentWishlistObj}return wishlistJS.currentWishlistObj},addItem:function(e,t=!1){wishlistJS.isProductInWishlist(e)||("G"==wishlistJS.currentWishlist(!0).userType?wishlistJS.addItemGuest(e,t):wishlistJS.addItemRegistered(e,t))},removeItem:function(e,t){wishlistJS.isProductInWishlist(e)&&("G"==wishlistJS.currentWishlist(!0).userType?wishlistJS.removeItemGuest(e,t):wishlistJS.removeItemRegistered(e,t))},addItemGuest:function(e,t){wishlistJS.currentWishlist().items.unshift(e),localStorage.setItem("guest-wishlist",JSON.stringify(wishlistJS.currentWishlist())),utagFiller.asyncAddToFavouritePDP(e),wishlistJS.currentWishlist(!0),t&&wishlistJS.loadWishListGuest()},removeItemGuest:function(e,t){let r=wishlistJS.currentWishlist().items.indexOf(e);if(wishlistJS.currentWishlist().items.splice(r,1),localStorage.setItem("guest-wishlist",JSON.stringify(wishlistJS.currentWishlist())),t){let e=$(".productListingWidget.wishlist-page").length>0;wishlistJS.addItem(t,e)}0!=wishlistJS.currentWishlist().items.length||t?wishlistJS.currentWishlist(!0):($(".empty-wishlist").removeClass("d-none"),$(".wishlist-filled").addClass("d-none"))},addItemRegistered:function(e,t){if(e){let r="storeId=10750";Array.isArray(e)?$.each(e,function(e,t){r+="&catEntryId_"+(e+1)+"="+t}):r+="&catEntryId="+e,$.ajax({url:getAbsoluteURL()+"AjaxInterestItemAdd?"+r,type:"POST",success:function(r){wishlistJS.updateRegisteredWishList(e,"add"),t&&CatalogEntryListJS.performFilter(!0),utagFiller.asyncAddToFavouritePDP(e)}})}},removeItemRegistered:function(e,t){if(e){let r="storeId=10750";Array.isArray(e)?$.each(e,function(e,t){r+="&catEntryId_"+(e+1)+"="+t}):r+="&catEntryId="+e,wishlistJS.updateRegisteredWishList(e,"remove"),0!=wishlistJS.currentWishlist().items.length||t||($(".empty-wishlist").removeClass("d-none"),$(".wishlist-filled").addClass("d-none")),$.ajax({url:getAbsoluteURL()+"AjaxInterestItemDelete?"+r,type:"POST",success:function(e){if(t){let e=$(".productListingWidget.wishlist-page").length>0;wishlistJS.addItemRegistered(t,e)}}})}},removeItemFromWishlist:function(e){let t=$(".favBtn-"+e).parents(".product.card");t.find(".product--img").css("opacity","0.5"),t.find(".product-details").addClass("d-none"),t.find(".delete-btn").addClass("d-none"),t.find(".product-remove").removeClass("d-none"),-1==wishlistJS.pendingRemove.indexOf(e)&&wishlistJS.pendingRemove.push(e),console.log("Candidate to remove -> "+wishlistJS.pendingRemove),setTimeout(function(){let r=wishlistJS.pendingRemove.indexOf(e);-1!=r&&(wishlistJS.pendingRemove.splice(r,1),wishlistJS.removeItem(e),t.parents(".single-prod").remove(),CatalogEntryListJS.createPagination(),0==$(".list-products-results").find(".single-prod").length?"G"==wishlistJS.currentWishlist(!0).userType&&wishlistJS.loadWishListGuest():CatalogEntryListJS.performFilter(!0))},5e3)},abortRemove:function(e){let t=$(".favBtn-"+e).parents(".product.card");t.find(".product--img").css("opacity","1"),t.find(".product-details").removeClass("d-none"),t.find(".delete-btn").removeClass("d-none"),t.find(".product-remove").addClass("d-none");let r=wishlistJS.pendingRemove.indexOf(e);-1!=r&&wishlistJS.pendingRemove.splice(r,1)},isProductInWishlist:function(e){return wishlistJS.currentWishlist().items.length>0&&-1!=wishlistJS.currentWishlist().items.indexOf(e)},initWishListItems:function(e=!1){if(userdataJS.userType)if("G"===userdataJS.userType)wishlistJS.initWishListItemsElab(e);else{let t=sessionStorage.getItem("registered-wishlist");null===t||void 0===typeof t||null!==t&&""===t?wishlistJS.initWishlist(e,function(){wishlistJS.initWishListItemsElab(e),wishlistJS.mergeWishList()}):wishlistJS.initWishListItemsElab(e)}},initWishListItemsElab:function(e){let t="";e&&(t=$("#product-itemId").val()||"",$("#favBtnPDP").removeClass("active"),$("#favBtnPDPMobile").removeClass("active")),$.each(wishlistJS.currentWishlist(!0).items,function(e,r){if(t==r||""==t){let e,a;t?(e=$("#favBtnPDP"),a=$("#favBtnPDPMobile")):e=$(".favBtn-"+r),e&&e.addClass("active"),a&&a.addClass("active")}})},updateRegisteredWishList:function(e,t){let r=[];Array.isArray(e)?r=e:r.push(e),$.each(r,function(e,r){if("add"==t)wishlistJS.currentWishlistObj.items.unshift(r);else{let e=wishlistJS.currentWishlistObj.items.indexOf(r);wishlistJS.currentWishlistObj.items.splice(e,1)}});let a=JSON.stringify(wishlistJS.currentWishlistObj);sessionStorage.setItem("registered-wishlist",a),wishlistJS.currentWishlist(!0)},mergeWishList:function(){if("R"==userdataJS.userType){let e=localStorage.getItem("guest-wishlist");if(e&&(wishListObj=JSON.parse(e),wishListObj.items.length>0)){let e=[];$.each(wishListObj.items,function(t,r){wishlistJS.isProductInWishlist(r)||e.push(r)}),e.length>0&&wishlistJS.addItemRegistered(e);let t={listId:"",items:[],userType:"G"};localStorage.setItem("guest-wishlist",JSON.stringify(t))}}},loadWishListGuest:function(e=!1){if(wishlistJS.currentWishlist(!0).items.length>0){e||$("#loadSpinnerProducts").removeClass("d-none");let t="";$.each(wishlistJS.currentWishlist(!0).items,function(e,r){t+=(0==t.length?"":",")+r});let r="wishlist_items="+t,a=getAbsoluteURL()+"wishlist?"+r;$.ajax({url:a,type:"POST",success:function(e){CatalogEntryListJS.updateProductListView(e,a)}}),"R"==wishlistJS.currentWishlist().userType&&$(window).width()>992&&$("#goToMyAccount").removeClass("d-none")}0==wishlistJS.currentWishlist().items.length&&($(".empty-wishlist").removeClass("d-none"),$(".wishlist-filled").addClass("d-none"),utagFiller.setOtherPage("Wishlist","Account","","Empty"))},showModal:function(e,t=!0,r){void 0!==r&&""!=r||(r=e);let a=$("#productPartNumber-"+e).val(),i=$("#productCategory-"+a).val(),o="/wishlist-preview?omitHeader=1&isModalPDP=true&isModalWishlist=true&wishlistItemId="+r+"&productId="+e+"&category="+i;$.ajax({url:o,dataType:"html",method:"GET",success:function(r){let a=jQuery(r).find("#contentWrapper").html();$("#wishlist-preview-modal .modal-body").html(a),wishlistJS.isProductInWishlist(e)?$(".pdp-sidebar-wrapper .shopperActions-wrapper #btnAddToFavourite").addClass("d-none"):$(".pdp-sidebar-wrapper .shopperActions-wrapper #btnAddToFavourite").removeClass("d-none"),t?($("#wishlist-preview-modal").modal(),utagFiller.wishlistModalPreviewPDP(e),"undefined"!=typeof productDisplayJS&&productDisplayJS.setCommonParameters(WCParamJS.langId,WCParamJS.storeId,WCParamJS.catalogId,"",WCParamJS.commandContextCurrency)):$(".product-color-picker").slick({dots:!1,infinite:!1,slidesToShow:4,slidesToScroll:1})},error:function(e){console.log("wishlist errore")}})},updateItemWishlist:function(e,t,r){wishlistJS.isProductInWishlist(e)&&(wishlistJS.removeItem(e,t),"wishlist"==r&&$("#wishlist-preview-modal").modal("hide"))}},MapRHelper={orderStatus:[{key:"COMPLETED",value:"Consegnato in negozio"},{key:"DELIVERED",value:"Consegnato in negozio"},{key:"IN PROGRESS",value:"In preparazione"},{key:"RETURN",value:"Reso in negozio"}],getCRMUserInfo:function(e=!1){return new Promise((t,r)=>{let a,i="crm_"+userdataJS.User_Id;if(sessionStorage.getItem(i)&&(a=JSON.parse(atob(sessionStorage.getItem(i)))),!a||e){let e=new Date,a=3,o=e.getFullYear()-a+"-"+(e.getMonth()+1)+"-"+e.getDate(),n="audience=order_history";n+="&orderHistoryType=RETAIL_ONLY",n+="&startDate="+o,$.ajax({url:"GetCRMUserInfo",data:n,type:"POST",success:function(e){let a=ajaxResponseToJson(e);if(a&&a.response){let e={error:!0,errorMessage:""};try{let o=atob(a.response).split("_|_");if(2==o.length){let a=o[0],n=o[1];if(userdataJS.userEmail===a){let e=JSON.parse(n),r=MapRHelper.createCRMUser(e);null==r&&((r={}).email=userEmail,r.order_list=[]),sessionStorage.setItem(i,btoa(JSON.stringify(r))),MapRHelper.enrichOrder(r),t(r)}else e.errorMessage="getCRMUserInfo, useremail not authorized",r(e)}else e.errorMessage="getCRMUserInfo, response not valid",r(e)}catch(t){e.errorMessage="getCRMUserInfo "+t,r(e)}}else rejectError.errorMessage="getCRMUserInfo uknown response: "+a,r(rejectError)},error:function(e,t){r(t)}})}else MapRHelper.enrichOrder(a),t(a)})},createCRMUser:function(e){if(e.event_list.length>0){let t=e.event_list,r={};return r.email=t[0].profile_id.email,r.order_list=[],$.each(t,function(e,t){try{let e=MapRHelper.createOrder(t.transaction);e.orderItems.length>0&&(e.storeInfo=t.store,e.event_date=t.event_date,e.orderDate=new Date(e.event_date).toShortFormat(),e.event_type=t.event_type,e.channel=t.channel,r.order_list.push(e))}catch(e){console.log("Error parsing retail order "+e)}}),r}return null},createOrder:function(e){let t=e;if(e.line_items.length>0){let r=e.line_items;t.orderType="retail",t.type=r[0].line_item_type,t.orderItems=[],t.services=[],t.other=[];let a=!1,i=!1,o=null,n=null,s=[];$.each(r,function(e,r){try{let e=MapRHelper.enrichOrderItem(r);switch(e.isCompletePair=!1,e.product_classification.commodity){case"Frames":case"Sunglasses":case"Contacts":case"Accessories":case"Manufacturing Service":"Frames"==e.product_classification.commodity&&(a=!0,n=e),t.orderItems.push(e);break;case"Store Services":"Lens Packages"==e.product_classification.branddescription?(s.push(e),o=e,i=!0):t.services.push(e);break;default:t.other.push(e)}}catch(e){console.log("Error parsing retail orderItem for order "+t.order_id+" -> "+e)}}),a&&i&&null!=n&&null!=o?(n.isCompletePair=!0,n.lensInfo=o,$.each(s,function(e,r){n.lensInfo.upc!=r.upc&&t.orderItems.push(r)})):$.each(s,function(e,r){t.orderItems.push(r)}),t.hasOrderItems=t.orderItems.length>0,t.hasServices=t.services.length>0,t.total_tender_value=Number(t.total_tender_value).toFixed(2).replace(".",",");let l=t.tender_details.payment_methods_used.length;t.paymentUsed=t.tender_details.payment_card_type||t.tender_details.payment_methods_used[l-1]}if(t.status="Sconosciuto",null!=t.salesorder_status_details){t.statusRaw=t.salesorder_status_details.order_status;let e=t.statusRaw;"RETURN"==t.type&&(e="RETURN",t.return_total_tender_value=t.total_tender_value.replace("-","").trim()),"DELIVERED"!=e&&"COMPLETED"!=e||(t.orderDeliveredInStore=!0);let r=MapRHelper.orderStatus.filter(t=>t.key==e);r.length>0&&(t.status=r[0].value)}return t},enrichOrderItem:function(e){let t=e;return t.orderItemType=t.product_classification.commodity,"Manufacturing Service"==t.orderItemType&&t.product_info&&t.product_info.productType?(t.orderItemType=t.product_info.productType,t.isAccessoryCL=!0):t.product_info||(t.product_info={}),t.isCustom=t.product_classification.isCustom,t.getQuantity=function(){return t.quantity},t.checkImageTypeAvailable=function(e){return!!this.product_pictures&&this.product_pictures.pictures_flags.indexOf(e)>-1},t.getImage=function(e,t="_default"){if(this.isFallbackImg=!1,this.product_pictures){let r=this.product_pictures.pictures[e];if("Degree"==e&&(t=Number(t).toFixed(1)),r&&r[t])return"https://assets2.salmoiraghievigano.it"+r[t][0]}else if(this.additional_info){let e=this.getAdditionalInfoAttr("Moco");if(e)return"https://assets.salmoiraghievigano.it/extra/image/salmoiraghivigano/products/"+(e=e.replaceAll("&","e").replaceAll(" ","_"))+"_shad_fr.png?impolicy=SV_PDP_CL";if("Frames"==this.orderItemType||"Sunglasses"==this.orderItemType){return"https://assets.salmoiraghievigano.it/is/image/salmoiraghivigano/"+this.additional_info.upc+"__001.png?impolicy=SV_PDP_CL"}}return"Frames"==this.orderItemType||"Sunglasses"==this.orderItemType?(this.isFallbackImg=!0,"https://media.salmoiraghievigano.it/MyAccount/frames_generic.png"):"Contacts"==this.orderItemType?(this.isFallbackImg=!0,"https://media.salmoiraghievigano.it/MyAccount/lens_generic.png"):"Accessories"==this.orderItemType?"Accessories Eyewear"==this.product_classification.category?(this.isFallbackImg=!0,"https://media.salmoiraghievigano.it/MyAccount/frames_generic.png"):(this.isFallbackImg=!0,"https://media.salmoiraghievigano.it/MyAccount/accessories_generic.png"):null},t.displayImage=t.getImage("Catalog image"),t},enrichOrder:function(e){$.each(e.order_list,function(e,t){$.each(t.orderItems,function(e,t){MapRHelper.enrichOrderItem(t)})}),e.getOrder=function(e){return new Promise((t,r)=>{let a=this.order_list.filter(t=>t.order_id==e);if(a.length>0){let e=a[0],i=[];return $.each(e.orderItems,function(e,t){i.push(t.upc)}),$.ajax({url:"/webapp/wcs/stores/servlet/ProductInfoGetterView?storeId=10750&upc="+i.join(","),type:"GET",success:function(r){let a=JSON.parse(r);$.each(e.orderItems,function(e,t){let r=a.filter(e=>e.upc==t.upc);r.length>0&&(t.additional_info=r[0]),t.getAdditionalInfoAttr=function(e){if(!t.additional_info)return null;{let r=t.additional_info.attributes.filter(t=>t.name==e);if(r.length>0)return r[0].value}}}),t(e)},error:function(e,t){r(t)}}),a[0]}t(null)})}},getAdditionalInfo:function(e){return new Promise((t,r)=>{e?$.ajax({url:"/webapp/wcs/stores/servlet/ProductInfoGetterView?storeId=10750&upc="+e.join(","),type:"GET",success:function(e){let r=JSON.parse(e);t(r)},error:function(e,t){r(t)}}):t(null)})}},MyAccount={userOrdersListApp:null,userSubscriptionsApp:null,userReorderApp:null,pageSize:50,initReorder:function(){MyAccount.initVueReorderApp("#reorder-cl-user-hover",!0),$("#reorder-cl-user").length>0&&MyAccount.initVueReorderApp("#reorder-cl-user",!1),MyAccount.getCLOrderList().then(function(e){e&&e.length>0&&(MyAccount.userReorderHoverApp&&(MyAccount.userReorderHoverApp.lastOrderCL=MyAccount.parseUserReorder(e[0]),MyAccount.userReorderHoverApp.lastOrderLoaded=!0),MyAccount.userReorderApp&&(MyAccount.userReorderApp.lastOrderCL=MyAccount.parseUserReorder(e[0]),MyAccount.userReorderApp.lastOrderLoaded=!0))}).catch(function(e){console.log(e.errorMessage)})},getCLOrderList:function(e=!1){return new Promise((t,r)=>{let a,i="contact_"+userdataJS.User_Id;if(sessionStorage.getItem(i)&&(a=JSON.parse(atob(sessionStorage.getItem(i)))),!a||e){let e=WCParamJS.storeId,a=WCParamJS.langId,o=sessionStorage.getItem("userData"),n="";if("undefined"!=o){n=JSON.parse(o).userId}let s="storeId="+e+"&langId="+a+"&userId="+n+"&pageSize="+MyAccount.pageSize+"&pageNumber=1&productType=contact&encoding=true",l={error:!0,errorMessage:""};$.ajax({url:"GetOrderListView?"+s+"&tm="+(new Date).getTime(),data:s,type:"GET",success:function(e){let a=ajaxResponseToJson(e);if(a&&a.response)try{sessionStorage.setItem(i,a.response);let e=atob(a.response);e=JSON.parse(e),MyAccount.enrichOrderListOnline(e),t(e)}catch(e){l.errorMessage="getCLOrderList "+e,r(l)}else l.errorMessage="getCLOrderList unknown response: "+a,r(l)},error:function(e,t){r(t)}})}else MyAccount.enrichOrderListOnline(a),t(a)})},init:function(){MyAccount.initOrderView(),$('.filter-order .card-body input[type="checkbox"]').change(function(){var e=$(this).val();MyAccount.userOrdersListApp.toggleCommodity(e);var t=MyAccount.userOrdersListApp.getCountCommoditySelected();$(".filter-order .filter-title span").text("("+t+")"),$("#spn-filter-count").text("("+t+")")}),$("#btn-filter-list").click(function(){"online"==MyAccount.userOrdersListApp.tabSelected?MyAccount.userOrdersListApp.filterByCommodity(MyAccount.userOrdersListApp.onlineCommoditiesSelected):MyAccount.userOrdersListApp.filterByCommodity(MyAccount.userOrdersListApp.retailCommoditiesSelected),MyAccount.closeFilterColumnOrders(),$(".icon-close").click()}),$(window).width()>900&&($(".filter-toggle").on("click",function(){$(this).toggleClass("open"),$(".filter-orders-modal").toggleClass("open"),$("html").addClass("modal-open"),$(".filter-orders-modal").modal()}),$(".filter-orders-modal").on("show.bs.modal",function(e){setTimeout(function(){$(".modal-backdrop").attr("onclick","MyAccount.closeFilterColumnOrders()")})}),$(".modal-backdrop").on("click",function(){$(this).hasClass("modal-backdrop--filters")&&MyAccount.closeFilterColumnOrders()})),$(window).width()<900&&$(".filter-toggle").on("click",function(){$(".filter-orders-modal").addClass("filter-orders-modal"),$("html").addClass("modal-open"),$(".filter-orders-modal").modal(),$(".modal-backdrop").hide()})},closeFilterColumnOrders:function(){closeFilterColumn(),$("html").removeClass("modal-open")},initEditProfile:function(){$(".success-edit-profile-toast").length>0&&setTimeout(function(){closeEditProfileToast()},5e3)},initOrderView:function(){$(".toggle-order button").click(function(){$(this).hasClass("active")||($(this).addClass("active").siblings().removeClass("active"),$(this).hasClass("toggle-order-store")?($(".online-orders").addClass("d-none"),$(".online-orders").removeClass("d-flex"),$(".store-orders").addClass("d-flex"),$(".store-orders").removeClass("d-none"),MyAccount.userOrdersListApp.retailLoaded||(MyAccount.userOrdersListApp.loadingRetailOrders=!0,MapRHelper.getCRMUserInfo().then(function(e){MyAccount.userOrdersListApp.retailOrdersList=MyAccount.userOrdersListApp.retailFilteredOrdersList=e.order_list,MyAccount.userOrdersListApp.retailLoaded=!0,MyAccount.userOrdersListApp.loadingRetailOrders=!1;let t=[];$.each(e.order_list,function(e,r){$.each(r.orderItems,function(e,r){t.push(r.upc)})}),MapRHelper.getAdditionalInfo(t).then(function(e){$.each(MyAccount.userOrdersListApp.retailFilteredOrdersList,function(t,r){$.each(r.orderItems,function(t,r){let a=e.filter(e=>e.upc==r.upc);r.getAdditionalInfoAttr=function(e){if(!r.additional_info)return null;{let t=r.additional_info.attributes.filter(t=>t.name==e);if(t.length>0)return t[0].value}},a.length>0&&(r.additional_info=a[0],r.displayImage=r.getImage("Catalog image"))})})})}).catch(function(e){MyAccount.userOrdersListApp.loadingRetailOrders=!1,console.log(e.errorMessage)})),MyAccount.userOrdersListApp.tabSelected="retail"):($(".store-orders").removeClass("d-flex"),$(".store-orders").addClass("d-none"),$(".online-orders").removeClass("d-none"),$(".online-orders").addClass("d-flex"),MyAccount.userOrdersListApp.tabSelected="online"),MyAccount.reInitProductFilters())}),$("#product-sort-by").click(function(){var e=$(".select-options");"none"===e.css("display")?e.css("display","block"):e.css("display","none")}),MyAccount.initVueApp(),MyAccount.userOrdersListApp.loadingOnlineOrders=!0,MyAccount.getOnlineOrderList().then(function(e){MyAccount.userOrdersListApp.onlineOrdersList=MyAccount.userOrdersListApp.onlineFilteredOrdersList=e,MyAccount.userOrdersListApp.loadingOnlineOrders=!1}),GetURLParameter("retailTab")&&$(".toggle-order button").click(),MyAccount.initProductSort(),MyAccount.initProductFilters()},initSubscriptions:function(){MyAccount.userSubscriptionsApp=appUserSubscriptions.mount("#subscription-list"),MyAccount.getOnlineOrderList(!0).then(function(e){MyAccount.userSubscriptionsApp.subscriptionsList=e,MyAccount.userSubscriptionsApp.loadingSubscriptions=!1})},initPaymentDetail:function(){$(".custom-radio .custom-control-input").each(function(){"addresspayment"!==$(this).attr("id")&&$(this).click(function(e){$("#WC_MyAccountQuickCheckoutProfileForm_inputs_billing").val($(this).val())})}),$(".modify-address").each(function(){$(this).click(function(e){e.preventDefault(),paymentaddressJS.modifyAddress($(this))})}),$(".cancel-modify-address").each(function(){$(this).click(function(e){e.preventDefault(),paymentaddressJS.cancelModifyAddress()})}),$("#btn-add-payment-address").click(function(e){e.preventDefault(),paymentaddressJS.prepareAddAddress()})},initVueReorderApp:function(e,t){t?MyAccount.userReorderHoverApp=appUserReorderHover.mount(e):MyAccount.userReorderApp=appUserReorder.mount(e)},initVueApp:function(){MyAccount.userOrdersListApp=appStoreOrders.mount("#user_orders_list")},initVueOrderDetailApp:function(e){let t;MyAccount.storeOrderDetailApp=appStoreOrderDetails.mount("#order-details-container"),"online"==e?(t=GetURLParameter("orderId"))&&MyAccount.getOnlineOrderDetails(t).then(function(e){MyAccount.storeOrderDetailApp.currentOrder=e}):(t=GetURLParameter("retailOrder"),MapRHelper.getCRMUserInfo().then(function(e){return e.getOrder(t)}).then(function(e){MyAccount.storeOrderDetailApp.currentOrder=e}))},getOnlineOrderList:function(e=!1,t=1){let r=WCParamJS.storeId,a=WCParamJS.langId,i=sessionStorage.getItem("userData"),o="";if("undefined"!=i){o=JSON.parse(i).userId}let n="storeId="+r+"&langId="+a+"&userId="+o+"&pageSize="+MyAccount.pageSize+"&pageNumber="+t;return e&&(n+="&isRecurring=true"),new Promise((e,t)=>{$.ajax({url:"GetOrderListView?"+n+"&tm="+(new Date).getTime(),type:"GET",success:function(r){let a=ajaxResponseToJson(r);MyAccount.enrichOrderListOnline(a),a?e(a):t(a)},error:function(e,r){t(r)}})})},getOnlineOrderDetails:function(e){return new Promise((t,r)=>{let a=GetURLParameter("storeId"),i=GetURLParameter("langId");$.ajax({url:"GetOrderDetailsView?storeId="+a+"&langId="+i+"&orderId="+e+"&tm="+(new Date).getTime(),type:"GET",success:function(e){let a=ajaxResponseToJson(e);if(a){let e=MyAccount.parseOnlineOrderDetails(a);t(e)}else r(a)},error:function(e,t){r(t)}})})},parseOnlineOrderDetails:function(e){let t={};if(t.sourceData=e,t.order_id=e.orderId,t.orderDate=e.placeDateIT,t.orderType="online",t.status=e.orderStatusLabel||e.orderStatus,t.statusRaw=e.orderStatus,t.orderItems=e.orderItem,t.shipType=e.orderItem[0].shipModeCode,t.isRecurring=e.isRecurring,t.isRefillOrder=e.isRefillOrder,t.isRecurring){switch(t.subscriptionState=e.subscriptionState,t.subscriptionInfo=e.subscriptionInfo,t.subscriptionState){case"Active":t.status="In preparazione";break;case"Suspended":case"OnHold":t.status="Sospeso";break;case"Canceled":t.status="Cancellato"}t.subscriptionNextRefill=e.subscriptionNextRefill,t.subscriptionNextRefillLabel=e.subscriptionNextRefillLabel,t.subscriptionFrequency=e.subscriptionFrequency,t.subscriptionFrequencyValue=e.subscriptionFrequencyValue,t.subscriptionId=e.subscriptionId,t.subscriptionInfo.subscriptionParentOrderId=e.subscriptionParentOrderId}if("PickupInStoreSV"==t.shipType){let e=t.sourceData.orderExtendAttribute.filter(e=>e.attributeName.includes("Store")),r={};$.each(e,function(e,t){switch(t.attributeName){case"StoreName":r.store_name=t.attributeValue;break;case"StoreNumber":r.store_number=t.attributeValue;break;case"StoreInfo":let e=t.attributeValue.split("|");if(e.length=4){let t=e[0].split(",");r.address=t[0],t.length>1&&(r.postal_code=t[1]);let a=e[1].substring(0,e[1].indexOf("(")).trim(),i=e[1].substring(e[1].indexOf("(")+1,e[1].indexOf(")")).trim();r.city=a,r.state_province=i,r.phone=e[2];let o=e[3].split(",");2==o.length&&(r.latitude=o[0],r.longitude=o[1])}}}),t.storeInfo=r}t.orderDeliveredInStore=e.orderDeliveredInStore,t.orderDelivered=e.orderDelivered,t.orderShipped=e.orderShipped,t.hasContactLens=e.hasContactLens,t.shipDate=e.shipDate,$.each(e.paymentInstruction,function(e,r){let a=r.protocolData.filter(e=>"paymentType"==e.name);if(a.length>0){if("SV_GFT"==a[0].value){t.giftCardInfo={};let e=r.protocolData.filter(e=>"giftCardNumber"==e.name);t.giftCardInfo.giftNumber=e.length>0?e[0].value:"";let a=r.protocolData.filter(e=>"giftCardTransId"==e.name);t.giftCardInfo.transaction_id=a.length>0?a[0].value:"",t.giftCardInfo.amount=Number(r.piAmount).toFixed(2);let i=r.protocolData.filter(e=>"billto_firstname"==e.name);t.giftCardInfo.firstName=i.length>0?i[0].value:"";let o=r.protocolData.filter(e=>"billto_lastname"==e.name);t.giftCardInfo.lastName=o.length>0?o[0].value:"";let n=r.protocolData.filter(e=>"billTo_street1"==e.name);t.giftCardInfo.address=n.length>0?n[0].value:"";let s=r.protocolData.filter(e=>"billTo_state"==e.name);t.giftCardInfo.state=s.length>0?s[0].value:"";let l=r.protocolData.filter(e=>"billto_city"==e.name);t.giftCardInfo.city=l.length>0?l[0].value:"";let d=r.protocolData.filter(e=>"billTo_postalCode"==e.name);t.giftCardInfo.zipCode=d.length>0?d[0].value:""}else{t.paymentInfo=r;let e=t.paymentInfo.protocolData.filter(e=>"paymentType"==e.name);t.paymentInfo.paymentType=e.length>0?e[0].value:"";let a=t.paymentInfo.protocolData.filter(e=>"cc_brand"==e.name);t.paymentInfo.cardBrand=a.length>0?a[0].value:"";let i=t.paymentInfo.protocolData.filter(e=>"temp_account"==e.name);t.paymentInfo.cardLastDigits=i.length>0?i[0].value:"";let o=t.paymentInfo.protocolData.filter(e=>"recurringSubscriptionInfo_subscriptionID"==e.name);t.paymentInfo.recurringSubscriptionId=o.length>0?o[0].value:"";let n=t.paymentInfo.protocolData.filter(e=>"expire_month"==e.name),s=n.length>0?n[0].value:"",l=t.paymentInfo.protocolData.filter(e=>"expire_year"==e.name),d=l.length>0?l[0].value:"";t.paymentInfo.cardExpiration=s+"/"+d;let c=new Date,u=c.getMonth()+1,p=c.getFullYear();t.paymentInfo.cardExpired=!1,(d==p&&s<u||d<p)&&(t.paymentInfo.cardExpired=!0)}}}),t.shippingInfo={},t.shippingInfo.addressId=e.orderItem[0].addressId,t.shippingInfo.nickName=e.orderItem[0].nickName,t.shippingInfo.firstName=e.orderItem[0].firstName,t.shippingInfo.lastName=e.orderItem[0].lastName,t.shippingInfo.city=e.orderItem[0].city,t.shippingInfo.addressLine=e.orderItem[0].addressLine,t.shippingInfo.state=e.orderItem[0].state,t.shippingInfo.zipCode=e.orderItem[0].zipCode;let r=e.grandTotal;return t.giftCardInfo&&(r-=t.giftCardInfo.amount),t.subtotal=Number(e.totalProductPrice).toFixed(2),t.subtotalLabel=Number(t.subtotal).toFixed(2).replace(".",","),t.total=Number(r).toFixed(2),t.totalLabel=Number(r).toFixed(2).replace(".",","),t.getDiscount=function(){let e=0;if(t.sourceData.adjustment){let r=t.sourceData.adjustment.filter(e=>"Discount"==e.usage);$.each(r,function(t,r){e+=Number(r.amount)})}return e},t.totalAdjustment=Number(t.getDiscount()).toFixed(2),t.totalAdjustmentLabel=Number(-1*t.totalAdjustment).toFixed(2).replace(".",","),t.discountPercentage=Number(100*t.totalAdjustment/t.subtotal).toFixed(0),$.each(t.orderItems,function(e,t){if(t.manufacturer=t.catalogEntryDetail.manufacturer,t.quantity=Number(t.quantity),t.getNameLabel=function(){let e="";switch(t.orderItemType){case"Frames":case"Sunglasses":e=t.getAttribute("BRAND")+" "+t.getAttribute("MODEL_NAME");break;case"ContactLens":case"Accessories":e=t.isAccessory&&t.isAccessoryCL?t.getAttribute("BRAND")+" "+t.getAttribute("MODEL_NAME"):t.catalogEntryDetail.name}return e},t.getAttribute=function(e){let r=t.catalogEntryDetail.attributes.filter(t=>t.identifier==e);return r.length>0?r[0].values[0].value:""},t.getImage=function(e){let r="";switch(t.orderItemType){case"Frames":case"Sunglasses":r="https://assets.salmoiraghievigano.it/is/image/salmoiraghivigano/"+t.catalogEntryDetail.partNumber+"__001.png?impolicy=SV_PDP_CL";break;case"ContactLens":case"Accessories":let e=t.catalogEntryDetail.mfPartNumber_ntk;e||(e=t.getAttribute("MODEL_NAME")),e||(e=t.catalogEntryDetail.partNumber),r="https://assets.salmoiraghievigano.it/extra/image/salmoiraghivigano/products/"+(e=e.replaceAll("&","e").replaceAll(" ","_"))+"_shad_fr.png?impolicy=SV_PDP_CL"}return r},"ContactLens"==t.orderItemType){switch(t.getAttribute("ContactLens_type")){case"1 Giorno":t.frequency="Giornaliere";break;case"2 Settimane":t.frequency="Quindicinali";break;case"1 Mese":t.frequency="Mensili";break;default:t.frequency=""}}t.getQuantity=function(){let e=0;return"ContactLens"==t.orderItemType?(""!=t.rightLensInfo&&(e+=Number(t.rightLensInfo.quantity)),""!=t.leftLensInfo&&(e+=Number(t.leftLensInfo.quantity))):e=t.quantity,e},t.getDiscount=function(){let e=0;if(t.adjustment){let r=t.adjustment.filter(e=>"Discount"==e.usage);$.each(r,function(t,r){e+=Number(r.amount)})}return e},t.fullPrice=Number(t.orderItemPrice),t.price=Number(t.orderItemPrice)+t.getDiscount(),t.fullPriceFormatted=t.fullPrice.toFixed(2).replace(".",","),t.priceFormatted=t.price.toFixed(2).replace(".",",")}),t},enrichOrderListOnline:function(e){$.each(e,function(e,t){if(t.paymentInstruction&&t.paymentInstruction.length>0){let e=t.paymentInstruction[0].protocolData.filter(e=>"paymentType"==e.name);t.paymentInstruction[0].paymentType=e.length>0?e[0].value:"";let r=t.paymentInstruction[0].protocolData.filter(e=>"cc_brand"==e.name);t.paymentInstruction[0].cardBrand=r.length>0?r[0].value:"";let a=t.paymentInstruction[0].protocolData.filter(e=>"temp_account"==e.name);t.paymentInstruction[0].cardLastDigits=a.length>0?a[0].value:"";let i=t.paymentInstruction[0].protocolData.filter(e=>"recurringSubscriptionInfo_subscriptionID"==e.name);t.paymentInstruction[0].recurringSubscriptionId=t.length>0?i[0].value:"";let o=t.paymentInstruction[0].protocolData.filter(e=>"expire_month"==e.name),n=o.length>0?o[0].value:"",s=t.paymentInstruction[0].protocolData.filter(e=>"expire_year"==e.name),l=s.length>0?s[0].value:"";t.paymentInstruction[0].cardExpiration=n+"/"+l;let d=new Date,c=d.getMonth()+1,u=d.getFullYear();t.paymentInstruction[0].cardExpired=!1,(l==u&&n<c||l<u)&&(t.paymentInstruction[0].cardExpired=!0)}if($.each(t.orderItemsMerged,function(e,t){if(t.manufacturer=t.catalogEntryDetail.manufacturer,t.getAttribute=function(e){let r=t.catalogEntryDetail.attributes.filter(t=>t.identifier==e);return r.length>0?r[0].values[0].value:""},"Contacts"==t.orderItemType){switch(t.getAttribute("ContactLens_type")){case"1 Giorno":t.frequency="Giornaliere";break;case"2 Settimane":t.frequency="Quindicinali";break;case"1 Mese":t.frequency="Mensili";break;default:t.frequency=""}}t.getNameLabel=function(){let e="";switch(t.orderItemType){case"Frames":case"Sunglasses":case"Readers":e=t.getAttribute("BRAND")+" "+t.getAttribute("MODEL_NAME");break;case"Contacts":case"Accessories":e=t.isAccessory&&t.isAccessoryCL?t.getAttribute("BRAND")+" "+t.getAttribute("MODEL_NAME"):t.catalogEntryDetail.name}return e}}),"PickupInStoreSV"==t.shipType){let e=t.orderExtendAttribute.filter(e=>e.attributeName.includes("Store")),r={};$.each(e,function(e,t){switch(t.attributeName){case"StoreName":r.store_name=t.attributeValue;break;case"StoreNumber":r.store_number=t.attributeValue;break;case"StoreInfo":let e=t.attributeValue.split("|");if(e.length=4){let t=e[0].split(",");r.address=t[0],t.length>1&&(r.postal_code=t[1]);let a=e[1].substring(0,e[1].indexOf("(")).trim(),i=e[1].substring(e[1].indexOf("(")+1,e[1].indexOf(")")).trim();r.city=a,r.state_province=i,r.phone=e[2];let o=e[3].split(",");2==o.length&&(r.latitude=o[0],r.longitude=o[1])}}}),t.storeInfo=r}})},parseUserReorder:function(e){return $.each(e.orderItemsMerged,function(t,r){if(r.isContactLenses)return e.orderItemReorder=r,e}),e},initProductSort:function(){$("#product-sort-by div.select ul li").each(function(){var e=$(this).attr("rel");if(-1==e)$(this).remove();else{var t="MyAccount.userOrdersListApp.setOrder("+("asc"==e)+")";$(this).attr("onclick",t)}})},initProductFilters:function(){$(".filter-order .filter-title span").text("(0)"),$("#spn-filter-count").text("(0)"),MyAccount.userOrdersListApp.resetSelection(),$('.filter-order .card-body input[type="checkbox"]').prop("checked",!1)},reInitProductFilters:function(){$('.filter-order .card-body input[type="checkbox"]').prop("checked",!1),$('.filter-order .card-body input[type="checkbox"]').each(function(){let e=MyAccount.userOrdersListApp.isCommoditySelected($(this).val());$(this).prop("checked",e)});var e=MyAccount.userOrdersListApp.getCountCommoditySelected();$(".filter-order .filter-title span").text("("+e+")"),$("#spn-filter-count").text("("+e+")")}},jQuery.extend(ContactUsHelper,{messageOK1:"Grazie!",messageOK2:"Il tua richiesta è stata presa in carico.",messageKO1:"Errore",messageKO2:"Il tua richiesta non è stata presa in carico.",init:function(){console.log("ContactUsHelper init"),this.prepareOnSubmit(),this.prepareSelect("shop1","api"),this.prepareSelect("request1","api"),$.validator.methods.email=function(e,t){return this.optional(t)||/^[a-zA-Z0-9._\+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e)}},init_legacy:function(){console.log("ContactUsHelper init legacy"),this.prepareSelect("shop1"),this.prepareSelect("request1")},prepareOnSubmit:function(){$("#contact-form-cs").on("submit",function(e){e.preventDefault(),$("#contact-form-cs").valid()&&(console.log("prepareOnSubmit - invoke postContactUSCS"),ContactUsHelper.postContactUSCS())})},prepareSelect:function(e,t="form"){var r=null,a="/wcsstore/SalmoiraghiStorefrontAssetStore/javascript/contactus/select_"+t+"_"+e+".json";$.ajax({url:a,type:"GET",success:function(a){if(a&&(r=JSON.parse(a))){var i=$("#"+e);if("form"==t||"api"==t&&"shop1"==e)$.each(r,function(e,t){i.append($("<option>",{value:t}).text(t))});else for(var o in r)if(r.hasOwnProperty(o)){var n=r[o],s=$("<option>",{value:n.label}).appendTo(i);s.text(n.label),s.attr("support-type",n["support-type"]),s.attr("inquiry-type",n["inquiry-type"])}initSelectCustom(e)}}})},postContactUSCS:function(){var e=ContactUsHelper;let t=ContactUsHelper.convertFormToJSON("#contact-form-cs");t?$.ajax({type:"POST",url:"ContactUSCS",data:t,success:function(t){console.log(t);let r=ajaxResponseToJson(t);if(r&&r.response){r.response.success?(console.log("success!"),$("#message-text1").text(e.messageOK1),$("#message-text2").text(e.messageOK2),$("#submitFormPopup").modal("show")):(console.log("errore chiamata!"),ContactUsHelper.postError())}else console.log("errore chiamata!"),ContactUsHelper.postError()},error:function(e,t){console.log(t),ContactUsHelper.postError()}}):ContactUsHelper.postError()},postError:function(){var e=ContactUsHelper;$("#message-text1").text(e.messageKO1),$("#message-text2").text(e.messageKO2),$("#submitFormPopup").modal("show")},convertFormToJSON:function(e){let t=$("#firstName").val(),r=$("#lastName").val(),a=$("#phone1").val(),i=$("#email1").val();$("#request1").val();var o=$("#request1").find("option:selected");let n=o.attr("support-type"),s=o.attr("inquiry-type");return{customerFirstname:t,customerLastname:r,customerMobile:a,customerEmail:i,store:$("#shop1").val(),orderNumber:$("#orderid").val(),notes:$("#txtMessage1").val(),policynotice:$("#policynotice").val(),supportType:n,inquiryType:s}}});
